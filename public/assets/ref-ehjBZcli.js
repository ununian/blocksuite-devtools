import{c as C,J as Sn,D as ct,z as R,g as q,a4 as yt,a8 as Qt,x as X,I as En,F as Cn,a9 as Rn,aa as Me,ab as Ne,ac as Tn,T as z,a1 as mt,a3 as Be}from"./static-yoecXErL.js";var we={exports:{}};we.exports;(function(s){var e=function(){var t=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function o(a,c){if(!r[a]){r[a]={};for(var d=0;d<a.length;d++)r[a][a.charAt(d)]=d}return r[a][c]}var l={compressToBase64:function(a){if(a==null)return"";var c=l._compress(a,6,function(d){return n.charAt(d)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(a){return a==null?"":a==""?null:l._decompress(a.length,32,function(c){return o(n,a.charAt(c))})},compressToUTF16:function(a){return a==null?"":l._compress(a,15,function(c){return t(c+32)})+" "},decompressFromUTF16:function(a){return a==null?"":a==""?null:l._decompress(a.length,16384,function(c){return a.charCodeAt(c)-32})},compressToUint8Array:function(a){for(var c=l.compress(a),d=new Uint8Array(c.length*2),h=0,u=c.length;h<u;h++){var f=c.charCodeAt(h);d[h*2]=f>>>8,d[h*2+1]=f%256}return d},decompressFromUint8Array:function(a){if(a==null)return l.decompress(a);for(var c=new Array(a.length/2),d=0,h=c.length;d<h;d++)c[d]=a[d*2]*256+a[d*2+1];var u=[];return c.forEach(function(f){u.push(t(f))}),l.decompress(u.join(""))},compressToEncodedURIComponent:function(a){return a==null?"":l._compress(a,6,function(c){return i.charAt(c)})},decompressFromEncodedURIComponent:function(a){return a==null?"":a==""?null:(a=a.replace(/ /g,"+"),l._decompress(a.length,32,function(c){return o(i,a.charAt(c))}))},compress:function(a){return l._compress(a,16,function(c){return t(c)})},_compress:function(a,c,d){if(a==null)return"";var h,u,f={},p={},m="",y="",v="",x=2,_=3,E=2,b=[],g=0,w=0,S;for(S=0;S<a.length;S+=1)if(m=a.charAt(S),Object.prototype.hasOwnProperty.call(f,m)||(f[m]=_++,p[m]=!0),y=v+m,Object.prototype.hasOwnProperty.call(f,y))v=y;else{if(Object.prototype.hasOwnProperty.call(p,v)){if(v.charCodeAt(0)<256){for(h=0;h<E;h++)g=g<<1,w==c-1?(w=0,b.push(d(g)),g=0):w++;for(u=v.charCodeAt(0),h=0;h<8;h++)g=g<<1|u&1,w==c-1?(w=0,b.push(d(g)),g=0):w++,u=u>>1}else{for(u=1,h=0;h<E;h++)g=g<<1|u,w==c-1?(w=0,b.push(d(g)),g=0):w++,u=0;for(u=v.charCodeAt(0),h=0;h<16;h++)g=g<<1|u&1,w==c-1?(w=0,b.push(d(g)),g=0):w++,u=u>>1}x--,x==0&&(x=Math.pow(2,E),E++),delete p[v]}else for(u=f[v],h=0;h<E;h++)g=g<<1|u&1,w==c-1?(w=0,b.push(d(g)),g=0):w++,u=u>>1;x--,x==0&&(x=Math.pow(2,E),E++),f[y]=_++,v=String(m)}if(v!==""){if(Object.prototype.hasOwnProperty.call(p,v)){if(v.charCodeAt(0)<256){for(h=0;h<E;h++)g=g<<1,w==c-1?(w=0,b.push(d(g)),g=0):w++;for(u=v.charCodeAt(0),h=0;h<8;h++)g=g<<1|u&1,w==c-1?(w=0,b.push(d(g)),g=0):w++,u=u>>1}else{for(u=1,h=0;h<E;h++)g=g<<1|u,w==c-1?(w=0,b.push(d(g)),g=0):w++,u=0;for(u=v.charCodeAt(0),h=0;h<16;h++)g=g<<1|u&1,w==c-1?(w=0,b.push(d(g)),g=0):w++,u=u>>1}x--,x==0&&(x=Math.pow(2,E),E++),delete p[v]}else for(u=f[v],h=0;h<E;h++)g=g<<1|u&1,w==c-1?(w=0,b.push(d(g)),g=0):w++,u=u>>1;x--,x==0&&(x=Math.pow(2,E),E++)}for(u=2,h=0;h<E;h++)g=g<<1|u&1,w==c-1?(w=0,b.push(d(g)),g=0):w++,u=u>>1;for(;;)if(g=g<<1,w==c-1){b.push(d(g));break}else w++;return b.join("")},decompress:function(a){return a==null?"":a==""?null:l._decompress(a.length,32768,function(c){return a.charCodeAt(c)})},_decompress:function(a,c,d){var h=[],u=4,f=4,p=3,m="",y=[],v,x,_,E,b,g,w,S={val:d(0),position:c,index:1};for(v=0;v<3;v+=1)h[v]=v;for(_=0,b=Math.pow(2,2),g=1;g!=b;)E=S.val&S.position,S.position>>=1,S.position==0&&(S.position=c,S.val=d(S.index++)),_|=(E>0?1:0)*g,g<<=1;switch(_){case 0:for(_=0,b=Math.pow(2,8),g=1;g!=b;)E=S.val&S.position,S.position>>=1,S.position==0&&(S.position=c,S.val=d(S.index++)),_|=(E>0?1:0)*g,g<<=1;w=t(_);break;case 1:for(_=0,b=Math.pow(2,16),g=1;g!=b;)E=S.val&S.position,S.position>>=1,S.position==0&&(S.position=c,S.val=d(S.index++)),_|=(E>0?1:0)*g,g<<=1;w=t(_);break;case 2:return""}for(h[3]=w,x=w,y.push(w);;){if(S.index>a)return"";for(_=0,b=Math.pow(2,p),g=1;g!=b;)E=S.val&S.position,S.position>>=1,S.position==0&&(S.position=c,S.val=d(S.index++)),_|=(E>0?1:0)*g,g<<=1;switch(w=_){case 0:for(_=0,b=Math.pow(2,8),g=1;g!=b;)E=S.val&S.position,S.position>>=1,S.position==0&&(S.position=c,S.val=d(S.index++)),_|=(E>0?1:0)*g,g<<=1;h[f++]=t(_),w=f-1,u--;break;case 1:for(_=0,b=Math.pow(2,16),g=1;g!=b;)E=S.val&S.position,S.position>>=1,S.position==0&&(S.position=c,S.val=d(S.index++)),_|=(E>0?1:0)*g,g<<=1;h[f++]=t(_),w=f-1,u--;break;case 2:return y.join("")}if(u==0&&(u=Math.pow(2,p),p++),h[w])m=h[w];else if(w===f)m=x+x.charAt(0);else return null;y.push(m),h[f++]=x+m.charAt(0),u--,x=m,u==0&&(u=Math.pow(2,p),p++)}}};return l}();s!=null?s.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(we);var Le=we.exports;class An{constructor(e){this.std=e,this._jobMiddlewares=[],this._adapterMap=new Map,this.use=t=>{this._jobMiddlewares.push(t)},this.unuse=t=>{this._jobMiddlewares=this._jobMiddlewares.filter(n=>n!==t)},this.registerAdapter=(t,n,i=0)=>{this._adapterMap.set(t,{adapter:n,priority:i})},this.unregisterAdapter=t=>{this._adapterMap.delete(t)},this._getDataByType=t=>{const n=new Map;for(const i of t.types)i==="Files"?n.set(i,Array.from(t.files)):n.set(i,t.getData(i));return i=>{const r=n.get(i);if(r)return r;const o=(n.get("Files")??[]).filter(l=>l.type===i);return o.length>0?o:""}},this._getSnapshotByPriority=async(t,n,i,r)=>{const o=Array.from(this._adapterMap.entries()).sort((l,a)=>a[1].priority-l[1].priority);for(const[l,{adapter:a}]of o){const c=t(l);if(!(Array.isArray(c)&&(c.length===0||!c.map(d=>d.type===l).reduce((d,h)=>d||h,!1)))&&c){const d=this._getJob();a.applyConfigs(d.adapterConfigs);const h={file:c,assets:d.assetsManager,blockVersions:n.workspace.meta.blockVersions,pageVersion:n.workspace.meta.pageVersion,workspaceVersion:n.workspace.meta.workspaceVersion,workspaceId:n.workspace.id,pageId:n.id},u=await a.toSliceSnapshot(h);if(u)return d.snapshotToSlice(u,n,i,r)}}return null},this.copy=async t=>this.copySlice(t),this.paste=async(t,n,i,r)=>{const o=t.clipboardData;if(o)try{const l=this.readFromClipboard(o),a=await this._getSnapshotByPriority(c=>l[c],n,i,r);return C(a),a}catch{const l=this._getDataByType(o);return await this._getSnapshotByPriority(c=>l(c),n,i,r)}},this.pasteBlockSnapshot=async(t,n,i,r)=>this._getJob().snapshotToBlock(t,n,i,r),this.copySlice=async t=>{const n=Array.from(this._adapterMap.keys());await this.writeToClipboard(async i=>{const r={...i};return await Promise.all(n.map(async o=>{const l=await this._getClipboardItem(t,o);typeof l=="string"&&(r[o]=l)})),r})}}_getJob(){return new Sn({middlewares:this._jobMiddlewares,workspace:this.std.workspace})}async _getClipboardItem(e,t){const n=this._getJob(),i=this._adapterMap.get(t);C(i);const{adapter:r}=i,o=await n.sliceToSnapshot(e);return r.applyConfigs(n.adapterConfigs),(await r.fromSliceSnapshot({snapshot:o,assets:n.assetsManager})).file}async writeToClipboard(e){const n=await e({"text/plain":"","text/html":"","image/png":""}),i=n["text/plain"],r=n["text/html"],o=n["image/png"];delete n["text/plain"],delete n["text/html"],delete n["image/png"];const a=`<div data-blocksuite-snapshot=${Le.compressToEncodedURIComponent(JSON.stringify(n))}>${r}</div>`,d={"text/html":new Blob([a],{type:"text/html"})};if(i.length>0){const h=new Blob([i],{type:"text/plain"});d["text/plain"]=h}if(o instanceof Blob)d["image/png"]=o;else if(o.length>0){const h=new Blob([o],{type:"image/png"});d["image/png"]=h}await navigator.clipboard.write([new ClipboardItem(d)])}readFromClipboard(e){const t=e.getData("text/html"),r=new DOMParser().parseFromString(t,"text/html").querySelector("[data-blocksuite-snapshot]");return C(r),JSON.parse(Le.decompressFromEncodedURIComponent(r.dataset.blocksuiteSnapshot))}}const H=Symbol("cmds");class $n{constructor(e){this.std=e,this._commands=new Map,this._getCommandCtx=()=>({std:this.std}),this.createChain=(t,n)=>{const i=this._getCommandCtx,r=this.createChain,o=this.pipe,l=(a,[c,...d])=>{c&&c(a,h=>l({...a,...h},d))};return{[H]:n,run:function(){const a=i();let c=!1;try{const d=this[H];l(a,[...d,(h,u)=>{c=!0,u()}])}catch(d){console.error(d)}return c},with:function(a){const c=this[H];return r(t,[...c,(d,h)=>h(a)])},inline:function(a){const c=this[H];return r(t,[...c,a])},try:function(a){const c=this[H];return r(t,[...c,(d,h)=>{let u=d;const f=a(o());for(const p of f)if(p[H]=[(y,v)=>{v(u)},...p[H]],p.inline((y,v)=>{u={...u,...y},v()}).run()){h(u);break}}])},tryAll:function(a){const c=this[H];return r(t,[...c,(d,h)=>{let u=d;const f=a(o());let p=!0;for(const m of f)m[H]=[(v,x)=>{x(u)},...m[H]],m.inline((v,x)=>{u={...u,...v},x()}).run()&&(p=!1);p||h(u)}])},...t}},this.pipe=()=>{const t={},n=this.createChain;for(const[i,r]of this._commands.entries())t[i]=function(o){const l=this[H];return n(t,[...l,(a,c)=>r({...a,...o},c)])};return n(t,[])},this.getChainCtx=t=>{const n={};return t.inline((i,r)=>{Object.assign(n,i),r()}).run(),n}}add(e,t){return this._commands.set(e,t),this}}class tt{constructor(e){this.event=e,this.type="defaultState"}}class ft{constructor(){this._map={},this.add=e=>{const t=e.type;this._map[t]&&console.warn("UIEventStateContext: state name duplicated",t),this._map[t]=e},this.has=e=>!!this._map[e],this.get=e=>{const t=this._map[e];return C(t,`UIEventStateContext: state ${e} not found`),t}}static from(...e){const t=new ft;return e.forEach(n=>{t.add(n)}),t}}class A{constructor(){}static{this.id=e=>e[e.length-1]}static{this.parent=e=>e.slice(0,e.length-1)}static{this.pathToKey=e=>e.join("|")}static{this.keyToPath=e=>e.split("|")}static{this.equals=(e,t)=>A.pathToKey(e)===A.pathToKey(t)}static{this.includes=(e,t)=>A.pathToKey(e).startsWith(A.pathToKey(t))}}class he extends tt{constructor({event:e}){super(e),this.type="clipboardState",this.raw=e}}var nt=(s=>(s.Selection="selection",s.Target="target",s))(nt||{});class It extends tt{constructor({event:e,sourceType:t}){super(e),this.type="sourceState",this.sourceType=t}}class On{constructor(e){this._dispatcher=e,this._cut=t=>{if(!this._dispatcher.isActive)return;const n=new he({event:t});this._dispatcher.run("cut",this._createContext(t,n))},this._copy=t=>{if(!this._dispatcher.isActive)return;const n=new he({event:t});this._dispatcher.run("copy",this._createContext(t,n))},this._paste=t=>{if(!this._dispatcher.isActive)return;const n=new he({event:t});this._dispatcher.run("paste",this._createContext(t,n))}}_createContext(e,t){return ft.from(new tt(e),new It({event:e,sourceType:nt.Selection}),t)}listen(){this._dispatcher.disposables.addFromEvent(document,"cut",this._cut),this._dispatcher.disposables.addFromEvent(document,"copy",this._copy),this._dispatcher.disposables.addFromEvent(document,"paste",this._paste)}}var st={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Ft={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Pn=typeof navigator<"u"&&/Mac/.test(navigator.platform),kn=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var P=0;P<10;P++)st[48+P]=st[96+P]=String(P);for(var P=1;P<=24;P++)st[P+111]="F"+P;for(var P=65;P<=90;P++)st[P]=String.fromCharCode(P+32),Ft[P]=String.fromCharCode(P);for(var de in st)Ft.hasOwnProperty(de)||(Ft[de]=st[de]);function Dn(s){var e=Pn&&s.metaKey&&s.shiftKey&&!s.ctrlKey&&!s.altKey||kn&&s.shiftKey&&s.key&&s.key.length==1||s.key=="Unidentified",t=!e&&s.key||(s.shiftKey?Ft:st)[s.keyCode]||s.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}const In=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function Mn(s){const e=s.split(/-(?!$)/);let t=e.at(-1);t==="Space"&&(t=" ");let n,i,r,o;return e.slice(0,-1).forEach(l=>{if(/^(cmd|meta|m)$/i.test(l)){o=!0;return}if(/^a(lt)?$/i.test(l)){n=!0;return}if(/^(c|ctrl|control)$/i.test(l)){i=!0;return}if(/^s(hift)?$/i.test(l)){r=!0;return}if(/^mod$/i.test(l)){In?o=!0:i=!0;return}throw new Error("Unrecognized modifier name: "+l)}),n&&(t="Alt-"+t),i&&(t="Ctrl-"+t),o&&(t="Meta-"+t),r&&(t="Shift-"+t),t}function ue(s,e,t=!0){return e.altKey&&(s="Alt-"+s),e.ctrlKey&&(s="Ctrl-"+s),e.metaKey&&(s="Meta-"+s),t&&e.shiftKey&&(s="Shift-"+s),s}function Nn(s){const e=Object.create(null);for(const t in s)e[Mn(t)]=s[t];return e}function Bn(s){const e=Nn(s);return t=>{const i=t.get("keyboardState").raw,r=Dn(i),o=e[ue(r,i)];if(o&&o(t))return!0;if(r.length!==1||r===" ")return!1;if(i.shiftKey){const c=e[ue(r,i,!1)];if(c&&c(t))return!0}const l=i.shiftKey||i.altKey||i.metaKey||r.charCodeAt(0)>127,a=st[i.keyCode];if(l&&a&&a!==r){const c=e[ue(a,i)];if(c&&c(t))return!0}return!1}}class Ue extends tt{constructor({event:e,composing:t}){super(e),this.type="keyboardState",this.raw=e,this.composing=t}}class Rt extends tt{constructor({event:e,rect:t,startX:n,startY:i,last:r}){super(e),this.type="pointerState";const o=e.clientX-t.left,l=e.clientY-t.top;this.raw=e,this.point={x:o,y:l},this.containerOffset={x:t.left,y:t.top},this.start={x:n,y:i},this.delta=r?{x:o-r.point.x,y:l-r.point.y}:{x:0,y:0},this.keys={shift:e.shiftKey,cmd:e.metaKey||e.ctrlKey,alt:e.altKey},this.button=r?.button||e.button,this.dragging=!!r}get x(){return this.point.x}get y(){return this.point.y}}class Ln{constructor(e){this._dispatcher=e,this.composition=!1,this._down=t=>{if(!this._dispatcher.isActive)return;const n=new Ue({event:t,composing:this.composition});this._dispatcher.run("keyDown",this._createContext(t,n))},this._up=t=>{if(!this._dispatcher.isActive)return;const n=new Ue({event:t,composing:this.composition});this._dispatcher.run("keyUp",this._createContext(t,n))}}_createContext(e,t){return ft.from(new tt(e),new It({event:e,sourceType:nt.Selection}),t)}listen(){this._dispatcher.disposables.addFromEvent(document,"keydown",this._down),this._dispatcher.disposables.addFromEvent(document,"keyup",this._up),this._dispatcher.disposables.addFromEvent(document,"compositionstart",()=>{this.composition=!0}),this._dispatcher.disposables.addFromEvent(document,"compositionend",()=>{this.composition=!1})}bindHotkey(e,t){return this._dispatcher.add("keyDown",n=>this.composition?!1:Bn(e)(n),t)}}function Fe(s,e){const t=s.x-e.x,n=s.y-e.y;return Math.pow(t,2)+Math.pow(n,2)>4}const Un=s=>s.toLowerCase();class Fn{constructor(e){this._dispatcher=e,this._lastPointerDownEvent=null,this._startDragState=null,this._lastDragState=null,this._pointerDownCount=0,this._dragging=!1,this._startX=-1/0,this._startY=-1/0,this._reset=()=>{this._startX=-1/0,this._startY=-1/0,this._lastDragState=null,this._dragging=!1},this._down=t=>{this._dispatcher.activate(),this._lastPointerDownEvent&&t.timeStamp-this._lastPointerDownEvent.timeStamp<500&&!Fe(t,this._lastPointerDownEvent)?this._pointerDownCount++:this._pointerDownCount=1;const n=new Rt({event:t,rect:this._rect,startX:this._startX,startY:this._startY,last:null});this._startX=n.point.x,this._startY=n.point.y,this._startDragState=n,this._lastDragState=n,this._lastPointerDownEvent=t,this._dispatcher.run("pointerDown",this._createContext(t,n)),this._dispatcher.disposables.addFromEvent(document,"pointermove",this._move),this._dispatcher.disposables.addFromEvent(document,"pointerup",this._up)},this._up=t=>{const n=new Rt({event:t,rect:this._rect,startX:this._startX,startY:this._startY,last:this._lastDragState}),i=this._createContext(t,n);(()=>{if(this._dragging){this._dispatcher.run("dragEnd",i);return}this._dispatcher.run("click",i),this._pointerDownCount===2&&this._dispatcher.run("doubleClick",i),this._pointerDownCount===3&&this._dispatcher.run("tripleClick",i)})(),this._dispatcher.run("pointerUp",i),this._reset(),document.removeEventListener("pointermove",this._move),document.removeEventListener("pointerup",this._up)},this._move=t=>{const n=this._lastDragState,i=new Rt({event:t,rect:this._rect,startX:this._startX,startY:this._startY,last:n});this._lastDragState=i,C(this._startDragState),!this._dragging&&Fe(this._startDragState.raw,i.raw)&&(this._dragging=!0,this._dispatcher.run("dragStart",this._createContext(t,this._startDragState))),this._dragging&&this._dispatcher.run("dragMove",this._createContext(t,i))},this._moveOn=t=>{const n=new Rt({event:t,rect:this._rect,startX:this._startX,startY:this._startY,last:this._lastDragState});this._dispatcher.run("pointerMove",this._createContext(t,n))},this._out=t=>{const n=new Rt({event:t,rect:this._rect,startX:-1/0,startY:-1/0,last:null});this._dispatcher.run("pointerOut",this._createContext(t,n))}}listen(){this._dispatcher.disposables.addFromEvent(this._dispatcher.host,"pointerdown",this._down),this._dispatcher.disposables.addFromEvent(this._dispatcher.host,"pointermove",this._moveOn),this._dispatcher.disposables.addFromEvent(this._dispatcher.host,"pointerout",this._out)}get _rect(){return this._dispatcher.host.getBoundingClientRect()}_createContext(e,t){return ft.from(new tt(e),new It({event:e,sourceType:nt.Target}),t)}}class jn{constructor(e){this._dispatcher=e,this._prev=null,this._compositionUpdate=t=>{const n=this._buildScope("compositionUpdate");this._dispatcher.run("compositionUpdate",this._createContext(t),n)},this._compositionStart=t=>{const n=this._buildScope("compositionStart");this._dispatcher.run("compositionStart",this._createContext(t),n)},this._compositionEnd=t=>{const n=this._buildScope("compositionEnd");this._dispatcher.run("compositionEnd",this._createContext(t),n)},this._selectionChange=t=>{if(!this._dispatcher.isActive)return;const n=this._buildScope("selectionChange");this._dispatcher.run("selectionChange",this._createContext(t),n)},this._buildScope=t=>{let n;const i=document.getSelection();if(i&&i.rangeCount>0){const r=i.getRangeAt(0);n=this._buildEventScopeByNativeRange(t,r),this._prev=r}else this._prev!==null&&(n=this._buildEventScopeByNativeRange(t,this._prev),this._prev=null);return n}}listen(){this._dispatcher.disposables.addFromEvent(document,"selectionchange",this._selectionChange),this._dispatcher.disposables.addFromEvent(document,"compositionstart",this._compositionStart),this._dispatcher.disposables.addFromEvent(document,"compositionend",this._compositionEnd),this._dispatcher.disposables.addFromEvent(document,"compositionupdate",this._compositionUpdate)}_createContext(e){return ft.from(new tt(e),new It({event:e,sourceType:nt.Selection}))}_buildEventScopeByNativeRange(e,t){const i=this._findBlockElementPath(t).map(o=>o).filter(o=>!!o),r=Array.from(new Set(i.flatMap(o=>o.map(l=>this._dispatcher.std.page.getBlockById(l)?.flavour)).filter(o=>!!o))).reverse();return this._dispatcher.buildEventScope(e,r,i)}_findBlockElementPath(e){const t=e.startContainer,n=e.endContainer,i=e.commonAncestorContainer,r=this._dispatcher.std.view.getNodeView;if(i.nodeType===Node.TEXT_NODE){const d=r(i);if(d)return[d.path]}const o=new Set;let l=!1;const a=(d,h)=>{if(d&&d!==h){if(d===n){o.add(d),l=!1;return}d===t&&(l=!0),l&&(d.nodeType===Node.TEXT_NODE||d.nodeType===Node.ELEMENT_NODE)&&o.add(d),a(d.firstChild,h),a(d.nextSibling,h)}};a(i.firstChild,i);const c=new Set;return o.forEach(d=>{const h=r(d);h&&(c.has(h.path)||c.add(h.path))}),Array.from(c)}}const on=["beforeInput","blur","focus","drop","contextMenu","wheel"],Vn=["click","doubleClick","tripleClick","pointerDown","pointerMove","pointerUp","pointerOut","dragStart","dragMove","dragEnd","keyDown","keyUp","selectionChange","compositionStart","compositionUpdate","compositionEnd","cut","copy","paste",...on];class lt{constructor(e){this.std=e,this.disposables=new ct,this._handlersMap=Object.fromEntries(Vn.map(t=>[t,[]])),this.activate=()=>{const t=lt._activeDispatcher;t!==this&&(lt._activeDispatcher=this,t?.std.selection.clear())},this.deactivate=()=>{const t=lt._activeDispatcher;t&&t===this&&(lt._activeDispatcher=null,t.std.selection.clear())},this.bindHotkey=(...t)=>this._keyboardControl.bindHotkey(...t),this._pointerControl=new Fn(this),this._keyboardControl=new Ln(this),this._rangeControl=new jn(this),this._clipboardControl=new On(this)}static{this._activeDispatcher=null}get isActive(){return lt._activeDispatcher===this}mount(){this.disposables.disposed&&(this.disposables=new ct),this._bindEvents()}unmount(){this.disposables.dispose()}get host(){return this.std.host}run(e,t,n){const i=t.get("sourceState");if(!(!n&&(n=this._getEventScope(e,i),!n)))for(const r of n.runners){const{fn:o}=r;if(o(t))return}}add(e,t,n){const i={fn:t,flavour:n?.flavour,path:n?.path};return this._handlersMap[e].unshift(i),()=>{this._handlersMap[e].includes(i)&&(this._handlersMap[e]=this._handlersMap[e].filter(r=>r!==i))}}get _currentSelections(){return this.std.selection.value}_getEventScope(e,t){if(!this._handlersMap[e])return;let i;switch(t.sourceType){case nt.Selection:{i=this._buildEventScopeBySelection(e);break}case nt.Target:{i=this._buildEventScopeByTarget(e,t.event.target);break}default:throw new Error(`Unknown event scope source: ${t.sourceType}`)}return i}buildEventScope(e,t,n){const i=this._handlersMap[e];if(!i)return;const r=i.filter(a=>a.flavour===void 0&&a.path===void 0),o=i.filter(a=>{const c=a.path;return c===void 0?!1:n.some(d=>A.includes(d,c))}),l=i.filter(a=>a.flavour&&t.includes(a.flavour));return{runners:o.concat(l).concat(r),flavours:t,paths:n}}_buildEventScopeByTarget(e,t){if(!this._handlersMap[e])return;const i=this.std.view.getNodeView(t)?.path;if(!i)return this._buildEventScopeBySelection(e);const r=i.map(o=>this.std.page.getBlockById(o)?.flavour).filter(o=>!!o).reverse();return this.buildEventScope(e,r,[i])}_buildEventScopeBySelection(e){if(!this._handlersMap[e])return;const n=this._currentSelections,i={},r=n.map(l=>l.path).flatMap(l=>l.map(a=>this.std.page.getBlockById(a)?.flavour)).filter(l=>!l||i[l]?!1:(i[l]=!0,!0)).reverse(),o=n.map(l=>l.path);return this.buildEventScope(e,r,o)}_bindEvents(){on.forEach(e=>{this.disposables.addFromEvent(this.host,Un(e),t=>{this.run(e,ft.from(new tt(t),new It({event:t,sourceType:nt.Selection})))})}),this._pointerControl.listen(),this._keyboardControl.listen(),this._rangeControl.listen(),this._clipboardControl.listen()}}class te{constructor({path:e}){this.path=e}get blockId(){return A.id(this.path)}is(e){return this.type===e}get type(){return this.constructor.type}get group(){return this.constructor.group}static fromJSON(e){throw new Error("You must override this method")}}const Hn=R.object({path:R.array(R.string())});class jt extends te{static{this.type="block"}static{this.group="note"}equals(e){return e instanceof jt?A.equals(this.path,e.path):!1}toJSON(){return{type:"block",path:this.path}}static fromJSON(e){return Hn.parse(e),new jt({path:e.path})}}const qn=R.object({x:R.number(),y:R.number()});class Vt extends te{static{this.type="cursor"}static{this.group="edgeless"}constructor(e,t){super({path:[]}),this.x=e,this.y=t}equals(e){return e instanceof Vt?this.x===e.x&&this.y===e.y:!1}toJSON(){return{type:"cursor",x:this.x,y:this.y}}static fromJSON(e){return qn.parse(e),new Vt(e.x,e.y)}}const zn=R.object({elements:R.array(R.string()),editing:R.boolean()});class Ht extends te{static{this.type="surface"}static{this.group="edgeless"}constructor(e,t,n){super({path:e}),this.elements=t,this.editing=n}isEmpty(){return this.elements.length===0&&!this.editing}equals(e){return e instanceof Ht?this.blockId===e.blockId&&this.elements.length===e.elements.length&&this.elements.every((t,n)=>t===e.elements[n])&&this.editing===e.editing:!1}toJSON(){return{type:"surface",path:this.path,elements:this.elements,editing:this.editing}}static fromJSON(e){return zn.parse(e),new Ht(e.path,e.elements,e.editing)}}const Kn=R.object({from:R.object({path:R.array(R.string()),index:R.number(),length:R.number()}),to:R.object({path:R.array(R.string()),index:R.number(),length:R.number()}).nullable(),isReverse:R.boolean().optional()});class qt extends te{static{this.type="text"}static{this.group="note"}constructor({from:e,to:t,isReverse:n}){super({path:e.path}),this.from=e,this.to=this._equalPoint(e,t)?null:t,this.isReverse=!!n}get start(){return this.isReverse?this.to??this.from:this.from}get end(){return this.isReverse?this.from:this.to??this.from}empty(){return!!this.to}_equalPoint(e,t){return e&&t?A.equals(e.path,t.path)&&e.index===t.index&&e.length===t.length:e===t}equals(e){return e instanceof qt?A.equals(this.path,e.path)&&this._equalPoint(e.from,this.from)&&this._equalPoint(e.to,this.to):!1}toJSON(){return{type:"text",from:this.from,to:this.to,isReverse:this.isReverse}}static fromJSON(e){return Kn.parse(e),new qt({from:e.from,to:e.to,isReverse:!!e.isReverse})}isCollapsed(){return this.to===null&&this.from.length===0}isInSameBlock(){return this.to===null||A.equals(this.from.path,this.to.path)}}class Wn{constructor(e){this.std=e,this.disposables=new ct,this._selectionConstructors={},this.slots={changed:new q,remoteChanged:new q},this._jsonToSelection=t=>{const n=this._selectionConstructors[t.type];if(!n)throw new Error(`Unknown selection type: ${t.type}`);return n.fromJSON(t)},this._itemAdded=t=>{t.stackItem.meta.set("selection-state",this.value)},this._itemPopped=t=>{const n=t.stackItem.meta.get("selection-state");n&&this.set(n)},this._setupDefaultSelections()}register(e){return[e].flat().forEach(t=>{this._selectionConstructors[t.type]=t}),this}get _store(){return this.std.workspace.awarenessStore}_setupDefaultSelections(){this.register([qt,jt,Ht,Vt])}create(e,...t){const n=this._selectionConstructors[e];if(!n)throw new Error(`Unknown selection type: ${e}`);return new n(...t)}get value(){return this._store.getLocalSelection().map(e=>this._jsonToSelection(e))}fromJSON(e){const t=e.map(n=>this._jsonToSelection(n));return this.set(t)}set(e){this._store.setLocalSelection(e.map(t=>t.toJSON())),this.slots.changed.emit(e)}setGroup(e,t){const n=this.value.filter(i=>i.group!==e);this.set([...n,...t])}getGroup(e){return this.value.filter(t=>t.group===e)}update(e){const t=e(this.value);this.set(t)}clear(e){if(e){const t=this.value.filter(n=>!e.includes(n.type));this.set(t)}else this.set([])}find(e){return this.value.find(t=>t.is(e))}filter(e){return this.value.filter(t=>t.is(e))}get remoteSelections(){const e=new Map;return this._store.getStates().forEach((t,n)=>{if(n===this._store.awareness.clientID)return;const i=t.selection.map(r=>{try{return this._jsonToSelection(r)}catch(o){return console.error("Parse remote selection failed:",n,r,o),null}}).filter(r=>!!r);e.set(n,i)}),e}mount(){this.disposables.disposed&&(this.disposables=new ct),this.std.page.history.on("stack-item-added",this._itemAdded),this.std.page.history.on("stack-item-popped",this._itemPopped),this.disposables.add(this._store.slots.update.on(({id:e})=>{e!==this._store.awareness.clientID&&this.slots.remoteChanged.emit(this.remoteSelections)}))}unmount(){this.std.page.history.off("stack-item-added",this._itemAdded),this.std.page.history.off("stack-item-popped",this._itemPopped),this.slots.changed.dispose(),this.disposables.dispose(),this.clear()}dispose(){Object.values(this.slots).forEach(e=>e.dispose()),this.disposables.dispose()}}class Yn{constructor(e){this.std=e,this._specs=new Map,this._services=new Map}dispose(){this._services.forEach(e=>{e.dispose(),e.unmounted()}),this._services.clear()}applySpecs(e){const t=this._specs,n=this._buildSpecMap(e);this._diffServices(t,n),this._specs=n}getView(e){const t=this._specs.get(e);return t?t.view:null}getService(e){return this._services.get(e)}_diffServices(e,t){e.forEach((n,i)=>{if(t.has(i)&&t.get(i)?.service===n.service)return;const r=this._services.get(i);r&&(r.dispose(),r.unmounted()),this._services.delete(i)}),t.forEach((n,i)=>{if(this._services.has(i)||!n.service)return;const r=new n.service({flavour:i,std:this.std});this._services.set(i,r),r.mounted()})}_buildSpecMap(e){const t=new Map;return e.forEach(n=>{t.set(n.schema.model.flavour,n)}),t}}const Xn={childList:!0,subtree:!0};class Gn{constructor(e){this.std=e,this._cachedTree=null,this._cachedPath=new Map,this.viewSpec=new Set,this.getChildren=t=>{const n=this.fromPath(t);return n?n.children:[]},this.getNodeView=t=>{for(const[n,i]of this.viewSpec.entries()){const r=i.fromDOM(t);if(r)return{...r}}return null},this.calculatePath=t=>this._calculateNodeViewPath(t).map(i=>i.id),this._getViewSpec=t=>Array.from(this.viewSpec).find(n=>n.type===t),this._calculateNodeViewPath=t=>{if(this._cachedPath.has(t))return this._cachedPath.get(t);const n=this.std.host,i=(o,l)=>{if(!o||o===n)return l;const a=this.getNodeView(o);if(!a)return l;const c=this._getViewSpec(a.type);C(c);const d=c.toDOM(a).parentElement;return d?i(d,l.concat(a)):l},r=i(t,[]).reverse();return this._cachedPath.set(t,r),r},this.getNodeViewTree=()=>{if(this._cachedTree)return this._cachedTree;const t=r=>{const o=this.getNodeView(r);if(!o)throw new Error("nodeView not found");const l=this._getViewSpec(o.type);C(l);const a=l.getChildren(l.toDOM(o)).map(c=>t(c));return{...o,children:a}},n=this.std.host.querySelector("[data-block-id]");C(n);const i={id:"__root__",path:[],children:[t(n)]};return this._cachedTree=i,i},this.fromPath=t=>{const n=this.getNodeViewTree();return t.reduce((i,r)=>{if(!i)return null;const o=i.children.find(l=>l.id===r);return o||null},n)},this.walkThrough=(t,n=[])=>{const i=this.fromPath(n);C(i,`Invalid path to get node in view: ${n}`);const r=o=>(l,a)=>{t(l,a,o)!==!0&&l.children.forEach(r(l))};i.children.forEach(r(i))},this.getParent=t=>t.length===0?null:this.fromPath(A.parent(t)),this.findPrev=(t,n)=>{const i=l=>{const a=this.getParent(l);if(!a)return null;const c=this._indexOf(l,a);if(c===-1)return null;if(c===0){const d=this.getParent(A.parent(l));return d?{nodeView:a,parent:d,index:this._indexOf(A.parent(l),d)}:null}return{nodeView:a.children[c-1],parent:a,index:c-1}};let r=null;const o=l=>{const a=i(l);if(!a)return;const{nodeView:c,parent:d,index:h}=a;if(n(c,h,d)){r=c;return}o(c.path)};return o(t),r},this.findNext=(t,n)=>{const i=l=>{const a=this.getParent(l);if(!a)return null;const c=this._indexOf(l,a);if(c===-1)return null;if(c===a.children.length-1){const d=this.getParent(A.parent(l));return d?{nodeView:a,parent:d,index:this._indexOf(A.parent(l),d)}:null}return{nodeView:a.children[c+1],parent:a,index:c+1}};let r=null;const o=l=>{const a=i(l);if(!a)return;const{nodeView:c,parent:d,index:h}=a;if(n(c,h,d)){r=c;return}o(c.path)};return o(t),r},this.indexOf=t=>{const n=this.getParent(t);return n?this._indexOf(t,n):-1},this._indexOf=(t,n)=>n.children.findIndex(i=>i.id===t[t.length-1]),this._observer=new MutationObserver(()=>{this._cachedPath.clear(),this._cachedTree=null})}register(e){this.viewSpec.add(e)}viewFromPath(e,t){const n=this.fromPath(t);return!n||n.type!==e?null:n.view}mount(){this._observer.observe(this.std.host,Xn)}unmount(){this._cachedPath.clear(),this._cachedTree=null,this._observer.disconnect(),this.viewSpec.clear()}}class Jn{constructor(e){this.host=e.host,this.workspace=e.workspace,this.page=e.page,this.event=new lt(this),this.selection=new Wn(this),this.command=new $n(this),this.spec=new Yn(this),this.view=new Gn(this),this.clipboard=new An(this)}mount(){this.selection.mount(),this.event.mount(),this.view.mount()}unmount(){this.event.unmount(),this.selection.unmount(),this.view.unmount(),this.spec.dispose()}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ut=globalThis,xe=Ut.ShadowRoot&&(Ut.ShadyCSS===void 0||Ut.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,be=Symbol(),je=new WeakMap;let Se=class{constructor(e,t,n){if(this._$cssResult$=!0,n!==be)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(xe&&e===void 0){const n=t!==void 0&&t.length===1;n&&(e=je.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&je.set(t,e))}return e}toString(){return this.cssText}};const Zn=s=>new Se(typeof s=="string"?s:s+"",void 0,be),or=(s,...e)=>{const t=s.length===1?s[0]:e.reduce((n,i,r)=>n+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+s[r+1],s[0]);return new Se(t,s,be)},Qn=(s,e)=>{if(xe)s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const t of e){const n=document.createElement("style"),i=Ut.litNonce;i!==void 0&&n.setAttribute("nonce",i),n.textContent=t.cssText,s.appendChild(n)}},Ve=xe?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return Zn(t)})(s):s;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:ts,defineProperty:es,getOwnPropertyDescriptor:ns,getOwnPropertyNames:ss,getOwnPropertySymbols:is,getPrototypeOf:rs}=Object,ee=globalThis,He=ee.trustedTypes,os=He?He.emptyScript:"",as=ee.reactiveElementPolyfillSupport,At=(s,e)=>s,zt={toAttribute(s,e){switch(e){case Boolean:s=s?os:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch{t=null}}return t}},Ee=(s,e)=>!ts(s,e),qe={attribute:!0,type:String,converter:zt,reflect:!1,hasChanged:Ee};Symbol.metadata??=Symbol("metadata"),ee.litPropertyMetadata??=new WeakMap;class vt extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=qe){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){const n=Symbol(),i=this.getPropertyDescriptor(e,n,t);i!==void 0&&es(this.prototype,e,i)}}static getPropertyDescriptor(e,t,n){const{get:i,set:r}=ns(this.prototype,e)??{get(){return this[t]},set(o){this[t]=o}};return{get(){return i?.call(this)},set(o){const l=i?.call(this);r.call(this,o),this.requestUpdate(e,l,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??qe}static _$Ei(){if(this.hasOwnProperty(At("elementProperties")))return;const e=rs(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(At("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(At("properties"))){const t=this.properties,n=[...ss(t),...is(t)];for(const i of n)this.createProperty(i,t[i])}const e=this[Symbol.metadata];if(e!==null){const t=litPropertyMetadata.get(e);if(t!==void 0)for(const[n,i]of t)this.elementProperties.set(n,i)}this._$Eh=new Map;for(const[t,n]of this.elementProperties){const i=this._$Eu(t,n);i!==void 0&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const i of n)t.unshift(Ve(i))}else e!==void 0&&t.push(Ve(e));return t}static _$Eu(e,t){const n=t.attribute;return n===!1?void 0:typeof n=="string"?n:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$Eg=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$ES(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$E_??=new Set).add(e),this.renderRoot!==void 0&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$E_?.delete(e)}_$ES(){const e=new Map,t=this.constructor.elementProperties;for(const n of t.keys())this.hasOwnProperty(n)&&(e.set(n,this[n]),delete this[n]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Qn(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$E_?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$E_?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$EO(e,t){const n=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,n);if(i!==void 0&&n.reflect===!0){const r=(n.converter?.toAttribute!==void 0?n.converter:zt).toAttribute(t,n.type);this._$Em=e,r==null?this.removeAttribute(i):this.setAttribute(i,r),this._$Em=null}}_$AK(e,t){const n=this.constructor,i=n._$Eh.get(e);if(i!==void 0&&this._$Em!==i){const r=n.getPropertyOptions(i),o=typeof r.converter=="function"?{fromAttribute:r.converter}:r.converter?.fromAttribute!==void 0?r.converter:zt;this._$Em=i,this[i]=o.fromAttribute(t,r.type),this._$Em=null}}requestUpdate(e,t,n){if(e!==void 0){if(n??=this.constructor.getPropertyOptions(e),!(n.hasChanged??Ee)(this[e],t))return;this.C(e,t,n)}this.isUpdatePending===!1&&(this._$Eg=this._$EP())}C(e,t,n){this._$AL.has(e)||this._$AL.set(e,t),n.reflect===!0&&this._$Em!==e&&(this._$ET??=new Set).add(e)}async _$EP(){this.isUpdatePending=!0;try{await this._$Eg}catch(t){Promise.reject(t)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[i,r]of this._$Ep)this[i]=r;this._$Ep=void 0}const n=this.constructor.elementProperties;if(n.size>0)for(const[i,r]of n)r.wrapped!==!0||this._$AL.has(i)||this[i]===void 0||this.C(i,this[i],r)}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$E_?.forEach(n=>n.hostUpdate?.()),this.update(t)):this._$Ej()}catch(n){throw e=!1,this._$Ej(),n}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$E_?.forEach(t=>t.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ej(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Eg}shouldUpdate(e){return!0}update(e){this._$ET&&=this._$ET.forEach(t=>this._$EO(t,this[t])),this._$Ej()}updated(e){}firstUpdated(e){}}vt.elementStyles=[],vt.shadowRootOptions={mode:"open"},vt[At("elementProperties")]=new Map,vt[At("finalized")]=new Map,as?.({ReactiveElement:vt}),(ee.reactiveElementVersions??=[]).push("2.0.3");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let Y=class extends vt{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=yt(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return Qt}};Y._$litElement$=!0,Y.finalized=!0,globalThis.litElementHydrateSupport?.({LitElement:Y});const ls=globalThis.litElementPolyfillSupport;ls?.({LitElement:Y});(globalThis.litElementVersions??=[]).push("4.0.3");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ne=s=>(e,t)=>{t!==void 0?t.addInitializer(()=>{customElements.define(s,e)}):customElements.define(s,e)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const cs={attribute:!0,type:String,converter:zt,reflect:!1,hasChanged:Ee},hs=(s=cs,e,t)=>{const{kind:n,metadata:i}=t;let r=globalThis.litPropertyMetadata.get(i);if(r===void 0&&globalThis.litPropertyMetadata.set(i,r=new Map),r.set(t.name,s),n==="accessor"){const{name:o}=t;return{set(l){const a=e.get.call(this);e.set.call(this,l),this.requestUpdate(o,a,s)},init(l){return l!==void 0&&this.C(o,void 0,s),l}}}if(n==="setter"){const{name:o}=t;return function(l){const a=this[o];e.call(this,l),this.requestUpdate(o,a,s)}}throw Error("Unsupported decorator location: "+n)};function $(s){return(e,t)=>typeof t=="object"?hs(s,e,t):((n,i,r)=>{const o=i.hasOwnProperty(r);return i.constructor.createProperty(r,o?{...n,wrapped:!0}:n),o?Object.getOwnPropertyDescriptor(i,r):void 0})(s,e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function ds(s){return $({...s,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ge=(s,e,t)=>(t.configurable=!0,t.enumerable=!0,Reflect.decorate&&typeof e!="object"&&Object.defineProperty(s,e,t),t);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function lr(s,e){return(t,n,i)=>{const r=o=>o.renderRoot?.querySelector(s)??null;if(e){const{get:o,set:l}=typeof n=="object"?t:i??(()=>{const a=Symbol();return{get(){return this[a]},set(c){this[a]=c}}})();return ge(t,n,{get(){let a=o.call(this);return a===void 0&&(a=r(this),(a!==null||this.hasUpdated)&&l.call(this,a)),a}})}return ge(t,n,{get(){return r(this)}})}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function cr(s){return(e,t)=>ge(e,t,{async get(){return await this.updateComplete,this.renderRoot?.querySelector(s)??null}})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const se={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},ie=s=>(...e)=>({_$litDirective$:s,values:e});let re=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,n){this._$Ct=e,this._$AM=t,this._$Ci=n}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const an="important",us=" !"+an,Et=ie(class extends re{constructor(s){if(super(s),s.type!==se.ATTRIBUTE||s.name!=="style"||s.strings?.length>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(s){return Object.keys(s).reduce((e,t)=>{const n=s[t];return n==null?e:e+`${t=t.includes("-")?t:t.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${n};`},"")}update(s,[e]){const{style:t}=s.element;if(this.ut===void 0)return this.ut=new Set(Object.keys(e)),this.render(e);for(const n of this.ut)e[n]==null&&(this.ut.delete(n),n.includes("-")?t.removeProperty(n):t[n]=null);for(const n in e){const i=e[n];if(i!=null){this.ut.add(n);const r=typeof i=="string"&&i.endsWith(us);n.includes("-")||r?t.setProperty(n,r?i.slice(0,-11):i,r?an:""):t[n]=i}}return Qt}}),Ct="​",dr="‌",ht="data-v-root";function $t(s){const e=s.rootElement;if(!e)throw new Error("editor root element not found");const t=e.getRootNode();return(t instanceof Document||t instanceof ShadowRoot)&&"getSelection"in t?t:e.ownerDocument}function fs(s){const e=s.closest(`[${ht}]`);C(e,"element must be inside a v-root");const t=e.inlineEditor;return C(t,"element must be inside a v-root with inline-editor"),t}var ps=Object.defineProperty,gs=Object.getOwnPropertyDescriptor,Ce=(s,e,t,n)=>{for(var i=n>1?void 0:n?gs(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&ps(e,t,i),i};let dt=class extends Y{constructor(){super(...arguments),this.delta={insert:Ct}}render(){const s=fs(this),e=s.attributeService.attributeRenderer;if(s.isEmbed(this.delta)){if(this.delta.insert.length!==1)throw new Error(`The length of embed node should only be 1.
          This seems to be an internal issue with inline editor.
          Please go to https://github.com/toeverything/blocksuite/issues
          to report it.`);return X`<span
        data-v-embed="true"
        data-v-element="true"
        contenteditable="false"
        style=${Et({userSelect:"none"})}
        >${e(this.delta,this.selected)}</span
      >`}return X`<span data-v-element="true"
      >${e(this.delta,this.selected)}</span
    >`}createRenderRoot(){return this}};Ce([$({type:Object})],dt.prototype,"delta",2);Ce([$({attribute:!1})],dt.prototype,"selected",2);dt=Ce([ne("v-element")],dt);const Bt=X`<span
  data-v-embed-gap="true"
  style=${Et({userSelect:"text",padding:"0 0.5px",outline:"none"})}
  ><v-text></v-text
></span>`;var ms=Object.defineProperty,vs=Object.getOwnPropertyDescriptor,ln=(s,e,t,n)=>{for(var i=n>1?void 0:n?vs(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&ms(e,t,i),i};let Pt=class extends Y{constructor(){super(...arguments),this.elements=[]}get vElements(){return Array.from(this.querySelectorAll("v-element"))}get vTexts(){return Array.from(this.querySelectorAll("v-text"))}get textLength(){return this.vElements.reduce((s,e)=>s+e.delta.insert.length,0)}get textContent(){return this.vElements.reduce((s,e)=>s+e.delta.insert,"")}async getUpdateComplete(){const s=await super.getUpdateComplete();return await Promise.all(this.vElements.map(e=>e.updateComplete)),await Promise.all(this.vTexts.map(e=>e.updateComplete)),s}firstUpdated(){this.style.display="block"}render(){if(this.elements.length===0)return X`<div><v-text .str=${Ct}></v-text></div>`;if(!this.isConnected)return;const s=this.closest(`[${ht}]`);C(s,"v-line must be inside a v-root");const e=s.inlineEditor;C(e,"v-line must be inside a v-root with inline-editor");const t=this.elements.flatMap(([n,i],r)=>{if(e.isEmbed(i)){if(i.insert.length!==1)throw new Error(`The length of embed node should only be 1.
            This seems to be an internal issue with inline editor.
            Please go to https://github.com/toeverything/blocksuite/issues
            to report it.`);if(r===0){const o=this.elements[r+1]?.[1];return!o||e.isEmbed(o)?[Bt,n,Bt]:[Bt,n]}else{const o=this.elements[r+1]?.[1];return!o||e.isEmbed(o)?[n,Bt]:[n]}}return n});return X`<div style=${Et({padding:"0 0.5px"})}>${t}</div>`}createRenderRoot(){return this}};ln([$({attribute:!1})],Pt.prototype,"elements",2);Pt=ln([ne("v-line")],Pt);var ys=Object.defineProperty,_s=Object.getOwnPropertyDescriptor,Re=(s,e,t,n)=>{for(var i=n>1?void 0:n?_s(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&ys(e,t,i),i};let Kt=class extends Y{constructor(){super(...arguments),this.str=Ct,this.styles={"word-wrap":"break-word","white-space":"break-spaces"}}render(){return X`<span style=${Et(this.styles)} data-v-text="true"
      >${this.str}</span
    >`}createRenderRoot(){return this}};Re([$({attribute:!1})],Kt.prototype,"str",2);Re([$({attribute:!1})],Kt.prototype,"styles",2);Kt=Re([ne("v-text")],Kt);class ws{constructor(e,t={}){this.editor=e,this.hooks=t}}function xs(s){let e="";s.underline&&(e+="underline"),s.strike&&(e+=" line-through");let t={};return s.code&&(t={"font-family":'"SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace',"line-height":"normal",background:"rgba(135,131,120,0.15)",color:"#EB5757","border-radius":"3px","font-size":"85%",padding:"0.2em 0.4em"}),Et({"word-wrap":"break-word","white-space":"break-spaces","font-weight":s.bold?"bold":"normal","font-style":s.italic?"italic":"normal","text-decoration":e.length>0?e:"none",...t})}const bs=()=>s=>{const e=s.attributes?xs(s.attributes):Et({});return X`<span style=${e}
      ><v-text .str=${s.insert}></v-text
    ></span>`},Ss=R.object({bold:R.literal(!0).optional().nullable().catch(void 0),italic:R.literal(!0).optional().nullable().catch(void 0),underline:R.literal(!0).optional().nullable().catch(void 0),strike:R.literal(!0).optional().nullable().catch(void 0),code:R.literal(!0).optional().nullable().catch(void 0),link:R.string().optional().nullable().catch(void 0)});function Es(s){const e=[];let t=s.insert;for(;t.length>0;){const n=t.indexOf(`
`);if(n===-1){e.push({insert:t,attributes:s.attributes});break}t.slice(0,n).length>0&&e.push({insert:t.slice(0,n),attributes:s.attributes}),e.push(`
`),t=t.slice(n+1)}return e}function Cs(s){if(s.length===0)return[[]];const e=s.flatMap(Es);function*t(n){let i=0;for(let r=0;r<n.length;r++)if(n[r]===`
`){const o=n.slice(i,r);i=r+1,yield o}else r===n.length-1&&(yield n.slice(i));n.at(-1)===`
`&&(yield[])}return Array.from(t(e))}function Wt(s){return s instanceof Element?s instanceof dt?s.querySelector('[data-v-embed="true"]')!==null:!!s.closest('[data-v-embed="true"]'):!!s.parentElement?.closest('[data-v-embed="true"]')}function ze(s,e){const t=[];for(const n of e)if(s.isEmbed(n)){const i=[...n.insert].map(r=>({insert:r,attributes:n.attributes}));t.push(...i)}else t.push(n);return t}function Rs(s){return s instanceof Text&&s.parentElement?.dataset.vText==="true"}function Ts(s){return s instanceof HTMLElement&&(s.dataset.vElement==="true"||s instanceof dt)}function As(s){return s instanceof HTMLElement&&(s instanceof Pt||s.parentElement instanceof Pt)}function $s(s){return s instanceof HTMLElement&&s.dataset.vRoot==="true"}const Os=En||Cn?"metaKey":"ctrlKey",Ps=!1,ur=!0;function fr(s,e){const t={};function n(l){return l.shortKey&&(l[Os]=l.shortKey,delete l.shortKey),l}function i(l,a){return["altKey","ctrlKey","metaKey","shiftKey"].some(c=>Object.hasOwn(a,c)&&a[c]!==l[c])?!1:a.key===l.key}function r(l){const a=n(l);(Array.isArray(a.key)?a.key:[a.key]).forEach(d=>{const h={...a,key:d};t[d]=t[d]??[],t[d].push(h)})}Object.values(e).forEach(l=>{r(l)});function o(l){if(l.defaultPrevented||l.isComposing)return;const c=(t[l.key]??[]).filter(_=>i(l,_));if(c.length===0)return;const d=s.getInlineRange();if(!d)return;const[h,u]=s.getTextPoint(d.index),[f,p]=d.length===0?[h,u]:s.getTextPoint(d.index+d.length),m=h.textContent?h.textContent.slice(0,u):"",y=f.textContent?f.textContent.slice(p):"",v={inlineRange:d,inlineEditor:s,collapsed:d.length===0,prefixText:m,suffixText:y,raw:l};c.some(_=>_.prefix&&!_.prefix.test(v.prefixText)||_.suffix&&!_.suffix.test(v.suffixText)?!1:_.handler(v)===Ps)&&l.preventDefault()}return o}function kt(s){return s.wholeText===Ct?0:s.wholeText.length}function Z(s){return Array.from(s.querySelectorAll('[data-v-text="true"]')).map(n=>{const i=Array.from(n.childNodes).find(r=>r instanceof Text);if(!i)throw new Error("text node not found");return i})}function me(s,e){if(Rs(s))return[s,e];if(Ts(s)){const n=Z(s);if(n.length===1){const i=n[0].parentElement?.closest('[data-v-element="true"]');if(i instanceof HTMLElement&&i.dataset.vEmbed==="true")return[n[0],0]}return n[e]?[n[e],0]:null}if(As(s)||$s(s))return ve(s,e,!0);if(!(s instanceof Node))return null;const t=ks(s);return t?Ds(t,s,e):null}function wt(s,e,t){if(t.dataset.vRoot!=="true")throw new Error("textRangeToDomPoint should be called with editor root element");if(!t.contains(s))return null;const n=Z(t),i=n.indexOf(s);let r=0;for(const c of n.slice(0,i))r+=kt(c);s.wholeText!==Ct&&(r+=e);const o=s.parentElement;if(!o)throw new Error("text element parent not found");const l=o.closest("v-line");if(!l)throw new Error("line element not found");const a=Array.from(t.querySelectorAll("v-line")).indexOf(l);return{text:s,index:r+a}}function ks(s){const e=s.parentElement?.closest("v-line");if(e)return Array.from(e.querySelectorAll("v-element"));const t=s instanceof Element?s.closest(`[${ht}]`):s.parentElement?.closest(`[${ht}]`);return t?Array.from(t.querySelectorAll("v-line")):null}function Ds(s,e,t){const n=s[0];for(let i=0;i<s.length;i++){const r=s[i];if(i===0&&We(e,r))return ve(n,t,!0);if(Is(e,r))return ve(n,t,!1);if(i===s.length-1&&Ye(e,r)||i<s.length-1&&Ye(e,r)&&We(e,s[i+1]))return Ke(r)}return null}function Ke(s){const e=Z(s);if(e.length===0)return null;const t=e[e.length-1];return[t,kt(t)]}function ve(s,e,t){const n=Z(s);if(n.length===0)return null;const i=t?n[0]:n[n.length-1];return[i,e===0?e:i.length]}function Is(s,e){return e.compareDocumentPosition(s)===Node.DOCUMENT_POSITION_CONTAINED_BY||e.compareDocumentPosition(s)===(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)}function We(s,e){return s.compareDocumentPosition(e)===Node.DOCUMENT_POSITION_FOLLOWING}function Ye(s,e){return s.compareDocumentPosition(e)===Node.DOCUMENT_POSITION_PRECEDING}const Ms=({rootElement:s,startText:e,endText:t})=>s.contains(e)&&s.contains(t),Ns=({rootElement:s,startText:e,endText:t,startTextOffset:n,endTextOffset:i})=>{const r=wt(e,n,s),o=wt(t,i,s);return!r||!o?null:{index:Math.min(r.index,o.index),length:Math.abs(r.index-o.index)}},Bs=({rootElement:s,startText:e,endText:t})=>!s.contains(e)&&s.contains(t),Ls=({rootElement:s,endText:e,endTextOffset:t})=>{const n=wt(e,t,s);return n?{index:0,length:n.index}:null},Us=({rootElement:s,startText:e,endText:t})=>s.contains(e)&&!s.contains(t),Fs=({yText:s,rootElement:e,startText:t,startTextOffset:n})=>{const i=wt(t,n,e);return i?{index:i.index,length:s.length-i.index}:null},js=({rootElement:s,startText:e,endText:t,range:n})=>!s.contains(e)&&!s.contains(t)&&n.intersectsNode(s),Vs=({yText:s})=>({index:0,length:s.length}),Hs=(s,e,t)=>{const{startContainer:n,startOffset:i,endContainer:r,endOffset:o}=s,l=me(n,i),a=me(r,o);if(!l||!a)return null;const[c,d]=l,[h,u]=a;return{rootElement:e,range:s,yText:t,startNode:n,startOffset:i,endNode:r,endOffset:o,startText:c,startTextOffset:d,endText:h,endTextOffset:u}};function qs(s,e,t){const n=Hs(s,e,t);if(!n)return null;if(n.startNode&&n.startNode===n.endNode&&Wt(n.startNode)){const i=wt(n.startText,n.startTextOffset,e);if(i)return{index:i.index,length:1}}return Ms(n)?Ns(n):Bs(n)?Ls(n):Us(n)?Fs(n):js(n)?Vs(n):null}function zs(s,e){const t=Array.from(s.querySelectorAll("v-line"));let n=null,i=null,r=0,o=0,l=0;for(let c=0;c<t.length&&!(n&&i);c++){const d=Z(t[c]);for(const h of d){const u=kt(h);if(!n&&l+u>=e.index&&(n=h,r=e.index-l),!i&&l+u>=e.index+e.length&&(i=h,o=e.index+e.length-l),n&&i)break;l+=u}l+=1}if(!n||!i)return null;if(Wt(n)){const c=n.parentElement?.closest("v-element");if(!c)throw new Error("failed to find vElement for a text note in an embed element");const d=c.nextElementSibling;if(!d)throw new Error("failed to find nextSibling sibling of an embed element");const h=Z(d);d instanceof dt?(n=h[h.length-1],r=kt(n)):(n=h[0],r=0)}if(Wt(i)){const c=i.parentElement?.closest("v-element");if(!c)throw new Error("failed to find vElement for a text note in an embed element");const d=c.nextElementSibling;if(!d)throw new Error("failed to find nextSibling sibling of an embed element");i=Z(d)[0],o=0}const a=document.createRange();return a.setStart(n,r),a.setEnd(i,o),a}function Ks(s,e,t){return X`<v-element
    .selected=${t}
    .delta=${{insert:s.insert,attributes:e(s.attributes)}}
  ></v-element>`}function Ws(s,e,t,n){e&&(t.insertText(s,e,n),t.setInlineRange({index:s.index+e.length,length:0}))}function Ys(s,e){e.insertLineBreak(s),e.setInlineRange({index:s.index+1,length:0})}function Xs(s,e){e.deleteText(s),e.setInlineRange({index:s.index,length:0})}function Gs(s,e,t,n,i){if(i.isValidInlineRange(n))if(s==="insertText")Ws(n,e,i,t);else if(s==="insertParagraph"||s==="insertLineBreak")Ys(n,i);else if(s.startsWith("delete"))Xs(n,i);else return}class Js{constructor(e){this.editor=e,this._marks=null,this._attributeRenderer=bs(),this._attributeSchema=Ss,this.setMarks=t=>{this._marks=t},this.resetMarks=()=>{this._marks=null},this.setAttributeSchema=t=>{this._attributeSchema=t},this.setAttributeRenderer=t=>{this._attributeRenderer=t},this.getFormat=(t,n=!1)=>{const r=this.editor.deltaService.getDeltasByInlineRange(t).filter(([l,a])=>a.index+a.length>t.index&&a.index<=t.index+t.length).map(([l])=>l.attributes);return n?r.reduce((l,a)=>({...l,...a}),{}):!r.length||r.some(l=>!l)?{}:r.reduce((l,a)=>{const c={};for(const d in l){const h=d;l[h]===a[h]&&(c[h]=l[h])}return c})},this.normalizeAttributes=t=>{if(!t)return;const n=this._attributeSchema.safeParse(t);if(!n.success){console.error(n.error);return}return Object.fromEntries(Object.entries(n.data).filter(([i,r])=>r||r===null))}}get marks(){return this._marks}get attributeRenderer(){return this._attributeRenderer}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{D:Zs}=Rn,pr=(s,e)=>e===void 0?s?._$litType$!==void 0:s?._$litType$===e,Qs=s=>s.strings===void 0,Xe=()=>document.createComment(""),Tt=(s,e,t)=>{const n=s._$AA.parentNode,i=e===void 0?s._$AB:e._$AA;if(t===void 0){const r=n.insertBefore(Xe(),i),o=n.insertBefore(Xe(),i);t=new Zs(r,o,s,s.options)}else{const r=t._$AB.nextSibling,o=t._$AM,l=o!==s;if(l){let a;t._$AQ?.(s),t._$AM=s,t._$AP!==void 0&&(a=s._$AU)!==o._$AU&&t._$AP(a)}if(r!==i||l){let a=t._$AA;for(;a!==r;){const c=a.nextSibling;n.insertBefore(a,i),a=c}}}return t},at=(s,e,t=s)=>(s._$AI(e,t),s),ti={},ei=(s,e=ti)=>s._$AH=e,ni=s=>s._$AH,fe=s=>{s._$AP?.(!1,!0);let e=s._$AA;const t=s._$AB.nextSibling;for(;e!==t;){const n=e.nextSibling;e.remove(),e=n}};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ge=(s,e,t)=>{const n=new Map;for(let i=e;i<=t;i++)n.set(s[i],i);return n},cn=ie(class extends re{constructor(s){if(super(s),s.type!==se.CHILD)throw Error("repeat() can only be used in text expressions")}ht(s,e,t){let n;t===void 0?t=e:e!==void 0&&(n=e);const i=[],r=[];let o=0;for(const l of s)i[o]=n?n(l,o):o,r[o]=t(l,o),o++;return{values:r,keys:i}}render(s,e,t){return this.ht(s,e,t).values}update(s,[e,t,n]){const i=ni(s),{values:r,keys:o}=this.ht(e,t,n);if(!Array.isArray(i))return this.dt=o,r;const l=this.dt??=[],a=[];let c,d,h=0,u=i.length-1,f=0,p=r.length-1;for(;h<=u&&f<=p;)if(i[h]===null)h++;else if(i[u]===null)u--;else if(l[h]===o[f])a[f]=at(i[h],r[f]),h++,f++;else if(l[u]===o[p])a[p]=at(i[u],r[p]),u--,p--;else if(l[h]===o[p])a[p]=at(i[h],r[p]),Tt(s,a[p+1],i[h]),h++,p--;else if(l[u]===o[f])a[f]=at(i[u],r[f]),Tt(s,i[h],i[u]),u--,f++;else if(c===void 0&&(c=Ge(o,f,p),d=Ge(l,h,u)),c.has(l[h]))if(c.has(l[u])){const m=d.get(o[f]),y=m!==void 0?i[m]:null;if(y===null){const v=Tt(s,i[h]);at(v,r[f]),a[f]=v}else a[f]=at(y,r[f]),Tt(s,i[h],y),i[m]=null;f++}else fe(i[u]),u--;else fe(i[h]),h++;for(;f<=p;){const m=Tt(s,a[p+1]);at(m,r[f]),a[f++]=m}for(;h<=u;){const m=i[h++];m!==null&&fe(m)}return this.dt=o,ei(s,a),Qt}});class si{constructor(e){this.editor=e,this.mapDeltasInInlineRange=(t,n,i=!1)=>{const r=i?ze(this.editor,this.deltas):this.deltas,o=[];return r.reduce((l,a,c)=>{const d=a.insert.length,h=t.index-d,u=t.index+t.length;if(l>=h&&(l<u||t.length===0&&l===t.index)){const p=n(a,l,c);o.push(p)}return l+d},0),o},this.getDeltaByRangeIndex=t=>{const n=this.deltas;let i=0;for(const r of n){if(i+r.insert.length>=t)return r;i+=r.insert.length}return null},this.getDeltasByInlineRange=t=>this.mapDeltasInInlineRange(t,(n,i)=>[n,{index:i,length:n.insert.length}]),this.render=async(t=!0)=>{if(!this.editor.mounted)return;this.editor.slots.render.emit();const n=this.editor.rootElement,i=ze(this.editor,this.deltas),r=Cs(i);let o=0;const l=r.map(a=>{if(a.length>0){const c=[];a.forEach(h=>{c.push([h,o]),o++});const d=c.map(([h,u])=>{let f=!1;const p=this.editor.getInlineRange();return p&&(f=this.isNormalizedDeltaSelected(u,p)),[Ks(h,this.editor.attributeService.normalizeAttributes,f),h]});return X`<v-line .elements=${d}></v-line>`}else return X`<v-line .elements=${[]}></v-line>`});try{yt(cn(l.map((a,c)=>({line:a,index:c})),a=>a.index,a=>a.line),n)}catch{this.editor.rerenderWholeEditor(),await this.editor.waitForUpdate()}await this.editor.waitForUpdate(),t&&this.editor.rangeService.syncInlineRange(),this.editor.slots.renderComplete.emit()}}get deltas(){return this.editor.yText.toDelta()}isNormalizedDeltaSelected(e,t){let n=!1;return t.length>=1&&this.editor.mapDeltasInInlineRange(t,(i,r,o)=>{o===e&&r>=t.index&&(n=!0)},!0),n}}function ye(s,e){return s===e||(s&&e?ii(s,e):!1)}function ii(s,e){return s.index===e.index&&s.length===e.length}function ri(s,e){return s.index<=e.index+e.length&&s.index+s.length>=e.index}function oi(s,e){if(!ri(s,e))return null;const t=Math.max(s.index,e.index),n=Math.min(s.index+s.length,e.index+e.length)-t;return{index:t,length:n}}class ai{constructor(e){this.editor=e,this._isComposing=!1,this._previousAnchor=null,this._previousFocus=null,this.mount=()=>{const t=this.editor.eventSource,n=this.editor.rootElement;this.inlineRangeProvider||this.editor.disposables.addFromEvent(document,"selectionchange",this._onSelectionChange),this.editor.disposables.addFromEvent(t,"beforeinput",this._onBeforeInput),this.editor.disposables.addFromEvent(t,"compositionstart",this._onCompositionStart),this.editor.disposables.addFromEvent(t,"compositionupdate",this._onCompositionUpdate),this.editor.disposables.addFromEvent(t,"compositionend",i=>{this._onCompositionEnd(i).catch(console.error)}),this.editor.disposables.addFromEvent(t,"keydown",this._onKeyDown),this.editor.disposables.addFromEvent(n,"click",this._onClick)},this._isRangeCompletelyInRoot=t=>{const n=this.editor.rootElement,i=document.createRange();return i.selectNode(n),t.startContainer.compareDocumentPosition(t.endContainer)&Node.DOCUMENT_POSITION_FOLLOWING?i.comparePoint(t.startContainer,t.startOffset)>=0&&i.comparePoint(t.endContainer,t.endOffset)<=0:i.comparePoint(t.endContainer,t.startOffset)>=0&&i.comparePoint(t.startContainer,t.endOffset)<=0},this._onSelectionChange=()=>{const t=this.editor.rootElement,n=this.editor.getInlineRange();if(this._isComposing)return;const r=$t(this.editor).getSelection();if(!r)return;if(r.rangeCount===0){n!==null&&this.editor.setInlineRange(null,!1);return}const o=r.getRangeAt(0);if(o.startContainer===o.endContainer&&o.startContainer.textContent===Ct&&o.startOffset===1){o.setStart(o.startContainer,0),o.setEnd(o.endContainer,0),r.removeAllRanges(),r.addRange(o);return}if(!o.intersectsNode(t))if(o.endContainer.contains(t)&&Array.from(o.endContainer.childNodes).filter(c=>c instanceof HTMLElement).length===1&&o.startContainer.contains(t)&&Array.from(o.startContainer.childNodes).filter(c=>c instanceof HTMLElement).length===1){this.editor.focusEnd();return}else{n!==null&&this.editor.setInlineRange(null,!1);return}this._previousAnchor=[o.startContainer,o.startOffset],this._previousFocus=[o.endContainer,o.endOffset];const l=this.editor.toInlineRange(r.getRangeAt(0));ye(n,l)||this.editor.setInlineRange(l,!1),((o.startContainer.nodeType!==Node.TEXT_NODE||o.endContainer.nodeType!==Node.TEXT_NODE)&&o.startContainer!==this._previousAnchor[0]&&o.endContainer!==this._previousFocus[0]&&o.startOffset!==this._previousAnchor[1]&&o.endOffset!==this._previousFocus[1]||o.startContainer.nodeType===Node.COMMENT_NODE||o.endContainer.nodeType===Node.COMMENT_NODE)&&this.editor.syncInlineRange()},this._compositionInlineRange=null,this._onCompositionStart=()=>{this._isComposing=!0,this.editor.rootElement.querySelectorAll('[data-v-embed="true"]').forEach(i=>{i.removeAttribute("contenteditable")});const n=this.editor.rangeService.getNativeRange();n?this._compositionInlineRange=this.editor.toInlineRange(n):this._compositionInlineRange=null},this._onCompositionUpdate=()=>{if(!this.editor.rootElement.isConnected)return;const t=this.editor.rangeService.getNativeRange();this.editor.isReadonly||!t||!this._isRangeCompletelyInRoot(t)||this.editor.slots.inputting.emit()},this._onCompositionEnd=async t=>{if(this._isComposing=!1,!this.editor.rootElement.isConnected)return;const n=this.editor.rangeService.getNativeRange();if(this.editor.isReadonly||!n||!this._isRangeCompletelyInRoot(n))return;this.editor.rerenderWholeEditor(),await this.editor.waitForUpdate();const i=this._compositionInlineRange;if(!i)return;t.preventDefault();let r={inlineEditor:this.editor,raw:t,inlineRange:i,data:t.data,attributes:{}};const o=this.editor.hooks.compositionEnd;if(o&&(r=o(r)),!r)return;const{inlineRange:l,data:a}=r;a&&a.length>0&&(this.editor.insertText(l,a,r.attributes),this.editor.setInlineRange({index:l.index+a.length,length:0},!1)),this.editor.slots.inputting.emit()},this._onBeforeInput=t=>{const n=this.editor.rangeService.getNativeRange();if(this.editor.isReadonly||this._isComposing||!n||!this._isRangeCompletelyInRoot(n)||!this.editor.getInlineRange())return;const i=t.getTargetRanges();if(i.length>0){const h=i[0],u=document.createRange();u.setStart(h.startContainer,h.startOffset),u.setEnd(h.endContainer,h.endOffset);const f=this.editor.toInlineRange(u);ye(this.editor.getInlineRange(),f)||this.editor.setInlineRange(f,!1)}const r=this.editor.getInlineRange();if(!r)return;t.preventDefault();let o={inlineEditor:this.editor,raw:t,inlineRange:r,data:t.data,attributes:{}};const l=this.editor.hooks.beforeinput;if(l&&(o=l(o)),!o)return;const{raw:a,data:c,inlineRange:d}=o;Gs(a.inputType,c,o.attributes,d,this.editor),this.editor.slots.inputting.emit()},this._onKeyDown=t=>{const n=this.editor.getInlineRange();if(n&&(this.editor.slots.keydown.emit(t),!t.shiftKey&&(t.key==="ArrowLeft"||t.key==="ArrowRight"))){if(n.length!==0)return;const i=()=>{t.preventDefault(),t.stopPropagation()},r=this.editor.getDeltasByInlineRange(n);if(r.length===2)t.key==="ArrowLeft"&&this.editor.isEmbed(r[0][0])?(i(),this.editor.setInlineRange({index:n.index-1,length:1})):t.key==="ArrowRight"&&this.editor.isEmbed(r[1][0])&&(i(),this.editor.setInlineRange({index:n.index,length:1}));else if(r.length===1){const o=r[0][0];this.editor.isEmbed(o)&&(t.key==="ArrowLeft"&&n.index-1>=0?(i(),this.editor.setInlineRange({index:n.index-1,length:1})):t.key==="ArrowRight"&&n.index+1<=this.editor.yTextLength&&(i(),this.editor.setInlineRange({index:n.index,length:1})))}}},this._onClick=t=>{if(t.target instanceof Node&&Wt(t.target)){const i=$t(this.editor).getSelection();if(!i)return;if(t.target instanceof HTMLElement){const r=t.target.closest("v-element");r&&i.selectAllChildren(r)}else{const r=t.target.parentElement?.closest("v-element");r&&i.selectAllChildren(r)}}}}get isComposing(){return this._isComposing}get inlineRangeProvider(){return this.editor.inlineRangeProvider}}class li{constructor(e){this.editor=e,this._inlineRange=null,this._lastStartRelativePosition=null,this._lastEndRelativePosition=null,this.onInlineRangeUpdated=async([t,n])=>{if(ye(this._inlineRange,t)||(this._inlineRange=t,t?(this._lastStartRelativePosition=Me(this.yText,t.index),this._lastEndRelativePosition=Me(this.yText,t.index+t.length)):(this._lastStartRelativePosition=null,this._lastEndRelativePosition=null),this.editor.mounted&&(await this.editor.waitForUpdate(),this.editor.requestUpdate(!1)),!n))return;if(this._inlineRange===null){const l=$t(this.editor).getSelection();l&&l.rangeCount>0&&l.getRangeAt(0).intersectsNode(this.editor.rootElement)&&l.removeAllRanges();return}requestAnimationFrame(()=>{this.syncInlineRange()})},this.getInlineRange=()=>this.inlineRangeProvider?this.inlineRangeProvider.getInlineRange():this._inlineRange,this.getInlineRangeFromElement=t=>{const n=document.createRange(),i=t.querySelector("[data-v-text");if(!i)return null;const r=i.childNodes[1];return C(r instanceof Text),n.setStart(r,0),n.setEnd(r,r.textContent?.length??0),this.toInlineRange(n)},this.isValidInlineRange=t=>!(t&&(t.index<0||t.index+t.length>this.editor.yText.length)),this.isFirstLine=t=>{if(!t)return!1;if(t.length>0)throw new Error("Inline range should be collapsed");const n=this.toDomRange(t);if(!n)throw new Error("failed to convert inline range to domRange");if(this.editor.yTextString.slice(0,t.index).includes(`
`))return!1;const r=n.commonAncestorContainer.parentElement;C(r);const o=r.getBoundingClientRect(),l=n.getClientRects();return l[l.length-1].top===o.top},this.isLastLine=t=>{if(!t)return!1;if(t.length>0)throw new Error("Inline range should be collapsed");if(this.editor.yTextString.slice(t.index).includes(`
`))return!1;const i=this.toDomRange(t);if(!i)throw new Error("failed to convert inline range to domRange");const r=i.commonAncestorContainer.parentElement;C(r);const o=r.getBoundingClientRect(),l=i.getClientRects();return l[l.length-1].bottom===o.bottom},this.setInlineRange=(t,n=!0)=>{if(!this.isValidInlineRange(t))throw new Error("invalid inline range");if(this.inlineRangeProvider){this.inlineRangeProvider.setInlineRange(t,n);return}this.editor.slots.inlineRangeUpdate.emit([t,n])},this.focusEnd=()=>{this.setInlineRange({index:this.editor.yTextLength,length:0})},this.focusStart=()=>{this.setInlineRange({index:0,length:0})},this.selectAll=()=>{this.setInlineRange({index:0,length:this.editor.yTextLength})},this.focusIndex=t=>{this.setInlineRange({index:t,length:0})},this.syncInlineRange=()=>{const t=this.getInlineRange();t&&this.editor.mounted&&this._applyInlineRange(t)},this.toDomRange=t=>{const n=this.editor.rootElement;return zs(n,t)},this.toInlineRange=t=>{const{rootElement:n,yText:i}=this.editor;return qs(t,n,i)},this._applyInlineRange=t=>{const i=$t(this.editor).getSelection();if(!i)return;const r=this.toDomRange(t);r&&(i.removeAllRanges(),i.addRange(r),this.editor.slots.inlineRangeApply.emit(r))}}get yText(){return this.editor.yText}get inlineRangeProvider(){return this.editor.inlineRangeProvider}get rootElement(){return this.editor.rootElement}get lastStartRelativePosition(){return this._lastStartRelativePosition}get lastEndRelativePosition(){return this._lastEndRelativePosition}getNativeSelection(){const t=$t(this.editor).getSelection();return!t||t.rangeCount===0?null:t}getNativeRange(){const e=this.getNativeSelection();return e?e.getRangeAt(0):null}getTextPoint(e){const t=Array.from(this.rootElement.querySelectorAll("v-line"));let n=0;for(const i of t){const r=Z(i);for(const o of r){if(!o.textContent)throw new Error("text element should have textContent");if(n+o.textContent.length>=e)return[o,e-n];n+=kt(o)}n+=1}throw new Error("failed to find leaf")}getLine(e){const t=Array.from(this.rootElement.querySelectorAll("v-line"));let n=0;for(const i of t){if(e>=n&&e<=n+i.textLength)return[i,e-n];if(e===n+i.textLength&&e===this.editor.yTextLength)return[i,e-n];n+=i.textLength+1}throw new Error("failed to find line")}}class ci{constructor(e){this.editor=e,this.transact=this.editor.transact,this.deleteText=t=>{this.transact(()=>{this.yText.delete(t.index,t.length)})},this.insertText=(t,n,i={})=>{this.editor.attributeService.marks&&(i={...i,...this.editor.attributeService.marks});const r=this.editor.attributeService.normalizeAttributes(i);if(!n||!n.length)throw new Error("text must not be empty");this.transact(()=>{this.yText.delete(t.index,t.length),this.yText.insert(t.index,n,r)})},this.insertLineBreak=t=>{this.transact(()=>{this.yText.delete(t.index,t.length),this.yText.insert(t.index,`
`)})},this.formatText=(t,n,i={})=>{const{match:r=()=>!0,mode:o="merge"}=i;this.editor.deltaService.getDeltasByInlineRange(t).filter(([a,c])=>r(a,c)).forEach(([a,c])=>{const d=this.editor.attributeService.normalizeAttributes(n);if(!d)return;const h=oi(t,c);h&&(o==="replace"&&this.resetText(h),this.transact(()=>{this.yText.format(h.index,h.length,d)}))})},this.resetText=t=>{const n=[];for(let r=t.index;r<=t.index+t.length;r++){const o=this.editor.getDeltaByRangeIndex(r);o&&n.push(o)}const i=Object.fromEntries(n.flatMap(r=>r.attributes?Object.keys(r.attributes).map(o=>[o,null]):[]));this.transact(()=>{this.yText.format(t.index,t.length,{...i})})},this.setText=(t,n={})=>{this.transact(()=>{this.yText.delete(0,this.yText.length),this.yText.insert(0,t,n)})}}get yText(){return this.editor.yText}}class gr{constructor(e,t={}){if(this._disposables=new ct,this._rootElement=null,this._eventSource=null,this._isReadonly=!1,this._eventService=new ai(this),this._rangeService=new li(this),this._attributeService=new Js(this),this._deltaService=new si(this),this._textService=new ci(this),this._mounted=!1,this.slots={mounted:new q,unmounted:new q,textChange:new q,render:new q,renderComplete:new q,inlineRangeUpdate:new q,inlineRangeApply:new q,inputting:new q,keydown:new q},this.setAttributeSchema=this._attributeService.setAttributeSchema,this.setAttributeRenderer=this._attributeService.setAttributeRenderer,this.setMarks=this._attributeService.setMarks,this.resetMarks=this._attributeService.resetMarks,this.getFormat=this._attributeService.getFormat,this.toDomRange=this.rangeService.toDomRange,this.toInlineRange=this.rangeService.toInlineRange,this.getInlineRange=this.rangeService.getInlineRange,this.getInlineRangeFromElement=this.rangeService.getInlineRangeFromElement,this.getNativeSelection=this.rangeService.getNativeSelection,this.getTextPoint=this.rangeService.getTextPoint,this.getLine=this.rangeService.getLine,this.isValidInlineRange=this.rangeService.isValidInlineRange,this.isFirstLine=this.rangeService.isFirstLine,this.isLastLine=this.rangeService.isLastLine,this.setInlineRange=this.rangeService.setInlineRange,this.focusStart=this.rangeService.focusStart,this.focusEnd=this.rangeService.focusEnd,this.selectAll=this.rangeService.selectAll,this.focusIndex=this.rangeService.focusIndex,this.syncInlineRange=this.rangeService.syncInlineRange,this.getDeltasByInlineRange=this.deltaService.getDeltasByInlineRange,this.getDeltaByRangeIndex=this.deltaService.getDeltaByRangeIndex,this.mapDeltasInInlineRange=this.deltaService.mapDeltasInInlineRange,this.isNormalizedDeltaSelected=this.deltaService.isNormalizedDeltaSelected,this.deleteText=this._textService.deleteText,this.insertText=this._textService.insertText,this.insertLineBreak=this._textService.insertLineBreak,this.formatText=this._textService.formatText,this.resetText=this._textService.resetText,this.setText=this._textService.setText,this._onYTextChange=(o,l)=>{if(this.yText.toString().includes("\r"))throw new Error('yText must not contain "\\r" because it will break the range synchronization');this.slots.textChange.emit(),Promise.resolve().then(()=>{if(this.deltaService.render().catch(console.error),!this.rangeService.getInlineRange())return;const c=this.rangeService.lastStartRelativePosition,d=this.rangeService.lastEndRelativePosition;if(!c||!d)return;const h=this.yText.doc;C(h);const u=Ne(c,h),f=Ne(d,h);console.log("🚀 ~ .then ~ absoluteEnd:",f,Tn(c));const p=u?.index,m=f?.index;if(!p||!m)return;const y={index:p,length:m-p};this.isValidInlineRange(y)&&this.setInlineRange(y)}).catch(console.error)},!e.doc)throw new Error("yText must be attached to a Y.Doc");if(e.toString().includes("\r"))throw new Error('yText must not contain "\\r" because it will break the range synchronization');const{isEmbed:n=()=>!1,hooks:i={},inlineRangeProvider:r=null}=t;this._yText=e,this.isEmbed=n,this._hooksService=new ws(this,i),this.inlineRangeProvider=r,r&&r.inlineRangeUpdated.on(o=>{this.slots.inlineRangeUpdate.emit(o)}),this.slots.inlineRangeUpdate.on(this.rangeService.onInlineRangeUpdated)}static{this.nativePointToTextPoint=me}static{this.textPointToDomPoint=wt}static{this.getTextNodesFromElement=Z}get disposables(){return this._disposables}get yText(){return this._yText}get yTextString(){return this.yText.toString()}get yTextLength(){return this.yText.length}get yTextDeltas(){return this.yText.toDelta()}get rootElement(){return C(this._rootElement),this._rootElement}get eventSource(){return C(this._eventSource),this._eventSource}get eventService(){return this._eventService}get rangeService(){return this._rangeService}get attributeService(){return this._attributeService}get deltaService(){return this._deltaService}get mounted(){return this._mounted}get marks(){return this._attributeService.marks}get hooks(){return this._hooksService.hooks}get isComposing(){return this._eventService.isComposing}mount(e,t=e){const n=e;n.inlineEditor=this,this._rootElement=n,this._eventSource=t,yt(z,this._rootElement),this._rootElement.contentEditable="true",this._rootElement.style.outline="none",this._eventSource.contentEditable="true",this._eventSource.style.outline="none",this._rootElement.dataset.vRoot="true",this._bindYTextObserver(),this._eventService.mount(),this._mounted=!0,this.slots.mounted.emit(),this._deltaService.render().catch(console.error)}unmount(){this.rootElement.isConnected&&yt(z,this.rootElement),this.rootElement.removeAttribute(ht),this._rootElement=null,this._mounted=!1,this.disposables.dispose(),this.slots.unmounted.emit()}requestUpdate(e=!0){this._deltaService.render(e).catch(console.error)}async waitForUpdate(){const e=Array.from(this.rootElement.querySelectorAll("v-line"));await Promise.all(e.map(t=>t.updateComplete))}setReadonly(e){this.rootElement.contentEditable=e?"false":"true",this._isReadonly=e}get isReadonly(){return this._isReadonly}rerenderWholeEditor(){this.rootElement.isConnected&&(yt(z,this.rootElement),this._deltaService.render().catch(console.error))}transact(e){const t=this.yText.doc;if(!t)throw new Error("yText is not attached to a doc");t.transact(e,t.clientID)}_bindYTextObserver(){this.yText.observe(this._onYTextChange),this.disposables.add({dispose:()=>{this.yText.unobserve(this._onYTextChange)}})}}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function hi(s,e,t){return s?e(s):t?.(s)}function Te(s){class e extends s{constructor(){super(...arguments),this._disposables=new ct}get disposables(){return this._disposables}connectedCallback(){super.connectedCallback(),this._disposables.disposed&&(this._disposables=new ct)}disconnectedCallback(){super.disconnectedCallback(),this._disposables.dispose()}}return e}class hn extends Y{static{this.disableShadowRoot=!0}static finalizeStyles(e){let t=super.finalizeStyles(e);return this.disableShadowRoot&&(t.forEach(n=>{if(n instanceof Se&&typeof document<"u"){const i=document.head,r=document.createElement("style");r.textContent=n.cssText,i.appendChild(r)}else console.error("unreachable")}),t=[]),t}createRenderRoot(){return this.constructor.disableShadowRoot?this:super.createRenderRoot()}}var di=Object.defineProperty,ui=Object.getOwnPropertyDescriptor,pt=(s,e,t,n)=>{for(var i=n>1?void 0:n?ui(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&di(e,t,i),i};class ot extends Te(hn){constructor(){super(...arguments),this.content=null,this.dirty=!1,this.selected=null,this.handleEvent=(e,t,n)=>{C(this.path,"Cannot bind block level hotkey without path");const i={flavour:n?.global?void 0:n?.flavour?this.model.flavour:void 0,path:n?.global||n?.flavour?void 0:this.path};this._disposables.add(this.host.event.add(e,t,i))},this.renderModel=e=>this.host.renderModel(e),this.renderModelChildren=e=>this.host.renderModelChildren(e)}get parentPath(){return this.path.slice(0,-1)}get parentBlockElement(){const e=this.parentElement;C(e);const t=this.host.view.getNodeView(e);return C(t),t.view}get childBlockElements(){return this.host.view.getChildren(this.path).filter(t=>t.type==="block").map(t=>t.view)}get rootBlockElement(){const e=this.host.view.viewFromPath("block",this.path.slice(0,1));return C(e),e}get topContenteditableElement(){return this.rootBlockElement}get flavour(){return this.model.flavour}get widgetElements(){return Object.keys(this.widgets).reduce((e,t)=>({...e,[t]:this.host.view.viewFromPath("widget",[...this.path,t])}),{})}get service(){return this.host.std.spec.getService(this.model.flavour)}get selection(){return this.host.selection}get std(){return this.host.std}get isVersionMismatch(){const e=this.page.schema.flavourSchemaMap.get(this.model.flavour);C(e,`Cannot find schema for flavour ${this.model.flavour}`);const t=e.version,n=this.model.version;return t!==n?(console.warn(`Version mismatch for block ${this.model.id}, expected ${t}, actual ${n}`),!0):!1}bindHotKey(e,t){C(this.path,"Cannot bind block level hotkey without path");const n={flavour:t?.global?void 0:t?.flavour?this.model.flavour:void 0,path:t?.global||t?.flavour?void 0:this.path};this._disposables.add(this.host.event.bindHotkey(e,n))}async getUpdateComplete(){const e=await super.getUpdateComplete();return await Promise.all(this.childBlockElements.map(t=>t.updateComplete)),e}update(e){this.dirty?(this.__reflectingProperties&&=this.__reflectingProperties.forEach(t=>this.__propertyToAttribute(t,this[t])),this._$changedProperties=new Map,this.isUpdatePending=!1,this.__childPart=yt(z,this.renderRoot),this.updateComplete.then(()=>{this.dirty=!1}).catch(console.error)):super.update(e)}connectedCallback(){super.connectedCallback(),this.path=this.host.view.calculatePath(this),this._disposables.add(this.model.propsUpdated.on(()=>{this.requestUpdate()})),this._disposables.add(this.model.childrenUpdated.on(()=>{this.requestUpdate()})),this._disposables.add(this.host.selection.slots.changed.on(e=>{const t=e.find(n=>A.equals(n.path,this.path));if(!t){this.selected=null;return}this.selected=t}))}disconnectedCallback(){super.disconnectedCallback()}renderBlock(){return z}renderVersionMismatch(e,t){return mt`
      <dl class="version-mismatch-warning" contenteditable="false">
        <dt>
          <h4>Block Version Mismatched</h4>
        </dt>
        <dd>
          <p>
            We can not render this <var>${this.model.flavour}</var> block
            because the version is mismatched.
          </p>
          <p>Editor version: <var>${e}</var></p>
          <p>Data version: <var>${t}</var></p>
        </dd>
      </dl>
    `}render(){return hi(this.isVersionMismatch,()=>{const e=this.page.schema.flavourSchemaMap.get(this.model.flavour);C(e,`Cannot find schema for flavour ${this.model.flavour}`);const t=e.version,n=this.model.version;return this.renderVersionMismatch(t,n)},()=>this.renderBlock())}}pt([$({attribute:!1})],ot.prototype,"host",2);pt([$({attribute:!1})],ot.prototype,"model",2);pt([$({attribute:!1})],ot.prototype,"content",2);pt([$({attribute:!1,hasChanged(s,e){return!s||!e?s!==e:!Object.keys(s).length&&!Object.keys(e).length?!1:s!==e}})],ot.prototype,"widgets",2);pt([$({attribute:!1})],ot.prototype,"page",2);pt([$({attribute:!1})],ot.prototype,"dirty",2);pt([ds({hasChanged(s,e){return!s||!e?s!==e:!s?.equals(e)}})],ot.prototype,"selected",2);class fi{constructor(e){this.manager=e,this.isComposing=!1,this._prevSelection=null,this._onStdSelectionChanged=t=>{this.host.updateComplete.then(()=>{const n=t.find(r=>r.is("text"))??null;(n&&this._prevSelection?n.equals(this._prevSelection):n===this._prevSelection)||(this._prevSelection=n,n?this.rangeManager.syncTextSelectionToRange(n):this.rangeManager.clear())}).catch(console.error)},this._onNativeSelectionChanged=async()=>{if(this.isComposing)return;await this.host.updateComplete;const t=document.getSelection();if(!t){this.selectionManager.clear(["text"]);return}const n=t.rangeCount>0?t.getRangeAt(0):null,i=!!t.anchorNode&&!!t.focusNode&&(t.anchorNode===t.focusNode?t.anchorOffset>t.focusOffset:t.anchorNode.compareDocumentPosition(t.focusNode)===Node.DOCUMENT_POSITION_PRECEDING);if(n){const r=this.rangeManager.getClosestInlineEditor(n.commonAncestorContainer);if(r&&r.isComposing)return;this._prevSelection=this.rangeManager.rangeToTextSelection(n,i),this.rangeManager.syncRangeToTextSelection(n,i)}else this._prevSelection=null,this.selectionManager.clear(["text"])},this._onBeforeInput=t=>{const n=this.selectionManager.find("text");if(!n||t.isComposing)return;const{from:i,to:r}=n;if(!r||A.equals(i.path,r.path))return;const o=this.rangeManager.value;if(!o)return;const l=this.rangeManager.getSelectedBlockElementsByRange(o,{mode:"flat"}),a=l.at(0),c=l.at(-1);if(!a||!c)return;const d=a.model.text,h=c.model.text;if(!d||!h)return;t.preventDefault(),this.host.page.transact(()=>{d.delete(i.index,i.length),d.insert(t.data??"",i.index),h.delete(0,r.length),d.join(h),l.slice(1).reverse().forEach(f=>{const p=this.host.page.getParent(f.model);C(p),this.host.page.deleteBlock(f.model,{bringChildrenTo:p})})});const u=this.selectionManager.create("text",{from:{path:i.path,index:i.index+(t.data?.length??0),length:0},to:null});this.selectionManager.set([u])},this._compositionStartCallback=null,this._onCompositionStart=()=>{const t=this.selectionManager.find("text");if(!t)return;const{from:n,to:i}=t;if(!i)return;this.isComposing=!0;const r=this.rangeManager.value;if(!r)return;const o=this.rangeManager.getSelectedBlockElementsByRange(r,{mode:"flat"}),l=this.rangeManager.getSelectedBlockElementsByRange(r,{mode:"highest",match:u=>u.model.role==="content"}),a=o.at(0),c=o.at(-1);if(!a||!c)return;const d=a.model.text,h=c.model.text;!d||!h||(this._compositionStartCallback=async u=>{this.isComposing=!1;const f=[];for(const m of l){const y=this.host.view.getParent(m.path)?.view;!(y instanceof ot)||f.includes(y)||(y.dirty=!0,await y.updateComplete,await y.updateComplete,f.push(y))}this.host.page.transact(()=>{h.delete(0,i.length),d.join(h),o.slice(1).reverse().forEach(m=>{const y=this.host.page.getParent(m.model);C(y),this.host.page.deleteBlock(m.model,{bringChildrenTo:y})})}),await this.host.updateComplete;const p=this.selectionManager.create("text",{from:{path:n.path,index:n.index+(u.data?.length??0),length:0},to:null});this.host.selection.set([p]),this.rangeManager.syncTextSelectionToRange(p)})},this._onCompositionEnd=t=>{this._compositionStartCallback&&(t.preventDefault(),this._compositionStartCallback(t).catch(console.error),this._compositionStartCallback=null)},this.host.disposables.add(this.selectionManager.slots.changed.on(this._onStdSelectionChanged)),this.host.disposables.add(this.host.event.add("selectionChange",()=>{this._onNativeSelectionChanged().catch(console.error)})),this.host.disposables.add(this.host.event.add("beforeInput",t=>{const n=t.get("defaultState").event;this._onBeforeInput(n)})),this.host.disposables.add(this.host.event.add("compositionStart",this._onCompositionStart)),this.host.disposables.add(this.host.event.add("compositionEnd",t=>{const n=t.get("defaultState").event;this._onCompositionEnd(n)}))}get selectionManager(){return this.host.selection}get rangeManager(){return C(this.host.rangeManager),this.host.rangeManager}get host(){return this.manager.host}}class Yt{constructor(e){this.host=e,this.binding=new fi(this)}static{this.rangeSyncExcludeAttr="data-range-sync-exclude"}static{this.rangeQueryExcludeAttr="data-range-query-exclude"}get value(){const e=document.getSelection();return C(e),e.rangeCount===0?null:e.getRangeAt(0)}clear(){const e=document.getSelection();C(e),e.removeAllRanges();const t=this.host.querySelector('[contenteditable="true"]');t instanceof HTMLElement&&t.blur()}set(e){const t=document.getSelection();C(t),t.removeAllRanges(),t.addRange(e)}syncTextSelectionToRange(e){const t=this.textSelectionToRange(e);t?this.set(t):this.clear()}syncRangeToTextSelection(e,t){const n=this.host.selection;if(!e){n.clear(["text"]);return}const i=this.rangeToTextSelection(e,t);i?n.setGroup("note",[i]):n.clear(["text"])}getSelectedBlockElementsByRange(e,t={}){const{mode:n="all",match:i=()=>!0}=t;let r=Array.from(this.host.querySelectorAll(`[${this.host.blockIdAttr}]:not([${Yt.rangeQueryExcludeAttr}="true"])`)).filter(l=>e.intersectsNode(l)&&i(l));if(r.length===0)return[];const o=this.getClosestBlock(e.startContainer);if(C(o),n==="flat")r=r.filter(l=>o.compareDocumentPosition(l)&Node.DOCUMENT_POSITION_FOLLOWING||l===o);else if(n==="highest"){let l=r[0];r=r.filter((a,c)=>c===0?!0:l.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_CONTAINED_BY?!1:(l=a,!0))}return r}textSelectionToRange(e){const{from:t,to:n,isReverse:i}=e,r=this.queryInlineEditorByPath(t.path);if(!r)return null;if(e.isInSameBlock())return r.toDomRange({index:t.index,length:t.length});{C(n);const o=this.queryInlineEditorByPath(n.path);if(!o)return null;const l=r.toDomRange({index:t.index,length:t.length}),a=o.toDomRange({index:n.index,length:n.length});if(!l||!a)return null;const c=document.createRange();if(i){const d=a.endContainer,h=a.endOffset,u=l.startContainer,f=l.startOffset;c.setStart(d,h),c.setEnd(u,f)}else{const d=l.startContainer,h=l.startOffset,u=a.endContainer,f=a.endOffset;c.setStart(d,h),c.setEnd(u,f)}return c}}rangeToTextSelection(e,t=!1){const{startContainer:n,endContainer:i}=e,r=this.getClosestBlock(n),o=this.getClosestBlock(i);if(!r||!o)return null;const l=this.getClosestInlineEditor(n),a=this.getClosestInlineEditor(i);if(!l||!a)return null;const c=l.toInlineRange(e),d=a.toInlineRange(e);return!c||!d?null:this.host.selection.create("text",{from:{path:r.path,index:c.index,length:c.length},to:r===o?null:{path:o.path,index:d.index,length:d.length},isReverse:t})}getClosestBlock(e){const t=e instanceof Element?e:e.parentElement;if(!t)return null;const n=t.closest(`[${this.host.blockIdAttr}]`);return!n||n.getAttribute(Yt.rangeSyncExcludeAttr)==="true"?null:n}getClosestInlineEditor(e){const t=e instanceof Element?e:e.parentElement;if(!t)return null;const n=t.closest(`[${ht}]`);return!n||!this.getClosestBlock(n)?null:n.inlineEditor}queryInlineEditorByPath(e){const t=this.host.view.viewFromPath("block",e);if(!t)return null;const n=t.querySelector(`[${ht}]`);return!n||!this.getClosestBlock(n)?null:n.inlineEditor}}var pi=Object.defineProperty,gi=Object.getOwnPropertyDescriptor,Mt=(s,e,t,n)=>{for(var i=n>1?void 0:n?gi(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&pi(e,t,i),i};let xt=class extends Te(hn){constructor(){super(...arguments),this.blockIdAttr="data-block-id",this.widgetIdAttr="data-widget-id",this.rangeManager=null,this.renderModel=s=>{const{flavour:e}=s;if(!this.page.schema.flavourSchemaMap.get(e))return console.warn(`Cannot find schema for ${e}.`),mt`${z}`;const n=this.std.spec.getView(e);if(!n)return console.warn(`Cannot find view for ${e}.`),mt`${z}`;const i=n.component,r=n.widgets?Object.entries(n.widgets).reduce((o,[l,a])=>{const c=mt`<${a} ${Be(this.widgetIdAttr)}=${l} .host=${this} .page=${this.page}></${a}>`;return{...o,[l]:c}},{}):{};return mt`<${i}
      ${Be(this.blockIdAttr)}=${s.id}
      .host=${this}
      .page=${this.page}
      .model=${s}
      .widgets=${r}
    ></${i}>`},this.renderModelChildren=s=>mt`${cn(s.children,e=>e.id,e=>this.renderModel(e))}`,this._registerView=()=>{const s=`[${this.blockIdAttr}]`,e=`[${this.widgetIdAttr}]`;this.std.view.register({type:"block",fromDOM:t=>Je(t,this.blockIdAttr,this.widgetIdAttr,"block"),toDOM:({view:t})=>t,getChildren:t=>Ze(t,s,e,"block")}),this.std.view.register({type:"widget",fromDOM:t=>Je(t,this.widgetIdAttr,this.blockIdAttr,"widget"),toDOM:({view:t})=>t,getChildren:t=>Ze(t,s,e,"widget")})}}get command(){return this.std.command}get event(){return this.std.event}get selection(){return this.std.selection}get view(){return this.std.view}get spec(){return this.std.spec}willUpdate(s){s.has("specs")&&this.std.spec.applySpecs(this.specs),super.willUpdate(s)}async getUpdateComplete(){const s=await super.getUpdateComplete(),e=this.page.root;C(e);const t=this.std.spec.getView(e.flavour);C(t);const n=Object.values(t.widgets??{}),i=[t.component,...n];return await Promise.all(i.map(r=>{const o=this.renderRoot.querySelector(r._$litStatic$);if(o instanceof Y)return o.updateComplete})),s}connectedCallback(){if(super.connectedCallback(),!this.page.root)throw new Error("This page is missing root block. Please initialize the default block structure before connecting the editor to DOM.");this.std=new Jn({host:this,workspace:this.page.workspace,page:this.page}),this._registerView(),this.std.mount(),this.std.spec.applySpecs(this.specs),this.rangeManager=new Yt(this)}disconnectedCallback(){super.disconnectedCallback(),this.std.unmount(),this.rangeManager=null}render(){const{root:s}=this.page;return s?this.renderModel(s):z}};Mt([$({attribute:!1})],xt.prototype,"specs",2);Mt([$({attribute:!1})],xt.prototype,"page",2);Mt([$({attribute:!1})],xt.prototype,"blockIdAttr",2);Mt([$({attribute:!1})],xt.prototype,"widgetIdAttr",2);xt=Mt([ne("editor-host")],xt);function Je(s,e,t,n){const i=`[${e}]`,r=`[${t}]`,o=s&&s instanceof HTMLElement?s:s.parentElement;if(!o)return null;const l=o.closest(i);if(!l)return null;const a=o.closest(r);if(l.contains(a))return null;const c=l.getAttribute(e);return C(c),{id:c,path:l.path,view:l,type:n}}function Ze(s,e,t,n){const i=`${e},${t}`;return Array.from(s.querySelectorAll(i)).filter(r=>r.parentElement?.closest(n==="block"?e:t)===s)}var mi=Object.defineProperty,vi=Object.getOwnPropertyDescriptor,dn=(s,e,t,n)=>{for(var i=n>1?void 0:n?vi(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&mi(e,t,i),i};class un extends Te(Y){constructor(){super(...arguments),this.handleEvent=(e,t,n)=>{this._disposables.add(this.host.event.add(e,t,{flavour:n?.global?void 0:this.flavour}))}}get widgetName(){return this.path[this.path.length-1]}get hostPath(){return this.path.slice(0,-1)}get blockElement(){const e=this.parentElement;C(e);const t=this.host.view.getNodeView(e);return C(t),t.view}get flavour(){return C(this.blockElement),this.blockElement.model.flavour}get std(){return this.host.std}bindHotKey(e,t){this._disposables.add(this.host.event.bindHotkey(e,{flavour:t?.global?void 0:this.flavour}))}connectedCallback(){super.connectedCallback(),this.path=this.host.view.calculatePath(this)}render(){return null}}dn([$({attribute:!1})],un.prototype,"host",2);dn([$({attribute:!1})],un.prototype,"page",2);const yi=["top","right","bottom","left"],Qe=["start","end"],tn=yi.reduce((s,e)=>s.concat(e,e+"-"+Qe[0],e+"-"+Qe[1]),[]),W=Math.min,D=Math.max,Xt=Math.round,Lt=Math.floor,it=s=>({x:s,y:s}),_i={left:"right",right:"left",bottom:"top",top:"bottom"},wi={start:"end",end:"start"};function _e(s,e,t){return D(s,W(e,t))}function G(s,e){return typeof s=="function"?s(e):s}function U(s){return s.split("-")[0]}function K(s){return s.split("-")[1]}function Ae(s){return s==="x"?"y":"x"}function $e(s){return s==="y"?"height":"width"}function gt(s){return["top","bottom"].includes(U(s))?"y":"x"}function Oe(s){return Ae(gt(s))}function fn(s,e,t){t===void 0&&(t=!1);const n=K(s),i=Oe(s),r=$e(i);let o=i==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(o=Jt(o)),[o,Jt(o)]}function xi(s){const e=Jt(s);return[Gt(s),e,Gt(e)]}function Gt(s){return s.replace(/start|end/g,e=>wi[e])}function bi(s,e,t){const n=["left","right"],i=["right","left"],r=["top","bottom"],o=["bottom","top"];switch(s){case"top":case"bottom":return t?e?i:n:e?n:i;case"left":case"right":return e?r:o;default:return[]}}function Si(s,e,t,n){const i=K(s);let r=bi(U(s),t==="start",n);return i&&(r=r.map(o=>o+"-"+i),e&&(r=r.concat(r.map(Gt)))),r}function Jt(s){return s.replace(/left|right|bottom|top/g,e=>_i[e])}function Ei(s){return{top:0,right:0,bottom:0,left:0,...s}}function Pe(s){return typeof s!="number"?Ei(s):{top:s,right:s,bottom:s,left:s}}function bt(s){return{...s,top:s.y,left:s.x,right:s.x+s.width,bottom:s.y+s.height}}function en(s,e,t){let{reference:n,floating:i}=s;const r=gt(e),o=Oe(e),l=$e(o),a=U(e),c=r==="y",d=n.x+n.width/2-i.width/2,h=n.y+n.height/2-i.height/2,u=n[l]/2-i[l]/2;let f;switch(a){case"top":f={x:d,y:n.y-i.height};break;case"bottom":f={x:d,y:n.y+n.height};break;case"right":f={x:n.x+n.width,y:h};break;case"left":f={x:n.x-i.width,y:h};break;default:f={x:n.x,y:n.y}}switch(K(e)){case"start":f[o]-=u*(t&&c?-1:1);break;case"end":f[o]+=u*(t&&c?-1:1);break}return f}const Ci=async(s,e,t)=>{const{placement:n="bottom",strategy:i="absolute",middleware:r=[],platform:o}=t,l=r.filter(Boolean),a=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:s,floating:e,strategy:i}),{x:d,y:h}=en(c,n,a),u=n,f={},p=0;for(let m=0;m<l.length;m++){const{name:y,fn:v}=l[m],{x,y:_,data:E,reset:b}=await v({x:d,y:h,initialPlacement:n,placement:u,strategy:i,middlewareData:f,rects:c,platform:o,elements:{reference:s,floating:e}});if(d=x??d,h=_??h,f={...f,[y]:{...f[y],...E}},b&&p<=50){p++,typeof b=="object"&&(b.placement&&(u=b.placement),b.rects&&(c=b.rects===!0?await o.getElementRects({reference:s,floating:e,strategy:i}):b.rects),{x:d,y:h}=en(c,u,a)),m=-1;continue}}return{x:d,y:h,placement:u,strategy:i,middlewareData:f}};async function oe(s,e){var t;e===void 0&&(e={});const{x:n,y:i,platform:r,rects:o,elements:l,strategy:a}=s,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:h="floating",altBoundary:u=!1,padding:f=0}=G(e,s),p=Pe(f),y=l[u?h==="floating"?"reference":"floating":h],v=bt(await r.getClippingRect({element:(t=await(r.isElement==null?void 0:r.isElement(y)))==null||t?y:y.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(l.floating)),boundary:c,rootBoundary:d,strategy:a})),x=h==="floating"?{...o.floating,x:n,y:i}:o.reference,_=await(r.getOffsetParent==null?void 0:r.getOffsetParent(l.floating)),E=await(r.isElement==null?void 0:r.isElement(_))?await(r.getScale==null?void 0:r.getScale(_))||{x:1,y:1}:{x:1,y:1},b=bt(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({rect:x,offsetParent:_,strategy:a}):x);return{top:(v.top-b.top+p.top)/E.y,bottom:(b.bottom-v.bottom+p.bottom)/E.y,left:(v.left-b.left+p.left)/E.x,right:(b.right-v.right+p.right)/E.x}}const Ri=s=>({name:"arrow",options:s,async fn(e){const{x:t,y:n,placement:i,rects:r,platform:o,elements:l,middlewareData:a}=e,{element:c,padding:d=0}=G(s,e)||{};if(c==null)return{};const h=Pe(d),u={x:t,y:n},f=Oe(i),p=$e(f),m=await o.getDimensions(c),y=f==="y",v=y?"top":"left",x=y?"bottom":"right",_=y?"clientHeight":"clientWidth",E=r.reference[p]+r.reference[f]-u[f]-r.floating[p],b=u[f]-r.reference[f],g=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let w=g?g[_]:0;(!w||!await(o.isElement==null?void 0:o.isElement(g)))&&(w=l.floating[_]||r.floating[p]);const S=E/2-b/2,N=w/2-m[p]/2-1,T=W(h[v],N),I=W(h[x],N),O=T,j=w-m[p]-I,k=w/2-m[p]/2+S,M=_e(O,k,j),B=!a.arrow&&K(i)!=null&&k!=M&&r.reference[p]/2-(k<O?T:I)-m[p]/2<0,V=B?k<O?k-O:k-j:0;return{[f]:u[f]+V,data:{[f]:M,centerOffset:k-M-V,...B&&{alignmentOffset:V}},reset:B}}});function Ti(s,e,t){return(s?[...t.filter(i=>K(i)===s),...t.filter(i=>K(i)!==s)]:t.filter(i=>U(i)===i)).filter(i=>s?K(i)===s||(e?Gt(i)!==i:!1):!0)}const Ai=function(s){return s===void 0&&(s={}),{name:"autoPlacement",options:s,async fn(e){var t,n,i;const{rects:r,middlewareData:o,placement:l,platform:a,elements:c}=e,{crossAxis:d=!1,alignment:h,allowedPlacements:u=tn,autoAlignment:f=!0,...p}=G(s,e),m=h!==void 0||u===tn?Ti(h||null,f,u):u,y=await oe(e,p),v=((t=o.autoPlacement)==null?void 0:t.index)||0,x=m[v];if(x==null)return{};const _=fn(x,r,await(a.isRTL==null?void 0:a.isRTL(c.floating)));if(l!==x)return{reset:{placement:m[0]}};const E=[y[U(x)],y[_[0]],y[_[1]]],b=[...((n=o.autoPlacement)==null?void 0:n.overflows)||[],{placement:x,overflows:E}],g=m[v+1];if(g)return{data:{index:v+1,overflows:b},reset:{placement:g}};const w=b.map(T=>{const I=K(T.placement);return[T.placement,I&&d?T.overflows.slice(0,2).reduce((O,j)=>O+j,0):T.overflows[0],T.overflows]}).sort((T,I)=>T[1]-I[1]),N=((i=w.filter(T=>T[2].slice(0,K(T[0])?2:3).every(I=>I<=0))[0])==null?void 0:i[0])||w[0][0];return N!==l?{data:{index:v+1,overflows:b},reset:{placement:N}}:{}}}},$i=function(s){return s===void 0&&(s={}),{name:"flip",options:s,async fn(e){var t,n;const{placement:i,middlewareData:r,rects:o,initialPlacement:l,platform:a,elements:c}=e,{mainAxis:d=!0,crossAxis:h=!0,fallbackPlacements:u,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:m=!0,...y}=G(s,e);if((t=r.arrow)!=null&&t.alignmentOffset)return{};const v=U(i),x=U(l)===l,_=await(a.isRTL==null?void 0:a.isRTL(c.floating)),E=u||(x||!m?[Jt(l)]:xi(l));!u&&p!=="none"&&E.push(...Si(l,m,p,_));const b=[l,...E],g=await oe(e,y),w=[];let S=((n=r.flip)==null?void 0:n.overflows)||[];if(d&&w.push(g[v]),h){const O=fn(i,o,_);w.push(g[O[0]],g[O[1]])}if(S=[...S,{placement:i,overflows:w}],!w.every(O=>O<=0)){var N,T;const O=(((N=r.flip)==null?void 0:N.index)||0)+1,j=b[O];if(j)return{data:{index:O,overflows:S},reset:{placement:j}};let k=(T=S.filter(M=>M.overflows[0]<=0).sort((M,B)=>M.overflows[1]-B.overflows[1])[0])==null?void 0:T.placement;if(!k)switch(f){case"bestFit":{var I;const M=(I=S.map(B=>[B.placement,B.overflows.filter(V=>V>0).reduce((V,ce)=>V+ce,0)]).sort((B,V)=>B[1]-V[1])[0])==null?void 0:I[0];M&&(k=M);break}case"initialPlacement":k=l;break}if(i!==k)return{reset:{placement:k}}}return{}}}};function pn(s){const e=W(...s.map(r=>r.left)),t=W(...s.map(r=>r.top)),n=D(...s.map(r=>r.right)),i=D(...s.map(r=>r.bottom));return{x:e,y:t,width:n-e,height:i-t}}function Oi(s){const e=s.slice().sort((i,r)=>i.y-r.y),t=[];let n=null;for(let i=0;i<e.length;i++){const r=e[i];!n||r.y-n.y>n.height/2?t.push([r]):t[t.length-1].push(r),n=r}return t.map(i=>bt(pn(i)))}const Pi=function(s){return s===void 0&&(s={}),{name:"inline",options:s,async fn(e){const{placement:t,elements:n,rects:i,platform:r,strategy:o}=e,{padding:l=2,x:a,y:c}=G(s,e),d=Array.from(await(r.getClientRects==null?void 0:r.getClientRects(n.reference))||[]),h=Oi(d),u=bt(pn(d)),f=Pe(l);function p(){if(h.length===2&&h[0].left>h[1].right&&a!=null&&c!=null)return h.find(y=>a>y.left-f.left&&a<y.right+f.right&&c>y.top-f.top&&c<y.bottom+f.bottom)||u;if(h.length>=2){if(gt(t)==="y"){const T=h[0],I=h[h.length-1],O=U(t)==="top",j=T.top,k=I.bottom,M=O?T.left:I.left,B=O?T.right:I.right,V=B-M,ce=k-j;return{top:j,bottom:k,left:M,right:B,width:V,height:ce,x:M,y:j}}const y=U(t)==="left",v=D(...h.map(T=>T.right)),x=W(...h.map(T=>T.left)),_=h.filter(T=>y?T.left===x:T.right===v),E=_[0].top,b=_[_.length-1].bottom,g=x,w=v,S=w-g,N=b-E;return{top:E,bottom:b,left:g,right:w,width:S,height:N,x:g,y:E}}return u}const m=await r.getElementRects({reference:{getBoundingClientRect:p},floating:n.floating,strategy:o});return i.reference.x!==m.reference.x||i.reference.y!==m.reference.y||i.reference.width!==m.reference.width||i.reference.height!==m.reference.height?{reset:{rects:m}}:{}}}};async function ki(s,e){const{placement:t,platform:n,elements:i}=s,r=await(n.isRTL==null?void 0:n.isRTL(i.floating)),o=U(t),l=K(t),a=gt(t)==="y",c=["left","top"].includes(o)?-1:1,d=r&&a?-1:1,h=G(e,s);let{mainAxis:u,crossAxis:f,alignmentAxis:p}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...h};return l&&typeof p=="number"&&(f=l==="end"?p*-1:p),a?{x:f*d,y:u*c}:{x:u*c,y:f*d}}const mr=function(s){return s===void 0&&(s=0),{name:"offset",options:s,async fn(e){var t,n;const{x:i,y:r,placement:o,middlewareData:l}=e,a=await ki(e,s);return o===((t=l.offset)==null?void 0:t.placement)&&(n=l.arrow)!=null&&n.alignmentOffset?{}:{x:i+a.x,y:r+a.y,data:{...a,placement:o}}}}},Di=function(s){return s===void 0&&(s={}),{name:"shift",options:s,async fn(e){const{x:t,y:n,placement:i}=e,{mainAxis:r=!0,crossAxis:o=!1,limiter:l={fn:y=>{let{x:v,y:x}=y;return{x:v,y:x}}},...a}=G(s,e),c={x:t,y:n},d=await oe(e,a),h=gt(U(i)),u=Ae(h);let f=c[u],p=c[h];if(r){const y=u==="y"?"top":"left",v=u==="y"?"bottom":"right",x=f+d[y],_=f-d[v];f=_e(x,f,_)}if(o){const y=h==="y"?"top":"left",v=h==="y"?"bottom":"right",x=p+d[y],_=p-d[v];p=_e(x,p,_)}const m=l.fn({...e,[u]:f,[h]:p});return{...m,data:{x:m.x-t,y:m.y-n}}}}},Ii=function(s){return s===void 0&&(s={}),{options:s,fn(e){const{x:t,y:n,placement:i,rects:r,middlewareData:o}=e,{offset:l=0,mainAxis:a=!0,crossAxis:c=!0}=G(s,e),d={x:t,y:n},h=gt(i),u=Ae(h);let f=d[u],p=d[h];const m=G(l,e),y=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(a){const _=u==="y"?"height":"width",E=r.reference[u]-r.floating[_]+y.mainAxis,b=r.reference[u]+r.reference[_]-y.mainAxis;f<E?f=E:f>b&&(f=b)}if(c){var v,x;const _=u==="y"?"width":"height",E=["top","left"].includes(U(i)),b=r.reference[h]-r.floating[_]+(E&&((v=o.offset)==null?void 0:v[h])||0)+(E?0:y.crossAxis),g=r.reference[h]+r.reference[_]+(E?0:((x=o.offset)==null?void 0:x[h])||0)-(E?y.crossAxis:0);p<b?p=b:p>g&&(p=g)}return{[u]:f,[h]:p}}}},Mi=function(s){return s===void 0&&(s={}),{name:"size",options:s,async fn(e){const{placement:t,rects:n,platform:i,elements:r}=e,{apply:o=()=>{},...l}=G(s,e),a=await oe(e,l),c=U(t),d=K(t),h=gt(t)==="y",{width:u,height:f}=n.floating;let p,m;c==="top"||c==="bottom"?(p=c,m=d===(await(i.isRTL==null?void 0:i.isRTL(r.floating))?"start":"end")?"left":"right"):(m=c,p=d==="end"?"top":"bottom");const y=f-a[p],v=u-a[m],x=!e.middlewareData.shift;let _=y,E=v;if(h){const g=u-a.left-a.right;E=d||x?W(v,g):g}else{const g=f-a.top-a.bottom;_=d||x?W(y,g):g}if(x&&!d){const g=D(a.left,0),w=D(a.right,0),S=D(a.top,0),N=D(a.bottom,0);h?E=u-2*(g!==0||w!==0?g+w:D(a.left,a.right)):_=f-2*(S!==0||N!==0?S+N:D(a.top,a.bottom))}await o({...e,availableWidth:E,availableHeight:_});const b=await i.getDimensions(r.floating);return u!==b.width||f!==b.height?{reset:{rects:!0}}:{}}}};function rt(s){return gn(s)?(s.nodeName||"").toLowerCase():"#document"}function L(s){var e;return(s==null||(e=s.ownerDocument)==null?void 0:e.defaultView)||window}function et(s){var e;return(e=(gn(s)?s.ownerDocument:s.document)||window.document)==null?void 0:e.documentElement}function gn(s){return s instanceof Node||s instanceof L(s).Node}function Q(s){return s instanceof Element||s instanceof L(s).Element}function J(s){return s instanceof HTMLElement||s instanceof L(s).HTMLElement}function nn(s){return typeof ShadowRoot>"u"?!1:s instanceof ShadowRoot||s instanceof L(s).ShadowRoot}function Nt(s){const{overflow:e,overflowX:t,overflowY:n,display:i}=F(s);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!["inline","contents"].includes(i)}function Ni(s){return["table","td","th"].includes(rt(s))}function ke(s){const e=De(),t=F(s);return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(n=>(t.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(t.contain||"").includes(n))}function Bi(s){let e=St(s);for(;J(e)&&!ae(e);){if(ke(e))return e;e=St(e)}return null}function De(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function ae(s){return["html","body","#document"].includes(rt(s))}function F(s){return L(s).getComputedStyle(s)}function le(s){return Q(s)?{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}:{scrollLeft:s.pageXOffset,scrollTop:s.pageYOffset}}function St(s){if(rt(s)==="html")return s;const e=s.assignedSlot||s.parentNode||nn(s)&&s.host||et(s);return nn(e)?e.host:e}function mn(s){const e=St(s);return ae(e)?s.ownerDocument?s.ownerDocument.body:s.body:J(e)&&Nt(e)?e:mn(e)}function Dt(s,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const i=mn(s),r=i===((n=s.ownerDocument)==null?void 0:n.body),o=L(i);return r?e.concat(o,o.visualViewport||[],Nt(i)?i:[],o.frameElement&&t?Dt(o.frameElement):[]):e.concat(i,Dt(i,[],t))}function vn(s){const e=F(s);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const i=J(s),r=i?s.offsetWidth:t,o=i?s.offsetHeight:n,l=Xt(t)!==r||Xt(n)!==o;return l&&(t=r,n=o),{width:t,height:n,$:l}}function Ie(s){return Q(s)?s:s.contextElement}function _t(s){const e=Ie(s);if(!J(e))return it(1);const t=e.getBoundingClientRect(),{width:n,height:i,$:r}=vn(e);let o=(r?Xt(t.width):t.width)/n,l=(r?Xt(t.height):t.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!l||!Number.isFinite(l))&&(l=1),{x:o,y:l}}const Li=it(0);function yn(s){const e=L(s);return!De()||!e.visualViewport?Li:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Ui(s,e,t){return e===void 0&&(e=!1),!t||e&&t!==L(s)?!1:e}function ut(s,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=s.getBoundingClientRect(),r=Ie(s);let o=it(1);e&&(n?Q(n)&&(o=_t(n)):o=_t(s));const l=Ui(r,t,n)?yn(r):it(0);let a=(i.left+l.x)/o.x,c=(i.top+l.y)/o.y,d=i.width/o.x,h=i.height/o.y;if(r){const u=L(r),f=n&&Q(n)?L(n):n;let p=u.frameElement;for(;p&&n&&f!==u;){const m=_t(p),y=p.getBoundingClientRect(),v=F(p),x=y.left+(p.clientLeft+parseFloat(v.paddingLeft))*m.x,_=y.top+(p.clientTop+parseFloat(v.paddingTop))*m.y;a*=m.x,c*=m.y,d*=m.x,h*=m.y,a+=x,c+=_,p=L(p).frameElement}}return bt({width:d,height:h,x:a,y:c})}function Fi(s){let{rect:e,offsetParent:t,strategy:n}=s;const i=J(t),r=et(t);if(t===r)return e;let o={scrollLeft:0,scrollTop:0},l=it(1);const a=it(0);if((i||!i&&n!=="fixed")&&((rt(t)!=="body"||Nt(r))&&(o=le(t)),J(t))){const c=ut(t);l=_t(t),a.x=c.x+t.clientLeft,a.y=c.y+t.clientTop}return{width:e.width*l.x,height:e.height*l.y,x:e.x*l.x-o.scrollLeft*l.x+a.x,y:e.y*l.y-o.scrollTop*l.y+a.y}}function ji(s){return Array.from(s.getClientRects())}function _n(s){return ut(et(s)).left+le(s).scrollLeft}function Vi(s){const e=et(s),t=le(s),n=s.ownerDocument.body,i=D(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),r=D(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let o=-t.scrollLeft+_n(s);const l=-t.scrollTop;return F(n).direction==="rtl"&&(o+=D(e.clientWidth,n.clientWidth)-i),{width:i,height:r,x:o,y:l}}function Hi(s,e){const t=L(s),n=et(s),i=t.visualViewport;let r=n.clientWidth,o=n.clientHeight,l=0,a=0;if(i){r=i.width,o=i.height;const c=De();(!c||c&&e==="fixed")&&(l=i.offsetLeft,a=i.offsetTop)}return{width:r,height:o,x:l,y:a}}function qi(s,e){const t=ut(s,!0,e==="fixed"),n=t.top+s.clientTop,i=t.left+s.clientLeft,r=J(s)?_t(s):it(1),o=s.clientWidth*r.x,l=s.clientHeight*r.y,a=i*r.x,c=n*r.y;return{width:o,height:l,x:a,y:c}}function sn(s,e,t){let n;if(e==="viewport")n=Hi(s,t);else if(e==="document")n=Vi(et(s));else if(Q(e))n=qi(e,t);else{const i=yn(s);n={...e,x:e.x-i.x,y:e.y-i.y}}return bt(n)}function wn(s,e){const t=St(s);return t===e||!Q(t)||ae(t)?!1:F(t).position==="fixed"||wn(t,e)}function zi(s,e){const t=e.get(s);if(t)return t;let n=Dt(s,[],!1).filter(l=>Q(l)&&rt(l)!=="body"),i=null;const r=F(s).position==="fixed";let o=r?St(s):s;for(;Q(o)&&!ae(o);){const l=F(o),a=ke(o);!a&&l.position==="fixed"&&(i=null),(r?!a&&!i:!a&&l.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||Nt(o)&&!a&&wn(s,o))?n=n.filter(d=>d!==o):i=l,o=St(o)}return e.set(s,n),n}function Ki(s){let{element:e,boundary:t,rootBoundary:n,strategy:i}=s;const o=[...t==="clippingAncestors"?zi(e,this._c):[].concat(t),n],l=o[0],a=o.reduce((c,d)=>{const h=sn(e,d,i);return c.top=D(h.top,c.top),c.right=W(h.right,c.right),c.bottom=W(h.bottom,c.bottom),c.left=D(h.left,c.left),c},sn(e,l,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function Wi(s){const{width:e,height:t}=vn(s);return{width:e,height:t}}function Yi(s,e,t){const n=J(e),i=et(e),r=t==="fixed",o=ut(s,!0,r,e);let l={scrollLeft:0,scrollTop:0};const a=it(0);if(n||!n&&!r)if((rt(e)!=="body"||Nt(i))&&(l=le(e)),n){const c=ut(e,!0,r,e);a.x=c.x+e.clientLeft,a.y=c.y+e.clientTop}else i&&(a.x=_n(i));return{x:o.left+l.scrollLeft-a.x,y:o.top+l.scrollTop-a.y,width:o.width,height:o.height}}function rn(s,e){return!J(s)||F(s).position==="fixed"?null:e?e(s):s.offsetParent}function xn(s,e){const t=L(s);if(!J(s))return t;let n=rn(s,e);for(;n&&Ni(n)&&F(n).position==="static";)n=rn(n,e);return n&&(rt(n)==="html"||rt(n)==="body"&&F(n).position==="static"&&!ke(n))?t:n||Bi(s)||t}const Xi=async function(s){let{reference:e,floating:t,strategy:n}=s;const i=this.getOffsetParent||xn,r=this.getDimensions;return{reference:Yi(e,await i(t),n),floating:{x:0,y:0,...await r(t)}}};function Gi(s){return F(s).direction==="rtl"}const Ji={convertOffsetParentRelativeRectToViewportRelativeRect:Fi,getDocumentElement:et,getClippingRect:Ki,getOffsetParent:xn,getElementRects:Xi,getClientRects:ji,getDimensions:Wi,getScale:_t,isElement:Q,isRTL:Gi};function Zi(s,e){let t=null,n;const i=et(s);function r(){clearTimeout(n),t&&t.disconnect(),t=null}function o(l,a){l===void 0&&(l=!1),a===void 0&&(a=1),r();const{left:c,top:d,width:h,height:u}=s.getBoundingClientRect();if(l||e(),!h||!u)return;const f=Lt(d),p=Lt(i.clientWidth-(c+h)),m=Lt(i.clientHeight-(d+u)),y=Lt(c),x={rootMargin:-f+"px "+-p+"px "+-m+"px "+-y+"px",threshold:D(0,W(1,a))||1};let _=!0;function E(b){const g=b[0].intersectionRatio;if(g!==a){if(!_)return o();g?o(!1,g):n=setTimeout(()=>{o(!1,1e-7)},100)}_=!1}try{t=new IntersectionObserver(E,{...x,root:i.ownerDocument})}catch{t=new IntersectionObserver(E,x)}t.observe(s)}return o(!0),r}function vr(s,e,t,n){n===void 0&&(n={});const{ancestorScroll:i=!0,ancestorResize:r=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:a=!1}=n,c=Ie(s),d=i||r?[...c?Dt(c):[],...Dt(e)]:[];d.forEach(v=>{i&&v.addEventListener("scroll",t,{passive:!0}),r&&v.addEventListener("resize",t)});const h=c&&l?Zi(c,t):null;let u=-1,f=null;o&&(f=new ResizeObserver(v=>{let[x]=v;x&&x.target===c&&f&&(f.unobserve(e),cancelAnimationFrame(u),u=requestAnimationFrame(()=>{f&&f.observe(e)})),t()}),c&&!a&&f.observe(c),f.observe(e));let p,m=a?ut(s):null;a&&y();function y(){const v=ut(s);m&&(v.x!==m.x||v.y!==m.y||v.width!==m.width||v.height!==m.height)&&t(),m=v,p=requestAnimationFrame(y)}return t(),()=>{d.forEach(v=>{i&&v.removeEventListener("scroll",t),r&&v.removeEventListener("resize",t)}),h&&h(),f&&f.disconnect(),f=null,a&&cancelAnimationFrame(p)}}const yr=Ai,_r=Di,wr=$i,xr=Mi,br=Ri,Sr=Pi,Er=Ii,Cr=(s,e,t)=>{const n=new Map,i={platform:Ji,...t},r={...i.platform,_c:n};return Ci(s,e,{...i,platform:r})};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Rr=ie(class extends re{constructor(s){if(super(s),s.type!==se.ATTRIBUTE||s.name!=="class"||s.strings?.length>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(s){return" "+Object.keys(s).filter(e=>s[e]).join(" ")+" "}update(s,[e]){if(this.it===void 0){this.it=new Set,s.strings!==void 0&&(this.st=new Set(s.strings.join(" ").split(/\s/).filter(n=>n!=="")));for(const n in e)e[n]&&!this.st?.has(n)&&this.it.add(n);return this.render(e)}const t=s.element.classList;for(const n of this.it)n in e||(t.remove(n),this.it.delete(n));for(const n in e){const i=!!e[n];i===this.it.has(n)||this.st?.has(n)||(i?(t.add(n),this.it.add(n)):(t.remove(n),this.it.delete(n)))}return Qt}});/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Tr=s=>s??z;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ot=(s,e)=>{const t=s._$AN;if(t===void 0)return!1;for(const n of t)n._$AO?.(e,!1),Ot(n,e);return!0},Zt=s=>{let e,t;do{if((e=s._$AM)===void 0)break;t=e._$AN,t.delete(s),s=e}while(t?.size===0)},bn=s=>{for(let e;e=s._$AM;s=e){let t=e._$AN;if(t===void 0)e._$AN=t=new Set;else if(t.has(s))break;t.add(s),er(e)}};function Qi(s){this._$AN!==void 0?(Zt(this),this._$AM=s,bn(this)):this._$AM=s}function tr(s,e=!1,t=0){const n=this._$AH,i=this._$AN;if(i!==void 0&&i.size!==0)if(e)if(Array.isArray(n))for(let r=t;r<n.length;r++)Ot(n[r],!1),Zt(n[r]);else n!=null&&(Ot(n,!1),Zt(n));else Ot(this,s)}const er=s=>{s.type==se.CHILD&&(s._$AP??=tr,s._$AQ??=Qi)};class nr extends re{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,n){super._$AT(e,t,n),bn(this),this.isConnected=e._$AU}_$AO(e,t=!0){e!==this.isConnected&&(this.isConnected=e,e?this.reconnected?.():this.disconnected?.()),t&&(Ot(this,e),Zt(this))}setValue(e){if(Qs(this._$Ct))this._$Ct._$AI(e,this);else{const t=[...this._$Ct._$AH];t[this._$Ci]=e,this._$Ct._$AI(t,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ar=()=>new sr;class sr{}const pe=new WeakMap,$r=ie(class extends nr{render(s){return z}update(s,[e]){const t=e!==this.G;return t&&this.G!==void 0&&this.ot(void 0),(t||this.rt!==this.lt)&&(this.G=e,this.ct=s.options?.host,this.ot(this.lt=s.element)),z}ot(s){if(typeof this.G=="function"){const e=this.ct??globalThis;let t=pe.get(e);t===void 0&&(t=new WeakMap,pe.set(e,t)),t.get(this.G)!==void 0&&this.G.call(this.ct,void 0),t.set(this.G,s),s!==void 0&&this.G.call(this.ct,s)}else this.G.value=s}get rt(){return typeof this.G=="function"?pe.get(this.ct??globalThis)?.get(this.G):this.G?.value}disconnected(){this.rt===this.lt&&this.ot(void 0)}reconnected(){this.ot(this.lt)}});export{zt as $,Ar as A,ot as B,Tr as C,$r as D,xt as E,yr as F,oe as G,Sr as H,ht as I,Er as J,ur as K,hi as L,Ss as M,bs as N,xr as O,A as P,ie as Q,Yt as R,hn as S,qt as T,re as U,ei as V,Te as W,cr as X,An as Y,Ct as Z,pr as _,dr as a,se as a0,Qs as a1,Ji as a2,Ps as b,cn as c,ge as d,lr as e,Cr as f,mr as g,wr as h,or as i,Rr as j,vr as k,Le as l,br as m,$ as n,Et as o,_r as p,Zn as q,ds as r,Y as s,ne as t,gr as u,fr as v,te as w,Rt as x,un as y,jt as z};
//# sourceMappingURL=ref-ehjBZcli.js.map
