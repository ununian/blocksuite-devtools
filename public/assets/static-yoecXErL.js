(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();const Yc="modulepreload",Gc=function(s){return"/"+s},fi={},Jc=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){const i=document.getElementsByTagName("link");r=Promise.all(t.map(o=>{if(o=Gc(o),o in fi)return;fi[o]=!0;const a=o.endsWith(".css"),c=a?'[rel="stylesheet"]':"";if(!!n)for(let u=i.length-1;u>=0;u--){const d=i[u];if(d.href===o&&(!a||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${c}`))return;const h=document.createElement("link");if(h.rel=a?"stylesheet":Yc,a||(h.as="script",h.crossOrigin=""),h.href=o,document.head.appendChild(h),a)return new Promise((u,d)=>{h.addEventListener("load",u),h.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${o}`)))})}))}return r.then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function pi(s){return s!==Object(s)}function ig(s){}function k(s,e="val does not exist"){if(s==null)throw e instanceof Error?e:new Error(e)}function og(s,e="val exists"){if(s!=null)throw new Error(e)}function sr(s,e){const t=pi(s),n=pi(e);if(t&&n){if(!Object.is(s,e))return!1}else{if(t!==n)return!1;if(Array.isArray(s)&&Array.isArray(e))return s.length!==e.length?!1:s.every((r,i)=>sr(r,e[i]));if(typeof s=="object"&&typeof e=="object"){const r=Object.entries(s),i=Object.entries(e);return r.length!==i.length?!1:r.every((o,a)=>sr(o,i[a]))}}return!0}function qc(s,e,t="val is not same as expected"){if(!sr(s,e))throw new Error(t)}function ag(s,e,t="val is not instance of expected"){if(!(s instanceof e))throw new Error(t)}class fo{constructor(){this._disposed=!1,this._disposables=[]}get disposed(){return this._disposed}add(e){typeof e=="function"?this._disposed?e():this._disposables.push({dispose:e}):this._disposed?e.dispose():this._disposables.push(e)}addFromEvent(e,t,n,r){this.add({dispose:()=>{e.removeEventListener(t,n,r)}}),e.addEventListener(t,n,r)}dispose(){po(this._disposables),this._disposables=[],this._disposed=!0}}function Kc(s){return{dispose:()=>po(s)}}function po(s){for(const e of s)try{e.dispose()}catch(t){console.error(t)}}class O{constructor(){this._emitting=!1,this._callbacks=[],this._disposables=[],this.subscribe=(e,t,n)=>{let r;const{filter:i,equalityFn:o=Object.is}=n??{};return this.on(a=>{if(i&&!i(a))return;const c=e(a);(r===void 0||!o(r,c))&&(t(c),r=c)})}}filter(e){const t=new O;return t._disposables.push({dispose:()=>this.dispose()}),this.on(n=>{e(n)&&t.emit(n)}),t}on(e){if(this._emitting){const t=[...this._callbacks,e];this._callbacks=t}else this._callbacks.push(e);return{dispose:()=>{if(this._emitting)this._callbacks=this._callbacks.filter(t=>t!==e);else{const t=this._callbacks.indexOf(e);t>-1&&this._callbacks.splice(t,1)}}}}once(e){let t;const n=i=>{e(i),t&&t()},r=this.on(n);return t=r.dispose,r}unshift(e){if(this._emitting){const t=[e,...this._callbacks];this._callbacks=t}else this._callbacks.unshift(e);return{dispose:()=>{if(this._emitting)this._callbacks=this._callbacks.filter(t=>t!==e);else{const t=this._callbacks.indexOf(e);t>-1&&this._callbacks.splice(t,1)}}}}emit(e){const t=this._emitting;this._emitting=!0,this._callbacks.forEach(n=>{try{n(e)}catch(r){console.error(r)}}),this._emitting=t}pipe(e){return this._callbacks.push(t=>e.emit(t)),this}dispose(){Kc(this._disposables).dispose(),this._callbacks=[],this._disposables=[]}toDispose(e){return e.push(this),this}}const Nt=()=>new Set,jn=s=>s[s.length-1],Xc=(s,e)=>{for(let t=0;t<e.length;t++)s.push(e[t])},Qe=Array.from,Qc=(s,e)=>{for(let t=0;t<s.length;t++)if(e(s[t],t,s))return!0;return!1},el=(s,e)=>{const t=new Array(s);for(let n=0;n<s;n++)t[n]=e(n,t);return t},nr=Array.isArray,tl=String.fromCharCode,sl=s=>s.toLowerCase(),nl=/^\s*/g,rl=s=>s.replace(nl,""),il=/([A-Z])/g,gi=(s,e)=>rl(s.replace(il,t=>`${e}${sl(t)}`)),ol=s=>{const e=unescape(encodeURIComponent(s)),t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.codePointAt(r);return n},is=typeof TextEncoder<"u"?new TextEncoder:null,al=s=>is.encode(s),cl=is?al:ol;let ts=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ts&&ts.decode(new Uint8Array).length===1&&(ts=null);const ll=(s,e)=>el(e,()=>s).join(""),ne=()=>new Map,rr=s=>{const e=ne();return s.forEach((t,n)=>{e.set(n,t)}),e},he=(s,e,t)=>{let n=s.get(e);return n===void 0&&s.set(e,n=t()),n},hl=(s,e)=>{const t=[];for(const[n,r]of s)t.push(e(r,n));return t},ul=(s,e)=>{for(const[t,n]of s)if(e(n,t))return!0;return!1},mi=s=>s===void 0?null:s;class dl{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let go=new dl,fl=!0;try{typeof localStorage<"u"&&localStorage&&(go=localStorage,fl=!1)}catch{}const pl=go,gl=Object.assign,ml=Object.keys,yl=(s,e)=>{for(const t in s)e(s[t],t)},sn=s=>ml(s).length,_l=s=>{for(const e in s)return!1;return!0},wl=(s,e)=>{for(const t in s)if(!e(s[t],t))return!1;return!0},mo=(s,e)=>Object.prototype.hasOwnProperty.call(s,e),kl=(s,e)=>s===e||sn(s)===sn(e)&&wl(s,(t,n)=>(t!==void 0||mo(e,n))&&e[n]===t),Ar=(s,e,t=0)=>{try{for(;t<s.length;t++)s[t](...e)}finally{t<s.length&&Ar(s,e,t+1)}},yo=s=>s,vl=(s,e)=>s===e,ss=(s,e)=>{if(s==null||e==null)return vl(s,e);if(s.constructor!==e.constructor)return!1;if(s===e)return!0;switch(s.constructor){case ArrayBuffer:s=new Uint8Array(s),e=new Uint8Array(e);case Uint8Array:{if(s.byteLength!==e.byteLength)return!1;for(let t=0;t<s.length;t++)if(s[t]!==e[t])return!1;break}case Set:{if(s.size!==e.size)return!1;for(const t of s)if(!e.has(t))return!1;break}case Map:{if(s.size!==e.size)return!1;for(const t of s.keys())if(!e.has(t)||!ss(s.get(t),e.get(t)))return!1;break}case Object:if(sn(s)!==sn(e))return!1;for(const t in s)if(!mo(s,t)||!ss(s[t],e[t]))return!1;break;case Array:if(s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(!ss(s[t],e[t]))return!1;break;default:return!1}return!0},bl=(s,e)=>e.includes(s);var _o={};const Rt=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",xl=typeof window<"u"&&typeof document<"u"&&!Rt;let Me;const Sl=()=>{if(Me===void 0)if(Rt){Me=ne();const s=process.argv;let e=null;for(let t=0;t<s.length;t++){const n=s[t];n[0]==="-"?(e!==null&&Me.set(e,""),e=n):e!==null&&(Me.set(e,n),e=null)}e!==null&&Me.set(e,"")}else typeof location=="object"?(Me=ne(),(location.search||"?").slice(1).split("&").forEach(s=>{if(s.length!==0){const[e,t]=s.split("=");Me.set(`--${gi(e,"-")}`,t),Me.set(`-${gi(e,"-")}`,t)}})):Me=ne();return Me},ir=s=>Sl().has(s),or=s=>mi(Rt?_o[s.toUpperCase()]:pl.getItem(s)),El=s=>ir("--"+s)||or(s)!==null;El("production");const yi=Rt&&bl(_o.FORCE_COLOR,["true","1","2"]),Cl=!ir("no-colors")&&(!Rt||process.stdout.isTTY||yi)&&(!Rt||ir("color")||yi||or("COLORTERM")!==null||(or("TERM")||"").includes("color")),Ue=Math.floor,Js=Math.abs,wo=(s,e)=>s<e?s:e,Ct=(s,e)=>s>e?s:e,ko=s=>s!==0?s<0:1/s<0,_i=1,wi=2,Un=4,Vn=8,os=32,Le=64,de=128,bn=31,ar=63,pt=127,Al=2147483647,vo=Number.MAX_SAFE_INTEGER,Tl=Number.isInteger||(s=>typeof s=="number"&&isFinite(s)&&Ue(s)===s);class Ps{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const At=()=>new Ps,Ml=s=>{let e=s.cpos;for(let t=0;t<s.bufs.length;t++)e+=s.bufs[t].length;return e},ue=s=>{const e=new Uint8Array(Ml(s));let t=0;for(let n=0;n<s.bufs.length;n++){const r=s.bufs[n];e.set(r,t),t+=r.length}return e.set(new Uint8Array(s.cbuf.buffer,0,s.cpos),t),e},Dl=(s,e)=>{const t=s.cbuf.length;t-s.cpos<e&&(s.bufs.push(new Uint8Array(s.cbuf.buffer,0,s.cpos)),s.cbuf=new Uint8Array(Ct(t,e)*2),s.cpos=0)},H=(s,e)=>{const t=s.cbuf.length;s.cpos===t&&(s.bufs.push(s.cbuf),s.cbuf=new Uint8Array(t*2),s.cpos=0),s.cbuf[s.cpos++]=e},as=H,x=(s,e)=>{for(;e>pt;)H(s,de|pt&e),e=Ue(e/128);H(s,pt&e)},xn=(s,e)=>{const t=ko(e);for(t&&(e=-e),H(s,(e>ar?de:0)|(t?Le:0)|ar&e),e=Ue(e/64);e>0;)H(s,(e>pt?de:0)|pt&e),e=Ue(e/128)},cr=new Uint8Array(3e4),Il=cr.length/3,Ol=(s,e)=>{if(e.length<Il){const t=is.encodeInto(e,cr).written||0;x(s,t);for(let n=0;n<t;n++)H(s,cr[n])}else ce(s,cl(e))},$l=(s,e)=>{const t=unescape(encodeURIComponent(e)),n=t.length;x(s,n);for(let r=0;r<n;r++)H(s,t.codePointAt(r))},Ke=is&&is.encodeInto?Ol:$l,Nl=(s,e)=>Bs(s,ue(e)),Bs=(s,e)=>{const t=s.cbuf.length,n=s.cpos,r=wo(t-n,e.length),i=e.length-r;s.cbuf.set(e.subarray(0,r),n),s.cpos+=r,i>0&&(s.bufs.push(s.cbuf),s.cbuf=new Uint8Array(Ct(t*2,i)),s.cbuf.set(e.subarray(r)),s.cpos=i)},ce=(s,e)=>{x(s,e.byteLength),Bs(s,e)},Tr=(s,e)=>{Dl(s,e);const t=new DataView(s.cbuf.buffer,s.cpos,e);return s.cpos+=e,t},Rl=(s,e)=>Tr(s,4).setFloat32(0,e,!1),Pl=(s,e)=>Tr(s,8).setFloat64(0,e,!1),Bl=(s,e)=>Tr(s,8).setBigInt64(0,e,!1),ki=new DataView(new ArrayBuffer(4)),Ll=s=>(ki.setFloat32(0,s),ki.getFloat32(0)===s),cs=(s,e)=>{switch(typeof e){case"string":H(s,119),Ke(s,e);break;case"number":Tl(e)&&Js(e)<=Al?(H(s,125),xn(s,e)):Ll(e)?(H(s,124),Rl(s,e)):(H(s,123),Pl(s,e));break;case"bigint":H(s,122),Bl(s,e);break;case"object":if(e===null)H(s,126);else if(nr(e)){H(s,117),x(s,e.length);for(let t=0;t<e.length;t++)cs(s,e[t])}else if(e instanceof Uint8Array)H(s,116),ce(s,e);else{H(s,118);const t=Object.keys(e);x(s,t.length);for(let n=0;n<t.length;n++){const r=t[n];Ke(s,r),cs(s,e[r])}}break;case"boolean":H(s,e?120:121);break;default:H(s,127)}};class vi extends Ps{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&x(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const bi=s=>{s.count>0&&(xn(s.encoder,s.count===1?s.s:-s.s),s.count>1&&x(s.encoder,s.count-2))};class qs{constructor(){this.encoder=new Ps,this.s=0,this.count=0}write(e){this.s===e?this.count++:(bi(this),this.count=1,this.s=e)}toUint8Array(){return bi(this),ue(this.encoder)}}const xi=s=>{if(s.count>0){const e=s.diff*2+(s.count===1?0:1);xn(s.encoder,e),s.count>1&&x(s.encoder,s.count-2)}};class Zn{constructor(){this.encoder=new Ps,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(xi(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return xi(this),ue(this.encoder)}}class jl{constructor(){this.sarr=[],this.s="",this.lensE=new qs}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Ps;return this.sarr.push(this.s),this.s="",Ke(e,this.sarr.join("")),Bs(e,this.lensE.toUint8Array()),ue(e)}}const et=s=>new Error(s),De=()=>{throw et("Method unimplemented")},ae=()=>{throw et("Unexpected case")},bo=et("Unexpected end of array"),xo=et("Integer out of Range");class Sn{constructor(e){this.arr=e,this.pos=0}}const J=s=>new Sn(s),So=s=>s.pos!==s.arr.length,Ul=(s,e)=>{const t=new Uint8Array(s.arr.buffer,s.pos+s.arr.byteOffset,e);return s.pos+=e,t},le=s=>Ul(s,A(s)),Pt=s=>s.arr[s.pos++],A=s=>{let e=0,t=1;const n=s.arr.length;for(;s.pos<n;){const r=s.arr[s.pos++];if(e=e+(r&pt)*t,t*=128,r<de)return e;if(e>vo)throw xo}throw bo},En=s=>{let e=s.arr[s.pos++],t=e&ar,n=64;const r=(e&Le)>0?-1:1;if(!(e&de))return r*t;const i=s.arr.length;for(;s.pos<i;){if(e=s.arr[s.pos++],t=t+(e&pt)*n,n*=128,e<de)return r*t;if(t>vo)throw xo}throw bo},Vl=s=>{let e=A(s);if(e===0)return"";{let t=String.fromCodePoint(Pt(s));if(--e<100)for(;e--;)t+=String.fromCodePoint(Pt(s));else for(;e>0;){const n=e<1e4?e:1e4,r=s.arr.subarray(s.pos,s.pos+n);s.pos+=n,t+=String.fromCodePoint.apply(null,r),e-=n}return decodeURIComponent(escape(t))}},Zl=s=>ts.decode(le(s)),Xe=ts?Zl:Vl,Mr=(s,e)=>{const t=new DataView(s.arr.buffer,s.arr.byteOffset+s.pos,e);return s.pos+=e,t},Fl=s=>Mr(s,4).getFloat32(0,!1),zl=s=>Mr(s,8).getFloat64(0,!1),Wl=s=>Mr(s,8).getBigInt64(0,!1),Hl=[s=>{},s=>null,En,Fl,zl,Wl,s=>!1,s=>!0,Xe,s=>{const e=A(s),t={};for(let n=0;n<e;n++){const r=Xe(s);t[r]=ls(s)}return t},s=>{const e=A(s),t=[];for(let n=0;n<e;n++)t.push(ls(s));return t},le],ls=s=>Hl[127-Pt(s)](s);class Si extends Sn{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),So(this)?this.count=A(this)+1:this.count=-1),this.count--,this.s}}class Ks extends Sn{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=En(this);const e=ko(this.s);this.count=1,e&&(this.s=-this.s,this.count=A(this)+2)}return this.count--,this.s}}class Fn extends Sn{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=En(this),t=e&1;this.diff=Ue(e/2),this.count=1,t&&(this.count=A(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Yl{constructor(e){this.decoder=new Ks(e),this.str=Xe(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}}const Gl=s=>new Uint8Array(s),Jl=s=>{let e="";for(let t=0;t<s.byteLength;t++)e+=tl(s[t]);return btoa(e)},ql=s=>Buffer.from(s.buffer,s.byteOffset,s.byteLength).toString("base64"),Eo=xl?Jl:ql,Kl=s=>{const e=Gl(s.byteLength);return e.set(s),e};async function Dr(s){const e=await crypto.subtle.digest("SHA-256",s);return Eo(new Uint8Array(e)).replace(/\+/g,"-").replace(/\//g,"_")}class Xl{constructor(){this._map=new Map,this._blobsRef=new Map}async get(e){return this._map.get(e)??null}async set(e,t){const n=t||await Dr(await e.arrayBuffer());return this._map.set(n,e),n}async delete(e){this._map.delete(e)}async list(){return Array.from(this._map.keys())}async gc(){(await this.list()).forEach(t=>{const n=this._blobsRef.get(t);(!n||n<=0)&&(this.delete(t).catch(console.error),this._blobsRef.delete(t))})}increaseRef(e){const t=this._blobsRef.get(e)??0;this._blobsRef.set(e,t+1)}decreaseRef(e){const t=this._blobsRef.get(e)??0;this._blobsRef.set(e,Math.max(t-1,0))}}function Ql(s,e){const t=s.get(e);k(t);const n=t.name??void 0,r=n!==void 0&&n.includes(".")?n.split(".").at(-1):t.type!==""?t.type.split("/").at(-1):"blob";return`${n?.split(".").at(0)??e}.${r}`}class eh{constructor(){this._stack=[],this._globalContext=Object.create(null),this._defaultProp="children",this._skip=!1,this._skipChildrenNum=0,this.setDefaultProp=e=>{this._defaultProp=e}}get stack(){return this._stack}current(){return this._stack[this._stack.length-1]}currentNode(){return this.current()?.node}openNode(e,t){return this._stack.push({node:e,prop:t??this._defaultProp,context:Object.create(null)}),this}setNodeContext(e,t){return this._stack[this._stack.length-1].context[e]=t,this}getNodeContext(e){return this.current().context[e]}getGlobalContext(e){return this._globalContext[e]}pushGlobalContextStack(e,t){const n=this._globalContext[e];n instanceof Array?n.push(t):this._globalContext[e]=[t]}getGlobalContextStack(e){const t=this._globalContext[e];return t instanceof Array?t:[]}setGlobalContextStack(e,t){this._globalContext[e]=t}setGlobalContext(e,t){return this._globalContext[e]=t,this}closeNode(){const e=this._stack.pop();if(!e)return this;const t=this._stack.pop();return t?(t.node[e.prop]instanceof Array&&t.node[e.prop].push(e.node),this._stack.push(t),this):(this._stack.push(e),this)}skipAllChildren(){this._skip=!0}skipChildren(e=1){this._skipChildrenNum=e}}class th{constructor(){this.configs=new Map}applyConfigs(e){this.configs=new Map([...e])}}class sh{constructor(){this.setEnter=e=>{this._enter=e},this.setLeave=e=>{this._leave=e},this.setONodeTypeGuard=e=>{this._isONode=e},this.walk=async(e,t)=>(this.context.openNode(t),await this._visit({node:e,parent:null,prop:null,index:null}),qc(this.context.stack.length,1,"There are unclosed nodes"),this.context.currentNode()),this.walkONode=async e=>{await this._visit({node:e,parent:null,prop:null,index:null})},this._visit=async e=>{if(e.node&&(this.context._skipChildrenNum=0,this.context._skip=!1,this._enter&&await this._enter(e,this.context),!this.context._skip)){for(const t in e.node){const n=e.node[t];if(n&&typeof n=="object")if(Array.isArray(n))for(let r=this.context._skipChildrenNum;r<n.length;r+=1){const i=n[r];i!==null&&typeof i=="object"&&this._isONode(i)&&await this._visit({node:i,parent:e.node,prop:t,index:r})}else this.context._skipChildrenNum===0&&this._isONode(n)&&await this._visit({node:n,parent:e.node,prop:t,index:null})}this._leave&&await this._leave(e,this.context)}},this.context=new eh}}class Cn{constructor(){this._observers=ne()}on(e,t){he(this._observers,e,Nt).add(t)}once(e,t){const n=(...r)=>{this.off(e,n),t(...r)};this.on(e,n)}off(e,t){const n=this._observers.get(e);n!==void 0&&(n.delete(t),n.size===0&&this._observers.delete(e))}emit(e,t){return Qe((this._observers.get(e)||ne()).values()).forEach(n=>n(...t))}destroy(){this._observers=ne()}}const nh=crypto.getRandomValues.bind(crypto),Co=()=>nh(new Uint32Array(1))[0],rh="10000000-1000-4000-8000"+-1e11,Ir=()=>rh.replace(/[018]/g,s=>(s^Co()&15>>s/4).toString(16)),hs=Date.now,Ei=s=>new Promise(s);Promise.all.bind(Promise);class ih{constructor(e,t){this.left=e,this.right=t}}const Re=(s,e)=>new ih(s,e);typeof DOMParser<"u"&&new DOMParser;const oh=s=>hl(s,(e,t)=>`${t}:${e};`).join(""),We=Symbol,Ao=We(),To=We(),ah=We(),ch=We(),lh=We(),Mo=We(),hh=We(),Or=We(),uh=We(),dh=s=>{const e=[];let t=0;for(;t<s.length;t++){const n=s[t];n.constructor===String||n.constructor===Number||n.constructor===Object&&e.push(JSON.stringify(n))}return e},fh={[Ao]:Re("font-weight","bold"),[To]:Re("font-weight","normal"),[ah]:Re("color","blue"),[lh]:Re("color","green"),[ch]:Re("color","grey"),[Mo]:Re("color","red"),[hh]:Re("color","purple"),[Or]:Re("color","orange"),[uh]:Re("color","black")},ph=s=>{const e=[],t=[],n=ne();let r=[],i=0;for(;i<s.length;i++){const o=s[i],a=fh[o];if(a!==void 0)n.set(a.left,a.right);else if(o.constructor===String||o.constructor===Number){const c=oh(n);i>0||c.length>0?(e.push("%c"+o),t.push(c)):e.push(o)}else break}for(i>0&&(r=t,r.unshift(e.join("")));i<s.length;i++){const o=s[i];o instanceof Symbol||r.push(o)}return r},Do=Cl?ph:dh,lr=(...s)=>{console.log(...Do(s)),Io.forEach(e=>e.print(s))},gh=(...s)=>{console.warn(...Do(s)),s.unshift(Or),Io.forEach(e=>e.print(s))},Io=Nt(),Oo=s=>({[Symbol.iterator](){return this},next:s}),mh=(s,e)=>Oo(()=>{let t;do t=s.next();while(!t.done&&!e(t.value));return t}),zn=(s,e)=>Oo(()=>{const{done:t,value:n}=s.next();return{done:t,value:t?void 0:e(n)}});class yh extends Cn{constructor(e,t){super(),this.doc=e,this.awareness=t}}class $r{constructor(e,t){this.clock=e,this.len=t}}class Wt{constructor(){this.clients=new Map}}const yt=(s,e,t)=>e.clients.forEach((n,r)=>{const i=s.doc.store.clients.get(r);for(let o=0;o<n.length;o++){const a=n[o];Fo(s,i,a.clock,a.len,t)}}),_h=(s,e)=>{let t=0,n=s.length-1;for(;t<=n;){const r=Ue((t+n)/2),i=s[r],o=i.clock;if(o<=e){if(e<o+i.len)return r;t=r+1}else n=r-1}return null},Tt=(s,e)=>{const t=s.clients.get(e.client);return t!==void 0&&_h(t,e.clock)!==null},Nr=s=>{s.clients.forEach(e=>{e.sort((r,i)=>r.clock-i.clock);let t,n;for(t=1,n=1;t<e.length;t++){const r=e[n-1],i=e[t];r.clock+r.len>=i.clock?r.len=Ct(r.len,i.clock+i.len-r.clock):(n<t&&(e[n]=i),n++)}e.length=n})},Bt=s=>{const e=new Wt;for(let t=0;t<s.length;t++)s[t].clients.forEach((n,r)=>{if(!e.clients.has(r)){const i=n.slice();for(let o=t+1;o<s.length;o++)Xc(i,s[o].clients.get(r)||[]);e.clients.set(r,i)}});return Nr(e),e},us=(s,e,t,n)=>{he(s.clients,e,()=>[]).push(new $r(t,n))},An=()=>new Wt,Rr=s=>{const e=An();return s.clients.forEach((t,n)=>{const r=[];for(let i=0;i<t.length;i++){const o=t[i];if(o.deleted){const a=o.id.clock;let c=o.length;if(i+1<t.length)for(let l=t[i+1];i+1<t.length&&l.deleted;l=t[++i+1])c+=l.length;r.push(new $r(a,c))}}r.length>0&&e.clients.set(n,r)}),e},Ie=(s,e)=>{x(s.restEncoder,e.clients.size),Qe(e.clients.entries()).sort((t,n)=>n[0]-t[0]).forEach(([t,n])=>{s.resetDsCurVal(),x(s.restEncoder,t);const r=n.length;x(s.restEncoder,r);for(let i=0;i<r;i++){const o=n[i];s.writeDsClock(o.clock),s.writeDsLen(o.len)}})},Ve=s=>{const e=new Wt,t=A(s.restDecoder);for(let n=0;n<t;n++){s.resetDsCurVal();const r=A(s.restDecoder),i=A(s.restDecoder);if(i>0){const o=he(e.clients,r,()=>[]);for(let a=0;a<i;a++)o.push(new $r(s.readDsClock(),s.readDsLen()))}}return e},Ci=(s,e,t)=>{const n=new Wt,r=A(s.restDecoder);for(let i=0;i<r;i++){s.resetDsCurVal();const o=A(s.restDecoder),a=A(s.restDecoder),c=t.clients.get(o)||[],l=j(t,o);for(let h=0;h<a;h++){const u=s.readDsClock(),d=u+s.readDsLen();if(u<l){l<d&&us(n,o,l,d-l);let f=_e(c,u),p=c[f];for(!p.deleted&&p.id.clock<u&&(c.splice(f+1,0,on(e,p,u-p.id.clock)),f++);f<c.length&&(p=c[f++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(f,0,on(e,p,d-p.id.clock)),p.delete(e))}else us(n,o,u,d-u)}}if(n.clients.size>0){const i=new Ce;return x(i.restEncoder,0),Ie(i,n),i.toUint8Array()}return null},$o=(s,e)=>{if(s.clients.size!==e.clients.size)return!1;for(const[t,n]of s.clients.entries()){const r=e.clients.get(t);if(r===void 0||n.length!==r.length)return!1;for(let i=0;i<n.length;i++){const o=n[i],a=r[i];if(o.clock!==a.clock||o.len!==a.len)return!1}}return!0},No=Co;class Ne extends Cn{constructor({guid:e=Ir(),collectionid:t=null,gc:n=!0,gcFilter:r=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=n,this.gcFilter=r,this.clientID=No(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new Vo,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Ei(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Ei(l=>{const h=u=>{(u===void 0||u===!0)&&(this.off("sync",h),l())};this.on("sync",h)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&N(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Qe(this.subdocs).map(e=>e.guid))}transact(e,t=null){return N(this,e,t)}get(e,t=F){const n=he(this.share,e,()=>{const i=new t;return i._integrate(this,null),i}),r=n.constructor;if(t!==F&&r!==t)if(r===F){const i=new t;i._map=n._map,n._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=n._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=n._length,this.share.set(e,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return n}getArray(e=""){return this.get(e,z)}getText(e=""){return this.get(e,G)}getMap(e=""){return this.get(e,W)}getXmlFragment(e=""){return this.get(e,tt)}toJSON(){const e={};return this.share.forEach((t,n)=>{e[n]=t.toJSON()}),e}destroy(){Qe(this.subdocs).forEach(t=>t.destroy());const e=this._item;if(e!==null){this._item=null;const t=e.content;t.doc=new Ne({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,N(e.parent.doc,n=>{const r=t.doc;e.deleted||n.subdocsAdded.add(r),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(e,t){super.on(e,t)}off(e,t){super.off(e,t)}}class ds{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return A(this.restDecoder)}readDsLen(){return A(this.restDecoder)}}class ke extends ds{readLeftID(){return C(A(this.restDecoder),A(this.restDecoder))}readRightID(){return C(A(this.restDecoder),A(this.restDecoder))}readClient(){return A(this.restDecoder)}readInfo(){return Pt(this.restDecoder)}readString(){return Xe(this.restDecoder)}readParentInfo(){return A(this.restDecoder)===1}readTypeRef(){return A(this.restDecoder)}readLen(){return A(this.restDecoder)}readAny(){return ls(this.restDecoder)}readBuf(){return Kl(le(this.restDecoder))}readJSON(){return JSON.parse(Xe(this.restDecoder))}readKey(){return Xe(this.restDecoder)}}class Ro{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=A(this.restDecoder),this.dsCurrVal}readDsLen(){const e=A(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class fe extends Ro{constructor(e){super(e),this.keys=[],A(e),this.keyClockDecoder=new Fn(le(e)),this.clientDecoder=new Ks(le(e)),this.leftClockDecoder=new Fn(le(e)),this.rightClockDecoder=new Fn(le(e)),this.infoDecoder=new Si(le(e),Pt),this.stringDecoder=new Yl(le(e)),this.parentInfoDecoder=new Si(le(e),Pt),this.typeRefDecoder=new Ks(le(e)),this.lenDecoder=new Ks(le(e))}readLeftID(){return new gt(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new gt(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ls(this.restDecoder)}readBuf(){return le(this.restDecoder)}readJSON(){return ls(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class Lt{constructor(){this.restEncoder=At()}toUint8Array(){return ue(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){x(this.restEncoder,e)}writeDsLen(e){x(this.restEncoder,e)}}class at extends Lt{writeLeftID(e){x(this.restEncoder,e.client),x(this.restEncoder,e.clock)}writeRightID(e){x(this.restEncoder,e.client),x(this.restEncoder,e.clock)}writeClient(e){x(this.restEncoder,e)}writeInfo(e){as(this.restEncoder,e)}writeString(e){Ke(this.restEncoder,e)}writeParentInfo(e){x(this.restEncoder,e?1:0)}writeTypeRef(e){x(this.restEncoder,e)}writeLen(e){x(this.restEncoder,e)}writeAny(e){cs(this.restEncoder,e)}writeBuf(e){ce(this.restEncoder,e)}writeJSON(e){Ke(this.restEncoder,JSON.stringify(e))}writeKey(e){Ke(this.restEncoder,e)}}class Tn{constructor(){this.restEncoder=At(),this.dsCurrVal=0}toUint8Array(){return ue(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,x(this.restEncoder,t)}writeDsLen(e){e===0&&ae(),x(this.restEncoder,e-1),this.dsCurrVal+=e}}class Ce extends Tn{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Zn,this.clientEncoder=new qs,this.leftClockEncoder=new Zn,this.rightClockEncoder=new Zn,this.infoEncoder=new vi(as),this.stringEncoder=new jl,this.parentInfoEncoder=new vi(as),this.typeRefEncoder=new qs,this.lenEncoder=new qs}toUint8Array(){const e=At();return x(e,0),ce(e,this.keyClockEncoder.toUint8Array()),ce(e,this.clientEncoder.toUint8Array()),ce(e,this.leftClockEncoder.toUint8Array()),ce(e,this.rightClockEncoder.toUint8Array()),ce(e,ue(this.infoEncoder)),ce(e,this.stringEncoder.toUint8Array()),ce(e,ue(this.parentInfoEncoder)),ce(e,this.typeRefEncoder.toUint8Array()),ce(e,this.lenEncoder.toUint8Array()),Bs(e,ue(this.restEncoder)),ue(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){cs(this.restEncoder,e)}writeBuf(e){ce(this.restEncoder,e)}writeJSON(e){cs(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const wh=(s,e,t,n)=>{n=Ct(n,e[0].id.clock);const r=_e(e,n);x(s.restEncoder,e.length-r),s.writeClient(t),x(s.restEncoder,n);const i=e[r];i.write(s,n-i.id.clock);for(let o=r+1;o<e.length;o++)e[o].write(s,0)},Pr=(s,e,t)=>{const n=new Map;t.forEach((r,i)=>{j(e,i)>r&&n.set(i,r)}),Ls(e).forEach((r,i)=>{t.has(i)||n.set(i,0)}),x(s.restEncoder,n.size),Qe(n.entries()).sort((r,i)=>i[0]-r[0]).forEach(([r,i])=>{wh(s,e.clients.get(r),r,i)})},kh=(s,e)=>{const t=ne(),n=A(s.restDecoder);for(let r=0;r<n;r++){const i=A(s.restDecoder),o=new Array(i),a=s.readClient();let c=A(s.restDecoder);t.set(a,{i:0,refs:o});for(let l=0;l<i;l++){const h=s.readInfo();switch(bn&h){case 0:{const u=s.readLen();o[l]=new oe(C(a,c),u),c+=u;break}case 10:{const u=A(s.restDecoder);o[l]=new se(C(a,c),u),c+=u;break}default:{const u=(h&(Le|de))===0,d=new $(C(a,c),null,(h&de)===de?s.readLeftID():null,null,(h&Le)===Le?s.readRightID():null,u?s.readParentInfo()?e.get(s.readString()):s.readLeftID():null,u&&(h&os)===os?s.readString():null,ba(s,h));o[l]=d,c+=d.length}}}}return t},vh=(s,e,t)=>{const n=[];let r=Qe(t.keys()).sort((f,p)=>f-p);if(r.length===0)return null;const i=()=>{if(r.length===0)return null;let f=t.get(r[r.length-1]);for(;f.refs.length===f.i;)if(r.pop(),r.length>0)f=t.get(r[r.length-1]);else return null;return f};let o=i();if(o===null)return null;const a=new Vo,c=new Map,l=(f,p)=>{const g=c.get(f);(g==null||g>p)&&c.set(f,p)};let h=o.refs[o.i++];const u=new Map,d=()=>{for(const f of n){const p=f.id.client,g=t.get(p);g?(g.i--,a.clients.set(p,g.refs.slice(g.i)),t.delete(p),g.i=0,g.refs=[]):a.clients.set(p,[f]),r=r.filter(_=>_!==p)}n.length=0};for(;;){if(h.constructor!==se){const p=he(u,h.id.client,()=>j(e,h.id.client))-h.id.clock;if(p<0)n.push(h),l(h.id.client,h.id.clock-1),d();else{const g=h.getMissing(s,e);if(g!==null){n.push(h);const _=t.get(g)||{refs:[],i:0};if(_.refs.length===_.i)l(g,j(e,g)),d();else{h=_.refs[_.i++];continue}}else(p===0||p<h.length)&&(h.integrate(s,p),u.set(h.id.client,h.id.clock+h.length))}}if(n.length>0)h=n.pop();else if(o!==null&&o.i<o.refs.length)h=o.refs[o.i++];else{if(o=i(),o===null)break;h=o.refs[o.i++]}}if(a.clients.size>0){const f=new Ce;return Pr(f,a,new Map),x(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},bh=(s,e)=>Pr(s,e.doc.store,e.beforeState),Br=(s,e,t,n=new fe(s))=>N(e,r=>{r.local=!1;let i=!1;const o=r.doc,a=o.store,c=kh(n,o),l=vh(r,a,c),h=a.pendingStructs;if(h){for(const[d,f]of h.missing)if(f<j(a,d)){i=!0;break}if(l){for(const[d,f]of l.missing){const p=h.missing.get(d);(p==null||p>f)&&h.missing.set(d,f)}h.update=ps([h.update,l.update])}}else a.pendingStructs=l;const u=Ci(n,r,a);if(a.pendingDs){const d=new fe(J(a.pendingDs));A(d.restDecoder);const f=Ci(d,r,a);u&&f?a.pendingDs=ps([u,f]):a.pendingDs=u||f}else a.pendingDs=u;if(i){const d=a.pendingStructs.update;a.pendingStructs=null,Mn(r.doc,d)}},t,!1),xh=(s,e,t)=>Br(s,e,t,new ke(s)),Mn=(s,e,t,n=fe)=>{const r=J(e);Br(r,s,t,new n(r))},Sh=(s,e,t)=>Mn(s,e,t,ke),Eh=(s,e,t=new Map)=>{Pr(s,e.store,t),Ie(s,Rr(e.store))},Lr=(s,e=new Uint8Array([0]),t=new Ce)=>{const n=jr(e);Eh(t,s,n);const r=[t.toUint8Array()];if(s.store.pendingDs&&r.push(s.store.pendingDs),s.store.pendingStructs&&r.push(Hr(s.store.pendingStructs.update,e)),r.length>1){if(t.constructor===at)return qo(r.map((i,o)=>o===0?i:ta(i)));if(t.constructor===Ce)return ps(r)}return r[0]},Ch=(s,e)=>Lr(s,e,new at),Po=s=>{const e=new Map,t=A(s.restDecoder);for(let n=0;n<t;n++){const r=A(s.restDecoder),i=A(s.restDecoder);e.set(r,i)}return e},jr=s=>Po(new ds(J(s))),Ur=(s,e)=>(x(s.restEncoder,e.size),Qe(e.entries()).sort((t,n)=>n[0]-t[0]).forEach(([t,n])=>{x(s.restEncoder,t),x(s.restEncoder,n)}),s),Ah=(s,e)=>Ur(s,Ls(e.store)),Th=(s,e=new Tn)=>(s instanceof Map?Ur(e,s):Ah(e,s),e.toUint8Array()),Mh=s=>Th(s,new Lt);class Dh{constructor(){this.l=[]}}const Ai=()=>new Dh,Ti=(s,e)=>s.l.push(e),Mi=(s,e)=>{const t=s.l,n=t.length;s.l=t.filter(r=>e!==r),n===s.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Bo=(s,e,t)=>Ar(s.l,[e,t]);class gt{constructor(e,t){this.client=e,this.clock=t}}const dt=(s,e)=>s===e||s!==null&&e!==null&&s.client===e.client&&s.clock===e.clock,C=(s,e)=>new gt(s,e),Di=(s,e)=>{x(s,e.client),x(s,e.clock)},Ii=s=>C(A(s),A(s)),Vr=s=>{for(const[e,t]of s.doc.share.entries())if(t===s)return e;throw ae()},fs=(s,e)=>{for(;e!==null;){if(e.parent===s)return!0;e=e.parent._item}return!1},Ih=s=>{const e=[];let t=s._start;for(;t;)e.push(t),t=t.right;console.log("Children: ",e),console.log("Children content: ",e.filter(n=>!n.deleted).map(n=>n.content))};class Oh{constructor(e,t=e.getMap("users")){const n=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=n;const r=(i,o)=>{const a=i.get("ds"),c=i.get("ids"),l=h=>this.clients.set(h,o);a.observe(h=>{h.changes.added.forEach(u=>{u.content.getContent().forEach(d=>{d instanceof Uint8Array&&this.dss.set(o,Bt([this.dss.get(o)||An(),Ve(new ds(J(d)))]))})})}),this.dss.set(o,Bt(a.map(h=>Ve(new ds(J(h)))))),c.observe(h=>h.changes.added.forEach(u=>u.content.getContent().forEach(l))),c.forEach(l)};t.observe(i=>{i.keysChanged.forEach(o=>r(t.get(o),o))}),t.forEach(r)}setUserMapping(e,t,n,{filter:r=()=>!0}={}){const i=this.yusers;let o=i.get(n);o||(o=new W,o.set("ids",new z),o.set("ds",new z),i.set(n,o)),o.get("ids").push([t]),i.observe(a=>{setTimeout(()=>{const c=i.get(n);if(c!==o){o=c,this.clients.forEach((u,d)=>{n===u&&o.get("ids").push([d])});const l=new Lt,h=this.dss.get(n);h&&(Ie(l,h),o.get("ds").push([l.toUint8Array()]))}},0)}),e.on("afterTransaction",a=>{setTimeout(()=>{const c=o.get("ds"),l=a.deleteSet;if(a.local&&l.clients.size>0&&r(a,l)){const h=new Lt;Ie(h,l),c.push([h.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(const[t,n]of this.dss.entries())if(Tt(n,e))return t;return null}}class Dn{constructor(e,t,n,r=0){this.type=e,this.tname=t,this.item=n,this.assoc=r}}const $h=s=>{const e={};return s.type&&(e.type=s.type),s.tname&&(e.tname=s.tname),s.item&&(e.item=s.item),s.assoc!=null&&(e.assoc=s.assoc),e},Nh=s=>new Dn(s.type==null?null:C(s.type.client,s.type.clock),s.tname||null,s.item==null?null:C(s.item.client,s.item.clock),s.assoc==null?0:s.assoc);class Lo{constructor(e,t,n=0){this.type=e,this.index=t,this.assoc=n}}const Rh=(s,e,t=0)=>new Lo(s,e,t),Fs=(s,e,t)=>{let n=null,r=null;return s._item===null?r=Vr(s):n=C(s._item.id.client,s._item.id.clock),new Dn(n,r,e,t)},Ph=(s,e,t=0)=>{let n=s._start;if(t<0){if(e===0)return Fs(s,null,t);e--}for(;n!==null;){if(!n.deleted&&n.countable){if(n.length>e)return Fs(s,C(n.id.client,n.id.clock+e),t);e-=n.length}if(n.right===null&&t<0)return Fs(s,n.lastId,t);n=n.right}return Fs(s,null,t)},Bh=(s,e)=>{const{type:t,tname:n,item:r,assoc:i}=e;if(r!==null)x(s,0),Di(s,r);else if(n!==null)as(s,1),Ke(s,n);else if(t!==null)as(s,2),Di(s,t);else throw ae();return xn(s,i),s},Lh=s=>{const e=At();return Bh(e,s),ue(e)},jh=s=>{let e=null,t=null,n=null;switch(A(s)){case 0:n=Ii(s);break;case 1:t=Xe(s);break;case 2:e=Ii(s)}const r=So(s)?En(s):0;return new Dn(e,t,n,r)},Uh=s=>jh(J(s)),Vh=(s,e)=>{const t=e.store,n=s.item,r=s.type,i=s.tname,o=s.assoc;let a=null,c=0;if(n!==null){if(j(t,n.client)<=n.clock)return null;const l=fr(t,n),h=l.item;if(!(h instanceof $))return null;if(a=h.parent,a._item===null||!a._item.deleted){c=h.deleted||!h.countable?0:l.diff+(o>=0?0:1);let u=h.left;for(;u!==null;)!u.deleted&&u.countable&&(c+=u.length),u=u.left}}else{if(i!==null)a=e.get(i);else if(r!==null){if(j(t,r.client)<=r.clock)return null;const{item:l}=fr(t,r);if(l instanceof $&&l.content instanceof ve)a=l.content.type;else return null}else throw ae();o>=0?c=a._length:c=0}return Rh(a,c,s.assoc)},Zh=(s,e)=>s===e||s!==null&&e!==null&&s.tname===e.tname&&dt(s.item,e.item)&&dt(s.type,e.type)&&s.assoc===e.assoc;class Zr{constructor(e,t){this.ds=e,this.sv=t}}const Fh=(s,e)=>{const t=s.ds.clients,n=e.ds.clients,r=s.sv,i=e.sv;if(r.size!==i.size||t.size!==n.size)return!1;for(const[o,a]of r.entries())if(i.get(o)!==a)return!1;for(const[o,a]of t.entries()){const c=n.get(o)||[];if(a.length!==c.length)return!1;for(let l=0;l<a.length;l++){const h=a[l],u=c[l];if(h.clock!==u.clock||h.len!==u.len)return!1}}return!0},jo=(s,e=new Tn)=>(Ie(e,s.ds),Ur(e,s.sv),e.toUint8Array()),zh=s=>jo(s,new Lt),Uo=(s,e=new Ro(J(s)))=>new Zr(Ve(e),Po(e)),Wh=s=>Uo(s,new ds(J(s))),Fr=(s,e)=>new Zr(s,e),Hh=Fr(An(),new Map),Yh=s=>Fr(Rr(s.store),Ls(s.store)),Ye=(s,e)=>e===void 0?!s.deleted:e.sv.has(s.id.client)&&(e.sv.get(s.id.client)||0)>s.id.clock&&!Tt(e.ds,s.id),hr=(s,e)=>{const t=he(s.meta,hr,Nt),n=s.doc.store;t.has(e)||(e.sv.forEach((r,i)=>{r<j(n,i)&&te(s,C(i,r))}),yt(s,e.ds,r=>{}),t.add(e))},Gh=(s,e,t=new Ne)=>{if(s.gc)throw new Error("Garbage-collection must be disabled in `originDoc`!");const{sv:n,ds:r}=e,i=new Ce;return s.transact(o=>{let a=0;n.forEach(c=>{c>0&&a++}),x(i.restEncoder,a);for(const[c,l]of n){if(l===0)continue;l<j(s.store,c)&&te(o,C(c,l));const h=s.store.clients.get(c)||[],u=_e(h,l-1);x(i.restEncoder,u+1),i.writeClient(c),x(i.restEncoder,0);for(let d=0;d<=u;d++)h[d].write(i,0)}Ie(i,r)}),Mn(t,i.toUint8Array(),"snapshot"),t},Jh=(s,e,t=fe)=>{const n=new t(J(e)),r=new ct(n,!1);for(let o=r.curr;o!==null;o=r.next())if((s.sv.get(o.id.client)||0)<o.id.clock+o.length)return!1;const i=Bt([s.ds,Ve(n)]);return $o(s.ds,i)},qh=(s,e)=>Jh(s,e,ke);class Vo{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ls=s=>{const e=new Map;return s.clients.forEach((t,n)=>{const r=t[t.length-1];e.set(n,r.id.clock+r.length)}),e},j=(s,e)=>{const t=s.clients.get(e);if(t===void 0)return 0;const n=t[t.length-1];return n.id.clock+n.length},Zo=(s,e)=>{let t=s.clients.get(e.id.client);if(t===void 0)t=[],s.clients.set(e.id.client,t);else{const n=t[t.length-1];if(n.id.clock+n.length!==e.id.clock)throw ae()}t.push(e)},_e=(s,e)=>{let t=0,n=s.length-1,r=s[n],i=r.id.clock;if(i===e)return n;let o=Ue(e/(i+r.length-1)*n);for(;t<=n;){if(r=s[o],i=r.id.clock,i<=e){if(e<i+r.length)return o;t=o+1}else n=o-1;o=Ue((t+n)/2)}throw ae()},Kh=(s,e)=>{const t=s.clients.get(e.client);return t[_e(t,e.clock)]},ns=Kh,ur=(s,e,t)=>{const n=_e(e,t),r=e[n];return r.id.clock<t&&r instanceof $?(e.splice(n+1,0,on(s,r,t-r.id.clock)),n+1):n},te=(s,e)=>{const t=s.doc.store.clients.get(e.client);return t[ur(s,t,e.clock)]},Oi=(s,e,t)=>{const n=e.clients.get(t.client),r=_e(n,t.clock),i=n[r];return t.clock!==i.id.clock+i.length-1&&i.constructor!==oe&&n.splice(r+1,0,on(s,i,t.clock-i.id.clock+1)),i},Xh=(s,e,t)=>{const n=s.clients.get(e.id.client);n[_e(n,e.id.clock)]=t},Fo=(s,e,t,n,r)=>{if(n===0)return;const i=t+n;let o=ur(s,e,t),a;do a=e[o++],i<a.id.clock+a.length&&ur(s,e,i),r(a);while(o<e.length&&e[o].id.clock<i)};class zo{constructor(e,t,n){this.doc=e,this.deleteSet=new Wt,this.beforeState=Ls(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const $i=(s,e)=>e.deleteSet.clients.size===0&&!ul(e.afterState,(t,n)=>e.beforeState.get(n)!==t)?!1:(Nr(e.deleteSet),bh(s,e),Ie(s,e.deleteSet),!0),Ni=(s,e,t)=>{const n=e._item;(n===null||n.id.clock<(s.beforeState.get(n.id.client)||0)&&!n.deleted)&&he(s.changed,e,Nt).add(t)},Xs=(s,e)=>{let t=s[e],n=s[e-1],r=e;for(;r>0;t=n,n=s[--r-1]){if(n.deleted===t.deleted&&n.constructor===t.constructor&&n.mergeWith(t)){t instanceof $&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,n);continue}break}const i=e-r;return i&&s.splice(e+1-i,i),i},Wo=(s,e,t)=>{for(const[n,r]of s.clients.entries()){const i=e.clients.get(n);for(let o=r.length-1;o>=0;o--){const a=r[o],c=a.clock+a.len;for(let l=_e(i,a.clock),h=i[l];l<i.length&&h.id.clock<c;h=i[++l]){const u=i[l];if(a.clock+a.len<=u.id.clock)break;u instanceof $&&u.deleted&&!u.keep&&t(u)&&u.gc(e,!1)}}}},Ho=(s,e)=>{s.clients.forEach((t,n)=>{const r=e.clients.get(n);for(let i=t.length-1;i>=0;i--){const o=t[i],a=wo(r.length-1,1+_e(r,o.clock+o.len-1));for(let c=a,l=r[c];c>0&&l.id.clock>=o.clock;l=r[c])c-=1+Xs(r,c)}})},Qh=(s,e,t)=>{Wo(s,e,t),Ho(s,e)},Yo=(s,e)=>{if(e<s.length){const t=s[e],n=t.doc,r=n.store,i=t.deleteSet,o=t._mergeStructs;try{Nr(i),t.afterState=Ls(t.doc.store),n.emit("beforeObserverCalls",[t,n]);const a=[];t.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(t,c)})),a.push(()=>{t.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(h=>h.target._item===null||!h.target._item.deleted),c.forEach(h=>{h.currentTarget=l,h._path=null}),c.sort((h,u)=>h.path.length-u.path.length),Bo(l._dEH,c,t))})}),a.push(()=>n.emit("afterTransaction",[t,n])),Ar(a,[]),t._needFormattingCleanup&&xu(t)}finally{n.gc&&Wo(i,r,n.gcFilter),Ho(i,r),t.afterState.forEach((h,u)=>{const d=t.beforeState.get(u)||0;if(d!==h){const f=r.clients.get(u),p=Ct(_e(f,d),1);for(let g=f.length-1;g>=p;)g-=1+Xs(f,g)}});for(let h=o.length-1;h>=0;h--){const{client:u,clock:d}=o[h].id,f=r.clients.get(u),p=_e(f,d);p+1<f.length&&Xs(f,p+1)>1||p>0&&Xs(f,p)}if(!t.local&&t.afterState.get(n.clientID)!==t.beforeState.get(n.clientID)&&(lr(Or,Ao,"[yjs] ",To,Mo,"Changed the client-id because another client seems to be using it."),n.clientID=No()),n.emit("afterTransactionCleanup",[t,n]),n._observers.has("update")){const h=new at;$i(h,t)&&n.emit("update",[h.toUint8Array(),t.origin,n,t])}if(n._observers.has("updateV2")){const h=new Ce;$i(h,t)&&n.emit("updateV2",[h.toUint8Array(),t.origin,n,t])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=t;(a.size>0||l.size>0||c.size>0)&&(a.forEach(h=>{h.clientID=n.clientID,h.collectionid==null&&(h.collectionid=n.collectionid),n.subdocs.add(h)}),l.forEach(h=>n.subdocs.delete(h)),n.emit("subdocs",[{loaded:c,added:a,removed:l},n,t]),l.forEach(h=>h.destroy())),s.length<=e+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,s])):Yo(s,e+1)}}},N=(s,e,t=null,n=!0)=>{const r=s._transactionCleanups;let i=!1,o=null;s._transaction===null&&(i=!0,s._transaction=new zo(s,t,n),r.push(s._transaction),r.length===1&&s.emit("beforeAllTransactions",[s]),s.emit("beforeTransaction",[s._transaction,s]));try{o=e(s._transaction)}finally{if(i){const a=s._transaction===r[0];s._transaction=null,a&&Yo(r,0)}}return o};class eu{constructor(e,t){this.insertions=t,this.deletions=e,this.meta=new Map}}const Ri=(s,e,t)=>{yt(s,t.deletions,n=>{n instanceof $&&e.scope.some(r=>fs(r,n))&&ei(n,!1)})},Pi=(s,e,t)=>{let n=null,r=null;const i=s.doc,o=s.scope;if(N(i,a=>{for(;e.length>0&&n===null;){const c=i.store,l=e.pop(),h=new Set,u=[];let d=!1;yt(a,l.insertions,f=>{if(f instanceof $){if(f.redone!==null){let{item:p,diff:g}=fr(c,f.id);g>0&&(p=te(a,C(p.id.client,p.id.clock+g))),f=p}!f.deleted&&o.some(p=>fs(p,f))&&u.push(f)}}),yt(a,l.deletions,f=>{f instanceof $&&o.some(p=>fs(p,f))&&!Tt(l.insertions,f.id)&&h.add(f)}),h.forEach(f=>{d=va(a,f,h,l.insertions,s.ignoreRemoteMapChanges,s)!==null||d});for(let f=u.length-1;f>=0;f--){const p=u[f];s.deleteFilter(p)&&(p.delete(a),d=!0)}n=d?l:null}a.changed.forEach((c,l)=>{c.has(null)&&l._searchMarker&&(l._searchMarker.length=0)}),r=a},s),n!=null){const a=r.changedParentTypes;s.emit("stack-item-popped",[{stackItem:n,type:t,changedParentTypes:a},s])}return n};class zr extends Cn{constructor(e,{captureTimeout:t=500,captureTransaction:n=c=>!0,deleteFilter:r=()=>!0,trackedOrigins:i=new Set([null]),ignoreRemoteMapChanges:o=!1,doc:a=nr(e)?e[0].doc:e.doc}={}){super(),this.scope=[],this.doc=a,this.addToScope(e),this.deleteFilter=r,i.add(this),this.trackedOrigins=i,this.captureTransaction=n,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.lastChange=0,this.ignoreRemoteMapChanges=o,this.captureTimeout=t,this.afterTransactionHandler=c=>{if(!this.captureTransaction(c)||!this.scope.some(_=>c.changedParentTypes.has(_))||!this.trackedOrigins.has(c.origin)&&(!c.origin||!this.trackedOrigins.has(c.origin.constructor)))return;const l=this.undoing,h=this.redoing,u=l?this.redoStack:this.undoStack;l?this.stopCapturing():h||this.clear(!1,!0);const d=new Wt;c.afterState.forEach((_,E)=>{const B=c.beforeState.get(E)||0,R=_-B;R>0&&us(d,E,B,R)});const f=hs();let p=!1;if(this.lastChange>0&&f-this.lastChange<this.captureTimeout&&u.length>0&&!l&&!h){const _=u[u.length-1];_.deletions=Bt([_.deletions,c.deleteSet]),_.insertions=Bt([_.insertions,d])}else u.push(new eu(c.deleteSet,d)),p=!0;!l&&!h&&(this.lastChange=f),yt(c,c.deleteSet,_=>{_ instanceof $&&this.scope.some(E=>fs(E,_))&&ei(_,!0)});const g=[{stackItem:u[u.length-1],origin:c.origin,type:l?"redo":"undo",changedParentTypes:c.changedParentTypes},this];p?this.emit("stack-item-added",g):this.emit("stack-item-updated",g)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(e){e=nr(e)?e:[e],e.forEach(t=>{this.scope.every(n=>n!==t)&&(t.doc!==this.doc&&gh("[yjs#509] Not same Y.Doc"),this.scope.push(t))})}addTrackedOrigin(e){this.trackedOrigins.add(e)}removeTrackedOrigin(e){this.trackedOrigins.delete(e)}clear(e=!0,t=!0){(e&&this.canUndo()||t&&this.canRedo())&&this.doc.transact(n=>{e&&(this.undoStack.forEach(r=>Ri(n,this,r)),this.undoStack=[]),t&&(this.redoStack.forEach(r=>Ri(n,this,r)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:e,redoStackCleared:t}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let e;try{e=Pi(this,this.undoStack,"undo")}finally{this.undoing=!1}return e}redo(){this.redoing=!0;let e;try{e=Pi(this,this.redoStack,"redo")}finally{this.redoing=!1}return e}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*tu(s){const e=A(s.restDecoder);for(let t=0;t<e;t++){const n=A(s.restDecoder),r=s.readClient();let i=A(s.restDecoder);for(let o=0;o<n;o++){const a=s.readInfo();if(a===10){const c=A(s.restDecoder);yield new se(C(r,i),c),i+=c}else if(bn&a){const c=(a&(Le|de))===0,l=new $(C(r,i),null,(a&de)===de?s.readLeftID():null,null,(a&Le)===Le?s.readRightID():null,c?s.readParentInfo()?s.readString():s.readLeftID():null,c&&(a&os)===os?s.readString():null,ba(s,a));yield l,i+=l.length}else{const c=s.readLen();yield new oe(C(r,i),c),i+=c}}}}class ct{constructor(e,t){this.gen=tu(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===se);return this.curr}}const su=s=>Go(s,ke),Go=(s,e=fe)=>{const t=[],n=new e(J(s)),r=new ct(n,!1);for(let o=r.curr;o!==null;o=r.next())t.push(o);lr("Structs: ",t);const i=Ve(n);lr("DeleteSet: ",i)},nu=s=>Jo(s,ke),Jo=(s,e=fe)=>{const t=[],n=new e(J(s)),r=new ct(n,!1);for(let i=r.curr;i!==null;i=r.next())t.push(i);return{structs:t,ds:Ve(n)}};class Wr{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const qo=s=>ps(s,ke,at),Ko=(s,e=Tn,t=fe)=>{const n=new e,r=new ct(new t(J(s)),!1);let i=r.curr;if(i!==null){let o=0,a=i.id.client,c=i.id.clock!==0,l=c?0:i.id.clock+i.length;for(;i!==null;i=r.next())a!==i.id.client&&(l!==0&&(o++,x(n.restEncoder,a),x(n.restEncoder,l)),a=i.id.client,l=0,c=i.id.clock!==0),i.constructor===se&&(c=!0),c||(l=i.id.clock+i.length);l!==0&&(o++,x(n.restEncoder,a),x(n.restEncoder,l));const h=At();return x(h,o),Nl(h,n.restEncoder),n.restEncoder=h,n.toUint8Array()}else return x(n.restEncoder,0),n.toUint8Array()},ru=s=>Ko(s,Lt,ke),Xo=(s,e=fe)=>{const t=new Map,n=new Map,r=new ct(new e(J(s)),!1);let i=r.curr;if(i!==null){let o=i.id.client,a=i.id.clock;for(t.set(o,a);i!==null;i=r.next())o!==i.id.client&&(n.set(o,a),t.set(i.id.client,i.id.clock),o=i.id.client),a=i.id.clock+i.length;n.set(o,a)}return{from:t,to:n}},iu=s=>Xo(s,ke),ou=(s,e)=>{if(s.constructor===oe){const{client:t,clock:n}=s.id;return new oe(C(t,n+e),s.length-e)}else if(s.constructor===se){const{client:t,clock:n}=s.id;return new se(C(t,n+e),s.length-e)}else{const t=s,{client:n,clock:r}=t.id;return new $(C(n,r+e),null,C(n,r+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},ps=(s,e=fe,t=Ce)=>{if(s.length===1)return s[0];const n=s.map(h=>new e(J(h)));let r=n.map(h=>new ct(h,!0)),i=null;const o=new t,a=new Wr(o);for(;r=r.filter(d=>d.curr!==null),r.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const p=d.curr.id.clock-f.curr.id.clock;return p===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===se?1:-1:p}else return f.curr.id.client-d.curr.id.client}),r.length!==0;){const h=r[0],u=h.curr.id.client;if(i!==null){let d=h.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=i.struct.id.clock+i.struct.length&&d.id.client>=i.struct.id.client;)d=h.next(),f=!0;if(d===null||d.id.client!==u||f&&d.id.clock>i.struct.id.clock+i.struct.length)continue;if(u!==i.struct.id.client)Ge(a,i.struct,i.offset),i={struct:d,offset:0},h.next();else if(i.struct.id.clock+i.struct.length<d.id.clock)if(i.struct.constructor===se)i.struct.length=d.id.clock+d.length-i.struct.id.clock;else{Ge(a,i.struct,i.offset);const p=d.id.clock-i.struct.id.clock-i.struct.length;i={struct:new se(C(u,i.struct.id.clock+i.struct.length),p),offset:0}}else{const p=i.struct.id.clock+i.struct.length-d.id.clock;p>0&&(i.struct.constructor===se?i.struct.length-=p:d=ou(d,p)),i.struct.mergeWith(d)||(Ge(a,i.struct,i.offset),i={struct:d,offset:0},h.next())}}else i={struct:h.curr,offset:0},h.next();for(let d=h.curr;d!==null&&d.id.client===u&&d.id.clock===i.struct.id.clock+i.struct.length&&d.constructor!==se;d=h.next())Ge(a,i.struct,i.offset),i={struct:d,offset:0}}i!==null&&(Ge(a,i.struct,i.offset),i=null),Yr(a);const c=n.map(h=>Ve(h)),l=Bt(c);return Ie(o,l),o.toUint8Array()},Hr=(s,e,t=fe,n=Ce)=>{const r=jr(e),i=new n,o=new Wr(i),a=new t(J(s)),c=new ct(a,!1);for(;c.curr;){const h=c.curr,u=h.id.client,d=r.get(u)||0;if(c.curr.constructor===se){c.next();continue}if(h.id.clock+h.length>d)for(Ge(o,h,Ct(d-h.id.clock,0)),c.next();c.curr&&c.curr.id.client===u;)Ge(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===u&&c.curr.id.clock+c.curr.length<=d;)c.next()}Yr(o);const l=Ve(a);return Ie(i,l),i.toUint8Array()},au=(s,e)=>Hr(s,e,ke,at),Qo=s=>{s.written>0&&(s.clientStructs.push({written:s.written,restEncoder:ue(s.encoder.restEncoder)}),s.encoder.restEncoder=At(),s.written=0)},Ge=(s,e,t)=>{s.written>0&&s.currClient!==e.id.client&&Qo(s),s.written===0&&(s.currClient=e.id.client,s.encoder.writeClient(e.id.client),x(s.encoder.restEncoder,e.id.clock+t)),e.write(s.encoder,t),s.written++},Yr=s=>{Qo(s);const e=s.encoder.restEncoder;x(e,s.clientStructs.length);for(let t=0;t<s.clientStructs.length;t++){const n=s.clientStructs[t];x(e,n.written),Bs(e,n.restEncoder)}},In=(s,e,t,n)=>{const r=new t(J(s)),i=new ct(r,!1),o=new n,a=new Wr(o);for(let l=i.curr;l!==null;l=i.next())Ge(a,e(l),0);Yr(a);const c=Ve(r);return Ie(o,c),o.toUint8Array()},ea=({formatting:s=!0,subdocs:e=!0,yxml:t=!0}={})=>{let n=0;const r=ne(),i=ne(),o=ne(),a=ne();return a.set(null,null),c=>{switch(c.constructor){case oe:case se:return c;case $:{const l=c,h=l.content;switch(h.constructor){case wt:break;case ve:{if(t){const u=h.type;u instanceof _t&&(u.nodeName=he(i,u.nodeName,()=>"node-"+n)),u instanceof jt&&(u.hookName=he(i,u.hookName,()=>"hook-"+n))}break}case Ze:{const u=h;u.arr=u.arr.map(()=>n);break}case Mt:{const u=h;u.content=new Uint8Array([n]);break}case Dt:{const u=h;e&&(u.opts={},u.doc.guid=n+"");break}case He:{const u=h;u.embed={};break}case Z:{const u=h;s&&(u.key=he(o,u.key,()=>n+""),u.value=he(a,u.value,()=>({i:n})));break}case Ut:{const u=h;u.arr=u.arr.map(()=>n);break}case we:{const u=h;u.str=ll(n%10+"",u.str.length);break}default:ae()}return l.parentSub&&(l.parentSub=he(r,l.parentSub,()=>n+"")),n++,c}default:ae()}}},cu=(s,e)=>In(s,ea(e),ke,at),lu=(s,e)=>In(s,ea(e),fe,Ce),hu=s=>In(s,yo,ke,Ce),ta=s=>In(s,yo,fe,at),Bi="You must not compute changes after the event-handler fired.";class js{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=uu(this.currentTarget,this.target))}deletes(e){return Tt(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw et(Bi);const e=new Map,t=this.target;this.transaction.changed.get(t).forEach(r=>{if(r!==null){const i=t._map.get(r);let o,a;if(this.adds(i)){let c=i.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(i))if(c!==null&&this.deletes(c))o="delete",a=jn(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=jn(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(i))o="delete",a=jn(i.content.getContent());else return;e.set(r,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw et(Bi);const t=this.target,n=Nt(),r=Nt(),i=[];if(e={added:n,deleted:r,delta:i,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null;const c=()=>{a&&i.push(a)};for(let l=t._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,r.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),n.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const uu=(s,e)=>{const t=[];for(;e._item!==null&&e!==s;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let n=0,r=e._item.parent._start;for(;r!==e._item&&r!==null;)r.deleted||n++,r=r.right;t.unshift(n)}e=e._item.parent}return t},sa=80;let Gr=0;class du{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=Gr++}}const fu=s=>{s.timestamp=Gr++},na=(s,e,t)=>{s.p.marker=!1,s.p=e,e.marker=!0,s.index=t,s.timestamp=Gr++},pu=(s,e,t)=>{if(s.length>=sa){const n=s.reduce((r,i)=>r.timestamp<i.timestamp?r:i);return na(n,e,t),n}else{const n=new du(e,t);return s.push(n),n}},On=(s,e)=>{if(s._start===null||e===0||s._searchMarker===null)return null;const t=s._searchMarker.length===0?null:s._searchMarker.reduce((i,o)=>Js(e-i.index)<Js(e-o.index)?i:o);let n=s._start,r=0;for(t!==null&&(n=t.p,r=t.index,fu(t));n.right!==null&&r<e;){if(!n.deleted&&n.countable){if(e<r+n.length)break;r+=n.length}n=n.right}for(;n.left!==null&&r>e;)n=n.left,!n.deleted&&n.countable&&(r-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(r-=n.length);return t!==null&&Js(t.index-r)<n.parent.length/sa?(na(t,n,r),t):pu(s._searchMarker,n,r)},gs=(s,e,t)=>{for(let n=s.length-1;n>=0;n--){const r=s[n];if(t>0){let i=r.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(r.index-=i.length);if(i===null||i.marker===!0){s.splice(n,1);continue}r.p=i,i.marker=!0}(e<r.index||t>0&&e===r.index)&&(r.index=Ct(e,r.index+t))}},gu=s=>{let e=s._start;const t=[];for(;e;)t.push(e),e=e.right;return t},$n=(s,e,t)=>{const n=s,r=e.changedParentTypes;for(;he(r,s,()=>[]).push(t),s._item!==null;)s=s._item.parent;Bo(n._eH,t,e)};class F{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Ai(),this._dEH=Ai(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw De()}clone(){throw De()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Ti(this._eH,e)}observeDeep(e){Ti(this._dEH,e)}unobserve(e){Mi(this._eH,e)}unobserveDeep(e){Mi(this._dEH,e)}toJSON(){}}const ra=(s,e,t)=>{e<0&&(e=s._length+e),t<0&&(t=s._length+t);let n=t-e;const r=[];let i=s._start;for(;i!==null&&n>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&n>0;a++)r.push(o[a]),n--;e=0}}i=i.right}return r},ia=s=>{const e=[];let t=s._start;for(;t!==null;){if(t.countable&&!t.deleted){const n=t.content.getContent();for(let r=0;r<n.length;r++)e.push(n[r])}t=t.right}return e},mu=(s,e)=>{const t=[];let n=s._start;for(;n!==null;){if(n.countable&&Ye(n,e)){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},ms=(s,e)=>{let t=0,n=s._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e(r[i],t++,s)}n=n.right}},oa=(s,e)=>{const t=[];return ms(s,(n,r)=>{t.push(e(n,r,s))}),t},yu=s=>{let e=s._start,t=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),n=0,e=e.right}const r=t[n++];return t.length<=n&&(t=null),{done:!1,value:r}}}},aa=(s,e)=>{const t=On(s,e);let n=s._start;for(t!==null&&(n=t.p,e-=t.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(e<n.length)return n.content.getContent()[e];e-=n.length}},nn=(s,e,t,n)=>{let r=t;const i=s.doc,o=i.clientID,a=i.store,c=t===null?e._start:t.right;let l=[];const h=()=>{l.length>0&&(r=new $(C(o,j(a,o)),r,r&&r.lastId,c,c&&c.id,e,null,new Ze(l)),r.integrate(s,0),l=[])};n.forEach(u=>{if(u===null)l.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(u);break;default:switch(h(),u.constructor){case Uint8Array:case ArrayBuffer:r=new $(C(o,j(a,o)),r,r&&r.lastId,c,c&&c.id,e,null,new Mt(new Uint8Array(u))),r.integrate(s,0);break;case Ne:r=new $(C(o,j(a,o)),r,r&&r.lastId,c,c&&c.id,e,null,new Dt(u)),r.integrate(s,0);break;default:if(u instanceof F)r=new $(C(o,j(a,o)),r,r&&r.lastId,c,c&&c.id,e,null,new ve(u)),r.integrate(s,0);else throw new Error("Unexpected content type in insert operation")}}}),h()},ca=()=>et("Length exceeded!"),la=(s,e,t,n)=>{if(t>e._length)throw ca();if(t===0)return e._searchMarker&&gs(e._searchMarker,t,n.length),nn(s,e,null,n);const r=t,i=On(e,t);let o=e._start;for(i!==null&&(o=i.p,t-=i.index,t===0&&(o=o.prev,t+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(t<=o.length){t<o.length&&te(s,C(o.id.client,o.id.clock+t));break}t-=o.length}return e._searchMarker&&gs(e._searchMarker,r,n.length),nn(s,e,o,n)},_u=(s,e,t)=>{let r=(e._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:e._start}).p;if(r)for(;r.right;)r=r.right;return nn(s,e,r,t)},ha=(s,e,t,n)=>{if(n===0)return;const r=t,i=n,o=On(e,t);let a=e._start;for(o!==null&&(a=o.p,t-=o.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&te(s,C(a.id.client,a.id.clock+t)),t-=a.length);for(;n>0&&a!==null;)a.deleted||(n<a.length&&te(s,C(a.id.client,a.id.clock+n)),a.delete(s),n-=a.length),a=a.right;if(n>0)throw ca();e._searchMarker&&gs(e._searchMarker,r,-i+n)},rn=(s,e,t)=>{const n=e._map.get(t);n!==void 0&&n.delete(s)},Jr=(s,e,t,n)=>{const r=e._map.get(t)||null,i=s.doc,o=i.clientID;let a;if(n==null)a=new Ze([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Ze([n]);break;case Uint8Array:a=new Mt(n);break;case Ne:a=new Dt(n);break;default:if(n instanceof F)a=new ve(n);else throw new Error("Unexpected content type")}new $(C(o,j(i.store,o)),r,r&&r.lastId,null,null,e,t,a).integrate(s,0)},qr=(s,e)=>{const t=s._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},ua=s=>{const e={};return s._map.forEach((t,n)=>{t.deleted||(e[n]=t.content.getContent()[t.length-1])}),e},da=(s,e)=>{const t=s._map.get(e);return t!==void 0&&!t.deleted},wu=(s,e,t)=>{let n=s._map.get(e)||null;for(;n!==null&&(!t.sv.has(n.id.client)||n.id.clock>=(t.sv.get(n.id.client)||0));)n=n.left;return n!==null&&Ye(n,t)?n.content.getContent()[n.length-1]:void 0},fa=(s,e)=>{const t={};return s._map.forEach((n,r)=>{let i=n;for(;i!==null&&(!e.sv.has(i.id.client)||i.id.clock>=(e.sv.get(i.id.client)||0));)i=i.left;i!==null&&Ye(i,e)&&(t[r]=i.content.getContent()[i.length-1])}),t},zs=s=>mh(s.entries(),e=>!e[1].deleted);class Kr extends js{constructor(e,t){super(e,t),this._transaction=t}}class z extends F{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new z;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new z}clone(){const e=new z;return e.insert(0,this.toArray().map(t=>t instanceof F?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),$n(this,e,new Kr(this,e))}insert(e,t){this.doc!==null?N(this.doc,n=>{la(n,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?N(this.doc,t=>{_u(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?N(this.doc,n=>{ha(n,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return aa(this,e)}toArray(){return ia(this)}slice(e=0,t=this.length){return ra(this,e,t)}toJSON(){return this.map(e=>e instanceof F?e.toJSON():e)}map(e){return oa(this,e)}forEach(e){ms(this,e)}[Symbol.iterator](){return yu(this)}_write(e){e.writeTypeRef(ju)}}const ku=s=>new z;class Xr extends js{constructor(e,t,n){super(e,t),this.keysChanged=n}}class W extends F{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((n,r)=>{this.set(r,n)}),this._prelimContent=null}_copy(){return new W}clone(){const e=new W;return this.forEach((t,n)=>{e.set(n,t instanceof F?t.clone():t)}),e}_callObserver(e,t){$n(this,e,new Xr(this,e,t))}toJSON(){const e={};return this._map.forEach((t,n)=>{if(!t.deleted){const r=t.content.getContent()[t.length-1];e[n]=r instanceof F?r.toJSON():r}}),e}get size(){return[...zs(this._map)].length}keys(){return zn(zs(this._map),e=>e[0])}values(){return zn(zs(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return zn(zs(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,n)=>{t.deleted||e(t.content.getContent()[t.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?N(this.doc,t=>{rn(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?N(this.doc,n=>{Jr(n,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return qr(this,e)}has(e){return da(this,e)}clear(){this.doc!==null?N(this.doc,e=>{this.forEach(function(t,n,r){rn(e,r,n)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(Uu)}}const vu=s=>new W,qe=(s,e)=>s===e||typeof s=="object"&&typeof e=="object"&&s&&e&&kl(s,e);class dr{constructor(e,t,n,r){this.left=e,this.right=t,this.index=n,this.currentAttributes=r}forward(){switch(this.right===null&&ae(),this.right.content.constructor){case Z:this.right.deleted||Ht(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Li=(s,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case Z:e.right.deleted||Ht(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&te(s,C(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Ws=(s,e,t,n)=>{const r=new Map,i=n?On(e,t):null;if(i){const o=new dr(i.p.left,i.p,i.index,r);return Li(s,o,t-i.index)}else{const o=new dr(null,e._start,0,r);return Li(s,o,t)}},pa=(s,e,t,n)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===Z&&qe(n.get(t.right.content.key),t.right.content.value));)t.right.deleted||n.delete(t.right.content.key),t.forward();const r=s.doc,i=r.clientID;n.forEach((o,a)=>{const c=t.left,l=t.right,h=new $(C(i,j(r.store,i)),c,c&&c.lastId,l,l&&l.id,e,null,new Z(a,o));h.integrate(s,0),t.right=h,t.forward()})},Ht=(s,e)=>{const{key:t,value:n}=e;n===null?s.delete(t):s.set(t,n)},ga=(s,e)=>{for(;s.right!==null;){if(!(s.right.deleted||s.right.content.constructor===Z&&qe(e[s.right.content.key]||null,s.right.content.value)))break;s.forward()}},ma=(s,e,t,n)=>{const r=s.doc,i=r.clientID,o=new Map;for(const a in n){const c=n[a],l=t.currentAttributes.get(a)||null;if(!qe(l,c)){o.set(a,l);const{left:h,right:u}=t;t.right=new $(C(i,j(r.store,i)),h,h&&h.lastId,u,u&&u.id,e,null,new Z(a,c)),t.right.integrate(s,0),t.forward()}}return o},Wn=(s,e,t,n,r)=>{t.currentAttributes.forEach((d,f)=>{r[f]===void 0&&(r[f]=null)});const i=s.doc,o=i.clientID;ga(t,r);const a=ma(s,e,t,r),c=n.constructor===String?new we(n):n instanceof F?new ve(n):new He(n);let{left:l,right:h,index:u}=t;e._searchMarker&&gs(e._searchMarker,t.index,c.getLength()),h=new $(C(o,j(i.store,o)),l,l&&l.lastId,h,h&&h.id,e,null,c),h.integrate(s,0),t.right=h,t.index=u,t.forward(),pa(s,e,t,a)},ji=(s,e,t,n,r)=>{const i=s.doc,o=i.clientID;ga(t,r);const a=ma(s,e,t,r);e:for(;t.right!==null&&(n>0||a.size>0&&(t.right.deleted||t.right.content.constructor===Z));){if(!t.right.deleted)switch(t.right.content.constructor){case Z:{const{key:c,value:l}=t.right.content,h=r[c];if(h!==void 0){if(qe(h,l))a.delete(c);else{if(n===0)break e;a.set(c,l)}t.right.delete(s)}else t.currentAttributes.set(c,l);break}default:n<t.right.length&&te(s,C(t.right.id.client,t.right.id.clock+n)),n-=t.right.length;break}t.forward()}if(n>0){let c="";for(;n>0;n--)c+=`
`;t.right=new $(C(o,j(i.store,o)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new we(c)),t.right.integrate(s,0),t.forward()}pa(s,e,t,a)},ya=(s,e,t,n,r)=>{let i=e;const o=ne();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===Z){const l=i.content;o.set(l.key,l)}i=i.right}let a=0,c=!1;for(;e!==i;){if(t===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case Z:{const{key:h,value:u}=l,d=n.get(h)||null;(o.get(h)!==l||d===u)&&(e.delete(s),a++,!c&&(r.get(h)||null)===u&&d!==u&&(d===null?r.delete(h):r.set(h,d))),!c&&!e.deleted&&Ht(r,l);break}}}e=e.right}return a},bu=(s,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Z){const n=e.content.key;t.has(n)?e.delete(s):t.add(n)}e=e.left}},_a=s=>{let e=0;return N(s.doc,t=>{let n=s._start,r=s._start,i=ne();const o=rr(i);for(;r;){if(r.deleted===!1)switch(r.content.constructor){case Z:Ht(o,r.content);break;default:e+=ya(t,n,r,i,o),i=rr(o),n=r;break}r=r.right}}),e},xu=s=>{const e=new Set,t=s.doc;for(const[n,r]of s.afterState.entries()){const i=s.beforeState.get(n)||0;r!==i&&Fo(s,t.store.clients.get(n),i,r,o=>{!o.deleted&&o.content.constructor===Z&&o.constructor!==oe&&e.add(o.parent)})}N(t,n=>{yt(s,s.deleteSet,r=>{if(r instanceof oe||!r.parent._hasFormatting||e.has(r.parent))return;const i=r.parent;r.content.constructor===Z?e.add(i):bu(n,r)});for(const r of e)_a(r)})},Ui=(s,e,t)=>{const n=t,r=rr(e.currentAttributes),i=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case ve:case He:case we:t<e.right.length&&te(s,C(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(s);break}e.forward()}i&&ya(s,i,e.right,r,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&gs(o._searchMarker,e.index,-n+t),e};class Qr extends js{constructor(e,t,n){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(r=>{r===null?this.childListChanged=!0:this.keysChanged.add(r)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,t=[];N(e,n=>{const r=new Map,i=new Map;let o=this.target._start,a=null;const c={};let l="",h=0,u=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":u>0&&(f={delete:u}),u=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},r.size>0&&(f.attributes={},r.forEach((p,g)=>{p!==null&&(f.attributes[g]=p)}))),l="";break;case"retain":h>0&&(f={retain:h},_l(c)||(f.attributes=gl({},c))),h=0;break}f&&t.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case ve:case He:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),u+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),h+=1);break;case we:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),u+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),h+=o.length);break;case Z:{const{key:f,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const g=r.get(f)||null;qe(g,p)?p!==null&&o.delete(n):(a==="retain"&&d(),qe(p,i.get(f)||null)?delete c[f]:c[f]=p)}}else if(this.deletes(o)){i.set(f,p);const g=r.get(f)||null;qe(g,p)||(a==="retain"&&d(),c[f]=g)}else if(!o.deleted){i.set(f,p);const g=c[f];g!==void 0&&(qe(g,p)?g!==null&&o.delete(n):(a==="retain"&&d(),p===null?delete c[f]:c[f]=p))}o.deleted||(a==="insert"&&d(),Ht(r,o.content));break}}o=o.right}for(d();t.length>0;){const f=t[t.length-1];if(f.retain!==void 0&&f.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}}class G extends F{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new G}clone(){const e=new G;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const n=new Qr(this,e,t);$n(this,e,n),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===we&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?N(this.doc,n=>{const r=new dr(null,this._start,0,new Map);for(let i=0;i<e.length;i++){const o=e[i];if(o.insert!==void 0){const a=!t&&typeof o.insert=="string"&&i===e.length-1&&r.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Wn(n,this,r,a,o.attributes||{})}else o.retain!==void 0?ji(n,this,r,o.retain,o.attributes||{}):o.delete!==void 0&&Ui(n,r,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,n){const r=[],i=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const u={};let d=!1;i.forEach((p,g)=>{d=!0,u[g]=p});const f={insert:a};d&&(f.attributes=u),r.push(f),a=""}}const h=()=>{for(;c!==null;){if(Ye(c,e)||t!==void 0&&Ye(c,t))switch(c.content.constructor){case we:{const u=i.get("ychange");e!==void 0&&!Ye(c,e)?(u===void 0||u.user!==c.id.client||u.type!=="removed")&&(l(),i.set("ychange",n?n("removed",c.id):{type:"removed"})):t!==void 0&&!Ye(c,t)?(u===void 0||u.user!==c.id.client||u.type!=="added")&&(l(),i.set("ychange",n?n("added",c.id):{type:"added"})):u!==void 0&&(l(),i.delete("ychange")),a+=c.content.str;break}case ve:case He:{l();const u={insert:c.content.getContent()[0]};if(i.size>0){const d={};u.attributes=d,i.forEach((f,p)=>{d[p]=f})}r.push(u);break}case Z:Ye(c,e)&&(l(),Ht(i,c.content));break}c=c.right}l()};return e||t?N(o,u=>{e&&hr(u,e),t&&hr(u,t),h()},"cleanup"):h(),r}insert(e,t,n){if(t.length<=0)return;const r=this.doc;r!==null?N(r,i=>{const o=Ws(i,this,e,!n);n||(n={},o.currentAttributes.forEach((a,c)=>{n[c]=a})),Wn(i,this,o,t,n)}):this._pending.push(()=>this.insert(e,t,n))}insertEmbed(e,t,n){const r=this.doc;r!==null?N(r,i=>{const o=Ws(i,this,e,!n);Wn(i,this,o,t,n||{})}):this._pending.push(()=>this.insertEmbed(e,t,n||{}))}delete(e,t){if(t===0)return;const n=this.doc;n!==null?N(n,r=>{Ui(r,Ws(r,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,n){if(t===0)return;const r=this.doc;r!==null?N(r,i=>{const o=Ws(i,this,e,!1);o.right!==null&&ji(i,this,o,t,n)}):this._pending.push(()=>this.format(e,t,n))}removeAttribute(e){this.doc!==null?N(this.doc,t=>{rn(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?N(this.doc,n=>{Jr(n,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return qr(this,e)}getAttributes(){return ua(this)}_write(e){e.writeTypeRef(Vu)}}const Su=s=>new G;class Hn{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===_t||t.constructor===tt)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class tt extends F{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new tt}clone(){const e=new tt;return e.insert(0,this.toArray().map(t=>t instanceof F?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Hn(this,e)}querySelector(e){e=e.toUpperCase();const n=new Hn(this,r=>r.nodeName&&r.nodeName.toUpperCase()===e).next();return n.done?null:n.value}querySelectorAll(e){return e=e.toUpperCase(),Qe(new Hn(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){$n(this,e,new wa(this,t,e))}toString(){return oa(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},n){const r=e.createDocumentFragment();return n!==void 0&&n._createAssociation(r,this),ms(this,i=>{r.insertBefore(i.toDOM(e,t,n),null)}),r}insert(e,t){this.doc!==null?N(this.doc,n=>{la(n,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)N(this.doc,n=>{const r=e&&e instanceof F?e._item:e;nn(n,this,r,t)});else{const n=this._prelimContent,r=e===null?0:n.findIndex(i=>i===e)+1;if(r===0&&e!==null)throw et("Reference item not found");n.splice(r,0,...t)}}delete(e,t=1){this.doc!==null?N(this.doc,n=>{ha(n,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return ia(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return aa(this,e)}slice(e=0,t=this.length){return ra(this,e,t)}forEach(e){ms(this,e)}_write(e){e.writeTypeRef(Fu)}}const Eu=s=>new tt;class _t extends tt{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((n,r)=>{this.setAttribute(r,n)}),this._prelimAttrs=null}_copy(){return new _t(this.nodeName)}clone(){const e=new _t(this.nodeName),t=this.getAttributes();return yl(t,(n,r)=>{typeof n=="string"&&e.setAttribute(r,n)}),e.insert(0,this.toArray().map(n=>n instanceof F?n.clone():n)),e}toString(){const e=this.getAttributes(),t=[],n=[];for(const a in e)n.push(a);n.sort();const r=n.length;for(let a=0;a<r;a++){const c=n[a];t.push(c+'="'+e[c]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=t.length>0?" "+t.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(e){this.doc!==null?N(this.doc,t=>{rn(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?N(this.doc,n=>{Jr(n,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return qr(this,e)}hasAttribute(e){return da(this,e)}getAttributes(e){return e?fa(this,e):ua(this)}toDOM(e=document,t={},n){const r=e.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const a=i[o];typeof a=="string"&&r.setAttribute(o,a)}return ms(this,o=>{r.appendChild(o.toDOM(e,t,n))}),n!==void 0&&n._createAssociation(r,this),r}_write(e){e.writeTypeRef(Zu),e.writeKey(this.nodeName)}}const Cu=s=>new _t(s.readKey());class wa extends js{constructor(e,t,n){super(e,n),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(r=>{r===null?this.childListChanged=!0:this.attributesChanged.add(r)})}}class jt extends W{constructor(e){super(),this.hookName=e}_copy(){return new jt(this.hookName)}clone(){const e=new jt(this.hookName);return this.forEach((t,n)=>{e.set(n,t)}),e}toDOM(e=document,t={},n){const r=t[this.hookName];let i;return r!==void 0?i=r.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),n!==void 0&&n._createAssociation(i,this),i}_write(e){e.writeTypeRef(zu),e.writeKey(this.hookName)}}const Au=s=>new jt(s.readKey());class ys extends G{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new ys}clone(){const e=new ys;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,n){const r=e.createTextNode(this.toString());return n!==void 0&&n._createAssociation(r,this),r}toString(){return this.toDelta().map(e=>{const t=[];for(const r in e.attributes){const i=[];for(const o in e.attributes[r])i.push({key:o,value:e.attributes[r][o]});i.sort((o,a)=>o.key<a.key?-1:1),t.push({nodeName:r,attrs:i})}t.sort((r,i)=>r.nodeName<i.nodeName?-1:1);let n="";for(let r=0;r<t.length;r++){const i=t[r];n+=`<${i.nodeName}`;for(let o=0;o<i.attrs.length;o++){const a=i.attrs[o];n+=` ${a.key}="${a.value}"`}n+=">"}n+=e.insert;for(let r=t.length-1;r>=0;r--)n+=`</${t[r].nodeName}>`;return n}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(Wu)}}const Tu=s=>new ys;class Nn{constructor(e,t){this.id=e,this.length=t}get deleted(){throw De()}mergeWith(e){return!1}write(e,t,n){throw De()}integrate(e,t){throw De()}}const Mu=0;class oe extends Nn{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),Zo(e.doc.store,this)}write(e,t){e.writeInfo(Mu),e.writeLen(this.length-t)}getMissing(e,t){return null}}class Mt{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Mt(this.content)}splice(e){throw De()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}const Du=s=>new Mt(s.readBuf());class wt{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new wt(this.len)}splice(e){const t=new wt(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){us(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const Iu=s=>new wt(s.readLen()),ka=(s,e)=>new Ne({guid:s,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Dt{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Dt(ka(this.doc.guid,this.opts))}splice(e){throw De()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const Ou=s=>new Dt(ka(s.readString(),s.readAny()));class He{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new He(this.embed)}splice(e){throw De()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}const $u=s=>new He(s.readJSON());class Z{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Z(this.key,this.value)}splice(e){throw De()}mergeWith(e){return!1}integrate(e,t){const n=t.parent;n._searchMarker=null,n._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const Nu=s=>new Z(s.readKey(),s.readJSON());class Ut{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ut(this.arr)}splice(e){const t=new Ut(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const n=this.arr.length;e.writeLen(n-t);for(let r=t;r<n;r++){const i=this.arr[r];e.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const Ru=s=>{const e=s.readLen(),t=[];for(let n=0;n<e;n++){const r=s.readString();r==="undefined"?t.push(void 0):t.push(JSON.parse(r))}return new Ut(t)};class Ze{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ze(this.arr)}splice(e){const t=new Ze(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const n=this.arr.length;e.writeLen(n-t);for(let r=t;r<n;r++){const i=this.arr[r];e.writeAny(i)}}getRef(){return 8}}const Pu=s=>{const e=s.readLen(),t=[];for(let n=0;n<e;n++)t.push(s.readAny());return new Ze(t)};class we{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new we(this.str)}splice(e){const t=new we(this.str.slice(e));this.str=this.str.slice(0,e);const n=this.str.charCodeAt(e-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,e-1)+"",t.str=""+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}}const Bu=s=>new we(s.readString()),Lu=[ku,vu,Su,Cu,Eu,Au,Tu],ju=0,Uu=1,Vu=2,Zu=3,Fu=4,zu=5,Wu=6;class ve{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ve(this.type._copy())}splice(e){throw De()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(n=>{n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(n=>{for(;n!==null;)n.gc(e,!0),n=n.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const Hu=s=>new ve(Lu[s.readTypeRef()](s)),fr=(s,e)=>{let t=e,n=0,r;do n>0&&(t=C(t.client,t.clock+n)),r=ns(s,t),n=t.clock-r.id.clock,t=r.redone;while(t!==null&&r instanceof $);return{item:r,diff:n}},ei=(s,e)=>{for(;s!==null&&s.keep!==e;)s.keep=e,s=s.parent._item},on=(s,e,t)=>{const{client:n,clock:r}=e.id,i=new $(C(n,r+t),e,C(n,r+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),e.redone!==null&&(i.redone=C(e.redone.client,e.redone.clock+t)),e.right=i,i.right!==null&&(i.right.left=i),s._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),e.length=t,i},Vi=(s,e)=>Qc(s,t=>Tt(t.deletions,e)),va=(s,e,t,n,r,i)=>{const o=s.doc,a=o.store,c=o.clientID,l=e.redone;if(l!==null)return te(s,l);let h=e.parent._item,u=null,d;if(h!==null&&h.deleted===!0){if(h.redone===null&&(!t.has(h)||va(s,h,t,n,r,i)===null))return null;for(;h.redone!==null;)h=te(s,h.redone)}const f=h===null?e.parent:h.content.type;if(e.parentSub===null){for(u=e.left,d=e;u!==null;){let E=u;for(;E!==null&&E.parent._item!==h;)E=E.redone===null?null:te(s,E.redone);if(E!==null&&E.parent._item===h){u=E;break}u=u.left}for(;d!==null;){let E=d;for(;E!==null&&E.parent._item!==h;)E=E.redone===null?null:te(s,E.redone);if(E!==null&&E.parent._item===h){d=E;break}d=d.right}}else if(d=null,e.right&&!r){for(u=e;u!==null&&u.right!==null&&(u.right.redone||Tt(n,u.right.id)||Vi(i.undoStack,u.right.id)||Vi(i.redoStack,u.right.id));)for(u=u.right;u.redone;)u=te(s,u.redone);if(u&&u.right!==null)return null}else u=f._map.get(e.parentSub)||null;const p=j(a,c),g=C(c,p),_=new $(g,u,u&&u.lastId,d,d&&d.id,f,e.parentSub,e.content.copy());return e.redone=g,ei(_,!0),_.integrate(s,0),_};class $ extends Nn{constructor(e,t,n,r,i,o,a,c){super(e,c.getLength()),this.origin=n,this.left=t,this.right=r,this.rightOrigin=i,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?wi:0}set marker(e){(this.info&Vn)>0!==e&&(this.info^=Vn)}get marker(){return(this.info&Vn)>0}get keep(){return(this.info&_i)>0}set keep(e){this.keep!==e&&(this.info^=_i)}get countable(){return(this.info&wi)>0}get deleted(){return(this.info&Un)>0}set deleted(e){this.deleted!==e&&(this.info^=Un)}markDeleted(){this.info|=Un}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=j(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=j(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===gt&&this.id.client!==this.parent.client&&this.parent.clock>=j(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Oi(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=te(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===oe||this.right&&this.right.constructor===oe)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===$&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===$&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===gt){const n=ns(t,this.parent);n.constructor===oe?this.parent=null:this.parent=n.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=Oi(e,e.doc.store,C(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let n=this.left,r;if(n!==null)r=n.right;else if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start;const i=new Set,o=new Set;for(;r!==null&&r!==this.right;){if(o.add(r),i.add(r),dt(this.origin,r.origin)){if(r.id.client<this.id.client)n=r,i.clear();else if(dt(this.rightOrigin,r.rightOrigin))break}else if(r.origin!==null&&o.has(ns(e.doc.store,r.origin)))i.has(ns(e.doc.store,r.origin))||(n=r,i.clear());else break;r=r.right}this.left=n}if(this.left!==null){const n=this.left.right;this.right=n,this.left.right=this}else{let n;if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start,this.parent._start=this;this.right=n}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Zo(e.doc.store,this),this.content.integrate(e,this),Ni(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new oe(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:C(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&dt(e.origin,this.lastId)&&this.right===e&&dt(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach(n=>{n.p===e&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),us(e.deleteSet,this.id.client,this.id.clock,this.length),Ni(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw ae();this.content.gc(e),t?Xh(e,this,new oe(this.id,this.length)):this.content=new wt(this.length)}write(e,t){const n=t>0?C(this.id.client,this.id.clock+t-1):this.origin,r=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&bn|(n===null?0:de)|(r===null?0:Le)|(i===null?0:os);if(e.writeInfo(o),n!==null&&e.writeLeftID(n),r!==null&&e.writeRightID(r),n===null&&r===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=Vr(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===gt?(e.writeParentInfo(!1),e.writeLeftID(a)):ae();i!==null&&e.writeString(i)}this.content.write(e,t)}}const ba=(s,e)=>Yu[e&bn](s),Yu=[()=>{ae()},Iu,Ru,Du,Bu,$u,Nu,Hu,Pu,Ou,()=>{ae()}],Gu=10;class se extends Nn{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){ae()}write(e,t){e.writeInfo(Gu),x(e.restEncoder,this.length-t)}getMissing(e,t){return null}}const xa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Sa="__ $YJS$ __";xa[Sa]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");xa[Sa]=!0;const Ju=Object.freeze(Object.defineProperty({__proto__:null,AbsolutePosition:Lo,AbstractConnector:yh,AbstractStruct:Nn,AbstractType:F,Array:z,ContentAny:Ze,ContentBinary:Mt,ContentDeleted:wt,ContentDoc:Dt,ContentEmbed:He,ContentFormat:Z,ContentJSON:Ut,ContentString:we,ContentType:ve,Doc:Ne,GC:oe,ID:gt,Item:$,Map:W,PermanentUserData:Oh,RelativePosition:Dn,Skip:se,Snapshot:Zr,Text:G,Transaction:zo,UndoManager:zr,UpdateDecoderV1:ke,UpdateDecoderV2:fe,UpdateEncoderV1:at,UpdateEncoderV2:Ce,XmlElement:_t,XmlFragment:tt,XmlHook:jt,XmlText:ys,YArrayEvent:Kr,YEvent:js,YMapEvent:Xr,YTextEvent:Qr,YXmlEvent:wa,applyUpdate:Sh,applyUpdateV2:Mn,cleanupYTextFormatting:_a,compareIDs:dt,compareRelativePositions:Zh,convertUpdateFormatV1ToV2:hu,convertUpdateFormatV2ToV1:ta,createAbsolutePositionFromRelativePosition:Vh,createDeleteSet:An,createDeleteSetFromStructStore:Rr,createDocFromSnapshot:Gh,createID:C,createRelativePositionFromJSON:Nh,createRelativePositionFromTypeIndex:Ph,createSnapshot:Fr,decodeRelativePosition:Uh,decodeSnapshot:Wh,decodeSnapshotV2:Uo,decodeStateVector:jr,decodeUpdate:nu,decodeUpdateV2:Jo,diffUpdate:au,diffUpdateV2:Hr,emptySnapshot:Hh,encodeRelativePosition:Lh,encodeSnapshot:zh,encodeSnapshotV2:jo,encodeStateAsUpdate:Ch,encodeStateAsUpdateV2:Lr,encodeStateVector:Mh,encodeStateVectorFromUpdate:ru,encodeStateVectorFromUpdateV2:Ko,equalDeleteSets:$o,equalSnapshots:Fh,findIndexSS:_e,findRootTypeKey:Vr,getItem:ns,getState:j,getTypeChildren:gu,isDeleted:Tt,isParentOf:fs,iterateDeletedStructs:yt,logType:Ih,logUpdate:su,logUpdateV2:Go,mergeUpdates:qo,mergeUpdatesV2:ps,obfuscateUpdate:cu,obfuscateUpdateV2:lu,parseUpdateMeta:iu,parseUpdateMetaV2:Xo,readUpdate:xh,readUpdateV2:Br,relativePositionToJSON:$h,snapshot:Yh,snapshotContainsUpdate:qh,transact:N,tryGc:Qh,typeListToArraySnapshot:mu,typeMapGetAllSnapshot:fa,typeMapGetSnapshot:wu},Symbol.toStringTag,{value:"Module"})),Ea=[{desc:"frame element --> frame block (page v1 --> v2)",condition:s=>s<2,migrate:(s,e)=>{const t=e.getMap("blocks");let n,r;t.forEach(o=>{const a=o.get("sys:flavour");a==="affine:page"&&(n=o),a==="affine:surface"&&(r=o)}),k(n),k(r);const i=r.get("prop:elements").get("value");i.forEach(o=>{if(o.get("type")==="frame"){const a=new W,c=o.get("id");a.set("sys:flavour","affine:frame"),a.set("sys:id",c),a.set("sys:children",new z),a.set("prop:title",o.get("title").clone()),a.set("prop:xywh",o.get("xywh")),a.set("prop:index",o.get("index")),t.set(c,a),n.get("sys:children").push([c]),i.delete(c)}})}}],Ca=[{desc:"add pageVersion in meta",condition:s=>s.getMap("meta").get("workspaceVersion")<2,migrate:s=>{const e=s.getMap("meta");e.set("pageVersion",1),e.set("workspaceVersion",2)}}],qu=s=>{let e,t;const n=Jc(()=>import("./index-fICea6lq.js"),__vite__mapDeps([])).then(({createStore:r,...i})=>(e=r(`${s}_blob`,"blob"),t=r(`${s}_blob_mime`,"blob_mime"),i));return{crud:{get:async r=>{const i=(await n).get,o=await i(r,e);return o?new Blob([o],{type:await i(r,t)}):null},set:async(r,i)=>{const o=(await n).set;return await o(r,await i.arrayBuffer(),e),await o(r,i.type,t),r},delete:async r=>{const i=(await n).del;await i(r,e),await i(r,t)},list:async()=>{const r=(await n).keys;return r(e)}}}},Aa=()=>{const s=new Map;return{crud:{get:async e=>s.get(e)??null,set:async(e,t)=>(s.set(e,t),e),delete:async e=>{s.delete(e)},list:async()=>Array.from(s.keys())}}};function Ku(s){const e=new Map;return{crud:{get:async t=>{if(e.has(t))return e.get(t);{const n=await fetch(`/api/workspace/${s}/blob/${t}`,{method:"GET"}).then(r=>{if(!r.ok)throw new Error(`Failed to fetch blob ${t}`);return r.blob()});return e.set(t,n),n}},set:async(t,n)=>(e.set(t,n),await fetch(`/api/workspace/${s}/blob/${t}`,{method:"PUT",body:await n.arrayBuffer()}),t),delete:async t=>{e.delete(t),await fetch(`/api/workspace/${s}/blob/${t}`,{method:"DELETE"})},list:async()=>Array.from(e.keys())}}}const Yn=2,Gn=2,Jn="Schema not found. The block flavour may not be registered.",Ta="$blocksuite:internal:text$",rs="$blocksuite:internal:native$",Xu=new Set(["id","flavour","children"]);class Ae{static{this.is=e=>e instanceof W&&e.get("type")===rs}static{this.from=e=>new Ae(e.get("value"))}constructor(e){e instanceof W&&e.get("type")===rs?this._map=e:(this._map=new W,this._map.set("type",rs),this._map.set("value",e))}get yMap(){return this._map}setValue(e){return this._map.set("value",e)}getValue(){return this._map.get("value")}}class xe{constructor(e){if(typeof e=="string"){const t=e.replaceAll(`\r
`,`
`);this._yText=new G(t)}else if(e instanceof G)this._yText=e;else if(e instanceof Array){for(const n of e)n.insert&&(n.insert=n.insert.replaceAll(`\r
`,`
`));const t=new G;t.applyDelta(e),this._yText=t}else this._yText=new G}static fromDelta(e){const t=new G;return t.applyDelta(e),new xe(t)}get length(){return this._yText.length}get yText(){return this._yText}_transact(e){const t=this._yText.doc;if(!t)throw new Error("Failed to transact text! yText is not attached to a doc");t.transact(()=>{e()},t.clientID)}clone(){return new xe(this._yText.clone())}split(e,t=0){if(e<0||t<0||e+t>this._yText.length)throw new Error("Failed to split text! Index or length out of range, index: "+e+", length: "+t+", text length: "+this._yText.length);const n=this._yText.toDelta();if(!(n instanceof Array))throw new Error("This text cannot be split because we failed to get the deltas of it.");let r=0;const i=[];for(let c=0;c<n.length;c++){const l=n[c].insert;if(typeof l=="string"){if(r+l.length>=e+t){const h=l.slice(e+t-r);i.push({insert:h,attributes:n[c].attributes}),i.push(...n.slice(c+1));break}r+=l.length}else throw new Error("This text cannot be split because it contains non-string insert.")}this.delete(e,this.length-e);const o=new G;return o.applyDelta(i),new xe(o)}insert(e,t,n){if(e.length){if(t<0||t>this._yText.length)throw new Error("Failed to insert text! Index or length out of range, index: "+t+", length: "+length+", text length: "+this._yText.length);this._transact(()=>{this._yText.insert(t,e,n)})}}join(e){e.toDelta().length&&this._transact(()=>{const n=e._yText.toDelta();n.unshift({retain:this._yText.length}),this._yText.applyDelta(n)})}format(e,t,n){if(t!==0){if(e<0||t<0||e+t>this._yText.length)throw new Error("Failed to format text! Index or length out of range, index: "+e+", length: "+t+", text length: "+this._yText.length);this._transact(()=>{this._yText.format(e,t,n)})}}delete(e,t){if(t!==0){if(e<0||t<0||e+t>this._yText.length)throw new Error("Failed to delete text! Index or length out of range, index: "+e+", length: "+t+", text length: "+this._yText.length);this._transact(()=>{this._yText.delete(e,t)})}}replace(e,t,n,r){if(e<0||t<0||e+t>this._yText.length)throw new Error("Failed to replace text! The length of the text is"+this._yText.length+", but you are trying to replace from"+e+"to"+e+t);this._transact(()=>{this._yText.delete(e,t),this._yText.insert(e,n,r)})}clear(){this._yText.length&&this._transact(()=>{this._yText.delete(0,this._yText.length)})}applyDelta(e){this._transact(()=>{this._yText?.applyDelta(e)})}toDelta(){return this._yText?.toDelta()||[]}sliceToDelta(e,t){const n=[];if(t&&e>=t)return n;if(e===0&&t===0)return[];const r=this.toDelta();if(e<1&&!t)return r;if(r&&r instanceof Array){let i=0;for(let o=0;o<r.length;o++){const a=r[o];let c=a.insert||"";const l=c.length,h=t&&i+l>t,u=i+l>e&&n.length===0;if(u&&h){c=c.slice(e-i,t-i),n.push({...a,insert:c});break}else u||h?(c=h?c.slice(0,t-i):c.slice(e-i),n.push({...a,insert:c})):n.length>0&&n.push(a);if(t&&i+l>t)break;i=i+l}}return n}toString(){return this._yText?.toString()||""}}function ti(s){return s!==null&&typeof s=="object"&&Object.prototype.toString.call(s)==="[object Object]"&&[Object,void 0,null].some(e=>e===s.constructor)}function Fe(s,{deep:e=!0,transform:t=n=>n}={}){if(s instanceof Ae)return s.yMap;if(s instanceof xe)return s.yText.doc?s.yText.clone():s.yText;if(Array.isArray(s)){const n=new z,r=s.map(i=>e?Fe(i,{deep:e,transform:t}):i);return n.insert(0,r),n}if(ti(s)){const n=new W;return Object.entries(s).forEach(([r,i])=>{n.set(r,e?Fe(i,{deep:e,transform:t}):i)}),n}return s}function _s(s,{deep:e=!0,transform:t=n=>n}={}){if(Ae.is(s)){const n=new Ae(s);return t(n,s)}if(s instanceof G){const n=new xe(s);return t(n,s)}if(s instanceof z){const n=s.toArray().map(r=>e?_s(r,{deep:e,transform:t}):r);return t(n,s)}if(s instanceof W){const n=Object.fromEntries(Array.from(s.entries()).map(([r,i])=>[r,e?_s(i,{deep:e,transform:t}):i]));return t(n,s)}return t(s,s)}class si{constructor(){this._skipNext=!1,this._stashed=new Set,this._getOrigin=e=>({doc:e,proxy:!0,target:this}),this._updateWithSkip=e=>{this._skipNext=!0,e(),this._skipNext=!1},this._transact=(e,t)=>{e.transact(t,this._getOrigin(e))},this._onObserve=(e,t)=>{e.transaction.origin?.proxy!==!0&&(!e.transaction.local||e.transaction.origin instanceof zr)&&t(),this._options.onChange?.(this._proxy)}}get proxy(){return this._proxy}}const ye=new WeakMap;class Ma extends si{constructor(e,t,n){super(),this._source=e,this._ySource=t,this._options=n,this._getProxy=()=>new Proxy(this._source,{has:(r,i)=>Reflect.has(r,i),set:(r,i,o,a)=>{if(typeof i!="string")throw new Error("key cannot be a symbol");const c=Number(i);if(this._skipNext||Number.isNaN(c))return Reflect.set(r,i,o,a);if(this._stashed.has(c)){const f=Reflect.set(r,i,o,a);return this._options.onChange?.(this._proxy),f}const l=ye.get(this._ySource);k(l,"YData is not subscribed before changes");const h=this._ySource.doc;k(h,"YData is not bound to a Y.Doc");const u=Fe(o);this._transact(h,()=>{c<this._ySource.length&&this._ySource.delete(c,1),this._ySource.insert(c,[u])});const d=st(u,this._options);return Reflect.set(r,i,d,a)},get:(r,i,o)=>Reflect.get(r,i,o),deleteProperty:(r,i)=>{if(typeof i!="string")throw new Error("key cannot be a symbol");const o=ye.get(this._ySource);k(o,"YData is not subscribed before changes");const a=this._ySource.doc;k(a,"YData is not bound to a Y.Doc");const c=Number(i);return this._skipNext||Number.isNaN(c)||this._transact(a,()=>{this._ySource.delete(c,1)}),Reflect.deleteProperty(r,i)}}),this._observer=r=>{this._onObserve(r,()=>{let i=0;r.changes.delta.forEach(o=>{if(o.retain){i+=o.retain;return}if(o.delete){this._updateWithSkip(()=>{this._source.splice(i,o.delete)});return}if(o.insert){const c=[o.insert].flat().map(l=>st(l));this._updateWithSkip(()=>{this._source.splice(i,0,...c)}),i+=o.insert.length}})})},this._proxy=this._getProxy(),ye.set(t,this),t.observe(this._observer)}stash(e){this._stashed.add(e)}pop(e){const t=this._source[e];this._stashed.delete(e),this._proxy[e]=t}}class Da extends si{constructor(e,t,n){super(),this._source=e,this._ySource=t,this._options=n,this._getProxy=()=>new Proxy(this._source,{has:(r,i)=>Reflect.has(r,i),set:(r,i,o,a)=>{if(typeof i!="string")throw new Error("key cannot be a symbol");if(this._skipNext)return Reflect.set(r,i,o,a);if(this._stashed.has(i)){const d=Reflect.set(r,i,o,a);return this._options.onChange?.(this._proxy),d}const c=ye.get(this._ySource);k(c,"YData is not subscribed before changes");const l=this._ySource.doc;k(l,"YData is not bound to a Y.Doc");const h=Fe(o);this._transact(l,()=>{this._ySource.set(i,h)});const u=st(h,this._options);return Reflect.set(r,i,u,a)},get:(r,i,o)=>Reflect.get(r,i,o),deleteProperty:(r,i)=>{if(typeof i!="string")throw new Error("key cannot be a symbol");if(this._skipNext)return Reflect.deleteProperty(r,i);const o=ye.get(this._ySource);k(o,"YData is not subscribed before changes");const a=this._ySource.doc;return k(a,"YData is not bound to a Y.Doc"),this._transact(a,()=>{this._ySource.delete(i)}),Reflect.deleteProperty(r,i)}}),this._observer=r=>{this._onObserve(r,()=>{r.keysChanged.forEach(i=>{const o=r.changes.keys.get(i);if(o){if(o.action==="delete")this._updateWithSkip(()=>{delete this._source[i]});else if(o.action==="add"||o.action==="update"){const a=this._ySource.get(i);this._updateWithSkip(()=>{this._source[i]=ye.has(a)?ye.get(a):st(a,this._options)})}}})})},this._proxy=this._getProxy(),ye.set(t,this),t.observe(this._observer)}stash(e){this._stashed.add(e)}pop(e){const t=this._source[e];this._stashed.delete(e),this._proxy[e]=t}}function st(s,e={}){return ye.has(s)?ye.get(s).proxy:_s(s,{transform:(t,n)=>Ae.is(n)?t:n instanceof z?new Ma(t,n,e).proxy:n instanceof W?new Da(t,n,e).proxy:t})}function Qu(s,e){const t=ye.get(s);k(t,"YData is not subscribed before changes"),t.stash(e)}function ed(s,e){const t=ye.get(s);k(t,"YData is not subscribed before changes"),t.pop(e)}var I;(function(s){s.assertEqual=r=>r;function e(r){}s.assertIs=e;function t(r){throw new Error}s.assertNever=t,s.arrayToEnum=r=>{const i={};for(const o of r)i[o]=o;return i},s.getValidEnumValues=r=>{const i=s.objectKeys(r).filter(a=>typeof r[r[a]]!="number"),o={};for(const a of i)o[a]=r[a];return s.objectValues(o)},s.objectValues=r=>s.objectKeys(r).map(function(i){return r[i]}),s.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const i=[];for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&i.push(o);return i},s.find=(r,i)=>{for(const o of r)if(i(o))return o},s.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&isFinite(r)&&Math.floor(r)===r;function n(r,i=" | "){return r.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}s.joinValues=n,s.jsonStringifyReplacer=(r,i)=>typeof i=="bigint"?i.toString():i})(I||(I={}));var pr;(function(s){s.mergeShapes=(e,t)=>({...e,...t})})(pr||(pr={}));const y=I.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Je=s=>{switch(typeof s){case"undefined":return y.undefined;case"string":return y.string;case"number":return isNaN(s)?y.nan:y.number;case"boolean":return y.boolean;case"function":return y.function;case"bigint":return y.bigint;case"symbol":return y.symbol;case"object":return Array.isArray(s)?y.array:s===null?y.null:s.then&&typeof s.then=="function"&&s.catch&&typeof s.catch=="function"?y.promise:typeof Map<"u"&&s instanceof Map?y.map:typeof Set<"u"&&s instanceof Set?y.set:typeof Date<"u"&&s instanceof Date?y.date:y.object;default:return y.unknown}},m=I.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),td=s=>JSON.stringify(s,null,2).replace(/"([^"]+)":/g,"$1:");class Se extends Error{constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(i){return i.message},n={_errors:[]},r=i=>{for(const o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(r);else if(o.code==="invalid_return_type")r(o.returnTypeError);else if(o.code==="invalid_arguments")r(o.argumentsError);else if(o.path.length===0)n._errors.push(t(o));else{let a=n,c=0;for(;c<o.path.length;){const l=o.path[c];c===o.path.length-1?(a[l]=a[l]||{_errors:[]},a[l]._errors.push(t(o))):a[l]=a[l]||{_errors:[]},a=a[l],c++}}};return r(this),n}toString(){return this.message}get message(){return JSON.stringify(this.issues,I.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}Se.create=s=>new Se(s);const ws=(s,e)=>{let t;switch(s.code){case m.invalid_type:s.received===y.undefined?t="Required":t=`Expected ${s.expected}, received ${s.received}`;break;case m.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(s.expected,I.jsonStringifyReplacer)}`;break;case m.unrecognized_keys:t=`Unrecognized key(s) in object: ${I.joinValues(s.keys,", ")}`;break;case m.invalid_union:t="Invalid input";break;case m.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${I.joinValues(s.options)}`;break;case m.invalid_enum_value:t=`Invalid enum value. Expected ${I.joinValues(s.options)}, received '${s.received}'`;break;case m.invalid_arguments:t="Invalid function arguments";break;case m.invalid_return_type:t="Invalid function return type";break;case m.invalid_date:t="Invalid date";break;case m.invalid_string:typeof s.validation=="object"?"includes"in s.validation?(t=`Invalid input: must include "${s.validation.includes}"`,typeof s.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${s.validation.position}`)):"startsWith"in s.validation?t=`Invalid input: must start with "${s.validation.startsWith}"`:"endsWith"in s.validation?t=`Invalid input: must end with "${s.validation.endsWith}"`:I.assertNever(s.validation):s.validation!=="regex"?t=`Invalid ${s.validation}`:t="Invalid";break;case m.too_small:s.type==="array"?t=`Array must contain ${s.exact?"exactly":s.inclusive?"at least":"more than"} ${s.minimum} element(s)`:s.type==="string"?t=`String must contain ${s.exact?"exactly":s.inclusive?"at least":"over"} ${s.minimum} character(s)`:s.type==="number"?t=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="date"?t=`Date must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(s.minimum))}`:t="Invalid input";break;case m.too_big:s.type==="array"?t=`Array must contain ${s.exact?"exactly":s.inclusive?"at most":"less than"} ${s.maximum} element(s)`:s.type==="string"?t=`String must contain ${s.exact?"exactly":s.inclusive?"at most":"under"} ${s.maximum} character(s)`:s.type==="number"?t=`Number must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="bigint"?t=`BigInt must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="date"?t=`Date must be ${s.exact?"exactly":s.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(s.maximum))}`:t="Invalid input";break;case m.custom:t="Invalid input";break;case m.invalid_intersection_types:t="Intersection results could not be merged";break;case m.not_multiple_of:t=`Number must be a multiple of ${s.multipleOf}`;break;case m.not_finite:t="Number must be finite";break;default:t=e.defaultError,I.assertNever(s)}return{message:t}};let Ia=ws;function sd(s){Ia=s}function an(){return Ia}const cn=s=>{const{data:e,path:t,errorMaps:n,issueData:r}=s,i=[...t,...r.path||[]],o={...r,path:i};let a="";const c=n.filter(l=>!!l).slice().reverse();for(const l of c)a=l(o,{data:e,defaultError:a}).message;return{...r,path:i,message:r.message||a}},nd=[];function w(s,e){const t=cn({issueData:e,data:s.data,path:s.path,errorMaps:[s.common.contextualErrorMap,s.schemaErrorMap,an(),ws].filter(n=>!!n)});s.common.issues.push(t)}class X{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const r of t){if(r.status==="aborted")return T;r.status==="dirty"&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const r of t)n.push({key:await r.key,value:await r.value});return X.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const r of t){const{key:i,value:o}=r;if(i.status==="aborted"||o.status==="aborted")return T;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||r.alwaysSet)&&(n[i.value]=o.value)}return{status:e.value,value:n}}}const T=Object.freeze({status:"aborted"}),Oa=s=>({status:"dirty",value:s}),re=s=>({status:"valid",value:s}),gr=s=>s.status==="aborted",mr=s=>s.status==="dirty",ks=s=>s.status==="valid",ln=s=>typeof Promise<"u"&&s instanceof Promise;var v;(function(s){s.errToObj=e=>typeof e=="string"?{message:e}:e||{},s.toString=e=>typeof e=="string"?e:e?.message})(v||(v={}));class Oe{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Zi=(s,e)=>{if(ks(e))return{success:!0,data:e.value};if(!s.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Se(s.common.issues);return this._error=t,this._error}}};function M(s){if(!s)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:r}=s;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(o,a)=>o.code!=="invalid_type"?{message:a.defaultError}:typeof a.data>"u"?{message:n??a.defaultError}:{message:t??a.defaultError},description:r}}class D{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Je(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Je(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new X,ctx:{common:e.parent.common,data:e.data,parsedType:Je(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(ln(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const r={common:{issues:[],async:(n=t?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Je(e)},i=this._parseSync({data:e,path:r.path,parent:r});return Zi(r,i)}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Je(e)},r=this._parse({data:e,path:n.path,parent:n}),i=await(ln(r)?r:Promise.resolve(r));return Zi(n,i)}refine(e,t){const n=r=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(r):t;return this._refinement((r,i)=>{const o=e(r),a=()=>i.addIssue({code:m.custom,...n(r)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,t){return this._refinement((n,r)=>e(n)?!0:(r.addIssue(typeof t=="function"?t(n,r):t),!1))}_refinement(e){return new Te({schema:this,typeName:S.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return je.create(this,this._def)}nullable(){return bt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ee.create(this,this._def)}promise(){return Zt.create(this,this._def)}or(e){return Ss.create([this,e],this._def)}and(e){return Es.create(this,e,this._def)}transform(e){return new Te({...M(this._def),schema:this,typeName:S.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Ds({...M(this._def),innerType:this,defaultValue:t,typeName:S.ZodDefault})}brand(){return new Na({typeName:S.ZodBranded,type:this,...M(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new fn({...M(this._def),innerType:this,catchValue:t,typeName:S.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Us.create(this,e)}readonly(){return gn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const rd=/^c[^\s-]{8,}$/i,id=/^[a-z][a-z0-9]*$/,od=/^[0-9A-HJKMNP-TV-Z]{26}$/,ad=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,cd=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,ld="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let qn;const hd=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,ud=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,dd=s=>s.precision?s.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${s.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${s.precision}}Z$`):s.precision===0?s.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):s.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function fd(s,e){return!!((e==="v4"||!e)&&hd.test(s)||(e==="v6"||!e)&&ud.test(s))}class be extends D{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==y.string){const i=this._getOrReturnCtx(e);return w(i,{code:m.invalid_type,expected:y.string,received:i.parsedType}),T}const n=new X;let r;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:m.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:m.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){const o=e.data.length>i.value,a=e.data.length<i.value;(o||a)&&(r=this._getOrReturnCtx(e,r),o?w(r,{code:m.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&w(r,{code:m.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")cd.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"email",code:m.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")qn||(qn=new RegExp(ld,"u")),qn.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"emoji",code:m.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")ad.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"uuid",code:m.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")rd.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cuid",code:m.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")id.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cuid2",code:m.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")od.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"ulid",code:m.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),w(r,{validation:"url",code:m.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"regex",code:m.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(r=this._getOrReturnCtx(e,r),w(r,{code:m.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(r=this._getOrReturnCtx(e,r),w(r,{code:m.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(r=this._getOrReturnCtx(e,r),w(r,{code:m.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?dd(i).test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:m.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="ip"?fd(e.data,i.version)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"ip",code:m.invalid_string,message:i.message}),n.dirty()):I.assertNever(i);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(r=>e.test(r),{validation:t,code:m.invalid_string,...v.errToObj(n)})}_addCheck(e){return new be({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...v.errToObj(e)})}url(e){return this._addCheck({kind:"url",...v.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...v.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...v.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...v.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...v.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...v.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...v.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(t=e?.offset)!==null&&t!==void 0?t:!1,...v.errToObj(e?.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...v.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...v.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...v.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...v.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...v.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...v.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...v.errToObj(t)})}nonempty(e){return this.min(1,v.errToObj(e))}trim(){return new be({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new be({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new be({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}be.create=s=>{var e;return new be({checks:[],typeName:S.ZodString,coerce:(e=s?.coerce)!==null&&e!==void 0?e:!1,...M(s)})};function pd(s,e){const t=(s.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,r=t>n?t:n,i=parseInt(s.toFixed(r).replace(".","")),o=parseInt(e.toFixed(r).replace(".",""));return i%o/Math.pow(10,r)}class nt extends D{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==y.number){const i=this._getOrReturnCtx(e);return w(i,{code:m.invalid_type,expected:y.number,received:i.parsedType}),T}let n;const r=new X;for(const i of this._def.checks)i.kind==="int"?I.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),w(n,{code:m.invalid_type,expected:"integer",received:"float",message:i.message}),r.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),w(n,{code:m.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),w(n,{code:m.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):i.kind==="multipleOf"?pd(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),w(n,{code:m.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),w(n,{code:m.not_finite,message:i.message}),r.dirty()):I.assertNever(i);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,v.toString(t))}gt(e,t){return this.setLimit("min",e,!1,v.toString(t))}lte(e,t){return this.setLimit("max",e,!0,v.toString(t))}lt(e,t){return this.setLimit("max",e,!1,v.toString(t))}setLimit(e,t,n,r){return new nt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:v.toString(r)}]})}_addCheck(e){return new nt({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:v.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:v.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:v.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:v.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:v.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:v.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:v.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:v.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:v.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&I.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}nt.create=s=>new nt({checks:[],typeName:S.ZodNumber,coerce:s?.coerce||!1,...M(s)});class rt extends D{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==y.bigint){const i=this._getOrReturnCtx(e);return w(i,{code:m.invalid_type,expected:y.bigint,received:i.parsedType}),T}let n;const r=new X;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),w(n,{code:m.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),w(n,{code:m.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),w(n,{code:m.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):I.assertNever(i);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,v.toString(t))}gt(e,t){return this.setLimit("min",e,!1,v.toString(t))}lte(e,t){return this.setLimit("max",e,!0,v.toString(t))}lt(e,t){return this.setLimit("max",e,!1,v.toString(t))}setLimit(e,t,n,r){return new rt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:v.toString(r)}]})}_addCheck(e){return new rt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:v.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:v.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:v.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:v.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:v.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}rt.create=s=>{var e;return new rt({checks:[],typeName:S.ZodBigInt,coerce:(e=s?.coerce)!==null&&e!==void 0?e:!1,...M(s)})};class vs extends D{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==y.boolean){const n=this._getOrReturnCtx(e);return w(n,{code:m.invalid_type,expected:y.boolean,received:n.parsedType}),T}return re(e.data)}}vs.create=s=>new vs({typeName:S.ZodBoolean,coerce:s?.coerce||!1,...M(s)});class kt extends D{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==y.date){const i=this._getOrReturnCtx(e);return w(i,{code:m.invalid_type,expected:y.date,received:i.parsedType}),T}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return w(i,{code:m.invalid_date}),T}const n=new X;let r;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:m.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:m.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):I.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new kt({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:v.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:v.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}kt.create=s=>new kt({checks:[],coerce:s?.coerce||!1,typeName:S.ZodDate,...M(s)});class hn extends D{_parse(e){if(this._getType(e)!==y.symbol){const n=this._getOrReturnCtx(e);return w(n,{code:m.invalid_type,expected:y.symbol,received:n.parsedType}),T}return re(e.data)}}hn.create=s=>new hn({typeName:S.ZodSymbol,...M(s)});class bs extends D{_parse(e){if(this._getType(e)!==y.undefined){const n=this._getOrReturnCtx(e);return w(n,{code:m.invalid_type,expected:y.undefined,received:n.parsedType}),T}return re(e.data)}}bs.create=s=>new bs({typeName:S.ZodUndefined,...M(s)});class xs extends D{_parse(e){if(this._getType(e)!==y.null){const n=this._getOrReturnCtx(e);return w(n,{code:m.invalid_type,expected:y.null,received:n.parsedType}),T}return re(e.data)}}xs.create=s=>new xs({typeName:S.ZodNull,...M(s)});class Vt extends D{constructor(){super(...arguments),this._any=!0}_parse(e){return re(e.data)}}Vt.create=s=>new Vt({typeName:S.ZodAny,...M(s)});class mt extends D{constructor(){super(...arguments),this._unknown=!0}_parse(e){return re(e.data)}}mt.create=s=>new mt({typeName:S.ZodUnknown,...M(s)});class ze extends D{_parse(e){const t=this._getOrReturnCtx(e);return w(t,{code:m.invalid_type,expected:y.never,received:t.parsedType}),T}}ze.create=s=>new ze({typeName:S.ZodNever,...M(s)});class un extends D{_parse(e){if(this._getType(e)!==y.undefined){const n=this._getOrReturnCtx(e);return w(n,{code:m.invalid_type,expected:y.void,received:n.parsedType}),T}return re(e.data)}}un.create=s=>new un({typeName:S.ZodVoid,...M(s)});class Ee extends D{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==y.array)return w(t,{code:m.invalid_type,expected:y.array,received:t.parsedType}),T;if(r.exactLength!==null){const o=t.data.length>r.exactLength.value,a=t.data.length<r.exactLength.value;(o||a)&&(w(t,{code:o?m.too_big:m.too_small,minimum:a?r.exactLength.value:void 0,maximum:o?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(r.minLength!==null&&t.data.length<r.minLength.value&&(w(t,{code:m.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),r.maxLength!==null&&t.data.length>r.maxLength.value&&(w(t,{code:m.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((o,a)=>r.type._parseAsync(new Oe(t,o,t.path,a)))).then(o=>X.mergeArray(n,o));const i=[...t.data].map((o,a)=>r.type._parseSync(new Oe(t,o,t.path,a)));return X.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new Ee({...this._def,minLength:{value:e,message:v.toString(t)}})}max(e,t){return new Ee({...this._def,maxLength:{value:e,message:v.toString(t)}})}length(e,t){return new Ee({...this._def,exactLength:{value:e,message:v.toString(t)}})}nonempty(e){return this.min(1,e)}}Ee.create=(s,e)=>new Ee({type:s,minLength:null,maxLength:null,exactLength:null,typeName:S.ZodArray,...M(e)});function Ot(s){if(s instanceof L){const e={};for(const t in s.shape){const n=s.shape[t];e[t]=je.create(Ot(n))}return new L({...s._def,shape:()=>e})}else return s instanceof Ee?new Ee({...s._def,type:Ot(s.element)}):s instanceof je?je.create(Ot(s.unwrap())):s instanceof bt?bt.create(Ot(s.unwrap())):s instanceof $e?$e.create(s.items.map(e=>Ot(e))):s}class L extends D{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=I.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==y.object){const l=this._getOrReturnCtx(e);return w(l,{code:m.invalid_type,expected:y.object,received:l.parsedType}),T}const{status:n,ctx:r}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof ze&&this._def.unknownKeys==="strip"))for(const l in r.data)o.includes(l)||a.push(l);const c=[];for(const l of o){const h=i[l],u=r.data[l];c.push({key:{status:"valid",value:l},value:h._parse(new Oe(r,u,r.path,l)),alwaysSet:l in r.data})}if(this._def.catchall instanceof ze){const l=this._def.unknownKeys;if(l==="passthrough")for(const h of a)c.push({key:{status:"valid",value:h},value:{status:"valid",value:r.data[h]}});else if(l==="strict")a.length>0&&(w(r,{code:m.unrecognized_keys,keys:a}),n.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const h of a){const u=r.data[h];c.push({key:{status:"valid",value:h},value:l._parse(new Oe(r,u,r.path,h)),alwaysSet:h in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const l=[];for(const h of c){const u=await h.key;l.push({key:u,value:await h.value,alwaysSet:h.alwaysSet})}return l}).then(l=>X.mergeObjectSync(n,l)):X.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return v.errToObj,new L({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var r,i,o,a;const c=(o=(i=(r=this._def).errorMap)===null||i===void 0?void 0:i.call(r,t,n).message)!==null&&o!==void 0?o:n.defaultError;return t.code==="unrecognized_keys"?{message:(a=v.errToObj(e).message)!==null&&a!==void 0?a:c}:{message:c}}}:{}})}strip(){return new L({...this._def,unknownKeys:"strip"})}passthrough(){return new L({...this._def,unknownKeys:"passthrough"})}extend(e){return new L({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new L({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:S.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new L({...this._def,catchall:e})}pick(e){const t={};return I.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new L({...this._def,shape:()=>t})}omit(e){const t={};return I.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new L({...this._def,shape:()=>t})}deepPartial(){return Ot(this)}partial(e){const t={};return I.objectKeys(this.shape).forEach(n=>{const r=this.shape[n];e&&!e[n]?t[n]=r:t[n]=r.optional()}),new L({...this._def,shape:()=>t})}required(e){const t={};return I.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof je;)i=i._def.innerType;t[n]=i}}),new L({...this._def,shape:()=>t})}keyof(){return $a(I.objectKeys(this.shape))}}L.create=(s,e)=>new L({shape:()=>s,unknownKeys:"strip",catchall:ze.create(),typeName:S.ZodObject,...M(e)});L.strictCreate=(s,e)=>new L({shape:()=>s,unknownKeys:"strict",catchall:ze.create(),typeName:S.ZodObject,...M(e)});L.lazycreate=(s,e)=>new L({shape:s,unknownKeys:"strip",catchall:ze.create(),typeName:S.ZodObject,...M(e)});class Ss extends D{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function r(i){for(const a of i)if(a.result.status==="valid")return a.result;for(const a of i)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(a=>new Se(a.ctx.common.issues));return w(t,{code:m.invalid_union,unionErrors:o}),T}if(t.common.async)return Promise.all(n.map(async i=>{const o={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(r);{let i;const o=[];for(const c of n){const l={...t,common:{...t.common,issues:[]},parent:null},h=c._parseSync({data:t.data,path:t.path,parent:l});if(h.status==="valid")return h;h.status==="dirty"&&!i&&(i={result:h,ctx:l}),l.common.issues.length&&o.push(l.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const a=o.map(c=>new Se(c));return w(t,{code:m.invalid_union,unionErrors:a}),T}}get options(){return this._def.options}}Ss.create=(s,e)=>new Ss({options:s,typeName:S.ZodUnion,...M(e)});const Qs=s=>s instanceof As?Qs(s.schema):s instanceof Te?Qs(s.innerType()):s instanceof Ts?[s.value]:s instanceof it?s.options:s instanceof Ms?Object.keys(s.enum):s instanceof Ds?Qs(s._def.innerType):s instanceof bs?[void 0]:s instanceof xs?[null]:null;class Rn extends D{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==y.object)return w(t,{code:m.invalid_type,expected:y.object,received:t.parsedType}),T;const n=this.discriminator,r=t.data[n],i=this.optionsMap.get(r);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(w(t,{code:m.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),T)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const r=new Map;for(const i of t){const o=Qs(i.shape[e]);if(!o)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const a of o){if(r.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);r.set(a,i)}}return new Rn({typeName:S.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...M(n)})}}function yr(s,e){const t=Je(s),n=Je(e);if(s===e)return{valid:!0,data:s};if(t===y.object&&n===y.object){const r=I.objectKeys(e),i=I.objectKeys(s).filter(a=>r.indexOf(a)!==-1),o={...s,...e};for(const a of i){const c=yr(s[a],e[a]);if(!c.valid)return{valid:!1};o[a]=c.data}return{valid:!0,data:o}}else if(t===y.array&&n===y.array){if(s.length!==e.length)return{valid:!1};const r=[];for(let i=0;i<s.length;i++){const o=s[i],a=e[i],c=yr(o,a);if(!c.valid)return{valid:!1};r.push(c.data)}return{valid:!0,data:r}}else return t===y.date&&n===y.date&&+s==+e?{valid:!0,data:s}:{valid:!1}}class Es extends D{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(i,o)=>{if(gr(i)||gr(o))return T;const a=yr(i.value,o.value);return a.valid?((mr(i)||mr(o))&&t.dirty(),{status:t.value,value:a.data}):(w(n,{code:m.invalid_intersection_types}),T)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,o])=>r(i,o)):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Es.create=(s,e,t)=>new Es({left:s,right:e,typeName:S.ZodIntersection,...M(t)});class $e extends D{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==y.array)return w(n,{code:m.invalid_type,expected:y.array,received:n.parsedType}),T;if(n.data.length<this._def.items.length)return w(n,{code:m.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),T;!this._def.rest&&n.data.length>this._def.items.length&&(w(n,{code:m.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...n.data].map((o,a)=>{const c=this._def.items[a]||this._def.rest;return c?c._parse(new Oe(n,o,n.path,a)):null}).filter(o=>!!o);return n.common.async?Promise.all(i).then(o=>X.mergeArray(t,o)):X.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new $e({...this._def,rest:e})}}$e.create=(s,e)=>{if(!Array.isArray(s))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new $e({items:s,typeName:S.ZodTuple,rest:null,...M(e)})};class Cs extends D{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==y.object)return w(n,{code:m.invalid_type,expected:y.object,received:n.parsedType}),T;const r=[],i=this._def.keyType,o=this._def.valueType;for(const a in n.data)r.push({key:i._parse(new Oe(n,a,n.path,a)),value:o._parse(new Oe(n,n.data[a],n.path,a))});return n.common.async?X.mergeObjectAsync(t,r):X.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof D?new Cs({keyType:e,valueType:t,typeName:S.ZodRecord,...M(n)}):new Cs({keyType:be.create(),valueType:e,typeName:S.ZodRecord,...M(t)})}}class dn extends D{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==y.map)return w(n,{code:m.invalid_type,expected:y.map,received:n.parsedType}),T;const r=this._def.keyType,i=this._def.valueType,o=[...n.data.entries()].map(([a,c],l)=>({key:r._parse(new Oe(n,a,n.path,[l,"key"])),value:i._parse(new Oe(n,c,n.path,[l,"value"]))}));if(n.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const c of o){const l=await c.key,h=await c.value;if(l.status==="aborted"||h.status==="aborted")return T;(l.status==="dirty"||h.status==="dirty")&&t.dirty(),a.set(l.value,h.value)}return{status:t.value,value:a}})}else{const a=new Map;for(const c of o){const l=c.key,h=c.value;if(l.status==="aborted"||h.status==="aborted")return T;(l.status==="dirty"||h.status==="dirty")&&t.dirty(),a.set(l.value,h.value)}return{status:t.value,value:a}}}}dn.create=(s,e,t)=>new dn({valueType:e,keyType:s,typeName:S.ZodMap,...M(t)});class vt extends D{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==y.set)return w(n,{code:m.invalid_type,expected:y.set,received:n.parsedType}),T;const r=this._def;r.minSize!==null&&n.data.size<r.minSize.value&&(w(n,{code:m.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),r.maxSize!==null&&n.data.size>r.maxSize.value&&(w(n,{code:m.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const i=this._def.valueType;function o(c){const l=new Set;for(const h of c){if(h.status==="aborted")return T;h.status==="dirty"&&t.dirty(),l.add(h.value)}return{status:t.value,value:l}}const a=[...n.data.values()].map((c,l)=>i._parse(new Oe(n,c,n.path,l)));return n.common.async?Promise.all(a).then(c=>o(c)):o(a)}min(e,t){return new vt({...this._def,minSize:{value:e,message:v.toString(t)}})}max(e,t){return new vt({...this._def,maxSize:{value:e,message:v.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}vt.create=(s,e)=>new vt({valueType:s,minSize:null,maxSize:null,typeName:S.ZodSet,...M(e)});class $t extends D{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==y.function)return w(t,{code:m.invalid_type,expected:y.function,received:t.parsedType}),T;function n(a,c){return cn({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,an(),ws].filter(l=>!!l),issueData:{code:m.invalid_arguments,argumentsError:c}})}function r(a,c){return cn({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,an(),ws].filter(l=>!!l),issueData:{code:m.invalid_return_type,returnTypeError:c}})}const i={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof Zt){const a=this;return re(async function(...c){const l=new Se([]),h=await a._def.args.parseAsync(c,i).catch(f=>{throw l.addIssue(n(c,f)),l}),u=await Reflect.apply(o,this,h);return await a._def.returns._def.type.parseAsync(u,i).catch(f=>{throw l.addIssue(r(u,f)),l})})}else{const a=this;return re(function(...c){const l=a._def.args.safeParse(c,i);if(!l.success)throw new Se([n(c,l.error)]);const h=Reflect.apply(o,this,l.data),u=a._def.returns.safeParse(h,i);if(!u.success)throw new Se([r(h,u.error)]);return u.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new $t({...this._def,args:$e.create(e).rest(mt.create())})}returns(e){return new $t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new $t({args:e||$e.create([]).rest(mt.create()),returns:t||mt.create(),typeName:S.ZodFunction,...M(n)})}}class As extends D{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}As.create=(s,e)=>new As({getter:s,typeName:S.ZodLazy,...M(e)});class Ts extends D{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return w(t,{received:t.data,code:m.invalid_literal,expected:this._def.value}),T}return{status:"valid",value:e.data}}get value(){return this._def.value}}Ts.create=(s,e)=>new Ts({value:s,typeName:S.ZodLiteral,...M(e)});function $a(s,e){return new it({values:s,typeName:S.ZodEnum,...M(e)})}class it extends D{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return w(t,{expected:I.joinValues(n),received:t.parsedType,code:m.invalid_type}),T}if(this._def.values.indexOf(e.data)===-1){const t=this._getOrReturnCtx(e),n=this._def.values;return w(t,{received:t.data,code:m.invalid_enum_value,options:n}),T}return re(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return it.create(e)}exclude(e){return it.create(this.options.filter(t=>!e.includes(t)))}}it.create=$a;class Ms extends D{_parse(e){const t=I.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==y.string&&n.parsedType!==y.number){const r=I.objectValues(t);return w(n,{expected:I.joinValues(r),received:n.parsedType,code:m.invalid_type}),T}if(t.indexOf(e.data)===-1){const r=I.objectValues(t);return w(n,{received:n.data,code:m.invalid_enum_value,options:r}),T}return re(e.data)}get enum(){return this._def.values}}Ms.create=(s,e)=>new Ms({values:s,typeName:S.ZodNativeEnum,...M(e)});class Zt extends D{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==y.promise&&t.common.async===!1)return w(t,{code:m.invalid_type,expected:y.promise,received:t.parsedType}),T;const n=t.parsedType===y.promise?t.data:Promise.resolve(t.data);return re(n.then(r=>this._def.type.parseAsync(r,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Zt.create=(s,e)=>new Zt({type:s,typeName:S.ZodPromise,...M(e)});class Te extends D{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===S.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,i={addIssue:o=>{w(n,o),o.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),r.type==="preprocess"){const o=r.transform(n.data,i);return n.common.issues.length?{status:"dirty",value:n.data}:n.common.async?Promise.resolve(o).then(a=>this._def.schema._parseAsync({data:a,path:n.path,parent:n})):this._def.schema._parseSync({data:o,path:n.path,parent:n})}if(r.type==="refinement"){const o=a=>{const c=r.refinement(a,i);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){const a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?T:(a.status==="dirty"&&t.dirty(),o(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?T:(a.status==="dirty"&&t.dirty(),o(a.value).then(()=>({status:t.value,value:a.value}))))}if(r.type==="transform")if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!ks(o))return o;const a=r.transform(o.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>ks(o)?Promise.resolve(r.transform(o.value,i)).then(a=>({status:t.value,value:a})):o);I.assertNever(r)}}Te.create=(s,e,t)=>new Te({schema:s,typeName:S.ZodEffects,effect:e,...M(t)});Te.createWithPreprocess=(s,e,t)=>new Te({schema:e,effect:{type:"preprocess",transform:s},typeName:S.ZodEffects,...M(t)});class je extends D{_parse(e){return this._getType(e)===y.undefined?re(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}je.create=(s,e)=>new je({innerType:s,typeName:S.ZodOptional,...M(e)});class bt extends D{_parse(e){return this._getType(e)===y.null?re(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}bt.create=(s,e)=>new bt({innerType:s,typeName:S.ZodNullable,...M(e)});class Ds extends D{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===y.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Ds.create=(s,e)=>new Ds({innerType:s,typeName:S.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...M(e)});class fn extends D{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return ln(r)?r.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Se(n.common.issues)},input:n.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new Se(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}fn.create=(s,e)=>new fn({innerType:s,typeName:S.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...M(e)});class pn extends D{_parse(e){if(this._getType(e)!==y.nan){const n=this._getOrReturnCtx(e);return w(n,{code:m.invalid_type,expected:y.nan,received:n.parsedType}),T}return{status:"valid",value:e.data}}}pn.create=s=>new pn({typeName:S.ZodNaN,...M(s)});const gd=Symbol("zod_brand");class Na extends D{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Us extends D{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?T:i.status==="dirty"?(t.dirty(),Oa(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{const r=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return r.status==="aborted"?T:r.status==="dirty"?(t.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:n.path,parent:n})}}static create(e,t){return new Us({in:e,out:t,typeName:S.ZodPipeline})}}class gn extends D{_parse(e){const t=this._def.innerType._parse(e);return ks(t)&&(t.value=Object.freeze(t.value)),t}}gn.create=(s,e)=>new gn({innerType:s,typeName:S.ZodReadonly,...M(e)});const Ra=(s,e={},t)=>s?Vt.create().superRefine((n,r)=>{var i,o;if(!s(n)){const a=typeof e=="function"?e(n):typeof e=="string"?{message:e}:e,c=(o=(i=a.fatal)!==null&&i!==void 0?i:t)!==null&&o!==void 0?o:!0,l=typeof a=="string"?{message:a}:a;r.addIssue({code:"custom",...l,fatal:c})}}):Vt.create(),md={object:L.lazycreate};var S;(function(s){s.ZodString="ZodString",s.ZodNumber="ZodNumber",s.ZodNaN="ZodNaN",s.ZodBigInt="ZodBigInt",s.ZodBoolean="ZodBoolean",s.ZodDate="ZodDate",s.ZodSymbol="ZodSymbol",s.ZodUndefined="ZodUndefined",s.ZodNull="ZodNull",s.ZodAny="ZodAny",s.ZodUnknown="ZodUnknown",s.ZodNever="ZodNever",s.ZodVoid="ZodVoid",s.ZodArray="ZodArray",s.ZodObject="ZodObject",s.ZodUnion="ZodUnion",s.ZodDiscriminatedUnion="ZodDiscriminatedUnion",s.ZodIntersection="ZodIntersection",s.ZodTuple="ZodTuple",s.ZodRecord="ZodRecord",s.ZodMap="ZodMap",s.ZodSet="ZodSet",s.ZodFunction="ZodFunction",s.ZodLazy="ZodLazy",s.ZodLiteral="ZodLiteral",s.ZodEnum="ZodEnum",s.ZodEffects="ZodEffects",s.ZodNativeEnum="ZodNativeEnum",s.ZodOptional="ZodOptional",s.ZodNullable="ZodNullable",s.ZodDefault="ZodDefault",s.ZodCatch="ZodCatch",s.ZodPromise="ZodPromise",s.ZodBranded="ZodBranded",s.ZodPipeline="ZodPipeline",s.ZodReadonly="ZodReadonly"})(S||(S={}));const yd=(s,e={message:`Input not instance of ${s.name}`})=>Ra(t=>t instanceof s,e),Pa=be.create,Ba=nt.create,_d=pn.create,wd=rt.create,La=vs.create,kd=kt.create,vd=hn.create,bd=bs.create,xd=xs.create,Sd=Vt.create,Ed=mt.create,Cd=ze.create,Ad=un.create,Td=Ee.create,Md=L.create,Dd=L.strictCreate,Id=Ss.create,Od=Rn.create,$d=Es.create,Nd=$e.create,Rd=Cs.create,Pd=dn.create,Bd=vt.create,Ld=$t.create,jd=As.create,Ud=Ts.create,Vd=it.create,Zd=Ms.create,Fd=Zt.create,Fi=Te.create,zd=je.create,Wd=bt.create,Hd=Te.createWithPreprocess,Yd=Us.create,Gd=()=>Pa().optional(),Jd=()=>Ba().optional(),qd=()=>La().optional(),Kd={string:s=>be.create({...s,coerce:!0}),number:s=>nt.create({...s,coerce:!0}),boolean:s=>vs.create({...s,coerce:!0}),bigint:s=>rt.create({...s,coerce:!0}),date:s=>kt.create({...s,coerce:!0})},Xd=T;var b=Object.freeze({__proto__:null,defaultErrorMap:ws,setErrorMap:sd,getErrorMap:an,makeIssue:cn,EMPTY_PATH:nd,addIssueToContext:w,ParseStatus:X,INVALID:T,DIRTY:Oa,OK:re,isAborted:gr,isDirty:mr,isValid:ks,isAsync:ln,get util(){return I},get objectUtil(){return pr},ZodParsedType:y,getParsedType:Je,ZodType:D,ZodString:be,ZodNumber:nt,ZodBigInt:rt,ZodBoolean:vs,ZodDate:kt,ZodSymbol:hn,ZodUndefined:bs,ZodNull:xs,ZodAny:Vt,ZodUnknown:mt,ZodNever:ze,ZodVoid:un,ZodArray:Ee,ZodObject:L,ZodUnion:Ss,ZodDiscriminatedUnion:Rn,ZodIntersection:Es,ZodTuple:$e,ZodRecord:Cs,ZodMap:dn,ZodSet:vt,ZodFunction:$t,ZodLazy:As,ZodLiteral:Ts,ZodEnum:it,ZodNativeEnum:Ms,ZodPromise:Zt,ZodEffects:Te,ZodTransformer:Te,ZodOptional:je,ZodNullable:bt,ZodDefault:Ds,ZodCatch:fn,ZodNaN:pn,BRAND:gd,ZodBranded:Na,ZodPipeline:Us,ZodReadonly:gn,custom:Ra,Schema:D,ZodSchema:D,late:md,get ZodFirstPartyTypeKind(){return S},coerce:Kd,any:Sd,array:Td,bigint:wd,boolean:La,date:kd,discriminatedUnion:Od,effect:Fi,enum:Vd,function:Ld,instanceof:yd,intersection:$d,lazy:jd,literal:Ud,map:Pd,nan:_d,nativeEnum:Zd,never:Cd,null:xd,nullable:Wd,number:Ba,object:Md,oboolean:qd,onumber:Jd,optional:zd,ostring:Gd,pipeline:Yd,preprocess:Hd,promise:Fd,record:Rd,set:Bd,strictObject:Dd,string:Pa,symbol:vd,transformer:Fi,tuple:Nd,undefined:bd,union:Id,unknown:Ed,void:Ad,NEVER:Xd,ZodIssueCode:m,quotelessJson:td,ZodError:Se});const Qd=b.string(),ef=b.array(b.string()).optional(),tf=b.array(b.string()).optional(),sf=["root","hub","content"],nf=b.enum(sf),Yt=Object.freeze({Text:(s="")=>new xe(s),Boxed:s=>new Ae(s)}),ni=b.object({version:b.number(),model:b.object({role:nf,flavour:Qd,parent:ef,children:tf,props:b.function().args(b.custom()).returns(b.record(b.any())).optional(),toModel:b.function().args().returns(b.custom()).optional()}),transformer:b.function().args().returns(b.custom()).optional(),onUpgrade:b.function().args(b.any(),b.number(),b.number()).returns(b.void()).optional()});function rf({flavour:s,props:e,metadata:t,onUpgrade:n,toModel:r,transformer:i}){const o={version:t.version,model:{role:t.role,parent:t.parent,children:t.children,flavour:s,props:e,toModel:r},onUpgrade:n,transformer:i};return ni.parse(o),o}function of(){return class{}}class ja extends of(){constructor(){super(...arguments),this.created=new O,this.deleted=new O,this.propsUpdated=new O,this.childrenUpdated=new O}get childMap(){return this.children.reduce((e,t,n)=>(e.set(t.id,n),e),new Map)}get children(){const e=this.yBlock.get("sys:children");if(!e)return[];const t=[];return e.forEach(n=>{const r=this.page.getBlockById(n);r&&t.push(r)}),t}isEmpty(){return this.children.length===0}firstChild(){return this.children[0]||null}lastChild(){return this.children.length?this.children[this.children.length-1].lastChild():this}lastItem(){return this.children.length?this.children[this.children.length-1]:this}dispose(){this.created.dispose(),this.deleted.dispose(),this.propsUpdated.dispose(),this.childrenUpdated.dispose()}clone(){return Object.assign(Object.create(Object.getPrototypeOf(this)),this)}}var cg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function af(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function lg(s){if(s.__esModule)return s;var e=s.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(n){var r=Object.getOwnPropertyDescriptor(s,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return s[n]}})}),t}var cf=Ua;function Ua(s,e,t){s instanceof RegExp&&(s=zi(s,t)),e instanceof RegExp&&(e=zi(e,t));var n=Va(s,e,t);return n&&{start:n[0],end:n[1],pre:t.slice(0,n[0]),body:t.slice(n[0]+s.length,n[1]),post:t.slice(n[1]+e.length)}}function zi(s,e){var t=e.match(s);return t?t[0]:null}Ua.range=Va;function Va(s,e,t){var n,r,i,o,a,c=t.indexOf(s),l=t.indexOf(e,c+1),h=c;if(c>=0&&l>0){if(s===e)return[c,l];for(n=[],i=t.length;h>=0&&!a;)h==c?(n.push(h),c=t.indexOf(s,h+1)):n.length==1?a=[n.pop(),l]:(r=n.pop(),r<i&&(i=r,o=l),l=t.indexOf(e,h+1)),h=c<l&&c>=0?c:l;n.length&&(a=[i,o])}return a}var Za=cf,lf=df,Fa="\0SLASH"+Math.random()+"\0",za="\0OPEN"+Math.random()+"\0",ri="\0CLOSE"+Math.random()+"\0",Wa="\0COMMA"+Math.random()+"\0",Ha="\0PERIOD"+Math.random()+"\0";function Kn(s){return parseInt(s,10)==s?parseInt(s,10):s.charCodeAt(0)}function hf(s){return s.split("\\\\").join(Fa).split("\\{").join(za).split("\\}").join(ri).split("\\,").join(Wa).split("\\.").join(Ha)}function uf(s){return s.split(Fa).join("\\").split(za).join("{").split(ri).join("}").split(Wa).join(",").split(Ha).join(".")}function Ya(s){if(!s)return[""];var e=[],t=Za("{","}",s);if(!t)return s.split(",");var n=t.pre,r=t.body,i=t.post,o=n.split(",");o[o.length-1]+="{"+r+"}";var a=Ya(i);return i.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),e.push.apply(e,o),e}function df(s){return s?(s.substr(0,2)==="{}"&&(s="\\{\\}"+s.substr(2)),Qt(hf(s),!0).map(uf)):[]}function ff(s){return"{"+s+"}"}function pf(s){return/^-?0\d/.test(s)}function gf(s,e){return s<=e}function mf(s,e){return s>=e}function Qt(s,e){var t=[],n=Za("{","}",s);if(!n)return[s];var r=n.pre,i=n.post.length?Qt(n.post,!1):[""];if(/\$$/.test(n.pre))for(var o=0;o<i.length;o++){var a=r+"{"+n.body+"}"+i[o];t.push(a)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),l=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),h=c||l,u=n.body.indexOf(",")>=0;if(!h&&!u)return n.post.match(/,.*\}/)?(s=n.pre+"{"+n.body+ri+n.post,Qt(s)):[s];var d;if(h)d=n.body.split(/\.\./);else if(d=Ya(n.body),d.length===1&&(d=Qt(d[0],!1).map(ff),d.length===1))return i.map(function(Hc){return n.pre+d[0]+Hc});var f;if(h){var p=Kn(d[0]),g=Kn(d[1]),_=Math.max(d[0].length,d[1].length),E=d.length==3?Math.abs(Kn(d[2])):1,B=gf,R=g<p;R&&(E*=-1,B=mf);var ie=d.some(pf);f=[];for(var pe=p;B(pe,g);pe+=E){var Q;if(l)Q=String.fromCharCode(pe),Q==="\\"&&(Q="");else if(Q=String(pe),ie){var lt=_-Q.length;if(lt>0){var di=new Array(lt+1).join("0");pe<0?Q="-"+di+Q.slice(1):Q=di+Q}}f.push(Q)}}else{f=[];for(var ht=0;ht<d.length;ht++)f.push.apply(f,Qt(d[ht],!1))}for(var ht=0;ht<f.length;ht++)for(var o=0;o<i.length;o++){var a=r+f[ht]+i[o];(!e||h||a)&&t.push(a)}}return t}const yf=af(lf),_f=1024*64,mn=s=>{if(typeof s!="string")throw new TypeError("invalid pattern");if(s.length>_f)throw new TypeError("pattern is too long")},wf={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Jt=s=>s.replace(/[[\]\\-]/g,"\\$&"),kf=s=>s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Wi=s=>s.join(""),vf=(s,e)=>{const t=e;if(s.charAt(t)!=="[")throw new Error("not in a brace expression");const n=[],r=[];let i=t+1,o=!1,a=!1,c=!1,l=!1,h=t,u="";e:for(;i<s.length;){const g=s.charAt(i);if((g==="!"||g==="^")&&i===t+1){l=!0,i++;continue}if(g==="]"&&o&&!c){h=i+1;break}if(o=!0,g==="\\"&&!c){c=!0,i++;continue}if(g==="["&&!c){for(const[_,[E,B,R]]of Object.entries(wf))if(s.startsWith(_,i)){if(u)return["$.",!1,s.length-t,!0];i+=_.length,R?r.push(E):n.push(E),a=a||B;continue e}}if(c=!1,u){g>u?n.push(Jt(u)+"-"+Jt(g)):g===u&&n.push(Jt(g)),u="",i++;continue}if(s.startsWith("-]",i+1)){n.push(Jt(g+"-")),i+=2;continue}if(s.startsWith("-",i+1)){u=g,i+=2;continue}n.push(Jt(g)),i++}if(h<i)return["",!1,0,!1];if(!n.length&&!r.length)return["$.",!1,s.length-t,!0];if(r.length===0&&n.length===1&&/^\\?.$/.test(n[0])&&!l){const g=n[0].length===2?n[0].slice(-1):n[0];return[kf(g),!1,h-t,!1]}const d="["+(l?"^":"")+Wi(n)+"]",f="["+(l?"":"^")+Wi(r)+"]";return[n.length&&r.length?"("+d+"|"+f+")":n.length?d:f,a,h-t,!0]},es=(s,{windowsPathsNoEscape:e=!1}={})=>e?s.replace(/\[([^\/\\])\]/g,"$1"):s.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),bf=new Set(["!","?","+","*","@"]),Hi=s=>bf.has(s),xf="(?!(?:^|/)\\.\\.?(?:$|/))",Hs="(?!\\.)",Sf=new Set(["[","."]),Ef=new Set(["..","."]),Cf=new Set("().*{}+?[]^$\\!"),Af=s=>s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),ii="[^/]",Yi=ii+"*?",Gi=ii+"+?";class ee{type;#s;#n;#r=!1;#e=[];#t;#o;#c;#a=!1;#i;#l;#u=!1;constructor(e,t,n={}){this.type=e,e&&(this.#n=!0),this.#t=t,this.#s=this.#t?this.#t.#s:this,this.#i=this.#s===this?n:this.#s.#i,this.#c=this.#s===this?[]:this.#s.#c,e==="!"&&!this.#s.#a&&this.#c.push(this),this.#o=this.#t?this.#t.#e.length:0}get hasMagic(){if(this.#n!==void 0)return this.#n;for(const e of this.#e)if(typeof e!="string"&&(e.type||e.hasMagic))return this.#n=!0;return this.#n}toString(){return this.#l!==void 0?this.#l:this.type?this.#l=this.type+"("+this.#e.map(e=>String(e)).join("|")+")":this.#l=this.#e.map(e=>String(e)).join("")}#f(){if(this!==this.#s)throw new Error("should only call on root");if(this.#a)return this;this.toString(),this.#a=!0;let e;for(;e=this.#c.pop();){if(e.type!=="!")continue;let t=e,n=t.#t;for(;n;){for(let r=t.#o+1;!n.type&&r<n.#e.length;r++)for(const i of e.#e){if(typeof i=="string")throw new Error("string part in extglob AST??");i.copyIn(n.#e[r])}t=n,n=t.#t}}return this}push(...e){for(const t of e)if(t!==""){if(typeof t!="string"&&!(t instanceof ee&&t.#t===this))throw new Error("invalid part: "+t);this.#e.push(t)}}toJSON(){const e=this.type===null?this.#e.slice().map(t=>typeof t=="string"?t:t.toJSON()):[this.type,...this.#e.map(t=>t.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===this.#s||this.#s.#a&&this.#t?.type==="!")&&e.push({}),e}isStart(){if(this.#s===this)return!0;if(!this.#t?.isStart())return!1;if(this.#o===0)return!0;const e=this.#t;for(let t=0;t<this.#o;t++){const n=e.#e[t];if(!(n instanceof ee&&n.type==="!"))return!1}return!0}isEnd(){if(this.#s===this||this.#t?.type==="!")return!0;if(!this.#t?.isEnd())return!1;if(!this.type)return this.#t?.isEnd();const e=this.#t?this.#t.#e.length:0;return this.#o===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){const t=new ee(this.type,e);for(const n of this.#e)t.copyIn(n);return t}static#h(e,t,n,r){let i=!1,o=!1,a=-1,c=!1;if(t.type===null){let f=n,p="";for(;f<e.length;){const g=e.charAt(f++);if(i||g==="\\"){i=!i,p+=g;continue}if(o){f===a+1?(g==="^"||g==="!")&&(c=!0):g==="]"&&!(f===a+2&&c)&&(o=!1),p+=g;continue}else if(g==="["){o=!0,a=f,c=!1,p+=g;continue}if(!r.noext&&Hi(g)&&e.charAt(f)==="("){t.push(p),p="";const _=new ee(g,t);f=ee.#h(e,_,f,r),t.push(_);continue}p+=g}return t.push(p),f}let l=n+1,h=new ee(null,t);const u=[];let d="";for(;l<e.length;){const f=e.charAt(l++);if(i||f==="\\"){i=!i,d+=f;continue}if(o){l===a+1?(f==="^"||f==="!")&&(c=!0):f==="]"&&!(l===a+2&&c)&&(o=!1),d+=f;continue}else if(f==="["){o=!0,a=l,c=!1,d+=f;continue}if(Hi(f)&&e.charAt(l)==="("){h.push(d),d="";const p=new ee(f,h);h.push(p),l=ee.#h(e,p,l,r);continue}if(f==="|"){h.push(d),d="",u.push(h),h=new ee(null,t);continue}if(f===")")return d===""&&t.#e.length===0&&(t.#u=!0),h.push(d),d="",t.push(...u,h),l;d+=f}return t.type=null,t.#n=void 0,t.#e=[e.substring(n-1)],l}static fromGlob(e,t={}){const n=new ee(null,void 0,t);return ee.#h(e,n,0,t),n}toMMPattern(){if(this!==this.#s)return this.#s.toMMPattern();const e=this.toString(),[t,n,r,i]=this.toRegExpSource();if(!(r||this.#n||this.#i.nocase&&!this.#i.nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return n;const a=(this.#i.nocase?"i":"")+(i?"u":"");return Object.assign(new RegExp(`^${t}$`,a),{_src:t,_glob:e})}toRegExpSource(e){const t=e??!!this.#i.dot;if(this.#s===this&&this.#f(),!this.type){const c=this.isStart()&&this.isEnd(),l=this.#e.map(f=>{const[p,g,_,E]=typeof f=="string"?ee.#p(f,this.#n,c):f.toRegExpSource(e);return this.#n=this.#n||_,this.#r=this.#r||E,p}).join("");let h="";if(this.isStart()&&typeof this.#e[0]=="string"&&!(this.#e.length===1&&Ef.has(this.#e[0]))){const p=Sf,g=t&&p.has(l.charAt(0))||l.startsWith("\\.")&&p.has(l.charAt(2))||l.startsWith("\\.\\.")&&p.has(l.charAt(4)),_=!t&&!e&&p.has(l.charAt(0));h=g?xf:_?Hs:""}let u="";return this.isEnd()&&this.#s.#a&&this.#t?.type==="!"&&(u="(?:$|\\/)"),[h+l+u,es(l),this.#n=!!this.#n,this.#r]}const n=this.type==="*"||this.type==="+",r=this.type==="!"?"(?:(?!(?:":"(?:";let i=this.#d(t);if(this.isStart()&&this.isEnd()&&!i&&this.type!=="!"){const c=this.toString();return this.#e=[c],this.type=null,this.#n=void 0,[c,es(this.toString()),!1,!1]}let o=!n||e||t||!Hs?"":this.#d(!0);o===i&&(o=""),o&&(i=`(?:${i})(?:${o})*?`);let a="";if(this.type==="!"&&this.#u)a=(this.isStart()&&!t?Hs:"")+Gi;else{const c=this.type==="!"?"))"+(this.isStart()&&!t&&!e?Hs:"")+Yi+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&o?")":this.type==="*"&&o?")?":`)${this.type}`;a=r+i+c}return[a,es(i),this.#n=!!this.#n,this.#r]}#d(e){return this.#e.map(t=>{if(typeof t=="string")throw new Error("string type in extglob ast??");const[n,r,i,o]=t.toRegExpSource(e);return this.#r=this.#r||o,n}).filter(t=>!(this.isStart()&&this.isEnd())||!!t).join("|")}static#p(e,t,n=!1){let r=!1,i="",o=!1;for(let a=0;a<e.length;a++){const c=e.charAt(a);if(r){r=!1,i+=(Cf.has(c)?"\\":"")+c;continue}if(c==="\\"){a===e.length-1?i+="\\\\":r=!0;continue}if(c==="["){const[l,h,u,d]=vf(e,a);if(u){i+=l,o=o||h,a+=u-1,t=t||d;continue}}if(c==="*"){n&&e==="*"?i+=Gi:i+=Yi,t=!0;continue}if(c==="?"){i+=ii,t=!0;continue}i+=Af(c)}return[i,es(e),!!t,o]}}const Tf=(s,{windowsPathsNoEscape:e=!1}={})=>e?s.replace(/[?*()[\]]/g,"[$&]"):s.replace(/[?*()[\]\\]/g,"\\$&");var Xn={};const q=(s,e,t={})=>(mn(e),!t.nocomment&&e.charAt(0)==="#"?!1:new Pn(e,t).match(s)),Mf=/^\*+([^+@!?\*\[\(]*)$/,Df=s=>e=>!e.startsWith(".")&&e.endsWith(s),If=s=>e=>e.endsWith(s),Of=s=>(s=s.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(s)),$f=s=>(s=s.toLowerCase(),e=>e.toLowerCase().endsWith(s)),Nf=/^\*+\.\*+$/,Rf=s=>!s.startsWith(".")&&s.includes("."),Pf=s=>s!=="."&&s!==".."&&s.includes("."),Bf=/^\.\*+$/,Lf=s=>s!=="."&&s!==".."&&s.startsWith("."),jf=/^\*+$/,Uf=s=>s.length!==0&&!s.startsWith("."),Vf=s=>s.length!==0&&s!=="."&&s!=="..",Zf=/^\?+([^+@!?\*\[\(]*)?$/,Ff=([s,e=""])=>{const t=Ga([s]);return e?(e=e.toLowerCase(),n=>t(n)&&n.toLowerCase().endsWith(e)):t},zf=([s,e=""])=>{const t=Ja([s]);return e?(e=e.toLowerCase(),n=>t(n)&&n.toLowerCase().endsWith(e)):t},Wf=([s,e=""])=>{const t=Ja([s]);return e?n=>t(n)&&n.endsWith(e):t},Hf=([s,e=""])=>{const t=Ga([s]);return e?n=>t(n)&&n.endsWith(e):t},Ga=([s])=>{const e=s.length;return t=>t.length===e&&!t.startsWith(".")},Ja=([s])=>{const e=s.length;return t=>t.length===e&&t!=="."&&t!==".."},qa=typeof process=="object"&&process?typeof Xn=="object"&&Xn&&Xn.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",Ji={win32:{sep:"\\"},posix:{sep:"/"}},Yf=qa==="win32"?Ji.win32.sep:Ji.posix.sep;q.sep=Yf;const me=Symbol("globstar **");q.GLOBSTAR=me;const Gf="[^/]",Jf=Gf+"*?",qf="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Kf="(?:(?!(?:\\/|^)\\.).)*?",Xf=(s,e={})=>t=>q(t,s,e);q.filter=Xf;const ge=(s,e={})=>Object.assign({},s,e),Qf=s=>{if(!s||typeof s!="object"||!Object.keys(s).length)return q;const e=q;return Object.assign((n,r,i={})=>e(n,r,ge(s,i)),{Minimatch:class extends e.Minimatch{constructor(r,i={}){super(r,ge(s,i))}static defaults(r){return e.defaults(ge(s,r)).Minimatch}},AST:class extends e.AST{constructor(r,i,o={}){super(r,i,ge(s,o))}static fromGlob(r,i={}){return e.AST.fromGlob(r,ge(s,i))}},unescape:(n,r={})=>e.unescape(n,ge(s,r)),escape:(n,r={})=>e.escape(n,ge(s,r)),filter:(n,r={})=>e.filter(n,ge(s,r)),defaults:n=>e.defaults(ge(s,n)),makeRe:(n,r={})=>e.makeRe(n,ge(s,r)),braceExpand:(n,r={})=>e.braceExpand(n,ge(s,r)),match:(n,r,i={})=>e.match(n,r,ge(s,i)),sep:e.sep,GLOBSTAR:me})};q.defaults=Qf;const Ka=(s,e={})=>(mn(s),e.nobrace||!/\{(?:(?!\{).)*\}/.test(s)?[s]:yf(s));q.braceExpand=Ka;const ep=(s,e={})=>new Pn(s,e).makeRe();q.makeRe=ep;const tp=(s,e,t={})=>{const n=new Pn(e,t);return s=s.filter(r=>n.match(r)),n.options.nonull&&!s.length&&s.push(e),s};q.match=tp;const qi=/[?*]|[+@!]\(.*?\)|\[|\]/,sp=s=>s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class Pn{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(e,t={}){mn(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||qa,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const t of e)if(typeof t!="string")return!0;return!1}debug(...e){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=(...i)=>console.error(...i)),this.debug(this.pattern,this.globSet);const n=this.globSet.map(i=>this.slashSplit(i));this.globParts=this.preprocess(n),this.debug(this.pattern,this.globParts);let r=this.globParts.map((i,o,a)=>{if(this.isWindows&&this.windowsNoMagicRoot){const c=i[0]===""&&i[1]===""&&(i[2]==="?"||!qi.test(i[2]))&&!qi.test(i[3]),l=/^[a-z]:/i.test(i[0]);if(c)return[...i.slice(0,4),...i.slice(4).map(h=>this.parse(h))];if(l)return[i[0],...i.slice(1).map(h=>this.parse(h))]}return i.map(c=>this.parse(c))});if(this.debug(this.pattern,r),this.set=r.filter(i=>i.indexOf(!1)===-1),this.isWindows)for(let i=0;i<this.set.length;i++){const o=this.set[i];o[0]===""&&o[1]===""&&this.globParts[i][2]==="?"&&typeof o[3]=="string"&&/^[a-z]:$/i.test(o[3])&&(o[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let n=0;n<e.length;n++)for(let r=0;r<e[n].length;r++)e[n][r]==="**"&&(e[n][r]="*");const{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):t>=1?e=this.levelOneOptimize(e):e=this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let n=-1;for(;(n=t.indexOf("**",n+1))!==-1;){let r=n;for(;t[r+1]==="**";)r++;r!==n&&t.splice(n,r-n)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((n,r)=>{const i=n[n.length-1];return r==="**"&&i==="**"?n:r===".."&&i&&i!==".."&&i!=="."&&i!=="**"?(n.pop(),n):(n.push(r),n)},[]),t.length===0?[""]:t))}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let r=1;r<e.length-1;r++){const i=e[r];r===1&&i===""&&e[0]===""||(i==="."||i==="")&&(t=!0,e.splice(r,1),r--)}e[0]==="."&&e.length===2&&(e[1]==="."||e[1]==="")&&(t=!0,e.pop())}let n=0;for(;(n=e.indexOf("..",n+1))!==-1;){const r=e[n-1];r&&r!=="."&&r!==".."&&r!=="**"&&(t=!0,e.splice(n-1,2),n-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let n of e){let r=-1;for(;(r=n.indexOf("**",r+1))!==-1;){let o=r;for(;n[o+1]==="**";)o++;o>r&&n.splice(r+1,o-r);let a=n[r+1];const c=n[r+2],l=n[r+3];if(a!==".."||!c||c==="."||c===".."||!l||l==="."||l==="..")continue;t=!0,n.splice(r,1);const h=n.slice(0);h[r]="**",e.push(h),r--}if(!this.preserveMultipleSlashes){for(let o=1;o<n.length-1;o++){const a=n[o];o===1&&a===""&&n[0]===""||(a==="."||a==="")&&(t=!0,n.splice(o,1),o--)}n[0]==="."&&n.length===2&&(n[1]==="."||n[1]==="")&&(t=!0,n.pop())}let i=0;for(;(i=n.indexOf("..",i+1))!==-1;){const o=n[i-1];if(o&&o!=="."&&o!==".."&&o!=="**"){t=!0;const c=i===1&&n[i+1]==="**"?["."]:[];n.splice(i-1,2,...c),n.length===0&&n.push(""),i-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let n=t+1;n<e.length;n++){const r=this.partsMatch(e[t],e[n],!this.preserveMultipleSlashes);r&&(e[t]=r,e[n]=[])}return e.filter(t=>t.length)}partsMatch(e,t,n=!1){let r=0,i=0,o=[],a="";for(;r<e.length&&i<t.length;)if(e[r]===t[i])o.push(a==="b"?t[i]:e[r]),r++,i++;else if(n&&e[r]==="**"&&t[i]===e[r+1])o.push(e[r]),r++;else if(n&&t[i]==="**"&&e[r]===t[i+1])o.push(t[i]),i++;else if(e[r]==="*"&&t[i]&&(this.options.dot||!t[i].startsWith("."))&&t[i]!=="**"){if(a==="b")return!1;a="a",o.push(e[r]),r++,i++}else if(t[i]==="*"&&e[r]&&(this.options.dot||!e[r].startsWith("."))&&e[r]!=="**"){if(a==="a")return!1;a="b",o.push(t[i]),r++,i++}else return!1;return e.length===t.length&&o}parseNegate(){if(this.nonegate)return;const e=this.pattern;let t=!1,n=0;for(let r=0;r<e.length&&e.charAt(r)==="!";r++)t=!t,n++;n&&(this.pattern=e.slice(n)),this.negate=t}matchOne(e,t,n=!1){const r=this.options;if(this.isWindows){const g=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),_=!g&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),E=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),B=!E&&t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3]),R=_?3:g?0:void 0,ie=B?3:E?0:void 0;if(typeof R=="number"&&typeof ie=="number"){const[pe,Q]=[e[R],t[ie]];pe.toLowerCase()===Q.toLowerCase()&&(t[ie]=pe,ie>R?t=t.slice(ie):R>ie&&(e=e.slice(R)))}}const{optimizationLevel:i=1}=this.options;i>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var o=0,a=0,c=e.length,l=t.length;o<c&&a<l;o++,a++){this.debug("matchOne loop");var h=t[a],u=e[o];if(this.debug(t,h,u),h===!1)return!1;if(h===me){this.debug("GLOBSTAR",[t,h,u]);var d=o,f=a+1;if(f===l){for(this.debug("** at the end");o<c;o++)if(e[o]==="."||e[o]===".."||!r.dot&&e[o].charAt(0)===".")return!1;return!0}for(;d<c;){var p=e[d];if(this.debug(`
globstar while`,e,d,t,f,p),this.matchOne(e.slice(d),t.slice(f),n))return this.debug("globstar found match!",d,c,p),!0;if(p==="."||p===".."||!r.dot&&p.charAt(0)==="."){this.debug("dot detected!",e,d,t,f);break}this.debug("globstar swallow a segment, and continue"),d++}return!!(n&&(this.debug(`
>>> no match, partial?`,e,d,t,f),d===c))}let g;if(typeof h=="string"?(g=u===h,this.debug("string match",h,u,g)):(g=h.test(u),this.debug("pattern match",h,u,g)),!g)return!1}if(o===c&&a===l)return!0;if(o===c)return n;if(a===l)return o===c-1&&e[o]==="";throw new Error("wtf?")}braceExpand(){return Ka(this.pattern,this.options)}parse(e){mn(e);const t=this.options;if(e==="**")return me;if(e==="")return"";let n,r=null;(n=e.match(jf))?r=t.dot?Vf:Uf:(n=e.match(Mf))?r=(t.nocase?t.dot?$f:Of:t.dot?If:Df)(n[1]):(n=e.match(Zf))?r=(t.nocase?t.dot?zf:Ff:t.dot?Wf:Hf)(n):(n=e.match(Nf))?r=t.dot?Pf:Rf:(n=e.match(Bf))&&(r=Lf);const i=ee.fromGlob(e,this.options).toMMPattern();return r?Object.assign(i,{test:r}):i}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,n=t.noglobstar?Jf:t.dot?qf:Kf,r=new Set(t.nocase?["i"]:[]);let i=e.map(c=>{const l=c.map(h=>{if(h instanceof RegExp)for(const u of h.flags.split(""))r.add(u);return typeof h=="string"?sp(h):h===me?me:h._src});return l.forEach((h,u)=>{const d=l[u+1],f=l[u-1];h!==me||f===me||(f===void 0?d!==void 0&&d!==me?l[u+1]="(?:\\/|"+n+"\\/)?"+d:l[u]=n:d===void 0?l[u-1]=f+"(?:\\/|"+n+")?":d!==me&&(l[u-1]=f+"(?:\\/|\\/"+n+"\\/)"+d,l[u+1]=me))}),l.filter(h=>h!==me).join("/")}).join("|");const[o,a]=e.length>1?["(?:",")"]:["",""];i="^"+o+i+a+"$",this.negate&&(i="^(?!"+i+").+$");try{this.regexp=new RegExp(i,[...r].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;const n=this.options;this.isWindows&&(e=e.split("\\").join("/"));const r=this.slashSplit(e);this.debug(this.pattern,"split",r);const i=this.set;this.debug(this.pattern,"set",i);let o=r[r.length-1];if(!o)for(let a=r.length-2;!o&&a>=0;a--)o=r[a];for(let a=0;a<i.length;a++){const c=i[a];let l=r;if(n.matchBase&&c.length===1&&(l=[o]),this.matchOne(l,c,t))return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate}static defaults(e){return q.defaults(e).Minimatch}}q.AST=ee;q.Minimatch=Pn;q.escape=Tf;q.unescape=es;class Xa{constructor(e,t,n={}){this.schema=e,this.yBlock=t,this.options=n,this._byPassProxy=!1,this._stashed=new Set,this.stash=l=>{this._stashed.has(l)||(this._stashed.add(l),this.model[l]=_s(this.yBlock.get(`prop:${l}`),{transform:(h,u)=>Ae.is(u)?h:u instanceof W?new Proxy(h,{get:(d,f,p)=>Reflect.get(d,f,p),set:(d,f,p,g)=>{const _=Reflect.set(d,f,p,g);return this.options.onChange?.(this,l,p),_},deleteProperty:(d,f)=>{const p=Reflect.deleteProperty(d,f);return this.options.onChange?.(this,l,void 0),p}}):u instanceof z?new Proxy(h,{get:(d,f,p)=>Reflect.get(d,f,p),set:(d,f,p,g)=>{const _=Number(f);if(Number.isNaN(_))return Reflect.set(d,f,p,g);const E=Reflect.set(d,f,p,g);return this.options.onChange?.(this,l,p),E},deleteProperty:(d,f)=>{const p=Reflect.deleteProperty(d,f);return this.options.onChange?.(this,f,void 0),p}}):h}))},this.pop=l=>{if(!this._stashed.has(l))return;const h=this.model[l];this._stashed.delete(l),this.model[l]=h},this._byPassUpdate=l=>{this._byPassProxy=!0,l(),this._byPassProxy=!1},this._getPropsProxy=(l,h)=>st(h,{onChange:()=>{this.options.onChange?.(this,l,h)}});const{id:r,flavour:i,version:o,yChildren:a,props:c}=this._parseYBlock();this.id=r,this.flavour=i,this.yChildren=a,this.version=o,this.model=this._createModel(c),this.yChildren.observe(()=>{this.model.childrenUpdated.emit()}),this.yBlock.observe(l=>{l.keysChanged.forEach(h=>{const u=l.changes.keys.get(h);if(u){if(u.action==="update"||u.action==="add"){const d=this.yBlock.get(h),f=h.replace("prop:",""),p=this._getPropsProxy(f,d);this._byPassUpdate(()=>{this.model[f]=p}),this.options.onChange?.(this,f,d);return}if(u.action==="delete"){const d=h.replace("prop:","");this._byPassUpdate(()=>{delete this.model[d]}),this.options.onChange?.(this,d,void 0);return}}})}),this.yBlock.observeDeep(l=>{const h=l[0];!h||h.currentTarget===h.target||this.options.onChange?.(this,"",void 0)})}_parseYBlock(){let e,t,n,r;const i={};this.yBlock.forEach((c,l)=>{if(l.startsWith("prop:")){const h=l.replace("prop:","");i[h]=this._getPropsProxy(h,c);return}if(l==="sys:id"&&typeof c=="string"){e=c;return}if(l==="sys:flavour"&&typeof c=="string"){t=c;return}if(l==="sys:children"&&c instanceof z){r=c;return}if(l==="sys:version"&&typeof c=="number"){n=c;return}}),k(e,"Block id is not found"),k(t,"Block flavour is not found"),k(r,"Block children is not found");const o=this.schema.flavourSchemaMap.get(t);k(o,`Cannot find schema for flavour ${t}`);const a=o.model.props?.(Yt);return typeof n!="number"&&(n=o.version),a&&Object.entries(a).forEach(([c,l])=>{if(i[c]!==void 0)return;const h=Fe(l);this.yBlock.set(`prop:${c}`,h),i[c]=this._getPropsProxy(c,h)}),{id:e,flavour:t,version:n,props:i,yChildren:r}}_createModel(e){const t=this.schema.flavourSchemaMap.get(this.flavour);k(t,`Cannot find schema for flavour ${this.flavour}`);const n=t.model.toModel?.()??new ja;return Object.assign(n,e),n.id=this.id,n.version=this.version,n.keys=Object.keys(e),n.flavour=t.model.flavour,n.role=t.model.role,n.yBlock=this.yBlock,n.stash=this.stash,n.pop=this.pop,new Proxy(n,{has:(r,i)=>Reflect.has(r,i),set:(r,i,o,a)=>{if(!this._byPassProxy&&typeof i=="string"&&n.keys.includes(i)){if(this._stashed.has(i)){const h=Reflect.set(r,i,o,a);return this.options.onChange?.(this,i,o),h}const c=Fe(o);this.yBlock.set(`prop:${i}`,c);const l=this._getPropsProxy(i,c);return Reflect.set(r,i,l,a)}return Reflect.set(r,i,o,a)},get:(r,i,o)=>Reflect.get(r,i,o),deleteProperty:(r,i)=>(!this._byPassProxy&&typeof i=="string"&&n.keys.includes(i)&&this.yBlock.delete(`prop:${i}`),Reflect.deleteProperty(r,i))})}}var Ki;const np=Symbol("internal_error");class Qa extends Error{constructor(e,t){super(t),this[Ki]=!0,this.code=e}static{Ki=np}}class Qn extends Qa{constructor(e){super(100,`Migration failed. Please report to https://github.com/toeverything/blocksuite/issues
          ${e}`)}}class Pe extends Qa{constructor(e,t){super(101,`Invalid schema for ${e}: ${t}`)}}class rp{constructor(){this.flavourSchemaMap=new Map,this.validate=(e,t,n)=>{const r=this.flavourSchemaMap.get(e);k(r,new Pe(e,Jn));const i=()=>{n?.forEach(a=>{const c=this.flavourSchemaMap.get(a);k(c,new Pe(a,Jn)),this.validateSchema(c,r)})};if(r.model.role==="root"){if(t)throw new Pe(r.model.flavour,"Root block cannot have parent.");i();return}if(!t)throw new Pe(r.model.flavour,"Hub/Content must have parent.");const o=this.flavourSchemaMap.get(t);k(o,new Pe(t,Jn)),this.validateSchema(r,o),i()},this.upgradeWorkspace=e=>{this._upgradeBlockVersions(e),Ca.forEach(t=>{try{t.condition(e)&&t.migrate(e)}catch(n){throw console.error(n),new Qn(t.desc)}})},this.upgradePage=(e,t,n)=>{const r=n.getMap("blocks");Array.from(r.values()).forEach(i=>{const o=i.get("sys:flavour"),a=t[o]??0;k(a,`previous version for flavour ${o} not found`),this.upgradeBlock(o,a,i)}),Ea.forEach(i=>{try{i.condition(e,n)&&i.migrate(e,n)}catch(o){throw new Qn(`${i.desc}
            ${o}`)}})},this.upgradeBlock=(e,t,n)=>{try{const r=this.flavourSchemaMap.get(e);k(r);const{onUpgrade:i,version:o}=r;if(!i)return;const a=new Xa(this,n);return i(a.model,t,o)}catch(r){throw new Qn(`upgrade block ${e} failed.
          ${r}`)}},this._upgradeBlockVersions=e=>{const n=e.getMap("meta").get("blockVersions");n&&n.forEach((r,i)=>{const o=this.flavourSchemaMap.get(i);o&&r!==o.version&&n.set(i,o.version)})}}get versions(){return Object.fromEntries(Array.from(this.flavourSchemaMap.values()).map(e=>[e.model.flavour,e.version]))}toJSON(){return Object.fromEntries(Array.from(this.flavourSchemaMap.values()).map(e=>[e.model.flavour,{role:e.model.role,parent:e.model.parent,children:e.model.children}]))}register(e){return e.forEach(t=>{ni.parse(t),this.flavourSchemaMap.set(t.model.flavour,t)}),this}validateSchema(e,t){if(this._validateRole(e,t),!this._validateParent(e,t))throw new Pe(e.model.flavour,`Block cannot have parent: ${t.model.flavour}.`)}_validateRole(e,t){const n=e.model.role,r=t.model.role,i=e.model.flavour,o=t.model.flavour;if(n==="root")throw new Pe(i,`Root block cannot have parent: ${o}.`);if(n==="hub"&&r==="content")throw new Pe(i,`Hub block cannot be child of content block: ${o}.`);if(n==="content"&&r==="root")throw new Pe(i,`Content block can only be child of hub block or itself. But get: ${o}.`)}_matchFlavour(e,t){return q(e,t)||q(t,e)}_validateParent(e,t){const n=e.model.flavour,r=t.model.flavour,i=e.model.parent||["*"];return(t.model.children||["*"]).some(a=>i.some(c=>a==="*"&&c==="*"?!0:a==="*"?this._matchFlavour(c,r):c==="*"?this._matchFlavour(n,a):this._matchFlavour(n,a)&&this._matchFlavour(c,r)))}}class ec{constructor(e){this._assetsMap=new Map,this._blob=e.blob}getAssets(){return this._assetsMap}cleanup(){this._assetsMap.clear()}async readFromBlob(e){const t=await this._blob.get(e);k(t,`Blob ${e} not found in blob manager`),this._assetsMap.set(e,t)}async writeToBlob(e){const t=this._assetsMap.get(e);k(t),await this._blob.get(e)===null&&await this._blob.set(t,e)}}function yn(s){return s instanceof Ae?{[rs]:!0,value:s.getValue()}:s instanceof xe?{[Ta]:!0,delta:s.yText.toDelta()}:Array.isArray(s)?s.map(yn):ti(s)?Object.fromEntries(Object.entries(s).map(([e,t])=>[e,yn(t)])):s}function _n(s){return Array.isArray(s)?s.map(_n):s instanceof Object?Reflect.has(s,rs)?new Ae(Reflect.get(s,"value")):Reflect.has(s,Ta)?new xe(Reflect.get(s,"delta")):Object.fromEntries(Object.entries(s).map(([e,t])=>[e,_n(t)])):s}class tc{constructor(){this._internal=Yt}_propsFromSnapshot(e){return Object.fromEntries(Object.entries(e).map(([t,n])=>[t,_n(n)]))}_propsToSnapshot(e){return Object.fromEntries(e.keys.map(t=>{const n=e[t];return[t,yn(n)]}))}async fromSnapshot({json:e}){const{flavour:t,id:n,version:r,props:i}=e,o=this._propsFromSnapshot(i);return{id:n,flavour:t,version:r??-1,props:o}}async toSnapshot({model:e}){const{id:t,flavour:n,version:r}=e,i=this._propsToSnapshot(e);return{id:t,flavour:n,version:r,props:i}}}class Bn{constructor(e){this.data=e}static fromModels(e,t){const n=e.workspace.meta,{pageVersion:r,workspaceVersion:i}=n;return k(r),k(i),new Bn({content:t,workspaceId:e.workspace.id,pageId:e.id,pageVersion:r,workspaceVersion:i})}get content(){return this.data.content}get pageVersion(){return this.data.pageVersion}get workspaceVersion(){return this.data.workspaceVersion}get workspaceId(){return this.data.workspaceId}get pageId(){return this.data.pageId}}const Ft=b.object({type:b.literal("block"),id:b.string(),flavour:b.string(),version:b.number().optional(),props:b.record(b.unknown()),children:b.lazy(()=>Ft.array())}),_r=b.object({type:b.literal("slice"),content:Ft.array(),pageVersion:b.number(),workspaceVersion:b.number(),workspaceId:b.string(),pageId:b.string()}),wr=b.object({id:b.string(),type:b.literal("info"),pageVersion:b.number(),workspaceVersion:b.number(),properties:b.record(b.any())}),ip=b.object({id:b.string(),title:b.string(),createDate:b.number(),tags:b.array(b.string())}),kr=b.object({type:b.literal("page"),meta:ip,blocks:Ft});class op{constructor({workspace:e,middlewares:t=[]}){this._adapterConfigs=new Map,this._slots={beforeImport:new O,afterImport:new O,beforeExport:new O,afterExport:new O},this.blockToSnapshot=async n=>{const r=await this._blockToSnapshot(n);return Ft.parse(r),r},this.snapshotToModelData=async n=>{const{children:r,flavour:i,props:o,id:a}=n,c=this._getSchema(i),l={id:a,flavour:i,props:o};return await this._getTransformer(c).fromSnapshot({json:l,assets:this._assetsManager,children:r})},this.snapshotToBlock=async(n,r,i,o)=>(Ft.parse(n),await this._snapshotToBlock(n,r,i,o)),this.pageToSnapshot=async n=>{this._slots.beforeExport.emit({type:"page",page:n});const r=n.root,i=this._exportPageMeta(n);k(r,"Root block not found in page");const o=await this.blockToSnapshot(r),a={type:"page",meta:i,blocks:o};return this._slots.afterExport.emit({type:"page",page:n,snapshot:a}),kr.parse(a),a},this.snapshotToPage=async n=>{this._slots.beforeImport.emit({type:"page",snapshot:n}),kr.parse(n);const{meta:r,blocks:i}=n,o=this._workspace.createPage({id:r.id});return await o.load(),this._importPageMeta(o,r),await this.snapshotToBlock(i,o),this._slots.afterImport.emit({type:"page",snapshot:n,page:o}),o},this.workspaceInfoToSnapshot=()=>{this._slots.beforeExport.emit({type:"info"});const n=this._getWorkspaceMeta(),r={type:"info",id:this._workspace.id,...n};return this._slots.afterExport.emit({type:"info",snapshot:r}),wr.parse(r),r},this.snapshotToWorkspaceInfo=n=>{this._slots.beforeImport.emit({type:"info",snapshot:n}),wr.parse(n);const{properties:r}=n,i=this._workspace.meta.properties,o=r.tags?.options??[],a=i.tags?.options??[],c=new Set([...o,...a]);this._workspace.meta.setProperties({tags:{options:Array.from(c)}}),this._slots.afterImport.emit({type:"info",snapshot:n})},this.sliceToSnapshot=async n=>{this._slots.beforeExport.emit({type:"slice",slice:n});const{content:r,pageVersion:i,workspaceVersion:o,pageId:a,workspaceId:c}=n.data,l=[];for(const u of r)l.push(await this.blockToSnapshot(u));const h={type:"slice",workspaceId:c,pageId:a,pageVersion:i,workspaceVersion:o,content:l};return this._slots.afterExport.emit({type:"slice",slice:n,snapshot:h}),_r.parse(h),h},this.snapshotToSlice=async(n,r,i,o)=>{this._slots.beforeImport.emit({type:"slice",snapshot:n}),_r.parse(n);const{content:a,pageVersion:c,workspaceVersion:l,workspaceId:h,pageId:u}=n,d=[];for(const[p,g]of a.entries())d.push(await this._snapshotToBlock(g,r,i,(o??0)+p));const f=new Bn({content:d,pageVersion:c,workspaceVersion:l,workspaceId:h,pageId:u});return this._slots.afterImport.emit({type:"slice",snapshot:n,slice:f}),f},this._workspace=e,this._assetsManager=new ec({blob:e.blob}),t.forEach(n=>{n({slots:this._slots,assetsManager:this._assetsManager,workspace:this._workspace,adapterConfigs:this._adapterConfigs})})}get assetsManager(){return this._assetsManager}get assets(){return this._assetsManager.getAssets()}get adapterConfigs(){return this._adapterConfigs}reset(){this._assetsManager.cleanup()}_getSchema(e){const t=this._workspace.schema.flavourSchemaMap.get(e);return k(t,`Flavour schema not found for ${e}`),t}_getTransformer(e){return e.transformer?.()??new tc}_getWorkspaceMeta(){const{meta:e}=this._workspace,{pageVersion:t,workspaceVersion:n,properties:r,pages:i}=e;return k(t),k(n),k(r),k(i),{pageVersion:t,workspaceVersion:n,properties:JSON.parse(JSON.stringify(r)),pages:JSON.parse(JSON.stringify(i))}}_exportPageMeta(e){const t=e.meta;return k(t),{id:t.id,title:t.title,createDate:t.createDate,tags:[...t.tags]}}_importPageMeta(e,t){const n=e.meta,r=this._workspace.meta.properties.tags?.options;k(r),t.tags.forEach(i=>{if(!r.some(a=>a.id===i))throw new Error(`Tag ${i} is not in workspace options`);n.tags.push(i)})}async _blockToSnapshot(e){this._slots.beforeExport.emit({type:"block",model:e});const t=this._getSchema(e.flavour),r=await this._getTransformer(t).toSnapshot({model:e,assets:this._assetsManager}),i=await Promise.all(e.children.map(a=>this._blockToSnapshot(a))),o={type:"block",...r,children:i};return this._slots.afterExport.emit({type:"block",model:e,snapshot:o}),o}async _snapshotToBlock(e,t,n,r){this._slots.beforeImport.emit({type:"block",snapshot:e,parent:n,index:r});const{children:i,flavour:o,props:a,id:c}=e,l=this._getSchema(o),h={id:c,flavour:o,props:a},d=await this._getTransformer(l).fromSnapshot({json:h,assets:this._assetsManager,children:i});t.addBlock(d.flavour,{...d.props,id:d.id},n,r);for(const[p,g]of i.entries())await this._snapshotToBlock(g,t,c,p);const f=t.getBlockById(c);return k(f),this._slots.afterImport.emit({type:"block",snapshot:e,model:f,parent:n,index:r}),f}}let ap=(s=21)=>crypto.getRandomValues(new Uint8Array(s)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");function sc(){let s=0;return()=>(s++).toString()}function nc(s){let e=0;return()=>`${s}:${e++}`}const rc=()=>Ir(),vr=()=>ap(10);function ic(s,e){Array.isArray(e.children)&&e.children.forEach(t=>{if(!s.has(t.id))throw new Error("Invalid child id: "+t.id)})}function oc(s,e,t,n){const r=s.model.props?.(Yt)??{};Object.entries(n).forEach(([i,o])=>{Xu.has(i)||o!==void 0&&(e[i]=o)}),Object.entries(r).forEach(([i,o])=>{(!t.has(`prop:${i}`)||t.get(`prop:${i}`)===void 0)&&(e[i]=Fe(o))})}function cp(s){return Eo(Lr(s.doc))}const lp=Object.freeze(Object.defineProperty({__proto__:null,assertValidChildren:ic,encodeWorkspaceAsYjsUpdateV2:cp,syncBlockProps:oc},Symbol.toStringTag,{value:"Module"}));class hp{constructor({schema:e,yBlocks:t}){this._blocks=new Map,this._yBlocks=t,this._schema=e}getBlock(e){return this._blocks.get(e)}get blocks(){return this._blocks}onBlockAdded(e,t,n={}){if(this._blocks.has(e))return;const r=this._yBlocks.get(e);if(!r){console.warn(`Could not find block with id ${e}`);return}const i=new Xa(this._schema,r,n);this._blocks.set(e,i),i.model.page=t,i.model.created.emit()}onBlockRemoved(e){if(!this._blocks.has(e))return;const t=this._blocks.get(e);t.model.dispose(),this._blocks.delete(e),t.model.deleted.emit()}addBlock(e,t,n){const r=this._schema.flavourSchemaMap.get(t);k(r,`Could not find schema for flavour ${t}`);const i=new W;this._yBlocks.set(e,i);const o=r.version;i.set("sys:id",e),i.set("sys:flavour",t),i.set("sys:version",o);const c={...r.model.props?.(Yt)??{},...n},l=z.from((c.children??[]).map(h=>h.id));return i.set("sys:children",l),delete c.children,delete c.id,delete c.flavour,Object.entries(c).forEach(([h,u])=>{u!==void 0&&i.set(`prop:${h}`,Fe(u))}),i}removeBlock(e){this._yBlocks.delete(e)}}class ac{constructor(e,t,n){this._onLoadSlot=new O,this._initSubDoc=()=>{let r=this.rootDoc.spaces.get(this.id);return r?(this._loaded=!1,this.rootDoc.on("subdocs",this._onSubdocEvent)):(r=new Ne({guid:this.id}),this.rootDoc.spaces.set(this.id,r),this._loaded=!0,this._onLoadSlot.emit()),r},this._onSubdocEvent=({loaded:r})=>{Array.from(r).find(o=>o.guid===this._ySpaceDoc.guid)&&(this.rootDoc.off("subdocs",this._onSubdocEvent),this._loaded=!0,this._onLoadSlot.emit())},this.id=e,this.rootDoc=t,this.awarenessStore=n,this._ySpaceDoc=this._initSubDoc(),this._yBlocks=this._ySpaceDoc.getMap("blocks")}get yBlocks(){return this._yBlocks}get loaded(){return this._loaded}get spaceDoc(){return this._ySpaceDoc}async load(){if(this.loaded)return this;const e=new Promise(t=>{this._onLoadSlot.once(()=>{t(void 0)})});return this._ySpaceDoc.load(),await e,this}remove(){this.destroy(),this.rootDoc.spaces.delete(this.id)}destroy(){this._ySpaceDoc.destroy(),this._onLoadSlot.dispose(),this._loaded=!1}clear(){this._yBlocks.clear()}transact(e,t=!0){this._ySpaceDoc.transact(e,t?this.rootDoc.clientID:null)}}class cc extends ac{constructor({id:e,workspace:t,doc:n,awarenessStore:r,idGenerator:i=Ir}){super(e,n,r),this._root=null,this._docLoaded=!1,this._ready=!1,this._shouldTransact=!0,this.slots={ready:new O,historyUpdated:new O,rootAdded:new O,rootDeleted:new O,blockUpdated:new O},this._historyObserver=()=>{this.slots.historyUpdated.emit()},this._handleYEvents=o=>{for(const a of o)this._handleYEvent(a)},this._workspace=t,this._idGenerator=i,this._blockTree=new hp({schema:t.schema,yBlocks:this.yBlocks})}get readonly(){return this.awarenessStore.isReadonly(this)}get ready(){return this._ready}get history(){return this._history}get workspace(){return this._workspace}get schema(){return this.workspace.schema}get meta(){return this.workspace.meta.getPageMeta(this.id)}get blob(){return this.workspace.blob}get root(){return this._root}get isEmpty(){return this._yBlocks.size===0}get canUndo(){return this.readonly?!1:this._history.canUndo()}get canRedo(){return this.readonly?!1:this._history.canRedo()}get Text(){return xe}withoutTransact(e){this._shouldTransact=!1,e(),this._shouldTransact=!0}transact(e,t=this._shouldTransact){super.transact(e,t)}undo(){if(this.readonly){console.error("cannot modify data in readonly mode");return}this._history.undo()}redo(){if(this.readonly){console.error("cannot modify data in readonly mode");return}this._history.redo()}captureSync(){this._history.stopCapturing()}resetHistory(){this._history.clear()}generateBlockId(){return this._idGenerator()}getBlockById(e){return this._blockTree.getBlock(e)?.model??null}getBlockByFlavour(e){const t=typeof e=="string"?[e]:e;return Array.from(this._blockTree.blocks.values()).filter(({flavour:n})=>t.includes(n)).map(n=>n.model)}getParent(e){const t=this._root,n=typeof e=="string"?e:e.id;if(!t||t.id===n)return null;const r=o=>{const a=this.getBlockById(o);if(!a)return null;for(const[c]of a.childMap){if(c===n)return a;const l=r(c);if(l!==null)return l}return null},i=r(t.id);return i!==null?i:null}getPreviousSibling(e){const t=this.getParent(e);if(!t)return null;const n=t.children.indexOf(e);if(n===-1)throw new Error("Failed to getPreviousSiblings! Block not found in parent's children");return t.children[n-1]??null}getPreviousSiblings(e){const t=this.getParent(e);if(!t)return[];const n=t.children.indexOf(e);if(n===-1)throw new Error("Failed to getPreviousSiblings! Block not found in parent's children");return t.children.slice(0,n)}getNextSibling(e){const t=this.getParent(e);if(!t)return null;const n=t.children.indexOf(e);if(n===-1)throw new Error("Failed to getPreviousSiblings! Block not found in parent's children");return t.children[n+1]??null}getNextSiblings(e){const t=this.getParent(e);if(!t)return[];const n=t.children.indexOf(e);if(n===-1)throw new Error("Failed to getNextSiblings! Block not found in parent's children");return t.children.slice(n+1)}getSchemaByFlavour(e){return this.schema.flavourSchemaMap.get(e)}getInitialPropsByFlavour(e){const t=this.schema.flavourSchemaMap.get(e);return k(t),t.model.props?.(Yt)??{}}getBlocks(){const e=[];return this._blockTree.blocks.forEach(({model:n})=>{e.push(n)}),e}addBlocks(e,t,n){const r=[];return e.forEach(i=>{const o=this.addBlock(i.flavour,i.blockProps??{},t,n);r.push(o),typeof n=="number"&&n++}),r}addBlock(e,t={},n,r){if(this.readonly)throw new Error("cannot modify data in readonly mode");if(!e)throw new Error("Block props must contain flavour");const i=typeof n=="string"?this.getBlockById(n):n;this.schema.validate(e,i?.flavour,t.children?.map(c=>c.flavour));const o=t.id??this._idGenerator(),a={id:o,flavour:e,...t};return this.transact(()=>{this._blockTree.addBlock(o,e,{...t}),ic(this._yBlocks,a);const c=this.getSchemaByFlavour(e);k(c);const l=i?.id??(c.model.role==="root"?void 0:this._root?.id);if(l){const u=this._yBlocks.get(l).get("sys:children"),d=r??u.length;u.insert(d,[o])}}),o}moveBlocks(e,t,n=null,r=!0){if(this.readonly){console.error("Cannot modify data in read-only mode");return}if(!t)throw new Error("Can't find new parent block");const i=new Map;e.forEach(o=>{const a=this.getParent(o);if(!a)throw new Error("Can't find parent block for the current block");this.schema.validate(o.flavour,t.flavour);const c=i.get(a);if(c){if(this.getNextSibling(c[c.length-1])!==o)throw new Error("The blocks to move are not contiguous under their parent");c.push(o)}else i.set(a,[o])}),this.transact(()=>{let o=0,a=!0;for(const[c,l]of i){const u=this._yBlocks.get(t.id).get("sys:children"),f=this._yBlocks.get(c.id).get("sys:children"),p=l.map(({id:_})=>_),g=f.toArray().findIndex(_=>_===p[0]);if(f.delete(g,p.length),a){if(n){const _=u.toArray().findIndex(E=>E===n.id);if(_===-1)throw new Error("Target sibling not found");o=r?_:_+1}else o=u.length;a=!1}else o++;u.insert(o,p)}})}updateBlock(e,t){if(this.readonly){console.error("cannot modify data in readonly mode");return}const n=typeof t=="function";if(!n){const i=this.getParent(e);this.schema.validate(e.flavour,i?.flavour,t.children?.map(o=>o.flavour))}const r=this._yBlocks.get(e.id);k(r),this.transact(()=>{if(!n){if(t.children){const o=new z;o.insert(0,t.children.map(a=>a.id)),r.set("sys:children",o)}const i=this.schema.flavourSchemaMap.get(e.flavour);k(i),oc(i,e,r,t);return}t()})}addSiblingBlocks(e,t,n="after"){if(!t.length)return[];const r=this.getParent(e);k(r);const i=r.children.findIndex(({id:a})=>a===e.id)??0,o=n==="before"?i:i+1;if(t.length>1){const a=[];return t.forEach(c=>{const{flavour:l,...h}=c;k(l),a.push({flavour:l,blockProps:h})}),this.addBlocks(a,r.id,o)}else{k(t[0].flavour);const{flavour:a,...c}=t[0];return[this.addBlock(a,c,r.id,o)]}}deleteBlock(e,t={deleteChildren:!0}){if(this.readonly){console.error("cannot modify data in readonly mode");return}const{bringChildrenTo:n,deleteChildren:r}=t;if(n&&r){console.error("Cannot bring children to another block and delete them at the same time");return}const o=this._yBlocks.get(e.id).get("sys:children"),a=this.getParent(e);k(a);const l=this._yBlocks.get(a.id).get("sys:children"),h=l.toArray().indexOf(e.id);this.transact(()=>{if(h>-1&&l.delete(h,1),n)e.children.forEach(u=>{this.schema.validate(u.flavour,n.flavour)}),n.id===a.id?l.insert(h,o.toArray()):this._yBlocks.get(n.id).get("sys:children").push(o.toArray());else if(r){const u=d=>{this._yBlocks.get(d).get("sys:children").forEach(g=>{u(g)}),this._blockTree.removeBlock(d)};o.forEach(d=>{u(d)})}this._blockTree.removeBlock(e.id)})}trySyncFromExistingDoc(){if(this._docLoaded)throw new Error("Cannot sync from existing doc more than once");(this.workspace.meta.pages?.length??0)<=1&&this._handleVersion(),this._initYBlocks(),this._yBlocks.forEach((e,t)=>{this._handleYBlockAdd(t)}),this._docLoaded=!0,this._yBlocks.size>0&&(this._ready=!0,this.slots.ready.emit())}dispose(){this.slots.historyUpdated.dispose(),this.slots.rootAdded.dispose(),this.slots.rootDeleted.dispose(),this.slots.blockUpdated.dispose(),this._docLoaded&&(this._yBlocks.unobserveDeep(this._handleYEvents),this._yBlocks.clear())}_initYBlocks(){const{_yBlocks:e}=this;e.observeDeep(this._handleYEvents),this._history=new zr([e],{trackedOrigins:new Set([this._ySpaceDoc.clientID])}),this._history.on("stack-cleared",this._historyObserver),this._history.on("stack-item-added",this._historyObserver),this._history.on("stack-item-popped",this._historyObserver),this._history.on("stack-item-updated",this._historyObserver)}_getYBlock(e){const t=this._yBlocks.get(e);return t||null}_handleYBlockAdd(e){const t=this._getYBlock(e);if(!t){console.warn(`Failed to handle yBlock add, yBlock with id-${e} not found`);return}this._blockTree.onBlockAdded(e,this,{onChange:(o,a)=>{a&&o.model.propsUpdated.emit({key:a}),this.slots.blockUpdated.emit({type:"update",id:e,flavour:o.flavour,props:{key:a}})}});const n=this._blockTree.getBlock(e);k(n);const r=n.model,i=t.get("sys:children");if(i instanceof z&&i.forEach((o,a)=>{this._blockTree.blocks.has(o)||this._handleYBlockAdd(o),r.children[a]=this.getBlockById(o)}),r.role==="root"){this._root=r,this.slots.rootAdded.emit(this._root);return}this.slots.blockUpdated.emit({type:"add",id:e,flavour:r.flavour})}_handleYBlockDelete(e){const t=this.getBlockById(e);t===this._root&&this.slots.rootDeleted.emit(e),k(t),this._blockTree.onBlockRemoved(e),this.slots.blockUpdated.emit({type:"delete",id:e,flavour:t.flavour,parent:this.getParent(t)?.id??"",model:t})}_handleYEvent(e){e.target===this._yBlocks&&e.keys.forEach((t,n)=>{t.action==="add"?this._handleYBlockAdd(n):t.action==="delete"&&this._handleYBlockDelete(n)})}_handleVersion(){this.workspace.meta.hasVersion?this.awarenessStore.getFlag("enable_legacy_validation")&&this.workspace.meta.validateVersion(this.workspace):this.workspace.meta.writeVersion(this.workspace)}async load(e){return await super.load(),this._docLoaded||this.trySyncFromExistingDoc(),e&&(await e(),this._ready=!0,this.slots.ready.emit()),this}async waitForLoaded(){await this.load()}}var br={exports:{}};(function(s,e){Object.defineProperty(e,"__esModule",{value:!0}),e.isPlainObject=e.clone=e.recursive=e.merge=e.main=void 0,s.exports=e=t,e.default=t;function t(){for(var l=[],h=0;h<arguments.length;h++)l[h]=arguments[h];return n.apply(void 0,l)}e.main=t,t.clone=i,t.isPlainObject=o,t.recursive=r;function n(){for(var l=[],h=0;h<arguments.length;h++)l[h]=arguments[h];return c(l[0]===!0,!1,l)}e.merge=n;function r(){for(var l=[],h=0;h<arguments.length;h++)l[h]=arguments[h];return c(l[0]===!0,!0,l)}e.recursive=r;function i(l){if(Array.isArray(l)){for(var h=[],u=0;u<l.length;++u)h.push(i(l[u]));return h}else if(o(l)){var h={};for(var u in l)h[u]=i(l[u]);return h}else return l}e.clone=i;function o(l){return l&&typeof l=="object"&&!Array.isArray(l)}e.isPlainObject=o;function a(l,h){if(!o(l))return h;for(var u in h)u==="__proto__"||u==="constructor"||u==="prototype"||(l[u]=o(l[u])&&o(h[u])?a(l[u],h[u]):h[u]);return l}function c(l,h,u){var d;(l||!o(d=u.shift()))&&(d={});for(var f=0;f<u.length;++f){var p=u[f];if(o(p)){for(var g in p)if(!(g==="__proto__"||g==="constructor"||g==="prototype")){var _=l?i(p[g]):p[g];d[g]=h?a(d[g],_):_}}}return d}})(br,br.exports);var lc=br.exports;const er=3e4;class up extends Cn{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const t=hs();this.getLocalState()!==null&&er/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const n=[];this.meta.forEach((r,i)=>{i!==this.clientID&&er<=t-r.lastUpdated&&this.states.has(i)&&n.push(i)}),n.length>0&&dp(this,n,"timeout")},Ue(er/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const t=this.clientID,n=this.meta.get(t),r=n===void 0?0:n.clock+1,i=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:r,lastUpdated:hs()});const o=[],a=[],c=[],l=[];e===null?l.push(t):i==null?e!=null&&o.push(t):(a.push(t),ss(i,e)||c.push(t)),(o.length>0||c.length>0||l.length>0)&&this.emit("change",[{added:o,updated:c,removed:l},"local"]),this.emit("update",[{added:o,updated:a,removed:l},"local"])}setLocalStateField(e,t){const n=this.getLocalState();n!==null&&this.setLocalState({...n,[e]:t})}getStates(){return this.states}}const dp=(s,e,t)=>{const n=[];for(let r=0;r<e.length;r++){const i=e[r];if(s.states.has(i)){if(s.states.delete(i),i===s.clientID){const o=s.meta.get(i);s.meta.set(i,{clock:o.clock+1,lastUpdated:hs()})}n.push(i)}}n.length>0&&(s.emit("change",[{added:[],updated:[],removed:n},t]),s.emit("update",[{added:[],updated:[],removed:n},t]))},dg=(s,e,t=s.states)=>{const n=e.length,r=At();x(r,n);for(let i=0;i<n;i++){const o=e[i],a=t.get(o)||null,c=s.meta.get(o).clock;x(r,o),x(r,c),Ke(r,JSON.stringify(a))}return ue(r)},fg=(s,e,t)=>{const n=J(e),r=hs(),i=[],o=[],a=[],c=[],l=A(n);for(let h=0;h<l;h++){const u=A(n);let d=A(n);const f=JSON.parse(Xe(n)),p=s.meta.get(u),g=s.states.get(u),_=p===void 0?0:p.clock;(_<d||_===d&&f===null&&s.states.has(u))&&(f===null?u===s.clientID&&s.getLocalState()!=null?d++:s.states.delete(u):s.states.set(u,f),s.meta.set(u,{clock:d,lastUpdated:r}),p===void 0&&f!==null?i.push(u):p!==void 0&&f===null?c.push(u):f!==null&&(ss(f,g)||a.push(u),o.push(u)))}(i.length>0||a.length>0||c.length>0)&&s.emit("change",[{added:i,updated:a,removed:c},t]),(i.length>0||o.length>0||c.length>0)&&s.emit("update",[{added:i,updated:o,removed:c},t])};class hc{constructor(e,t,n){this.slots={update:new O},this._onAwarenessChange=r=>{const{added:i,removed:o,updated:a}=r,c=this.awareness.getStates();i.forEach(l=>{this.slots.update.emit({id:l,type:"add",state:c.get(l)})}),a.forEach(l=>{this.slots.update.emit({id:l,type:"update",state:c.get(l)})}),o.forEach(l=>{this.slots.update.emit({id:l,type:"remove"})})},this.store=e,this.awareness=t,this.awareness.on("change",this._onAwarenessChange),this.awareness.setLocalStateField("selection",[]),this._initFlags(n)}_initFlags(e){const t=this.awareness.getLocalState()?.flags,n=t?lc.merge(!0,e,t):{...e};this.awareness.setLocalStateField("flags",n)}setFlag(e,t){const n=this.awareness.getLocalState()?.flags??{};this.awareness.setLocalStateField("flags",{...n,[e]:t})}getFlag(e){return(this.awareness.getLocalState()?.flags??{})[e]}setReadonly(e,t){const n=this.getFlag("readonly")??{};this.setFlag("readonly",{...n,[e.id]:t})}isReadonly(e){const t=this.getFlag("readonly");return t&&typeof t=="object"?!!t[e.id]:!1}setLocalSelection(e){this.awareness.setLocalStateField("selection",e)}getLocalSelection(){return this.awareness.getLocalState()?.selection||[]}getStates(){return this.awareness.getStates()}destroy(){this.awareness&&(this.awareness.off("change",this._onAwarenessChange),this.slots.update.dispose())}}class uc extends Ne{constructor(){super(...arguments),this._spaces=this.getMap("spaces")}get spaces(){return this._spaces}toJSON(){const e=super.toJSON();delete e.spaces;const t={};return this.spaces.forEach((n,r)=>{t[r]=n.toJSON()}),{...e,spaces:t}}getMapProxy(e){const t=super.getMap(e);return st(t)}getArrayProxy(e){const t=super.getArray(e);return st(t)}transact(e,t){return super.transact(e,t)}}var dc=(s=>(s.NanoID="nanoID",s.UUIDv4="uuidV4",s.AutoIncrementByClientId="autoIncrementByClientId",s.AutoIncrement="autoIncrement",s))(dc||{});const fp={enable_legacy_validation:!0,enable_expand_database_block:!1,enable_bultin_ledits:!1,readonly:{}};class fc{constructor({id:e,providerCreators:t=[],awareness:n,idGenerator:r,defaultFlags:i}={id:vr()}){if(this.providers=[],this.spaces=new Map,this.id=e||"",this.doc=new uc({guid:e}),this.awarenessStore=new hc(this,n??new up(this.doc),lc.merge(!0,fp,i)),typeof r=="function")this.idGenerator=r;else switch(r){case"autoIncrement":{this.idGenerator=sc();break}case"autoIncrementByClientId":{this.idGenerator=nc(this.doc.clientID);break}case"uuidV4":{this.idGenerator=rc;break}case"nanoID":default:{this.idGenerator=vr;break}}this.providers=t.map(o=>o(this.id,this.doc,{awareness:this.awarenessStore.awareness}))}registerProvider(e,t){const n=e(t??this.id,this.doc,{awareness:this.awarenessStore.awareness});return this.providers.push(n),n}addSpace(e){this.spaces.set(e.id,e)}removeSpace(e){this.spaces.delete(e.id)}}const pp=s=>class extends s{constructor(e){super(e),this._storages=[],this._blobsRef=new Map,this._storages=(e.blobStorages??[Aa]).map(t=>t(e.id||"")),this.blob={get:async t=>{let n=!1,r=0;return new Promise(i=>{this._storages.forEach(o=>{o.crud.get(t).then(a=>{a&&!n&&(n=!0,i(a)),++r===this._storages.length&&!n&&i(null)}).catch(a=>{console.error(a),++r===this._storages.length&&!n&&i(null)})})})},set:async(t,n)=>{const r=n||await Dr(await t.arrayBuffer());return await Promise.all(this._storages.map(i=>i.crud.set(r,t))),r},delete:async t=>{await Promise.all(this._storages.map(n=>n.crud.delete(t)))},list:async()=>{const t=new Set;return await Promise.all(this._storages.map(async n=>{(await n.crud.list()).forEach(i=>t.add(i))})),Array.from(t)},gc:async()=>{(await this.blob.list()).forEach(n=>{const r=this._blobsRef.get(n);(!r||r<=0)&&(this.blob.delete(n).catch(console.error),this._blobsRef.delete(n))})},increaseRef:t=>{const n=this._blobsRef.get(t)??0;this._blobsRef.set(t,n+1)},decreaseRef:t=>{const n=this._blobsRef.get(t)??0;this._blobsRef.set(t,Math.max(n-1,0))}}}};function gp(s,e,t=(n,r)=>n===r){const n=[],r=[],i=[];for(const o of s)e.some(a=>t(a,o))?i.push(o):r.push(o);for(const o of e)s.some(a=>t(a,o))||n.push(o);return{changed:n.length||r.length,add:n,remove:r,unchanged:i}}class mp{constructor(e){this._disposables=new fo,this._linkIndexMap={},this.slots={indexUpdated:new O},this._backlinkIndexMapCache=null,this._disposables.add(e.slots.refreshIndex.on(()=>this._onRefreshIndex())),this._disposables.add(e.slots.pageRemoved.on(t=>this._onPageRemoved(t))),this._disposables.add(e.slots.blockUpdated.on(t=>this._onBlockUpdated(t))),this.slots.indexUpdated.on(()=>{this._backlinkIndexMapCache=null})}get linkIndexMap(){return this._linkIndexMap}getBacklink(e){if(this._backlinkIndexMapCache)return this._backlinkIndexMapCache[e]??[];const t={};for(const[n,r]of Object.entries(this._linkIndexMap))for(const[i,o]of Object.entries(r))o.forEach(({pageId:a,type:c})=>{a in t||(t[a]=[]),t[a].push({pageId:n,blockId:i,type:c})});return this._backlinkIndexMapCache=t,this._backlinkIndexMapCache[e]??[]}_onRefreshIndex(){this._linkIndexMap={}}_onPageRemoved(e){this._linkIndexMap[e]&&(this._linkIndexMap[e]={},this.slots.indexUpdated.emit({action:"delete",pageId:e}))}_onBlockUpdated({action:e,pageId:t,block:n,blockId:r}){switch(e){case"add":case"update":{let i=[];const o=n.get("prop:text");if(o)if(o instanceof G){const c=o.toDelta();i=[...i,...c.filter(l=>l.attributes&&l.attributes.reference).map(l=>({...l.attributes.reference,blockId:r}))]}else console.warn("Unexpected prop:text type",o);if(n.get("sys:flavour")==="affine:embed-linked-doc"){const c=n.get("prop:pageId");typeof c=="string"?i=[...i,{pageId:c,blockId:r,type:"LinkedPage"}]:console.warn("Unexpected prop:pageId type",c)}this._indexDelta({action:e,pageId:t,blockId:r,links:i});return}case"delete":{this._removeIndex(t,r);break}}}_indexDelta({action:e,pageId:t,blockId:n,links:r}){const i=this._linkIndexMap[t]?.[n]??[];gp(i,r).changed&&(this._linkIndexMap[t]={...this._linkIndexMap[t],[n]:r},this.slots.indexUpdated.emit({action:e,pageId:t,blockId:n}))}_removeIndex(e,t){if(!this._linkIndexMap[e]||!this._linkIndexMap[e][t])return;const n=this._linkIndexMap[e][t];delete this._linkIndexMap[e][t],n.length&&this.slots.indexUpdated.emit({action:"delete",pageId:e,blockId:t})}dispose(){this._disposables.dispose()}}class yp{constructor(e,{immediately:t=!1,slots:n}){if(this._disposables=new fo,this.slots={pageRemoved:new O,blockUpdated:new O,refreshIndex:new O},this._yPageObserver=(r,i,{pageId:o,yPage:a})=>{r.forEach(c=>{if(!(c instanceof Kr)){if(c instanceof Xr){if(c.target!==c.currentTarget){if(c.keysChanged.has("prop:text")){const l=c.path[0],h=a.get(l);k(h),this._indexBlock({action:"update",pageId:o,blockId:l,block:h})}return}Array.from(c.changes.keys.entries()).forEach(([l,{action:h}])=>{if(h==="delete"){this._indexBlock({action:h,pageId:o,blockId:l});return}const u=a.get(l);k(u),this._indexBlock({action:h,pageId:o,blockId:l,block:u})});return}if(c instanceof Qr){const l=c.path[0];if(!l||typeof l!="string")throw new Error("Failed to update index! Unexpected YText Event!");const h=a.get(l);k(h),this._indexBlock({action:"update",pageId:o,blockId:l,block:h});return}}})},this._doc=e,this._workspaceSlots=n,t){this._initIndex();return}setTimeout(()=>{this._initIndex()},0)}_initIndex(){const e=this._doc;if(!e.share.has("meta"))throw new Error("Failed to initialize indexer: workspace meta not found");let n={};this._disposables.add(()=>{Object.values(n).forEach(r=>r?.()),n={}}),Array.from(e.spaces.keys()).map(r=>({pageId:r,page:this._getPage(r)})).forEach(({pageId:r,page:i})=>{if(k(i,`Failed to find page '${r}'`),n[r]){console.warn(`Duplicated pageAdded event! ${r} already observed`,n);return}const o=this._indexPage(r,i);n[r]=o}),this._workspaceSlots.pageAdded.on(r=>{const i=this._getPage(r);if(k(i,`Failed to find page '${r}'`),n[r])return;const o=this._indexPage(r,i);n[r]=o}),this._workspaceSlots.pageRemoved.on(r=>{n[r]?.(),n[r]=null,this.slots.pageRemoved.emit(r)})}_indexPage(e,t){const n=t.getMap("blocks");n.forEach((i,o)=>{this._indexBlock({action:"add",pageId:e,blockId:o,block:i})});const r=(i,o)=>this._yPageObserver(i,o,{pageId:e,yPage:n});return n.observeDeep(r),()=>{n.unobserveDeep(r)}}_indexBlock(e){this.slots.blockUpdated.emit(e)}_getPage(e){return this._doc.spaces.get(e)}refreshIndex(){this.slots.refreshIndex.emit(),this._initIndex()}dispose(){this._disposables.dispose()}}const _p=globalThis.navigator?.userAgent??"",pc=globalThis.navigator?.platform,oi=typeof window<"u"&&typeof document<"u",wp=typeof process<"u"&&!oi,kp=/Apple Computer/.test(globalThis.navigator?.vendor),pg=oi&&navigator.userAgent.toLowerCase().indexOf("firefox")>-1,gg=kp&&(/Mobile\/\w+/.test(_p)||globalThis.navigator?.maxTouchPoints>2),mg=/Mac/i.test(pc),yg=/Win/.test(pc);var U;function en(s){return typeof s<"u"?s:!0}function Xi(s){const e=Array(s);for(let t=0;t<s;t++)e[t]=P();return e}function P(){return Object.create(null)}function vp(s,e){return e.length-s.length}function K(s){return typeof s=="string"}function ot(s){return typeof s=="object"}function ai(s){return typeof s=="function"}function gc(s,e){var t=bp;if(s&&(e&&(s=tn(s,e)),this.H&&(s=tn(s,this.H)),this.J&&1<s.length&&(s=tn(s,this.J)),t||t==="")){if(e=s.split(t),this.filter){s=this.filter,t=e.length;const n=[];for(let r=0,i=0;r<t;r++){const o=e[r];o&&!s[o]&&(n[i++]=o)}s=n}else s=e;return s}return s}const bp=/[\p{Z}\p{S}\p{P}\p{C}]+/u,xp=/[\u0300-\u036f]/g;function Qi(s,e){const t=Object.keys(s),n=t.length,r=[];let i="",o=0;for(let a=0,c,l;a<n;a++)c=t[a],(l=s[c])?(r[o++]=V(e?"(?!\\b)"+c+"(\\b|_)":c),r[o++]=l):i+=(i?"|":"")+c;return i&&(r[o++]=V(e?"(?!\\b)("+i+")(\\b|_)":"("+i+")"),r[o]=""),r}function tn(s,e){for(let t=0,n=e.length;t<n&&(s=s.replace(e[t],e[t+1]),s);t+=2);return s}function V(s){return new RegExp(s,"g")}function mc(s){let e="",t="";for(let n=0,r=s.length,i;n<r;n++)(i=s[n])!==t&&(e+=t=i);return e}var Sp={encode:yc,F:!1,G:""};function yc(s){return gc.call(this,(""+s).toLowerCase(),!1)}const _c={},It={};function wc(s){qt(s,"add"),qt(s,"append"),qt(s,"search"),qt(s,"update"),qt(s,"remove")}function qt(s,e){s[e+"Async"]=function(){const t=this,n=arguments;var r=n[n.length-1];let i;return ai(r)&&(i=r,delete n[n.length-1]),r=new Promise(function(o){setTimeout(function(){t.async=!0;const a=t[e].apply(t,n);t.async=!1,o(a)})}),i?(r.then(i),this):r}}function kc(s,e,t,n){const r=s.length;let i=[],o,a,c=0;n&&(n=[]);for(let l=r-1;0<=l;l--){const h=s[l],u=h.length,d=P();let f=!o;for(let p=0;p<u;p++){const g=h[p],_=g.length;if(_)for(let E=0,B,R;E<_;E++)if(R=g[E],o){if(o[R]){if(!l){if(t)t--;else if(i[c++]=R,c===e)return i}(l||n)&&(d[R]=1),f=!0}if(n&&(B=(a[R]||0)+1,a[R]=B,B<r)){const ie=n[B-2]||(n[B-2]=[]);ie[ie.length]=R}}else d[R]=1}if(n)o||(a=d);else if(!f)return[];o=d}if(n)for(let l=n.length-1,h,u;0<=l;l--){h=n[l],u=h.length;for(let d=0,f;d<u;d++)if(f=h[d],!o[f]){if(t)t--;else if(i[c++]=f,c===e)return i;o[f]=1}}return i}function Ep(s,e){const t=P(),n=P(),r=[];for(let i=0;i<s.length;i++)t[s[i]]=1;for(let i=0,o;i<e.length;i++){o=e[i];for(let a=0,c;a<o.length;a++)c=o[a],t[c]&&!n[c]&&(n[c]=1,r[r.length]=c)}return r}function Ln(s){this.l=s!==!0&&s,this.cache=P(),this.h=[]}function vc(s,e,t){ot(s)&&(s=s.query);let n=this.cache.get(s);return n||(n=this.search(s,e,t),this.cache.set(s,n)),n}Ln.prototype.set=function(s,e){if(!this.cache[s]){var t=this.h.length;for(t===this.l?delete this.cache[this.h[t-1]]:t++,--t;0<t;t--)this.h[t]=this.h[t-1];this.h[0]=s}this.cache[s]=e};Ln.prototype.get=function(s){const e=this.cache[s];if(this.l&&e&&(s=this.h.indexOf(s))){const t=this.h[s-1];this.h[s-1]=this.h[s],this.h[s]=t}return e};const Cp={memory:{charset:"latin:extra",D:3,B:4,m:!1},performance:{D:3,B:3,s:!1,context:{depth:2,D:1}},match:{charset:"latin:extra",G:"reverse"},score:{charset:"latin:advanced",D:20,B:3,context:{depth:3,D:9}},default:{}};function bc(s,e,t,n,r,i,o,a){setTimeout(function(){const c=s(t?t+"."+n:n,JSON.stringify(o));c&&c.then?c.then(function(){e.export(s,e,t,r,i+1,a)}):e.export(s,e,t,r,i+1,a)})}function xt(s,e){if(!(this instanceof xt))return new xt(s);var t;if(s){K(s)?s=Cp[s]:(t=s.preset)&&(s=Object.assign({},t[t],s)),t=s.charset;var n=s.lang;K(t)&&(t.indexOf(":")===-1&&(t+=":default"),t=It[t]),K(n)&&(n=_c[n])}else s={};let r,i,o=s.context||{};if(this.encode=s.encode||t&&t.encode||yc,this.register=e||P(),this.D=r=s.resolution||9,this.G=e=t&&t.G||s.tokenize||"strict",this.depth=e==="strict"&&o.depth,this.l=en(o.bidirectional),this.s=i=en(s.optimize),this.m=en(s.fastupdate),this.B=s.minlength||1,this.C=s.boost,this.map=i?Xi(r):P(),this.A=r=o.resolution||1,this.h=i?Xi(r):P(),this.F=t&&t.F||s.rtl,this.H=(e=s.matcher||n&&n.H)&&Qi(e,!1),this.J=(e=s.stemmer||n&&n.J)&&Qi(e,!0),t=e=s.filter||n&&n.filter){t=e,n=P();for(let a=0,c=t.length;a<c;a++)n[t[a]]=1;t=n}this.filter=t,this.cache=(e=s.cache)&&new Ln(e)}U=xt.prototype;U.append=function(s,e){return this.add(s,e,!0)};U.add=function(s,e,t,n){if(e&&(s||s===0)){if(!n&&!t&&this.register[s])return this.update(s,e);if(e=this.encode(e),n=e.length){const l=P(),h=P(),u=this.depth,d=this.D;for(let f=0;f<n;f++){let p=e[this.F?n-1-f:f];var r=p.length;if(p&&r>=this.B&&(u||!h[p])){var i=Ys(d,n,f),o="";switch(this.G){case"full":if(2<r){for(i=0;i<r;i++)for(var a=r;a>i;a--)if(a-i>=this.B){var c=Ys(d,n,f,r,i);o=p.substring(i,a),Kt(this,h,o,c,s,t)}break}case"reverse":if(1<r){for(a=r-1;0<a;a--)o=p[a]+o,o.length>=this.B&&Kt(this,h,o,Ys(d,n,f,r,a),s,t);o=""}case"forward":if(1<r){for(a=0;a<r;a++)o+=p[a],o.length>=this.B&&Kt(this,h,o,i,s,t);break}default:if(this.C&&(i=Math.min(i/this.C(e,p,f)|0,d-1)),Kt(this,h,p,i,s,t),u&&1<n&&f<n-1){for(r=P(),o=this.A,i=p,a=Math.min(u+1,n-f),r[i]=1,c=1;c<a;c++)if((p=e[this.F?n-1-f-c:f+c])&&p.length>=this.B&&!r[p]){r[p]=1;const g=this.l&&p>i;Kt(this,l,g?i:p,Ys(o+(n/2>o?0:1),n,f,a-1,c-1),s,t,g?p:i)}}}}}this.m||(this.register[s]=1)}}return this};function Ys(s,e,t,n,r){return t&&1<s?e+(n||0)<=s?t+(r||0):(s-1)/(e+(n||0))*(t+(r||0))+1|0:0}function Kt(s,e,t,n,r,i,o){let a=o?s.h:s.map;(!e[t]||o&&!e[t][o])&&(s.s&&(a=a[n]),o?(e=e[t]||(e[t]=P()),e[o]=1,a=a[o]||(a[o]=P())):e[t]=1,a=a[t]||(a[t]=[]),s.s||(a=a[n]||(a[n]=[])),i&&a.includes(r)||(a[a.length]=r,s.m&&(s=s.register[r]||(s.register[r]=[]),s[s.length]=a)))}U.search=function(s,e,t){t||(!e&&ot(s)?(t=s,s=t.query):ot(e)&&(t=e));let n=[],r,i,o=0;if(t){s=t.query||s,e=t.limit,o=t.offset||0;var a=t.context;i=t.suggest}if(s&&(s=this.encode(""+s),r=s.length,1<r)){t=P();var c=[];for(let h=0,u=0,d;h<r;h++)if((d=s[h])&&d.length>=this.B&&!t[d])if(this.s||i||this.map[d])c[u++]=d,t[d]=1;else return n;s=c,r=s.length}if(!r)return n;e||(e=100),a=this.depth&&1<r&&a!==!1,t=0;let l;a?(l=s[0],t=1):1<r&&s.sort(vp);for(let h,u;t<r;t++){if(u=s[t],a?(h=eo(this,n,i,e,o,r===2,u,l),i&&h===!1&&n.length||(l=u)):h=eo(this,n,i,e,o,r===1,u),h)return h;if(i&&t===r-1){if(c=n.length,!c){if(a){a=0,t=-1;continue}return n}if(c===1)return xc(n[0],e,o)}}return kc(n,e,o,i)};function eo(s,e,t,n,r,i,o,a){let c=[],l=a?s.h:s.map;if(s.s||(l=to(l,o,a,s.l)),l){let h=0;const u=Math.min(l.length,a?s.A:s.D);for(let d=0,f=0,p,g;d<u&&!((p=l[d])&&(s.s&&(p=to(p,o,a,s.l)),r&&p&&i&&(g=p.length,g<=r?(r-=g,p=null):(p=p.slice(r),r=0)),p&&(c[h++]=p,i&&(f+=p.length,f>=n))));d++);if(h){if(i)return xc(c,n,0);e[e.length]=c;return}}return!t&&c}function xc(s,e,t){return s=s.length===1?s[0]:[].concat.apply([],s),t||s.length>e?s.slice(t,t+e):s}function to(s,e,t,n){return t?(n=n&&e>t,s=(s=s[n?e:t])&&s[n?t:e]):s=s[e],s}U.contain=function(s){return!!this.register[s]};U.update=function(s,e){return this.remove(s).add(s,e)};U.remove=function(s,e){const t=this.register[s];if(t){if(this.m)for(let n=0,r;n<t.length;n++)r=t[n],r.splice(r.indexOf(s),1);else wn(this.map,s,this.D,this.s),this.depth&&wn(this.h,s,this.A,this.s);if(e||delete this.register[s],this.cache){e=this.cache;for(let n=0,r,i;n<e.h.length;n++)i=e.h[n],r=e.cache[i],r.includes(s)&&(e.h.splice(n--,1),delete e.cache[i])}}return this};function wn(s,e,t,n,r){let i=0;if(s.constructor===Array)if(r)e=s.indexOf(e),e!==-1?1<s.length&&(s.splice(e,1),i++):i++;else{r=Math.min(s.length,t);for(let o=0,a;o<r;o++)(a=s[o])&&(i=wn(a,e,t,n,r),n||i||delete s[o])}else for(let o in s)(i=wn(s[o],e,t,n,r))||delete s[o];return i}U.searchCache=vc;U.export=function(s,e,t,n,r,i){let o=!0;typeof i>"u"&&(o=new Promise(l=>{i=l}));let a,c;switch(r||(r=0)){case 0:if(a="reg",this.m){c=P();for(let l in this.register)c[l]=1}else c=this.register;break;case 1:a="cfg",c={doc:0,opt:this.s?1:0};break;case 2:a="map",c=this.map;break;case 3:a="ctx",c=this.h;break;default:typeof t>"u"&&i&&i();return}return bc(s,e||this,t,a,n,r,c,i),o};U.import=function(s,e){if(e)switch(K(e)&&(e=JSON.parse(e)),s){case"cfg":this.s=!!e.opt;break;case"reg":this.m=!1,this.register=e;break;case"map":this.map=e;break;case"ctx":this.h=e}};wc(xt.prototype);function Ap(s){s=s.data;var e=self._index;const t=s.args;var n=s.task;switch(n){case"init":n=s.options||{},s=s.factory,e=n.encode,n.cache=!1,e&&e.indexOf("function")===0&&(n.encode=Function("return "+e)()),s?(Function("return "+s)()(self),self._index=new self.FlexSearch.Index(n),delete self.FlexSearch):self._index=new xt(n);break;default:s=s.id,e=e[n].apply(e,t),postMessage(n==="search"?{id:s,msg:e}:{id:s})}}let so=0;function zt(s){if(!(this instanceof zt))return new zt(s);var e;s?ai(e=s.encode)&&(s.encode=e.toString()):s={},(e=(self||window)._factory)&&(e=e.toString());const t=typeof window>"u"&&self.exports,n=this;this.o=Tp(e,t,s.worker),this.h=P(),this.o&&(t?this.o.on("message",function(r){n.h[r.id](r.msg),delete n.h[r.id]}):this.o.onmessage=function(r){r=r.data,n.h[r.id](r.msg),delete n.h[r.id]},this.o.postMessage({task:"init",factory:e,options:s}))}Vs("add");Vs("append");Vs("search");Vs("update");Vs("remove");function Vs(s){zt.prototype[s]=zt.prototype[s+"Async"]=function(){const e=this,t=[].slice.call(arguments);var n=t[t.length-1];let r;return ai(n)&&(r=n,t.splice(t.length-1,1)),n=new Promise(function(i){setTimeout(function(){e.h[++so]=i,e.o.postMessage({task:s,id:so,args:t})})}),r?(n.then(r),this):n}}function Tp(s,e,t){let n;try{n=e?new(require("worker_threads")).Worker(__dirname+"/node/node.js"):s?new Worker(URL.createObjectURL(new Blob(["onmessage="+Ap.toString()],{type:"text/javascript"}))):new Worker(K(t)?t:"worker/worker.js",{type:"module"})}catch{}return n}function Is(s){if(!(this instanceof Is))return new Is(s);var e=s.document||s.doc||s,t;this.K=[],this.h=[],this.A=[],this.register=P(),this.key=(t=e.key||e.id)&&Gs(t,this.A)||"id",this.m=en(s.fastupdate),this.C=(t=e.store)&&t!==!0&&[],this.store=t&&P(),this.I=(t=e.tag)&&Gs(t,this.A),this.l=t&&P(),this.cache=(t=s.cache)&&new Ln(t),s.cache=!1,this.o=s.worker,this.async=!1,t=P();let n=e.index||e.field||e;K(n)&&(n=[n]);for(let r=0,i,o;r<n.length;r++)i=n[r],K(i)||(o=i,i=i.field),o=ot(o)?Object.assign({},s,o):s,this.o&&(t[i]=new zt(o),t[i].o||(this.o=!1)),this.o||(t[i]=new xt(o,this.register)),this.K[r]=Gs(i,this.A),this.h[r]=i;if(this.C)for(s=e.store,K(s)&&(s=[s]),e=0;e<s.length;e++)this.C[e]=Gs(s[e],this.A);this.index=t}function Gs(s,e){const t=s.split(":");let n=0;for(let r=0;r<t.length;r++)s=t[r],0<=s.indexOf("[]")&&(s=s.substring(0,s.length-2))&&(e[n]=!0),s&&(t[n++]=s);return n<t.length&&(t.length=n),1<n?t:t[0]}function xr(s,e){if(K(e))s=s[e];else for(let t=0;s&&t<e.length;t++)s=s[e[t]];return s}function Sr(s,e,t,n,r){if(s=s[r],n===t.length-1)e[r]=s;else if(s)if(s.constructor===Array)for(e=e[r]=Array(s.length),r=0;r<s.length;r++)Sr(s,e,t,n,r);else e=e[r]||(e[r]=P()),r=t[++n],Sr(s,e,t,n,r)}function Er(s,e,t,n,r,i,o,a){if(s=s[o])if(n===e.length-1){if(s.constructor===Array){if(t[n]){for(e=0;e<s.length;e++)r.add(i,s[e],!0,!0);return}s=s.join(" ")}r.add(i,s,a,!0)}else if(s.constructor===Array)for(o=0;o<s.length;o++)Er(s,e,t,n,r,i,o,a);else o=e[++n],Er(s,e,t,n,r,i,o,a)}U=Is.prototype;U.add=function(s,e,t){if(ot(s)&&(e=s,s=xr(e,this.key)),e&&(s||s===0)){if(!t&&this.register[s])return this.update(s,e);for(let n=0,r,i;n<this.h.length;n++)i=this.h[n],r=this.K[n],K(r)&&(r=[r]),Er(e,r,this.A,0,this.index[i],s,r[0],t);if(this.I){let n=xr(e,this.I),r=P();K(n)&&(n=[n]);for(let i=0,o,a;i<n.length;i++)if(o=n[i],!r[o]&&(r[o]=1,a=this.l[o]||(this.l[o]=[]),!t||!a.includes(s))&&(a[a.length]=s,this.m)){const c=this.register[s]||(this.register[s]=[]);c[c.length]=a}}if(this.store&&(!t||!this.store[s])){let n;if(this.C){n=P();for(let r=0,i;r<this.C.length;r++)i=this.C[r],K(i)?n[i]=e[i]:Sr(e,n,i,0,i[0])}this.store[s]=n||e}}return this};U.append=function(s,e){return this.add(s,e,!0)};U.update=function(s,e){return this.remove(s).add(s,e)};U.remove=function(s){if(ot(s)&&(s=xr(s,this.key)),this.register[s]){for(var e=0;e<this.h.length&&(this.index[this.h[e]].remove(s,!this.o),!this.m);e++);if(this.I&&!this.m)for(let t in this.l){e=this.l[t];const n=e.indexOf(s);n!==-1&&(1<e.length?e.splice(n,1):delete this.l[t])}this.store&&delete this.store[s],delete this.register[s]}return this};U.search=function(s,e,t,n){t||(!e&&ot(s)?(t=s,s=""):ot(e)&&(t=e,e=0));let r=[],i=[],o,a,c,l,h,u,d=0;if(t)if(t.constructor===Array)c=t,t=null;else{if(s=t.query||s,c=(o=t.pluck)||t.index||t.field,l=t.tag,a=this.store&&t.enrich,h=t.bool==="and",e=t.limit||e||100,u=t.offset||0,l&&(K(l)&&(l=[l]),!s)){for(let p=0,g;p<l.length;p++)(g=Mp.call(this,l[p],e,u,a))&&(r[r.length]=g,d++);return d?r:[]}K(c)&&(c=[c])}c||(c=this.h),h=h&&(1<c.length||l&&1<l.length);const f=!n&&(this.o||this.async)&&[];for(let p=0,g,_,E;p<c.length;p++){let B;if(_=c[p],K(_)||(B=_,_=B.field,s=B.query||s,e=B.limit||e,a=B.enrich||a),f)f[p]=this.index[_].searchAsync(s,e,B||t);else{if(n?g=n[p]:g=this.index[_].search(s,e,B||t),E=g&&g.length,l&&E){const R=[];let ie=0;h&&(R[0]=[g]);for(let pe=0,Q,lt;pe<l.length;pe++)Q=l[pe],(E=(lt=this.l[Q])&&lt.length)&&(ie++,R[R.length]=h?[lt]:lt);ie&&(g=h?kc(R,e||100,u||0):Ep(g,R),E=g.length)}if(E)i[d]=_,r[d++]=g;else if(h)return[]}}if(f){const p=this;return new Promise(function(g){Promise.all(f).then(function(_){g(p.search(s,e,t,_))})})}if(!d)return[];if(o&&(!a||!this.store))return r[0];for(let p=0,g;p<i.length;p++){if(g=r[p],g.length&&a&&(g=Sc.call(this,g)),o)return g;r[p]={field:i[p],result:g}}return r};function Mp(s,e,t,n){let r=this.l[s],i=r&&r.length-t;if(i&&0<i)return(i>e||t)&&(r=r.slice(t,t+e)),n&&(r=Sc.call(this,r)),{tag:s,result:r}}function Sc(s){const e=Array(s.length);for(let t=0,n;t<s.length;t++)n=s[t],e[t]={id:n,doc:this.store[n]};return e}U.contain=function(s){return!!this.register[s]};U.get=function(s){return this.store[s]};U.set=function(s,e){return this.store[s]=e,this};U.searchCache=vc;U.export=function(s,e,t,n,r,i){let o;if(typeof i>"u"&&(o=new Promise(a=>{i=a})),r||(r=0),n||(n=0),n<this.h.length){const a=this.h[n],c=this.index[a];e=this,setTimeout(function(){c.export(s,e,r?a:"",n,r++,i)||(n++,r=1,e.export(s,e,a,n,r,i))})}else{let a,c;switch(r){case 1:a="tag",c=this.l,t=null;break;case 2:a="store",c=this.store,t=null;break;default:i();return}bc(s,this,t,a,n,r,c,i)}return o};U.import=function(s,e){if(e)switch(K(e)&&(e=JSON.parse(e)),s){case"tag":this.l=e;break;case"reg":this.m=!1,this.register=e;for(let n=0,r;n<this.h.length;n++)r=this.index[this.h[n]],r.register=e,r.m=!1;break;case"store":this.store=e;break;default:s=s.split(".");const t=s[0];s=s[1],t&&s&&this.index[t].import(s,e)}};wc(Is.prototype);var Dp={encode:Ec,F:!1,G:""};const Ip=[V("[]"),"a",V("[]"),"e",V("[]"),"i",V("[]"),"o",V("[]"),"u",V("[]"),"y",V(""),"n",V("[c]"),"k",V(""),"s",V(" & ")," and "];function Ec(s){var e=s=""+s;return e.normalize&&(e=e.normalize("NFD").replace(xp,"")),gc.call(this,e.toLowerCase(),!s.normalize&&Ip)}var Op={encode:Cc,F:!1,G:"strict"};const $p=/[^a-z0-9]+/,no={b:"p",v:"f",w:"f",z:"s",x:"s",:"s",d:"t",n:"m",c:"k",g:"k",j:"k",q:"k",i:"e",y:"e",u:"o"};function Cc(s){s=Ec.call(this,s).join(" ");const e=[];if(s){const t=s.split($p),n=t.length;for(let r=0,i,o=0;r<n;r++)if((s=t[r])&&(!this.filter||!this.filter[s])){i=s[0];let a=no[i]||i,c=a;for(let l=1;l<s.length;l++){i=s[l];const h=no[i]||i;h&&h!==c&&(a+=h,c=h)}e[o++]=a}}return e}var Np={encode:Ac,F:!1,G:""};const Rp=[V("ae"),"a",V("oe"),"o",V("sh"),"s",V("th"),"t",V("ph"),"f",V("pf"),"f",V("(?![aeo])h(?![aeo])"),"",V("(?!^[aeo])h(?!^[aeo])"),""];function Ac(s,e){return s&&(s=Cc.call(this,s).join(" "),2<s.length&&(s=tn(s,Rp)),e||(1<s.length&&(s=mc(s)),s&&(s=s.split(" ")))),s||[]}var Pp={encode:Lp,F:!1,G:""};const Bp=V("(?!\\b)[aeo]");function Lp(s){return s&&(s=Ac.call(this,s,!0),1<s.length&&(s=s.replace(Bp,"")),1<s.length&&(s=mc(s)),s&&(s=s.split(" "))),s||[]}It["latin:default"]=Sp;It["latin:simple"]=Dp;It["latin:balance"]=Op;It["latin:advanced"]=Np;It["latin:extra"]=Pp;const Tc={Index:xt,Document:Is,Worker:zt,registerCharset:function(s,e){It[s]=e},registerLanguage:function(s,e){_c[s]=e}},jp=Tc.Document,Up=Tc.Index;function Vp(s){const e=Intl.Segmenter;if(e){const t=new Up({charset:"latin:advanced"}),n=t.encode.bind(t),r=/^[\p{Script=Latin}\p{Mark}\d]+$/u,i=new e([s],{granularity:"word"});return o=>{const a=[];return[...Array.from(i.segment(o)).filter(l=>{if(l.isWordLike){if(!r.test(l.segment))return!0;a.push(l.segment)}return!1}).map(l=>l.segment),...n(a.join(" "))]}}return t=>t.replace(/[\x00-\x7F]/g,"").split("")}const Zp=200;class Fp{constructor(e,t="en-US"){this._reindexMap=null,this._reindex=()=>{if(this._reindexMap){for(const n of this._reindexMap.keys()){const r=this._reindexMap.get(n);r&&(this._reindexMap.delete(n),this._indexer.add(n,r))}setTimeout(()=>{this._reindexMap&&requestIdleCallback(this._reindex,{timeout:1e3})},Zp)}},this._doc=e,this._indexer=new jp({document:{id:"id",index:["content","reference","space"],tag:"tags",store:["space","content"]},encode:Vp(t),tokenize:"forward",context:!0}),this._reindexMap=new Map,this._reindex(),e.spaces.observe(n=>{n.keysChanged.forEach(r=>{const i=this._getPage(r);i!=null&&this._handlePageIndexing(r,i)})}),oi&&window.addEventListener("beforeunload",()=>{this._reindexMap=null}),wp&&process.on("exit",()=>{this._reindexMap=null})}search(e){return new Map(this._search(e).flatMap(({result:t})=>t.map(n=>[n.id,{space:n.doc.space,content:n.doc.content}])))}_search(e){return typeof e=="object"?this._indexer.search({...e,enrich:!0}):this._indexer.search(e,{enrich:!0})}refreshPageIndex(e,t){const n=t.getMap("blocks");n.forEach((r,i)=>{this._refreshIndex(e,i,"add",n.get(i))})}_handlePageIndexing(e,t){if(!t)return;const n=t.getMap("blocks");this.refreshPageIndex(e,t),n.observeDeep(r=>{const i=r.flatMap(o=>(o.path?.length|0)>0?[[o.path[0],"update"]]:Array.from(o.changes.keys.entries()).map(([a,{action:c}])=>[a,c]));i.length&&i.forEach(([o,a])=>{this._refreshIndex(e,o,a,n.get(o))})})}_refreshIndex(e,t,n,r){switch(n){case"add":case"update":{if(r){const i=this._toContent(r.get("prop:title")||r.get("prop:text"));i&&this._reindexMap?.set(t,{content:i,space:e,tags:[e]})}break}case"delete":{this._reindexMap?.delete(t),this._indexer.remove(t);break}}}_toContent(e){if(e){if(typeof e=="string")return e;if(e instanceof G)return e.toJSON()}}_getPage(e){try{return this._doc.spaces.get(e)}catch{return}}}const zp=s=>class extends s{search(e){return this.indexer.search.search(e)}constructor(e){super(e);const t=new yp(this.doc,{slots:this.slots});this.indexer={search:new Fp(this.doc),backlink:new mp(t)}}},Cr=Symbol.for("react.test.json");function Wp(s){return!(typeof s!="object"||s===null)}const Hp=["sys:id","sys:version","sys:flavour","sys:children","prop:xywh","prop:cells","prop:elements"];function Mc(s,e){if(!Wp(s))throw new Error("Failed to parse doc record! Invalid data.");const t=s[e];if(!t)throw new Error(`Failed to parse doc record! Node not found! id: ${e}.`);const n=t["sys:flavour"],r=t["sys:children"],i=Object.fromEntries(Object.entries(t).filter(([o])=>!Hp.includes(o)));return"prop:text"in i&&i["prop:text"]instanceof Array&&(i["prop:text"]=ro(i["prop:text"])),"prop:title"in i&&i["prop:title"]instanceof Array&&(i["prop:title"]=ro(i["prop:title"])),"prop:columns"in i&&i["prop:columns"]instanceof Array&&(i["prop:columns"]=`Array [${i["prop:columns"].length}]`),"prop:views"in i&&i["prop:views"]instanceof Array&&(i["prop:views"]=`Array [${i["prop:views"].length}]`),{$$typeof:Cr,type:n,props:i,children:r?.map(o=>Mc(s,o))??[]}}function Dc(s){const e={};return s.share.forEach((t,n)=>{t instanceof W?e[n]=Oc(t):e[n]=t.toJSON()}),e}function Ic(s){return s instanceof Ne?Dc(s):s instanceof W?Oc(s):s instanceof G?Yp(s):s instanceof z?s.toArray().map(e=>Ic(e)):s instanceof F?s.toJSON():s}function Oc(s){const e={};return s.forEach((t,n)=>{e[n]=Ic(t)}),e}function Yp(s){return s.toDelta()}function ro(s){if(s.length)return s.length===1&&!s[0].attributes?s[0].insert:{$$typeof:Cr,type:"",props:{},children:s?.map(({insert:e,attributes:t})=>({$$typeof:Cr,type:"text",props:{insert:e,...t}}))}}const Gp=s=>class extends s{exportJSX(e,t=this.meta.pageMetas.at(0)?.id){k(t);const n=this.doc.spaces.get(t);k(n);const r=Dc(n);if(!r)throw new Error(`Page ${t} doesn't exist`);const i=r.blocks;if(!e){const o=Object.keys(i).at(0);if(!o)return null;e=o}return i[e]?Mc(i,e):null}};class Jp{}class qp{constructor(e){this.id="meta",this._prevPages=new Set,this.pageMetaAdded=new O,this.pageMetaRemoved=new O,this.pageMetasUpdated=new O,this.commonFieldsUpdated=new O,this._handleWorkspaceMetaEvents=t=>{t.forEach(n=>{const r=i=>n.target===this._yMap&&n.changes.keys.has(i);(n.target===this.yPages||n.target.parent===this.yPages||r("pages"))&&this._handlePageMetaEvent(),(r("name")||r("avatar"))&&this._handleCommonFieldsEvent()})},this.doc=e,this._yMap=e.getMap(this.id),this._proxy=e.getMapProxy(this.id),this._yMap.observeDeep(this._handleWorkspaceMetaEvents)}get yPages(){return this._yMap.get("pages")}get pages(){return this._proxy.pages}get name(){return this._proxy.name}get avatar(){return this._proxy.avatar}get blockVersions(){return this._proxy.blockVersions}get workspaceVersion(){return this._proxy.workspaceVersion}get pageVersion(){return this._proxy.pageVersion}setName(e){this.doc.transact(()=>{this._proxy.name=e},this.doc.clientID)}setAvatar(e){this.doc.transact(()=>{this._proxy.avatar=e},this.doc.clientID)}get pageMetas(){return this._proxy.pages?[...this._proxy.pages]:[]}getPageMeta(e){return this.pageMetas.find(t=>t.id===e)}addPageMeta(e,t){this.doc.transact(()=>{this.pages||(this._proxy.pages=[]);const n=this.pages;t===void 0?n.push(e):n.splice(t,0,e)},this.doc.clientID)}setPageMeta(e,t){const r=(this.pages??[]).findIndex(i=>e===i.id);this.doc.transact(()=>{if(this.pages||(this._proxy.pages=[]),r===-1)return;k(this.pages);const i=this.pages[r];Object.entries(t).forEach(([o,a])=>{i[o]=a})},this.doc.clientID)}removePageMeta(e){k(this.pages);const n=this.pageMetas.findIndex(r=>e===r.id);n!==-1&&this.doc.transact(()=>{k(this.pages),this.pages.splice(n,1)},this.doc.clientID)}get hasVersion(){return!this.blockVersions||!this.pageVersion||!this.workspaceVersion?!1:Object.keys(this.blockVersions).length>0}writeVersion(e){const{blockVersions:t,pageVersion:n,workspaceVersion:r}=this._proxy;if(r?console.error("Workspace version is already set"):this._proxy.workspaceVersion=Yn,n?console.error("Page version is already set"):this._proxy.pageVersion=Gn,t)console.error("Block versions is already set");else{const i={};e.schema.flavourSchemaMap.forEach((o,a)=>{i[a]=o.version}),this._proxy.blockVersions=i}}updateVersion(e){this._proxy.workspaceVersion=Yn,this._proxy.pageVersion=Gn;const t={};e.schema.flavourSchemaMap.forEach((n,r)=>{t[r]=n.version}),this._proxy.blockVersions=t}validateVersion(e){const t=this._proxy.workspaceVersion;if(!t)throw new Error("Invalid workspace data, workspace version is missing. Please make sure the data is valid.");if(t<Yn)throw new Error(`Workspace version ${t} is outdated. Please upgrade the editor.`);const n=this._proxy.pageVersion;if(!n)throw new Error("Invalid workspace data, page version is missing. Please make sure the data is valid.");if(n<Gn)throw new Error(`Page version ${n} is outdated. Please upgrade the editor.`);const r={...this._proxy.blockVersions};if(!r)throw new Error("Invalid workspace data, versions data is missing. Please make sure the data is valid");const i=Object.keys(r);if(i.length===0)throw new Error("Invalid workspace data, missing versions field. Please make sure the data is valid.");i.forEach(o=>{const a=r[o],c=e.schema.flavourSchemaMap.get(o)?.version;if(c){if(a>c)throw new Error(`Editor doesn't support ${o}@${a}. Please upgrade the editor.`);if(a<c)throw new Error(`In workspace data, the block flavour ${o}@${a} is outdated. Please downgrade the editor or try data migration.`)}else throw new Error(`Editor missing ${o} flavour. Please make sure this block flavour is registered.`)})}_handlePageMetaEvent(){const{pageMetas:e,_prevPages:t}=this;e.forEach(n=>{t.has(n.id)||this.pageMetaAdded.emit(n.id)}),t.forEach(n=>{!e.find(i=>i.id===n)&&this.pageMetaRemoved.emit(n)}),t.clear(),e.forEach(n=>t.add(n.id)),this.pageMetasUpdated.emit()}_handleCommonFieldsEvent(){this.commonFieldsUpdated.emit()}get properties(){const e=this._proxy.properties;return e||{tags:{options:[]}}}setProperties(e){this._proxy.properties=e,this.pageMetasUpdated.emit()}}var Kp=Object.defineProperty,Xp=Object.getOwnPropertyDescriptor,Qp=(s,e,t,n)=>{for(var r=n>1?void 0:n?Xp(e,t):e,i=s.length-1,o;i>=0;i--)(o=s[i])&&(r=(n?o(e,t,r):o(r))||r);return n&&r&&Kp(e,t,r),r};let kn=class extends Jp{constructor(s){super(),this.slots={pagesUpdated:new O,pageAdded:new O,pageRemoved:new O},this._schema=s.schema,this._store=new fc(s),this.meta=new qp(this.doc),this._bindPageMetaEvents()}get id(){return this._store.id}get isEmpty(){if(this.doc.store.clients.size===0)return!0;let s=!1;return this.doc.store.clients.size===1&&Array.from(this.doc.store.clients.values())[0].length<=2&&(s=!0),s}get awarenessStore(){return this._store.awarenessStore}get providers(){return this._store.providers}get pages(){return this._store.spaces}get doc(){return this._store.doc}get idGenerator(){return this._store.idGenerator}get schema(){return this._schema}registerProvider(s,e){return this._store.registerProvider(s,e)}_hasPage(s){return this.pages.has(s)}getPage(s){return this.pages.get(s)??null}_bindPageMetaEvents(){this.meta.pageMetaAdded.on(s=>{const e=new cc({id:s,workspace:this,doc:this.doc,awarenessStore:this.awarenessStore,idGenerator:this._store.idGenerator});this._store.addSpace(e),this.slots.pageAdded.emit(e.id)}),this.meta.pageMetasUpdated.on(()=>this.slots.pagesUpdated.emit()),this.meta.pageMetaRemoved.on(s=>{const e=this.getPage(s);this._store.removeSpace(e),e.remove(),this.slots.pageRemoved.emit(s)})}createPage(s={}){typeof s=="string"&&(s={id:s},console.warn("`createPage(pageId)` is deprecated, use `createPage()` directly or `createPage({ id: pageId })` instead"),console.warn("More details see https://github.com/toeverything/blocksuite/pull/2272"));const{id:e=this.idGenerator()}=s;if(this._hasPage(e))throw new Error("page already exists");return this.meta.addPageMeta({id:e,title:"",createDate:+new Date,tags:[]}),this.getPage(e)}setPageMeta(s,e){this.meta.setPageMeta(s,e)}removePage(s){const e=this.meta.getPageMeta(s);k(e);const t=this.getPage(s);t&&(t.dispose(),this.meta.removePageMeta(s),this._store.removeSpace(t))}};kn.Y=Ju;kn=Qp([pp,zp,Gp],kn);const $c=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Nc="__ $BLOCKSUITE_STORE$ __";$c[Nc]===!0&&console.error("@blocksuite/store was already imported. This breaks constructor checks and will lead to issues!");$c[Nc]=!0;const _g=Object.freeze(Object.defineProperty({__proto__:null,ASTWalker:sh,AssetsManager:ec,AwarenessStore:hc,BaseAdapter:th,BaseBlockTransformer:tc,BaseReactiveYData:si,BlockModel:ja,BlockSchema:ni,BlockSnapshotSchema:Ft,BlockSuiteDoc:uc,Boxed:Ae,Generator:dc,Job:op,MemoryBlobManager:Xl,Page:cc,PageSnapshotSchema:kr,ReactiveYArray:Ma,ReactiveYMap:Da,Schema:rp,Slice:Bn,SliceSnapshotSchema:_r,Slot:O,Space:ac,Store:fc,Text:xe,Utils:lp,get Workspace(){return kn},WorkspaceInfoSnapshotSchema:wr,createAutoIncrementIdGenerator:sc,createAutoIncrementIdGeneratorByClientId:nc,createIndexeddbStorage:qu,createMemoryStorage:Aa,createSimpleServerStorage:Ku,createYProxy:st,defineBlockSchema:rf,fromJSON:_n,getAssetName:Ql,internalPrimitives:Yt,isPureObject:ti,nanoid:vr,native2Y:Fe,pageMigrations:Ea,popProp:ed,sha:Dr,stashProp:Qu,toJSON:yn,uuidv4:rc,workspaceMigrations:Ca,y2Native:_s},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ci=globalThis,vn=ci.trustedTypes,io=vn?vn.createPolicy("lit-html",{createHTML:s=>s}):void 0,li="$lit$",Be=`lit$${(Math.random()+"").slice(9)}$`,hi="?"+Be,eg=`<${hi}>`,St=document,Os=()=>St.createComment(""),$s=s=>s===null||typeof s!="object"&&typeof s!="function",Rc=Array.isArray,Pc=s=>Rc(s)||typeof s?.[Symbol.iterator]=="function",tr=`[ 	
\f\r]`,Xt=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,oo=/-->/g,ao=/>/g,ut=RegExp(`>|${tr}(?:([^\\s"'>=/]+)(${tr}*=${tr}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),co=/'/g,lo=/"/g,Bc=/^(?:script|style|textarea|title)$/i,Lc=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),tg=Lc(1),wg=Lc(2),Ns=Symbol.for("lit-noChange"),Y=Symbol.for("lit-nothing"),ho=new WeakMap,ft=St.createTreeWalker(St,129);function jc(s,e){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return io!==void 0?io.createHTML(e):e}const Uc=(s,e)=>{const t=s.length-1,n=[];let r,i=e===2?"<svg>":"",o=Xt;for(let a=0;a<t;a++){const c=s[a];let l,h,u=-1,d=0;for(;d<c.length&&(o.lastIndex=d,h=o.exec(c),h!==null);)d=o.lastIndex,o===Xt?h[1]==="!--"?o=oo:h[1]!==void 0?o=ao:h[2]!==void 0?(Bc.test(h[2])&&(r=RegExp("</"+h[2],"g")),o=ut):h[3]!==void 0&&(o=ut):o===ut?h[0]===">"?(o=r??Xt,u=-1):h[1]===void 0?u=-2:(u=o.lastIndex-h[2].length,l=h[1],o=h[3]===void 0?ut:h[3]==='"'?lo:co):o===lo||o===co?o=ut:o===oo||o===ao?o=Xt:(o=ut,r=void 0);const f=o===ut&&s[a+1].startsWith("/>")?" ":"";i+=o===Xt?c+eg:u>=0?(n.push(l),c.slice(0,u)+li+c.slice(u)+Be+f):c+Be+(u===-2?a:f)}return[jc(s,i+(s[t]||"<?>")+(e===2?"</svg>":"")),n]};class Rs{constructor({strings:e,_$litType$:t},n){let r;this.parts=[];let i=0,o=0;const a=e.length-1,c=this.parts,[l,h]=Uc(e,t);if(this.el=Rs.createElement(l,n),ft.currentNode=this.el.content,t===2){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(r=ft.nextNode())!==null&&c.length<a;){if(r.nodeType===1){if(r.hasAttributes())for(const u of r.getAttributeNames())if(u.endsWith(li)){const d=h[o++],f=r.getAttribute(u).split(Be),p=/([.?@])?(.*)/.exec(d);c.push({type:1,index:i,name:p[2],strings:f,ctor:p[1]==="."?Zc:p[1]==="?"?Fc:p[1]==="@"?zc:Zs}),r.removeAttribute(u)}else u.startsWith(Be)&&(c.push({type:6,index:i}),r.removeAttribute(u));if(Bc.test(r.tagName)){const u=r.textContent.split(Be),d=u.length-1;if(d>0){r.textContent=vn?vn.emptyScript:"";for(let f=0;f<d;f++)r.append(u[f],Os()),ft.nextNode(),c.push({type:2,index:++i});r.append(u[d],Os())}}}else if(r.nodeType===8)if(r.data===hi)c.push({type:2,index:i});else{let u=-1;for(;(u=r.data.indexOf(Be,u+1))!==-1;)c.push({type:7,index:i}),u+=Be.length-1}i++}}static createElement(e,t){const n=St.createElement("template");return n.innerHTML=e,n}}function Et(s,e,t=s,n){if(e===Ns)return e;let r=n!==void 0?t._$Co?.[n]:t._$Cl;const i=$s(e)?void 0:e._$litDirective$;return r?.constructor!==i&&(r?._$AO?.(!1),i===void 0?r=void 0:(r=new i(s),r._$AT(s,t,n)),n!==void 0?(t._$Co??=[])[n]=r:t._$Cl=r),r!==void 0&&(e=Et(s,r._$AS(s,e.values),r,n)),e}class Vc{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:n}=this._$AD,r=(e?.creationScope??St).importNode(t,!0);ft.currentNode=r;let i=ft.nextNode(),o=0,a=0,c=n[0];for(;c!==void 0;){if(o===c.index){let l;c.type===2?l=new Gt(i,i.nextSibling,this,e):c.type===1?l=new c.ctor(i,c.name,c.strings,this,e):c.type===6&&(l=new Wc(i,this,e)),this._$AV.push(l),c=n[++a]}o!==c?.index&&(i=ft.nextNode(),o++)}return ft.currentNode=St,r}p(e){let t=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}}class Gt{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,n,r){this.type=2,this._$AH=Y,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=r,this._$Cv=r?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&e?.nodeType===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Et(this,e,t),$s(e)?e===Y||e==null||e===""?(this._$AH!==Y&&this._$AR(),this._$AH=Y):e!==this._$AH&&e!==Ns&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):Pc(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==Y&&$s(this._$AH)?this._$AA.nextSibling.data=e:this.$(St.createTextNode(e)),this._$AH=e}g(e){const{values:t,_$litType$:n}=e,r=typeof n=="number"?this._$AC(e):(n.el===void 0&&(n.el=Rs.createElement(jc(n.h,n.h[0]),this.options)),n);if(this._$AH?._$AD===r)this._$AH.p(t);else{const i=new Vc(r,this),o=i.u(this.options);i.p(t),this.$(o),this._$AH=i}}_$AC(e){let t=ho.get(e.strings);return t===void 0&&ho.set(e.strings,t=new Rs(e)),t}T(e){Rc(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,r=0;for(const i of e)r===t.length?t.push(n=new Gt(this.k(Os()),this.k(Os()),this,this.options)):n=t[r],n._$AI(i),r++;r<t.length&&(this._$AR(n&&n._$AB.nextSibling,r),t.length=r)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e&&e!==this._$AB;){const n=e.nextSibling;e.remove(),e=n}}setConnected(e){this._$AM===void 0&&(this._$Cv=e,this._$AP?.(e))}}class Zs{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,n,r,i){this.type=1,this._$AH=Y,this._$AN=void 0,this.element=e,this.name=t,this._$AM=r,this.options=i,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=Y}_$AI(e,t=this,n,r){const i=this.strings;let o=!1;if(i===void 0)e=Et(this,e,t,0),o=!$s(e)||e!==this._$AH&&e!==Ns,o&&(this._$AH=e);else{const a=e;let c,l;for(e=i[0],c=0;c<i.length-1;c++)l=Et(this,a[n+c],t,c),l===Ns&&(l=this._$AH[c]),o||=!$s(l)||l!==this._$AH[c],l===Y?e=Y:e!==Y&&(e+=(l??"")+i[c+1]),this._$AH[c]=l}o&&!r&&this.O(e)}O(e){e===Y?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class Zc extends Zs{constructor(){super(...arguments),this.type=3}O(e){this.element[this.name]=e===Y?void 0:e}}class Fc extends Zs{constructor(){super(...arguments),this.type=4}O(e){this.element.toggleAttribute(this.name,!!e&&e!==Y)}}class zc extends Zs{constructor(e,t,n,r,i){super(e,t,n,r,i),this.type=5}_$AI(e,t=this){if((e=Et(this,e,t,0)??Y)===Ns)return;const n=this._$AH,r=e===Y&&n!==Y||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,i=e!==Y&&(n===Y||r);r&&this.element.removeEventListener(this.name,this,n),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class Wc{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){Et(this,e)}}const kg={j:li,P:Be,A:hi,C:1,M:Uc,L:Vc,R:Pc,V:Et,D:Gt,I:Zs,H:Fc,N:zc,U:Zc,B:Wc},sg=ci.litHtmlPolyfillSupport;sg?.(Rs,Gt),(ci.litHtmlVersions??=[]).push("3.1.1");const vg=(s,e,t)=>{const n=t?.renderBefore??e;let r=n._$litPart$;if(r===void 0){const i=t?.renderBefore??null;n._$litPart$=r=new Gt(e.insertBefore(Os(),i),i,void 0,t??{})}return r._$AI(s),r};/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ui=Symbol.for(""),ng=s=>{if(s?.r===ui)return s?._$litStatic$},bg=s=>({_$litStatic$:s,r:ui}),xg=(s,...e)=>({_$litStatic$:e.reduce((t,n,r)=>t+(i=>{if(i._$litStatic$!==void 0)return i._$litStatic$;throw Error(`Value passed to 'literal' function must be a 'literal' result: ${i}. Use 'unsafeStatic' to pass non-literal values, but
            take care to ensure page security.`)})(n)+s[r+1],s[0]),r:ui}),uo=new Map,rg=s=>(e,...t)=>{const n=t.length;let r,i;const o=[],a=[];let c,l=0,h=!1;for(;l<n;){for(c=e[l];l<n&&(i=t[l],(r=ng(i))!==void 0);)c+=r+e[++l],h=!0;l!==n&&a.push(i),o.push(c),l++}if(l===n&&o.push(e[n]),h){const u=o.join("$$lit$$");(e=uo.get(u))===void 0&&(o.raw=o,uo.set(u,e=o)),t=a}return s(e,...t)},Sg=rg(tg);export{ja as $,au as A,Ae as B,ru as C,fo as D,Ne as E,mg as F,dc as G,pg as H,gg as I,op as J,Bn as K,cg as L,af as M,th as N,sh as O,Ft as P,Ql as Q,Dr as R,rp as S,Y as T,_n as U,yg as V,kn as W,tc as X,ap as Y,rf as Z,Jc as _,fg as a,wg as a0,Sg as a1,xg as a2,bg as a3,vg as a4,kr as a5,lg as a6,zr as a7,Ns as a8,kg as a9,Ph as aa,Vh as ab,Lh as ac,cp as b,k as c,qu as d,dg as e,xe as f,O as g,qc as h,ag as i,og as j,ig as k,Kc as l,sr as m,pi as n,_g as o,Aa as p,Ku as q,dp as r,lc as s,vr as t,Fe as u,Sh as v,Ch as w,tg as x,Mh as y,b as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=static-yoecXErL.js.map
