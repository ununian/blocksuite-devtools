{"version":3,"file":"ref-ehjBZcli.js","sources":["../../../../node_modules/.pnpm/lz-string@1.5.0/node_modules/lz-string/libs/lz-string.js","../../../block-std/src/clipboard/index.ts","../../../block-std/src/command/index.ts","../../../block-std/src/event/base.ts","../../../block-std/src/utils/path-finder.ts","../../../block-std/src/event/state/clipboard.ts","../../../block-std/src/event/state/source.ts","../../../block-std/src/event/control/clipboard.ts","../../../../node_modules/.pnpm/w3c-keyname@2.2.8/node_modules/w3c-keyname/index.js","../../../block-std/src/event/keymap.ts","../../../block-std/src/event/state/keyboard.ts","../../../block-std/src/event/state/pointer.ts","../../../block-std/src/event/control/keyboard.ts","../../../block-std/src/event/utils.ts","../../../block-std/src/event/control/pointer.ts","../../../block-std/src/event/control/range.ts","../../../block-std/src/event/dispatcher.ts","../../../block-std/src/selection/base.ts","../../../block-std/src/selection/variants/block.ts","../../../block-std/src/selection/variants/cursor.ts","../../../block-std/src/selection/variants/surface.ts","../../../block-std/src/selection/variants/text.ts","../../../block-std/src/selection/manager.ts","../../../block-std/src/spec/spec-store.ts","../../../block-std/src/view/view-store.ts","../../../block-std/src/scope/block-std-scope.ts","../../../../node_modules/.pnpm/@lit+reactive-element@2.0.3/node_modules/@lit/reactive-element/css-tag.js","../../../../node_modules/.pnpm/@lit+reactive-element@2.0.3/node_modules/@lit/reactive-element/reactive-element.js","../../../../node_modules/.pnpm/lit-element@4.0.3/node_modules/lit-element/lit-element.js","../../../../node_modules/.pnpm/@lit+reactive-element@2.0.3/node_modules/@lit/reactive-element/decorators/custom-element.js","../../../../node_modules/.pnpm/@lit+reactive-element@2.0.3/node_modules/@lit/reactive-element/decorators/property.js","../../../../node_modules/.pnpm/@lit+reactive-element@2.0.3/node_modules/@lit/reactive-element/decorators/state.js","../../../../node_modules/.pnpm/@lit+reactive-element@2.0.3/node_modules/@lit/reactive-element/decorators/base.js","../../../../node_modules/.pnpm/@lit+reactive-element@2.0.3/node_modules/@lit/reactive-element/decorators/query.js","../../../../node_modules/.pnpm/@lit+reactive-element@2.0.3/node_modules/@lit/reactive-element/decorators/query-async.js","../../../../node_modules/.pnpm/lit-html@3.1.1/node_modules/lit-html/directive.js","../../../../node_modules/.pnpm/lit-html@3.1.1/node_modules/lit-html/directives/style-map.js","../../../inline/src/consts.ts","../../../inline/src/utils/query.ts","../../../inline/src/components/v-element.ts","../../../inline/src/components/embed-gap.ts","../../../inline/src/components/v-line.ts","../../../inline/src/components/v-text.ts","../../../inline/src/services/hook.ts","../../../inline/src/utils/attribute-renderer.ts","../../../inline/src/utils/base-attributes.ts","../../../inline/src/utils/delta-convert.ts","../../../inline/src/utils/embed.ts","../../../inline/src/utils/guard.ts","../../../inline/src/utils/keyboard.ts","../../../inline/src/utils/text.ts","../../../inline/src/utils/point-conversion.ts","../../../inline/src/utils/range-conversion.ts","../../../inline/src/utils/renderer.ts","../../../inline/src/utils/transform-input.ts","../../../inline/src/services/attribute.ts","../../../../node_modules/.pnpm/lit-html@3.1.1/node_modules/lit-html/directive-helpers.js","../../../../node_modules/.pnpm/lit-html@3.1.1/node_modules/lit-html/directives/repeat.js","../../../inline/src/services/delta.ts","../../../inline/src/utils/inline-range.ts","../../../inline/src/services/event.ts","../../../inline/src/services/range.ts","../../../inline/src/services/text.ts","../../../inline/src/inline-editor.ts","../../../../node_modules/.pnpm/lit-html@3.1.1/node_modules/lit-html/directives/when.js","../../../lit/src/with-disposable.ts","../../../lit/src/element/shadowless-element.ts","../../../lit/src/element/block-element.ts","../../../lit/src/utils/range-binding.ts","../../../lit/src/utils/range-manager.ts","../../../lit/src/element/lit-host.ts","../../../lit/src/element/widget-element.ts","../../../../node_modules/.pnpm/@floating-ui+utils@0.2.1/node_modules/@floating-ui/utils/dist/floating-ui.utils.mjs","../../../../node_modules/.pnpm/@floating-ui+core@1.5.3/node_modules/@floating-ui/core/dist/floating-ui.core.mjs","../../../../node_modules/.pnpm/@floating-ui+utils@0.2.1/node_modules/@floating-ui/utils/dist/floating-ui.utils.dom.mjs","../../../../node_modules/.pnpm/@floating-ui+dom@1.5.4/node_modules/@floating-ui/dom/dist/floating-ui.dom.mjs","../../../../node_modules/.pnpm/lit-html@3.1.1/node_modules/lit-html/directives/class-map.js","../../../../node_modules/.pnpm/lit-html@3.1.1/node_modules/lit-html/directives/if-defined.js","../../../../node_modules/.pnpm/lit-html@3.1.1/node_modules/lit-html/async-directive.js","../../../../node_modules/.pnpm/lit-html@3.1.1/node_modules/lit-html/directives/ref.js"],"sourcesContent":["// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\n// This work is free. You can redistribute it and/or modify it\n// under the terms of the WTFPL, Version 2\n// For more information see LICENSE.txt or http://www.wtfpl.net/\n//\n// For more information, the home page:\n// http://pieroxy.net/blog/pages/lz-string/testing.html\n//\n// LZ-based compression algorithm, version 1.4.5\nvar LZString = (function() {\n\n// private property\nvar f = String.fromCharCode;\nvar keyStrBase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\nvar keyStrUriSafe = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\";\nvar baseReverseDic = {};\n\nfunction getBaseValue(alphabet, character) {\n  if (!baseReverseDic[alphabet]) {\n    baseReverseDic[alphabet] = {};\n    for (var i=0 ; i<alphabet.length ; i++) {\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\n    }\n  }\n  return baseReverseDic[alphabet][character];\n}\n\nvar LZString = {\n  compressToBase64 : function (input) {\n    if (input == null) return \"\";\n    var res = LZString._compress(input, 6, function(a){return keyStrBase64.charAt(a);});\n    switch (res.length % 4) { // To produce valid Base64\n    default: // When could this happen ?\n    case 0 : return res;\n    case 1 : return res+\"===\";\n    case 2 : return res+\"==\";\n    case 3 : return res+\"=\";\n    }\n  },\n\n  decompressFromBase64 : function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrBase64, input.charAt(index)); });\n  },\n\n  compressToUTF16 : function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 15, function(a){return f(a+32);}) + \" \";\n  },\n\n  decompressFromUTF16: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 16384, function(index) { return compressed.charCodeAt(index) - 32; });\n  },\n\n  //compress into uint8array (UCS-2 big endian format)\n  compressToUint8Array: function (uncompressed) {\n    var compressed = LZString.compress(uncompressed);\n    var buf=new Uint8Array(compressed.length*2); // 2 bytes per character\n\n    for (var i=0, TotalLen=compressed.length; i<TotalLen; i++) {\n      var current_value = compressed.charCodeAt(i);\n      buf[i*2] = current_value >>> 8;\n      buf[i*2+1] = current_value % 256;\n    }\n    return buf;\n  },\n\n  //decompress from uint8array (UCS-2 big endian format)\n  decompressFromUint8Array:function (compressed) {\n    if (compressed===null || compressed===undefined){\n        return LZString.decompress(compressed);\n    } else {\n        var buf=new Array(compressed.length/2); // 2 bytes per character\n        for (var i=0, TotalLen=buf.length; i<TotalLen; i++) {\n          buf[i]=compressed[i*2]*256+compressed[i*2+1];\n        }\n\n        var result = [];\n        buf.forEach(function (c) {\n          result.push(f(c));\n        });\n        return LZString.decompress(result.join(''));\n\n    }\n\n  },\n\n\n  //compress into a string that is already URI encoded\n  compressToEncodedURIComponent: function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 6, function(a){return keyStrUriSafe.charAt(a);});\n  },\n\n  //decompress from an output of compressToEncodedURIComponent\n  decompressFromEncodedURIComponent:function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    input = input.replace(/ /g, \"+\");\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrUriSafe, input.charAt(index)); });\n  },\n\n  compress: function (uncompressed) {\n    return LZString._compress(uncompressed, 16, function(a){return f(a);});\n  },\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\n    if (uncompressed == null) return \"\";\n    var i, value,\n        context_dictionary= {},\n        context_dictionaryToCreate= {},\n        context_c=\"\",\n        context_wc=\"\",\n        context_w=\"\",\n        context_enlargeIn= 2, // Compensate for the first entry which should not count\n        context_dictSize= 3,\n        context_numBits= 2,\n        context_data=[],\n        context_data_val=0,\n        context_data_position=0,\n        ii;\n\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\n      context_c = uncompressed.charAt(ii);\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary,context_c)) {\n        context_dictionary[context_c] = context_dictSize++;\n        context_dictionaryToCreate[context_c] = true;\n      }\n\n      context_wc = context_w + context_c;\n      if (Object.prototype.hasOwnProperty.call(context_dictionary,context_wc)) {\n        context_w = context_wc;\n      } else {\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n          if (context_w.charCodeAt(0)<256) {\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<8 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          } else {\n            value = 1;\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1) | value;\n              if (context_data_position ==bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = 0;\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<16 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          }\n          context_enlargeIn--;\n          if (context_enlargeIn == 0) {\n            context_enlargeIn = Math.pow(2, context_numBits);\n            context_numBits++;\n          }\n          delete context_dictionaryToCreate[context_w];\n        } else {\n          value = context_dictionary[context_w];\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n\n\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        // Add wc to the dictionary.\n        context_dictionary[context_wc] = context_dictSize++;\n        context_w = String(context_c);\n      }\n    }\n\n    // Output the code for w.\n    if (context_w !== \"\") {\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n        if (context_w.charCodeAt(0)<256) {\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<8 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        } else {\n          value = 1;\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | value;\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = 0;\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<16 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        delete context_dictionaryToCreate[context_w];\n      } else {\n        value = context_dictionary[context_w];\n        for (i=0 ; i<context_numBits ; i++) {\n          context_data_val = (context_data_val << 1) | (value&1);\n          if (context_data_position == bitsPerChar-1) {\n            context_data_position = 0;\n            context_data.push(getCharFromInt(context_data_val));\n            context_data_val = 0;\n          } else {\n            context_data_position++;\n          }\n          value = value >> 1;\n        }\n\n\n      }\n      context_enlargeIn--;\n      if (context_enlargeIn == 0) {\n        context_enlargeIn = Math.pow(2, context_numBits);\n        context_numBits++;\n      }\n    }\n\n    // Mark the end of the stream\n    value = 2;\n    for (i=0 ; i<context_numBits ; i++) {\n      context_data_val = (context_data_val << 1) | (value&1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data_position = 0;\n        context_data.push(getCharFromInt(context_data_val));\n        context_data_val = 0;\n      } else {\n        context_data_position++;\n      }\n      value = value >> 1;\n    }\n\n    // Flush the last char\n    while (true) {\n      context_data_val = (context_data_val << 1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data.push(getCharFromInt(context_data_val));\n        break;\n      }\n      else context_data_position++;\n    }\n    return context_data.join('');\n  },\n\n  decompress: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 32768, function(index) { return compressed.charCodeAt(index); });\n  },\n\n  _decompress: function (length, resetValue, getNextValue) {\n    var dictionary = [],\n        next,\n        enlargeIn = 4,\n        dictSize = 4,\n        numBits = 3,\n        entry = \"\",\n        result = [],\n        i,\n        w,\n        bits, resb, maxpower, power,\n        c,\n        data = {val:getNextValue(0), position:resetValue, index:1};\n\n    for (i = 0; i < 3; i += 1) {\n      dictionary[i] = i;\n    }\n\n    bits = 0;\n    maxpower = Math.pow(2,2);\n    power=1;\n    while (power!=maxpower) {\n      resb = data.val & data.position;\n      data.position >>= 1;\n      if (data.position == 0) {\n        data.position = resetValue;\n        data.val = getNextValue(data.index++);\n      }\n      bits |= (resb>0 ? 1 : 0) * power;\n      power <<= 1;\n    }\n\n    switch (next = bits) {\n      case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 2:\n        return \"\";\n    }\n    dictionary[3] = c;\n    w = c;\n    result.push(c);\n    while (true) {\n      if (data.index > length) {\n        return \"\";\n      }\n\n      bits = 0;\n      maxpower = Math.pow(2,numBits);\n      power=1;\n      while (power!=maxpower) {\n        resb = data.val & data.position;\n        data.position >>= 1;\n        if (data.position == 0) {\n          data.position = resetValue;\n          data.val = getNextValue(data.index++);\n        }\n        bits |= (resb>0 ? 1 : 0) * power;\n        power <<= 1;\n      }\n\n      switch (c = bits) {\n        case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 2:\n          return result.join('');\n      }\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n      if (dictionary[c]) {\n        entry = dictionary[c];\n      } else {\n        if (c === dictSize) {\n          entry = w + w.charAt(0);\n        } else {\n          return null;\n        }\n      }\n      result.push(entry);\n\n      // Add w+entry[0] to the dictionary.\n      dictionary[dictSize++] = w + entry.charAt(0);\n      enlargeIn--;\n\n      w = entry;\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n    }\n  }\n};\n  return LZString;\n})();\n\nif (typeof define === 'function' && define.amd) {\n  define(function () { return LZString; });\n} else if( typeof module !== 'undefined' && module != null ) {\n  module.exports = LZString\n} else if( typeof angular !== 'undefined' && angular != null ) {\n  angular.module('LZString', [])\n  .factory('LZString', function () {\n    return LZString;\n  });\n}\n","import { assertExists } from '@blocksuite/global/utils';\nimport type {\n  BaseAdapter,\n  BlockSnapshot,\n  JobMiddleware,\n  Page,\n  Slice,\n} from '@blocksuite/store';\nimport { Job } from '@blocksuite/store';\nimport * as lz from 'lz-string';\n\ntype AdapterMap = Map<\n  string,\n  {\n    adapter: BaseAdapter;\n    priority: number;\n  }\n>;\n\nexport class Clipboard {\n  private _jobMiddlewares: JobMiddleware[] = [];\n  private _adapterMap: AdapterMap = new Map();\n\n  constructor(public std: BlockSuite.Std) {}\n\n  use = (middleware: JobMiddleware) => {\n    this._jobMiddlewares.push(middleware);\n  };\n\n  unuse = (middleware: JobMiddleware) => {\n    this._jobMiddlewares = this._jobMiddlewares.filter(m => m !== middleware);\n  };\n\n  registerAdapter = (mimeType: string, adapter: BaseAdapter, priority = 0) => {\n    this._adapterMap.set(mimeType, { adapter, priority });\n  };\n\n  unregisterAdapter = (mimeType: string) => {\n    this._adapterMap.delete(mimeType);\n  };\n\n  private _getJob() {\n    return new Job({\n      middlewares: this._jobMiddlewares,\n      workspace: this.std.workspace,\n    });\n  }\n\n  // Gated by https://developer.mozilla.org/en-US/docs/Glossary/Transient_activation\n  // Need to be cloned to a map for later use\n  private _getDataByType = (clipboardData: DataTransfer) => {\n    const data = new Map<string, string | File[]>();\n    for (const type of clipboardData.types) {\n      if (type === 'Files') {\n        data.set(type, Array.from(clipboardData.files));\n      } else {\n        data.set(type, clipboardData.getData(type));\n      }\n    }\n    return (type: string) => {\n      const item = data.get(type);\n      if (item) {\n        return item;\n      }\n      const files = ((data.get('Files') ?? []) as File[]).filter(\n        f => f.type === type\n      );\n      if (files.length > 0) {\n        return files;\n      }\n      return '';\n    };\n  };\n\n  private async _getClipboardItem(slice: Slice, type: string) {\n    const job = this._getJob();\n    const adapterItem = this._adapterMap.get(type);\n    assertExists(adapterItem);\n    const { adapter } = adapterItem;\n    const snapshot = await job.sliceToSnapshot(slice);\n    adapter.applyConfigs(job.adapterConfigs);\n    return (\n      await adapter.fromSliceSnapshot({ snapshot, assets: job.assetsManager })\n    ).file;\n  }\n\n  private _getSnapshotByPriority = async (\n    getItem: (type: string) => string | File[],\n    page: Page,\n    parent?: string,\n    index?: number\n  ) => {\n    const byPriority = Array.from(this._adapterMap.entries()).sort(\n      (a, b) => b[1].priority - a[1].priority\n    );\n    for (const [type, { adapter }] of byPriority) {\n      const item = getItem(type);\n      if (Array.isArray(item)) {\n        if (item.length === 0) {\n          continue;\n        }\n        if (!item.map(f => f.type === type).reduce((a, b) => a || b, false)) {\n          continue;\n        }\n      }\n      if (item) {\n        const job = this._getJob();\n        adapter.applyConfigs(job.adapterConfigs);\n        const payload = {\n          file: item,\n          assets: job.assetsManager,\n          blockVersions: page.workspace.meta.blockVersions,\n          pageVersion: page.workspace.meta.pageVersion,\n          workspaceVersion: page.workspace.meta.workspaceVersion,\n          workspaceId: page.workspace.id,\n          pageId: page.id,\n        };\n        const sliceSnapshot = await adapter.toSliceSnapshot(payload);\n        if (sliceSnapshot) {\n          return job.snapshotToSlice(sliceSnapshot, page, parent, index);\n        }\n      }\n    }\n    return null;\n  };\n\n  copy = async (slice: Slice) => {\n    return this.copySlice(slice);\n  };\n\n  paste = async (\n    event: ClipboardEvent,\n    page: Page,\n    parent?: string,\n    index?: number\n  ) => {\n    const data = event.clipboardData;\n    if (!data) return;\n\n    try {\n      const json = this.readFromClipboard(data);\n      const slice = await this._getSnapshotByPriority(\n        type => json[type],\n        page,\n        parent,\n        index\n      );\n      assertExists(slice);\n      return slice;\n    } catch {\n      const getDataByType = this._getDataByType(data);\n      const slice = await this._getSnapshotByPriority(\n        type => getDataByType(type),\n        page,\n        parent,\n        index\n      );\n\n      return slice;\n    }\n  };\n\n  async writeToClipboard(\n    updateItems: (\n      items: Record<string, unknown>\n    ) => Promise<Record<string, unknown>>\n  ) {\n    const _items = {\n      'text/plain': '',\n      'text/html': '',\n      'image/png': '',\n    };\n\n    const items = await updateItems(_items);\n\n    const text = items['text/plain'] as string;\n    const innerHTML = items['text/html'] as string;\n    const png = items['image/png'] as string | Blob;\n\n    delete items['text/plain'];\n    delete items['text/html'];\n    delete items['image/png'];\n\n    const snapshot = lz.compressToEncodedURIComponent(JSON.stringify(items));\n    const html = `<div data-blocksuite-snapshot=${snapshot}>${innerHTML}</div>`;\n    const htmlBlob = new Blob([html], {\n      type: 'text/html',\n    });\n    const clipboardItems: Record<string, Blob> = {\n      'text/html': htmlBlob,\n    };\n    if (text.length > 0) {\n      const textBlob = new Blob([text], {\n        type: 'text/plain',\n      });\n      clipboardItems['text/plain'] = textBlob;\n    }\n\n    if (png instanceof Blob) {\n      clipboardItems['image/png'] = png;\n    } else if (png.length > 0) {\n      const pngBlob = new Blob([png], {\n        type: 'image/png',\n      });\n      clipboardItems['image/png'] = pngBlob;\n    }\n    await navigator.clipboard.write([new ClipboardItem(clipboardItems)]);\n  }\n\n  readFromClipboard(clipboardData: DataTransfer) {\n    const items = clipboardData.getData('text/html');\n    const domParser = new DOMParser();\n    const doc = domParser.parseFromString(items, 'text/html');\n    const dom = doc.querySelector<HTMLDivElement>('[data-blocksuite-snapshot]');\n    assertExists(dom);\n    const json = JSON.parse(\n      lz.decompressFromEncodedURIComponent(\n        dom.dataset.blocksuiteSnapshot as string\n      )\n    );\n    return json;\n  }\n\n  pasteBlockSnapshot = async (\n    snapshot: BlockSnapshot,\n    page: Page,\n    parent?: string,\n    index?: number\n  ) => {\n    const job = this._getJob();\n    return job.snapshotToBlock(snapshot, page, parent, index);\n  };\n\n  copySlice = async (slice: Slice) => {\n    const adapterKeys = Array.from(this._adapterMap.keys());\n\n    await this.writeToClipboard(async _items => {\n      const items = { ..._items };\n\n      await Promise.all(\n        adapterKeys.map(async type => {\n          const item = await this._getClipboardItem(slice, type);\n          if (typeof item === 'string') {\n            items[type] = item;\n          }\n        })\n      );\n      return items;\n    });\n  };\n}\n","// type A = {};\n// type B = { prop?: string };\n// type C = { prop: string };\n// type TestA = MakeOptionalIfEmpty<A>;  // void | {}\n// type TestB = MakeOptionalIfEmpty<B>;  // void | { prop?: string }\n// type TestC = MakeOptionalIfEmpty<C>;  // { prop: string }\ntype IfAllKeysOptional<T, Yes, No> =\n  Partial<T> extends T ? (T extends Partial<T> ? Yes : No) : No;\ntype MakeOptionalIfEmpty<T> = IfAllKeysOptional<T, void | T, T>;\n\nexport interface InitCommandCtx {\n  std: BlockSuite.Std;\n}\n\nexport type CommandKeyToData<K extends BlockSuite.CommandDataName> = Pick<\n  BlockSuite.CommandContext,\n  K\n>;\nexport type Command<\n  In extends BlockSuite.CommandDataName = never,\n  Out extends BlockSuite.CommandDataName = never,\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  InData extends object = {},\n> = (\n  ctx: CommandKeyToData<In> & InitCommandCtx & InData,\n  next: (ctx?: CommandKeyToData<Out>) => void\n) => void;\ntype Omit1<A, B> = [keyof Omit<A, keyof B>] extends [never]\n  ? void\n  : Omit<A, keyof B>;\ntype InDataOfCommand<C> =\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  C extends Command<infer K, any, infer R> ? CommandKeyToData<K> & R : never;\ntype OutDataOfCommand<C> =\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  C extends Command<any, infer K, any> ? CommandKeyToData<K> : never;\n// eslint-disable-next-line @typescript-eslint/ban-types\ntype CommonMethods<In extends object = {}> = {\n  run(): boolean;\n  with<T extends Partial<BlockSuite.CommandContext>>(value: T): Chain<In & T>;\n  inline: <InlineOut extends BlockSuite.CommandDataName = never>(\n    command: Command<Extract<keyof In, BlockSuite.CommandDataName>, InlineOut>\n  ) => Chain<In & CommandKeyToData<InlineOut>>;\n  try: <InlineOut extends BlockSuite.CommandDataName = never>(\n    fn: (chain: Chain<In>) => Chain<In & CommandKeyToData<InlineOut>>[]\n  ) => Chain<In & CommandKeyToData<InlineOut>>;\n  tryAll: <InlineOut extends BlockSuite.CommandDataName = never>(\n    fn: (chain: Chain<In>) => Chain<In & CommandKeyToData<InlineOut>>[]\n  ) => Chain<In & CommandKeyToData<InlineOut>>;\n};\nconst cmdSymbol = Symbol('cmds');\ntype Cmds = {\n  [cmdSymbol]: Command[];\n};\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport type Chain<In extends object = {}> = CommonMethods<In> & {\n  [K in keyof BlockSuite.Commands]: (\n    data: MakeOptionalIfEmpty<\n      Omit1<InDataOfCommand<BlockSuite.Commands[K]>, In>\n    >\n  ) => Chain<In & OutDataOfCommand<BlockSuite.Commands[K]>>;\n} & Cmds;\n\nexport class CommandManager {\n  private _commands = new Map<string, Command>();\n\n  constructor(public std: BlockSuite.Std) {}\n\n  private _getCommandCtx = (): InitCommandCtx => {\n    return {\n      std: this.std,\n    };\n  };\n\n  add<N extends BlockSuite.CommandName>(\n    name: N,\n    command: BlockSuite.Commands[N]\n  ): CommandManager;\n  add(name: string, command: Command) {\n    this._commands.set(name, command);\n    return this;\n  }\n\n  createChain = (\n    methods: Record<BlockSuite.CommandName, unknown>,\n    _cmds: Command[]\n  ): Chain => {\n    const getCommandCtx = this._getCommandCtx;\n    const createChain = this.createChain;\n    const pipe = this.pipe;\n    const runCmds = (\n      ctx: BlockSuite.CommandContext,\n      [cmd, ...rest]: Command[]\n    ) => {\n      if (cmd) {\n        cmd(ctx, data => runCmds({ ...ctx, ...data }, rest));\n      }\n    };\n\n    return {\n      [cmdSymbol]: _cmds,\n      run: function (this: Chain) {\n        const ctx = getCommandCtx();\n        let success = false;\n        try {\n          const cmds = this[cmdSymbol];\n          runCmds(ctx as BlockSuite.CommandContext, [\n            ...cmds,\n            (_, next) => {\n              success = true;\n              next();\n            },\n          ]);\n        } catch (err) {\n          console.error(err);\n        }\n\n        return success;\n      },\n      with: function (this: Chain, value) {\n        const cmds = this[cmdSymbol];\n        return createChain(methods, [\n          ...cmds,\n          (_, next) => next(value),\n        ]) as never;\n      },\n      inline: function (this: Chain, command) {\n        const cmds = this[cmdSymbol];\n        return createChain(methods, [...cmds, command]) as never;\n      },\n      try: function (this: Chain, fn) {\n        const cmds = this[cmdSymbol];\n        return createChain(methods, [\n          ...cmds,\n          (beforeCtx, next) => {\n            let ctx = beforeCtx;\n            const chains = fn(pipe());\n\n            for (const chain of chains) {\n              // inject ctx in the beginning\n              chain[cmdSymbol] = [\n                (_, next) => {\n                  next(ctx);\n                },\n                ...chain[cmdSymbol],\n              ];\n\n              const success = chain\n                .inline((branchCtx, next) => {\n                  ctx = { ...ctx, ...branchCtx };\n                  next();\n                })\n                .run();\n              if (success) {\n                next(ctx);\n                break;\n              }\n            }\n          },\n        ]) as never;\n      },\n      tryAll: function (this: Chain, fn) {\n        const cmds = this[cmdSymbol];\n        return createChain(methods, [\n          ...cmds,\n          (beforeCtx, next) => {\n            let ctx = beforeCtx;\n            const chains = fn(pipe());\n\n            let allFail = true;\n            for (const chain of chains) {\n              // inject ctx in the beginning\n              chain[cmdSymbol] = [\n                (_, next) => {\n                  next(ctx);\n                },\n                ...chain[cmdSymbol],\n              ];\n\n              const success = chain\n                .inline((branchCtx, next) => {\n                  ctx = { ...ctx, ...branchCtx };\n                  next();\n                })\n                .run();\n              if (success) {\n                allFail = false;\n              }\n            }\n            if (!allFail) {\n              next(ctx);\n            }\n          },\n        ]) as never;\n      },\n      ...methods,\n    } as Chain;\n  };\n  pipe = (): Chain<InitCommandCtx> => {\n    const methods = {} as Record<\n      string,\n      (data: Record<string, unknown>) => Chain\n    >;\n    const createChain = this.createChain;\n    for (const [name, command] of this._commands.entries()) {\n      methods[name] = function (\n        this: { [cmdSymbol]: Command[] },\n        data: Record<string, unknown>\n      ) {\n        const cmds = this[cmdSymbol];\n        return createChain(methods, [\n          ...cmds,\n          (ctx, next) => command({ ...ctx, ...data }, next),\n        ]);\n      };\n    }\n\n    return createChain(methods, []);\n  };\n  getChainCtx = <T extends BlockSuite.CommandContext>(chain: Chain<T>) => {\n    const ctx = {} as T;\n    chain\n      .inline((chainCtx, next) => {\n        Object.assign(ctx, chainCtx);\n        next();\n      })\n      .run();\n    return ctx;\n  };\n}\n\ndeclare global {\n  namespace BlockSuite {\n    interface CommandContext extends InitCommandCtx {}\n\n    interface Commands {}\n\n    type CommandName = keyof Commands;\n    type CommandDataName = keyof CommandContext;\n\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    type CommandChain<In extends object = {}> = Chain<In>;\n  }\n}\n","import { assertExists } from '@blocksuite/global/utils';\n\ntype MatchEvent<T extends string> = T extends UIEventStateType\n  ? BlockSuiteUIEventState[T]\n  : UIEventState;\n\nexport class UIEventState {\n  /** when extends, override it with pattern `xxxState` */\n  type = 'defaultState';\n\n  constructor(public event: Event) {}\n}\n\nexport class UIEventStateContext {\n  private _map: Record<string, UIEventState> = {};\n\n  static from(...states: UIEventState[]) {\n    const context = new UIEventStateContext();\n    states.forEach(state => {\n      context.add(state);\n    });\n    return context;\n  }\n\n  add = <State extends UIEventState = UIEventState>(state: State) => {\n    const name = state.type;\n    if (this._map[name]) {\n      console.warn('UIEventStateContext: state name duplicated', name);\n    }\n\n    this._map[name] = state;\n  };\n\n  has = (type: UIEventStateType) => {\n    return !!this._map[type];\n  };\n\n  get = <Type extends UIEventStateType = UIEventStateType>(\n    type: Type\n  ): MatchEvent<Type> => {\n    const state = this._map[type];\n    assertExists(state, `UIEventStateContext: state ${type} not found`);\n    return state as MatchEvent<Type>;\n  };\n}\n\nexport type UIEventHandler = (\n  context: UIEventStateContext\n) => boolean | null | undefined | void;\n\ndeclare global {\n  interface BlockSuiteUIEventState {\n    defaultState: UIEventState;\n  }\n\n  type UIEventStateType = keyof BlockSuiteUIEventState;\n}\n","export class PathFinder {\n  private constructor() {\n    // this is a static class\n  }\n\n  static id = (path: readonly string[]) => {\n    return path[path.length - 1];\n  };\n\n  static parent = (path: readonly string[]) => {\n    return path.slice(0, path.length - 1);\n  };\n\n  static pathToKey = (path: readonly string[]) => {\n    return path.join('|');\n  };\n\n  static keyToPath = (key: string) => {\n    return key.split('|');\n  };\n\n  static equals = (path1: readonly string[], path2: readonly string[]) => {\n    return PathFinder.pathToKey(path1) === PathFinder.pathToKey(path2);\n  };\n\n  // check if path1 includes path2\n  static includes = (path1: string[], path2: string[]) => {\n    return PathFinder.pathToKey(path1).startsWith(PathFinder.pathToKey(path2));\n  };\n}\n","import { UIEventState } from '../base.js';\n\ntype ClipboardEventStateOptions = {\n  event: ClipboardEvent;\n};\n\nexport class ClipboardEventState extends UIEventState {\n  override type = 'clipboardState';\n\n  raw: ClipboardEvent;\n\n  constructor({ event }: ClipboardEventStateOptions) {\n    super(event);\n\n    this.raw = event;\n  }\n}\n\ndeclare global {\n  interface BlockSuiteUIEventState {\n    clipboardState: ClipboardEventState;\n  }\n}\n","import { UIEventState } from '../base.js';\n\nexport enum EventScopeSourceType {\n  // The event scope should be built by selection path\n  Selection = 'selection',\n\n  // The event scope should be built by event target\n  Target = 'target',\n}\n\nexport type EventSourceStateOptions = {\n  event: Event;\n  sourceType: EventScopeSourceType;\n};\n\nexport class EventSourceState extends UIEventState {\n  override type = 'sourceState';\n  readonly sourceType: EventScopeSourceType;\n  constructor({ event, sourceType }: EventSourceStateOptions) {\n    super(event);\n    this.sourceType = sourceType;\n  }\n}\n\ndeclare global {\n  interface BlockSuiteUIEventState {\n    sourceState: EventSourceState;\n  }\n}\n","import { UIEventState, UIEventStateContext } from '../base.js';\nimport type { UIEventDispatcher } from '../dispatcher.js';\nimport { ClipboardEventState } from '../state/clipboard.js';\nimport { EventScopeSourceType, EventSourceState } from '../state/source.js';\n\nexport class ClipboardControl {\n  constructor(private _dispatcher: UIEventDispatcher) {}\n\n  private _createContext(event: Event, clipboardState: ClipboardEventState) {\n    return UIEventStateContext.from(\n      new UIEventState(event),\n      new EventSourceState({\n        event,\n        sourceType: EventScopeSourceType.Selection,\n      }),\n      clipboardState\n    );\n  }\n\n  listen() {\n    this._dispatcher.disposables.addFromEvent(document, 'cut', this._cut);\n    this._dispatcher.disposables.addFromEvent(document, 'copy', this._copy);\n    this._dispatcher.disposables.addFromEvent(document, 'paste', this._paste);\n  }\n\n  private _cut = (event: ClipboardEvent) => {\n    if (!this._dispatcher.isActive) return;\n\n    const clipboardEventState = new ClipboardEventState({\n      event,\n    });\n    this._dispatcher.run(\n      'cut',\n      this._createContext(event, clipboardEventState)\n    );\n  };\n\n  private _copy = (event: ClipboardEvent) => {\n    if (!this._dispatcher.isActive) return;\n\n    const clipboardEventState = new ClipboardEventState({\n      event,\n    });\n    this._dispatcher.run(\n      'copy',\n      this._createContext(event, clipboardEventState)\n    );\n  };\n\n  private _paste = (event: ClipboardEvent) => {\n    if (!this._dispatcher.isActive) return;\n\n    const clipboardEventState = new ClipboardEventState({\n      event,\n    });\n\n    this._dispatcher.run(\n      'paste',\n      this._createContext(event, clipboardEventState)\n    );\n  };\n}\n","export var base = {\n  8: \"Backspace\",\n  9: \"Tab\",\n  10: \"Enter\",\n  12: \"NumLock\",\n  13: \"Enter\",\n  16: \"Shift\",\n  17: \"Control\",\n  18: \"Alt\",\n  20: \"CapsLock\",\n  27: \"Escape\",\n  32: \" \",\n  33: \"PageUp\",\n  34: \"PageDown\",\n  35: \"End\",\n  36: \"Home\",\n  37: \"ArrowLeft\",\n  38: \"ArrowUp\",\n  39: \"ArrowRight\",\n  40: \"ArrowDown\",\n  44: \"PrintScreen\",\n  45: \"Insert\",\n  46: \"Delete\",\n  59: \";\",\n  61: \"=\",\n  91: \"Meta\",\n  92: \"Meta\",\n  106: \"*\",\n  107: \"+\",\n  108: \",\",\n  109: \"-\",\n  110: \".\",\n  111: \"/\",\n  144: \"NumLock\",\n  145: \"ScrollLock\",\n  160: \"Shift\",\n  161: \"Shift\",\n  162: \"Control\",\n  163: \"Control\",\n  164: \"Alt\",\n  165: \"Alt\",\n  173: \"-\",\n  186: \";\",\n  187: \"=\",\n  188: \",\",\n  189: \"-\",\n  190: \".\",\n  191: \"/\",\n  192: \"`\",\n  219: \"[\",\n  220: \"\\\\\",\n  221: \"]\",\n  222: \"'\"\n}\n\nexport var shift = {\n  48: \")\",\n  49: \"!\",\n  50: \"@\",\n  51: \"#\",\n  52: \"$\",\n  53: \"%\",\n  54: \"^\",\n  55: \"&\",\n  56: \"*\",\n  57: \"(\",\n  59: \":\",\n  61: \"+\",\n  173: \"_\",\n  186: \":\",\n  187: \"+\",\n  188: \"<\",\n  189: \"_\",\n  190: \">\",\n  191: \"?\",\n  192: \"~\",\n  219: \"{\",\n  220: \"|\",\n  221: \"}\",\n  222: \"\\\"\"\n}\n\nvar mac = typeof navigator != \"undefined\" && /Mac/.test(navigator.platform)\nvar ie = typeof navigator != \"undefined\" && /MSIE \\d|Trident\\/(?:[7-9]|\\d{2,})\\..*rv:(\\d+)/.exec(navigator.userAgent)\n\n// Fill in the digit keys\nfor (var i = 0; i < 10; i++) base[48 + i] = base[96 + i] = String(i)\n\n// The function keys\nfor (var i = 1; i <= 24; i++) base[i + 111] = \"F\" + i\n\n// And the alphabetic keys\nfor (var i = 65; i <= 90; i++) {\n  base[i] = String.fromCharCode(i + 32)\n  shift[i] = String.fromCharCode(i)\n}\n\n// For each code that doesn't have a shift-equivalent, copy the base name\nfor (var code in base) if (!shift.hasOwnProperty(code)) shift[code] = base[code]\n\nexport function keyName(event) {\n  // On macOS, keys held with Shift and Cmd don't reflect the effect of Shift in `.key`.\n  // On IE, shift effect is never included in `.key`.\n  var ignoreKey = mac && event.metaKey && event.shiftKey && !event.ctrlKey && !event.altKey ||\n      ie && event.shiftKey && event.key && event.key.length == 1 ||\n      event.key == \"Unidentified\"\n  var name = (!ignoreKey && event.key) ||\n    (event.shiftKey ? shift : base)[event.keyCode] ||\n    event.key || \"Unidentified\"\n  // Edge sometimes produces wrong names (Issue #3)\n  if (name == \"Esc\") name = \"Escape\"\n  if (name == \"Del\") name = \"Delete\"\n  // https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/8860571/\n  if (name == \"Left\") name = \"ArrowLeft\"\n  if (name == \"Up\") name = \"ArrowUp\"\n  if (name == \"Right\") name = \"ArrowRight\"\n  if (name == \"Down\") name = \"ArrowDown\"\n  return name\n}\n","import { base, keyName } from 'w3c-keyname';\n\nimport type { UIEventHandler } from './base.js';\n\nconst mac =\n  typeof navigator !== 'undefined'\n    ? /Mac|iP(hone|[oa]d)/.test(navigator.platform)\n    : false;\n\nfunction normalizeKeyName(name: string) {\n  const parts = name.split(/-(?!$)/);\n  let result = parts.at(-1);\n  if (result === 'Space') {\n    result = ' ';\n  }\n  let alt, ctrl, shift, meta;\n  parts.slice(0, -1).forEach(mod => {\n    if (/^(cmd|meta|m)$/i.test(mod)) {\n      meta = true;\n      return;\n    }\n    if (/^a(lt)?$/i.test(mod)) {\n      alt = true;\n      return;\n    }\n    if (/^(c|ctrl|control)$/i.test(mod)) {\n      ctrl = true;\n      return;\n    }\n    if (/^s(hift)?$/i.test(mod)) {\n      shift = true;\n      return;\n    }\n    if (/^mod$/i.test(mod)) {\n      if (mac) {\n        meta = true;\n      } else {\n        ctrl = true;\n      }\n      return;\n    }\n\n    throw new Error('Unrecognized modifier name: ' + mod);\n  });\n  if (alt) result = 'Alt-' + result;\n  if (ctrl) result = 'Ctrl-' + result;\n  if (meta) result = 'Meta-' + result;\n  if (shift) result = 'Shift-' + result;\n  return result as string;\n}\n\nfunction modifiers(name: string, event: KeyboardEvent, shift = true) {\n  if (event.altKey) name = 'Alt-' + name;\n  if (event.ctrlKey) name = 'Ctrl-' + name;\n  if (event.metaKey) name = 'Meta-' + name;\n  if (shift && event.shiftKey) name = 'Shift-' + name;\n  return name;\n}\n\nfunction normalize(map: Record<string, UIEventHandler>) {\n  const copy: Record<string, UIEventHandler> = Object.create(null);\n  for (const prop in map) copy[normalizeKeyName(prop)] = map[prop];\n  return copy;\n}\n\nexport function bindKeymap(\n  bindings: Record<string, UIEventHandler>\n): UIEventHandler {\n  const map = normalize(bindings);\n  return ctx => {\n    const state = ctx.get('keyboardState');\n    const event = state.raw;\n    const name = keyName(event);\n    const direct = map[modifiers(name, event)];\n    if (direct && direct(ctx)) {\n      return true;\n    }\n    if (name.length !== 1 || name === ' ') {\n      return false;\n    }\n\n    if (event.shiftKey) {\n      const noShift = map[modifiers(name, event, false)];\n      if (noShift && noShift(ctx)) {\n        return true;\n      }\n    }\n\n    // none standard keyboard, fallback to keyCode\n    const special =\n      event.shiftKey ||\n      event.altKey ||\n      event.metaKey ||\n      name.charCodeAt(0) > 127;\n    const baseName = base[event.keyCode];\n    if (special && baseName && baseName !== name) {\n      const fromCode = map[modifiers(baseName, event)];\n      if (fromCode && fromCode(ctx)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n}\n","import { UIEventState } from '../base.js';\n\ntype KeyboardEventStateOptions = {\n  event: KeyboardEvent;\n  composing: boolean;\n};\n\nexport class KeyboardEventState extends UIEventState {\n  override type = 'keyboardState';\n\n  raw: KeyboardEvent;\n\n  composing: boolean;\n\n  constructor({ event, composing }: KeyboardEventStateOptions) {\n    super(event);\n\n    this.raw = event;\n    this.composing = composing;\n  }\n}\n\ndeclare global {\n  interface BlockSuiteUIEventState {\n    keyboardState: KeyboardEventState;\n  }\n}\n","import { UIEventState } from '../base.js';\n\ntype PointerEventStateOptions = {\n  event: PointerEvent;\n  rect: DOMRect;\n  startX: number;\n  startY: number;\n  last: PointerEventState | null;\n};\n\ntype Point = { x: number; y: number };\n\nexport class PointerEventState extends UIEventState {\n  override type = 'pointerState';\n\n  raw: PointerEvent;\n  point: Point;\n  containerOffset: Point;\n  start: Point;\n  delta: Point;\n  keys: {\n    shift: boolean;\n    cmd: boolean;\n    alt: boolean;\n  };\n  button: number;\n  dragging: boolean;\n\n  get x() {\n    return this.point.x;\n  }\n\n  get y() {\n    return this.point.y;\n  }\n\n  constructor({ event, rect, startX, startY, last }: PointerEventStateOptions) {\n    super(event);\n\n    const offsetX = event.clientX - rect.left;\n    const offsetY = event.clientY - rect.top;\n\n    this.raw = event;\n    this.point = { x: offsetX, y: offsetY };\n    this.containerOffset = { x: rect.left, y: rect.top };\n    this.start = { x: startX, y: startY };\n    this.delta = last\n      ? { x: offsetX - last.point.x, y: offsetY - last.point.y }\n      : { x: 0, y: 0 };\n    this.keys = {\n      shift: event.shiftKey,\n      cmd: event.metaKey || event.ctrlKey,\n      alt: event.altKey,\n    };\n    this.button = last?.button || event.button;\n    this.dragging = !!last;\n  }\n}\n\ndeclare global {\n  interface BlockSuiteUIEventState {\n    pointerState: PointerEventState;\n  }\n}\n","import {\n  type UIEventHandler,\n  UIEventState,\n  UIEventStateContext,\n} from '../base.js';\nimport type { EventOptions, UIEventDispatcher } from '../dispatcher.js';\nimport { bindKeymap } from '../keymap.js';\nimport { KeyboardEventState } from '../state/index.js';\nimport { EventScopeSourceType, EventSourceState } from '../state/source.js';\n\nexport class KeyboardControl {\n  private composition = false;\n  constructor(private _dispatcher: UIEventDispatcher) {}\n\n  private _createContext(event: Event, keyboardState: KeyboardEventState) {\n    return UIEventStateContext.from(\n      new UIEventState(event),\n      new EventSourceState({\n        event,\n        sourceType: EventScopeSourceType.Selection,\n      }),\n      keyboardState\n    );\n  }\n\n  listen() {\n    this._dispatcher.disposables.addFromEvent(document, 'keydown', this._down);\n    this._dispatcher.disposables.addFromEvent(document, 'keyup', this._up);\n    this._dispatcher.disposables.addFromEvent(\n      document,\n      'compositionstart',\n      () => {\n        this.composition = true;\n      }\n    );\n    this._dispatcher.disposables.addFromEvent(\n      document,\n      'compositionend',\n      () => {\n        this.composition = false;\n      }\n    );\n  }\n\n  bindHotkey(keymap: Record<string, UIEventHandler>, options?: EventOptions) {\n    return this._dispatcher.add(\n      'keyDown',\n      ctx => {\n        if (this.composition) {\n          return false;\n        }\n        const binding = bindKeymap(keymap);\n        return binding(ctx);\n      },\n      options\n    );\n  }\n\n  private _down = (event: KeyboardEvent) => {\n    if (!this._dispatcher.isActive) return;\n\n    const keyboardEventState = new KeyboardEventState({\n      event,\n      composing: this.composition,\n    });\n    this._dispatcher.run(\n      'keyDown',\n      this._createContext(event, keyboardEventState)\n    );\n  };\n\n  private _up = (event: KeyboardEvent) => {\n    if (!this._dispatcher.isActive) return;\n\n    const keyboardEventState = new KeyboardEventState({\n      event,\n      composing: this.composition,\n    });\n\n    this._dispatcher.run(\n      'keyUp',\n      this._createContext(event, keyboardEventState)\n    );\n  };\n}\n","export function isFarEnough(a: PointerEvent, b: PointerEvent) {\n  const dx = a.x - b.x;\n  const dy = a.y - b.y;\n  return Math.pow(dx, 2) + Math.pow(dy, 2) > 4;\n}\n\nexport const toLowerCase = <T extends string>(str: T): Lowercase<T> =>\n  str.toLowerCase() as Lowercase<T>;\n","import { assertExists } from '@blocksuite/global/utils';\n\nimport { UIEventState, UIEventStateContext } from '../base.js';\nimport type { UIEventDispatcher } from '../dispatcher.js';\nimport { PointerEventState } from '../state/index.js';\nimport { EventScopeSourceType, EventSourceState } from '../state/source.js';\nimport { isFarEnough } from '../utils.js';\n\nexport class PointerControl {\n  private _lastPointerDownEvent: PointerEvent | null = null;\n  private _startDragState: PointerEventState | null = null;\n  private _lastDragState: PointerEventState | null = null;\n  private _pointerDownCount = 0;\n  private _dragging = false;\n  private _startX = -Infinity;\n  private _startY = -Infinity;\n\n  constructor(private _dispatcher: UIEventDispatcher) {}\n\n  listen() {\n    this._dispatcher.disposables.addFromEvent(\n      this._dispatcher.host,\n      'pointerdown',\n      this._down\n    );\n    this._dispatcher.disposables.addFromEvent(\n      this._dispatcher.host,\n      'pointermove',\n      this._moveOn\n    );\n    this._dispatcher.disposables.addFromEvent(\n      this._dispatcher.host,\n      'pointerout',\n      this._out\n    );\n  }\n\n  private get _rect() {\n    return this._dispatcher.host.getBoundingClientRect();\n  }\n\n  private _reset = () => {\n    this._startX = -Infinity;\n    this._startY = -Infinity;\n    this._lastDragState = null;\n    this._dragging = false;\n  };\n\n  private _createContext(event: Event, pointerState: PointerEventState) {\n    return UIEventStateContext.from(\n      new UIEventState(event),\n      new EventSourceState({\n        event,\n        sourceType: EventScopeSourceType.Target,\n      }),\n      pointerState\n    );\n  }\n\n  private _down = (event: PointerEvent) => {\n    this._dispatcher.activate();\n\n    if (\n      this._lastPointerDownEvent &&\n      event.timeStamp - this._lastPointerDownEvent.timeStamp < 500 &&\n      !isFarEnough(event, this._lastPointerDownEvent)\n    ) {\n      this._pointerDownCount++;\n    } else {\n      this._pointerDownCount = 1;\n    }\n\n    const pointerEventState = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: this._startX,\n      startY: this._startY,\n      last: null,\n    });\n\n    this._startX = pointerEventState.point.x;\n    this._startY = pointerEventState.point.y;\n    this._startDragState = pointerEventState;\n    this._lastDragState = pointerEventState;\n    this._lastPointerDownEvent = event;\n\n    this._dispatcher.run(\n      'pointerDown',\n      this._createContext(event, pointerEventState)\n    );\n\n    this._dispatcher.disposables.addFromEvent(\n      document,\n      'pointermove',\n      this._move\n    );\n    this._dispatcher.disposables.addFromEvent(document, 'pointerup', this._up);\n  };\n\n  private _up = (event: PointerEvent) => {\n    const pointerEventState = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: this._startX,\n      startY: this._startY,\n      last: this._lastDragState,\n    });\n    const context = this._createContext(event, pointerEventState);\n\n    const run = () => {\n      if (this._dragging) {\n        this._dispatcher.run('dragEnd', context);\n        return;\n      }\n      this._dispatcher.run('click', context);\n      if (this._pointerDownCount === 2) {\n        this._dispatcher.run('doubleClick', context);\n      }\n      if (this._pointerDownCount === 3) {\n        this._dispatcher.run('tripleClick', context);\n      }\n    };\n\n    run();\n    this._dispatcher.run('pointerUp', context);\n\n    this._reset();\n    document.removeEventListener('pointermove', this._move);\n    document.removeEventListener('pointerup', this._up);\n  };\n\n  private _move = (event: PointerEvent) => {\n    const last = this._lastDragState;\n    const state = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: this._startX,\n      startY: this._startY,\n      last,\n    });\n    this._lastDragState = state;\n\n    assertExists(this._startDragState);\n\n    if (!this._dragging && isFarEnough(this._startDragState.raw, state.raw)) {\n      this._dragging = true;\n      this._dispatcher.run(\n        'dragStart',\n        this._createContext(event, this._startDragState)\n      );\n    }\n\n    if (this._dragging) {\n      this._dispatcher.run('dragMove', this._createContext(event, state));\n    }\n  };\n\n  private _moveOn = (event: PointerEvent) => {\n    const state = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: this._startX,\n      startY: this._startY,\n      last: this._lastDragState,\n    });\n\n    this._dispatcher.run('pointerMove', this._createContext(event, state));\n  };\n\n  private _out = (event: PointerEvent) => {\n    const state = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: -Infinity,\n      startY: -Infinity,\n      last: null,\n    });\n\n    this._dispatcher.run('pointerOut', this._createContext(event, state));\n  };\n}\n","import { UIEventState, UIEventStateContext } from '../base.js';\nimport type {\n  EventName,\n  EventScope,\n  UIEventDispatcher,\n} from '../dispatcher.js';\nimport { EventScopeSourceType, EventSourceState } from '../state/source.js';\n\nexport class RangeControl {\n  private _prev: Range | null = null;\n  constructor(private _dispatcher: UIEventDispatcher) {}\n\n  listen() {\n    this._dispatcher.disposables.addFromEvent(\n      document,\n      'selectionchange',\n      this._selectionChange\n    );\n    this._dispatcher.disposables.addFromEvent(\n      document,\n      'compositionstart',\n      this._compositionStart\n    );\n    this._dispatcher.disposables.addFromEvent(\n      document,\n      'compositionend',\n      this._compositionEnd\n    );\n    this._dispatcher.disposables.addFromEvent(\n      document,\n      'compositionupdate',\n      this._compositionUpdate\n    );\n  }\n\n  private _compositionUpdate = (event: Event) => {\n    const scope = this._buildScope('compositionUpdate');\n\n    this._dispatcher.run(\n      'compositionUpdate',\n      this._createContext(event),\n      scope\n    );\n  };\n\n  private _compositionStart = (event: Event) => {\n    const scope = this._buildScope('compositionStart');\n\n    this._dispatcher.run('compositionStart', this._createContext(event), scope);\n  };\n\n  private _compositionEnd = (event: Event) => {\n    const scope = this._buildScope('compositionEnd');\n\n    this._dispatcher.run('compositionEnd', this._createContext(event), scope);\n  };\n\n  private _selectionChange = (event: Event) => {\n    if (!this._dispatcher.isActive) return;\n\n    const scope = this._buildScope('selectionChange');\n\n    this._dispatcher.run('selectionChange', this._createContext(event), scope);\n  };\n\n  private _createContext(event: Event) {\n    return UIEventStateContext.from(\n      new UIEventState(event),\n      new EventSourceState({\n        event,\n        sourceType: EventScopeSourceType.Selection,\n      })\n    );\n  }\n\n  private _buildScope = (eventName: EventName) => {\n    let scope: EventScope | undefined;\n    const selection = document.getSelection();\n    if (selection && selection.rangeCount > 0) {\n      const range = selection.getRangeAt(0);\n      scope = this._buildEventScopeByNativeRange(eventName, range);\n      this._prev = range;\n    } else if (this._prev !== null) {\n      scope = this._buildEventScopeByNativeRange(eventName, this._prev);\n      this._prev = null;\n    }\n\n    return scope;\n  };\n\n  private _buildEventScopeByNativeRange(name: EventName, range: Range) {\n    const blocks = this._findBlockElementPath(range);\n    const paths = blocks\n      .map(blockView => {\n        return blockView;\n      })\n      .filter((path): path is string[] => !!path);\n    const flavours = Array.from(\n      new Set(\n        paths\n          .flatMap(path => {\n            return path.map(blockId => {\n              return this._dispatcher.std.page.getBlockById(blockId)?.flavour;\n            });\n          })\n          .filter((flavour): flavour is string => {\n            return !!flavour;\n          })\n      )\n    ).reverse();\n\n    return this._dispatcher.buildEventScope(name, flavours, paths);\n  }\n\n  private _findBlockElementPath(range: Range): string[][] {\n    const start = range.startContainer;\n    const end = range.endContainer;\n    const ancestor = range.commonAncestorContainer;\n    const getBlockView = this._dispatcher.std.view.getNodeView;\n    if (ancestor.nodeType === Node.TEXT_NODE) {\n      const leaf = getBlockView(ancestor);\n      if (leaf) {\n        return [leaf.path];\n      }\n    }\n    const nodes = new Set<Node>();\n\n    let startRecorded = false;\n    const dfsDOMSearch = (current: Node | null, ancestor: Node) => {\n      if (!current) {\n        return;\n      }\n      if (current === ancestor) {\n        return;\n      }\n      if (current === end) {\n        nodes.add(current);\n        startRecorded = false;\n        return;\n      }\n      if (current === start) {\n        startRecorded = true;\n      }\n      if (startRecorded) {\n        if (\n          current.nodeType === Node.TEXT_NODE ||\n          current.nodeType === Node.ELEMENT_NODE\n        ) {\n          nodes.add(current);\n        }\n      }\n      dfsDOMSearch(current.firstChild, ancestor);\n      dfsDOMSearch(current.nextSibling, ancestor);\n    };\n    dfsDOMSearch(ancestor.firstChild, ancestor);\n\n    const blocks = new Set<string[]>();\n    nodes.forEach(node => {\n      const blockView = getBlockView(node);\n      if (!blockView) {\n        return;\n      }\n      if (blocks.has(blockView.path)) {\n        return;\n      }\n      blocks.add(blockView.path);\n    });\n    return Array.from(blocks);\n  }\n}\n","import { DisposableGroup } from '@blocksuite/global/utils';\n\nimport { PathFinder } from '../utils/index.js';\nimport {\n  type UIEventHandler,\n  UIEventState,\n  UIEventStateContext,\n} from './base.js';\nimport { ClipboardControl } from './control/clipboard.js';\nimport { KeyboardControl } from './control/keyboard.js';\nimport { PointerControl } from './control/pointer.js';\nimport { RangeControl } from './control/range.js';\nimport { EventScopeSourceType, EventSourceState } from './state/source.js';\nimport { toLowerCase } from './utils.js';\n\nconst bypassEventNames = [\n  'beforeInput',\n\n  'blur',\n  'focus',\n  'drop',\n  'contextMenu',\n  'wheel',\n] as const;\n\nconst eventNames = [\n  'click',\n  'doubleClick',\n  'tripleClick',\n\n  'pointerDown',\n  'pointerMove',\n  'pointerUp',\n  'pointerOut',\n\n  'dragStart',\n  'dragMove',\n  'dragEnd',\n\n  'keyDown',\n  'keyUp',\n\n  'selectionChange',\n  'compositionStart',\n  'compositionUpdate',\n  'compositionEnd',\n\n  'cut',\n  'copy',\n  'paste',\n\n  ...bypassEventNames,\n] as const;\n\nexport type EventName = (typeof eventNames)[number];\nexport type EventOptions = {\n  flavour?: string;\n  path?: string[];\n};\nexport type EventHandlerRunner = {\n  fn: UIEventHandler;\n  flavour?: string;\n  path?: string[];\n};\n\nexport type EventScope = {\n  runners: EventHandlerRunner[];\n  flavours: string[];\n  paths: string[][];\n};\n\nexport class UIEventDispatcher {\n  disposables = new DisposableGroup();\n\n  private _handlersMap = Object.fromEntries(\n    eventNames.map((name): [EventName, Array<EventHandlerRunner>] => [name, []])\n  ) as Record<EventName, Array<EventHandlerRunner>>;\n\n  private _pointerControl: PointerControl;\n  private _keyboardControl: KeyboardControl;\n  private _rangeControl: RangeControl;\n  private _clipboardControl: ClipboardControl;\n\n  constructor(public std: BlockSuite.Std) {\n    this._pointerControl = new PointerControl(this);\n    this._keyboardControl = new KeyboardControl(this);\n    this._rangeControl = new RangeControl(this);\n    this._clipboardControl = new ClipboardControl(this);\n  }\n\n  private static _activeDispatcher: UIEventDispatcher | null = null;\n\n  get isActive() {\n    return UIEventDispatcher._activeDispatcher === this;\n  }\n\n  activate = () => {\n    const prevDispatcher = UIEventDispatcher._activeDispatcher;\n    if (prevDispatcher === this) return;\n    UIEventDispatcher._activeDispatcher = this;\n    prevDispatcher?.std.selection.clear();\n  };\n\n  deactivate = () => {\n    const prevDispatcher = UIEventDispatcher._activeDispatcher;\n    if (!prevDispatcher) return;\n    if (prevDispatcher !== this) return;\n    UIEventDispatcher._activeDispatcher = null;\n    prevDispatcher.std.selection.clear();\n  };\n\n  mount() {\n    if (this.disposables.disposed) {\n      this.disposables = new DisposableGroup();\n    }\n    this._bindEvents();\n  }\n\n  unmount() {\n    this.disposables.dispose();\n  }\n\n  get host() {\n    return this.std.host;\n  }\n\n  run(name: EventName, context: UIEventStateContext, scope?: EventScope) {\n    const sourceState = context.get('sourceState');\n    if (!scope) {\n      scope = this._getEventScope(name, sourceState);\n      if (!scope) {\n        return;\n      }\n    }\n\n    for (const runner of scope.runners) {\n      const { fn } = runner;\n      const result = fn(context);\n      if (result) {\n        return;\n      }\n    }\n  }\n\n  add(name: EventName, handler: UIEventHandler, options?: EventOptions) {\n    const runner: EventHandlerRunner = {\n      fn: handler,\n      flavour: options?.flavour,\n      path: options?.path,\n    };\n    this._handlersMap[name].unshift(runner);\n    return () => {\n      if (this._handlersMap[name].includes(runner)) {\n        this._handlersMap[name] = this._handlersMap[name].filter(\n          x => x !== runner\n        );\n      }\n    };\n  }\n\n  bindHotkey = (...args: Parameters<KeyboardControl['bindHotkey']>) =>\n    this._keyboardControl.bindHotkey(...args);\n\n  private get _currentSelections() {\n    return this.std.selection.value;\n  }\n\n  private _getEventScope(name: EventName, state: EventSourceState) {\n    const handlers = this._handlersMap[name];\n    if (!handlers) return;\n\n    let output: EventScope | undefined;\n\n    switch (state.sourceType) {\n      case EventScopeSourceType.Selection: {\n        output = this._buildEventScopeBySelection(name);\n        break;\n      }\n      case EventScopeSourceType.Target: {\n        output = this._buildEventScopeByTarget(\n          name,\n          state.event.target as Node\n        );\n        break;\n      }\n      default: {\n        throw new Error(`Unknown event scope source: ${state.sourceType}`);\n      }\n    }\n\n    return output;\n  }\n\n  buildEventScope(\n    name: EventName,\n    flavours: string[],\n    paths: string[][]\n  ): EventScope | undefined {\n    const handlers = this._handlersMap[name];\n    if (!handlers) return;\n\n    const globalEvents = handlers.filter(\n      handler => handler.flavour === undefined && handler.path === undefined\n    );\n\n    const pathEvents = handlers.filter(handler => {\n      const _path = handler.path;\n      if (_path === undefined) return false;\n      return paths.some(path => PathFinder.includes(path, _path));\n    });\n\n    const flavourEvents = handlers.filter(\n      handler => handler.flavour && flavours.includes(handler.flavour)\n    );\n\n    return {\n      runners: pathEvents.concat(flavourEvents).concat(globalEvents),\n      flavours,\n      paths,\n    };\n  }\n\n  private _buildEventScopeByTarget(name: EventName, target: Node) {\n    const handlers = this._handlersMap[name];\n    if (!handlers) return;\n\n    const path = this.std.view.getNodeView(target)?.path;\n    if (!path) {\n      return this._buildEventScopeBySelection(name);\n    }\n\n    const flavours = path\n      .map(blockId => {\n        return this.std.page.getBlockById(blockId)?.flavour;\n      })\n      .filter((flavour): flavour is string => {\n        return !!flavour;\n      })\n      .reverse();\n\n    return this.buildEventScope(name, flavours, [path]);\n  }\n\n  private _buildEventScopeBySelection(name: EventName) {\n    const handlers = this._handlersMap[name];\n    if (!handlers) return;\n\n    const selections = this._currentSelections;\n    const seen: Record<string, boolean> = {};\n\n    const flavours = selections\n      .map(selection => selection.path)\n      .flatMap(path => {\n        return path.map(blockId => {\n          return this.std.page.getBlockById(blockId)?.flavour;\n        });\n      })\n      .filter((flavour): flavour is string => {\n        if (!flavour) return false;\n        if (seen[flavour]) return false;\n        seen[flavour] = true;\n        return true;\n      })\n      .reverse();\n\n    const paths = selections.map(selection => selection.path);\n\n    return this.buildEventScope(name, flavours, paths);\n  }\n\n  private _bindEvents() {\n    bypassEventNames.forEach(eventName => {\n      this.disposables.addFromEvent(\n        this.host,\n        toLowerCase(eventName),\n        event => {\n          this.run(\n            eventName,\n            UIEventStateContext.from(\n              new UIEventState(event),\n              new EventSourceState({\n                event,\n                sourceType: EventScopeSourceType.Selection,\n              })\n            )\n          );\n        }\n      );\n    });\n\n    this._pointerControl.listen();\n    this._keyboardControl.listen();\n    this._rangeControl.listen();\n    this._clipboardControl.listen();\n  }\n}\n","import { PathFinder } from '../utils/index.js';\n\ntype SelectionConstructor<T = unknown> = {\n  new (...args: unknown[]): T;\n  type: string;\n  group: string;\n};\n\nexport type BaseSelectionOptions = {\n  path: string[];\n};\n\nexport abstract class BaseSelection {\n  static readonly type: string;\n  static readonly group: string;\n  readonly path: string[];\n\n  constructor({ path }: BaseSelectionOptions) {\n    this.path = path;\n  }\n\n  get blockId(): string {\n    return PathFinder.id(this.path);\n  }\n\n  is<T extends BlockSuite.SelectionType>(\n    type: T\n  ): this is BlockSuite.SelectionInstance[T] {\n    return this.type === type;\n  }\n\n  get type(): BlockSuite.SelectionType {\n    return (this.constructor as SelectionConstructor)\n      .type as BlockSuite.SelectionType;\n  }\n\n  get group(): string {\n    return (this.constructor as SelectionConstructor).group;\n  }\n\n  abstract equals(other: BaseSelection): boolean;\n\n  abstract toJSON(): Record<string, unknown>;\n\n  static fromJSON(_: Record<string, unknown>): BaseSelection {\n    throw new Error('You must override this method');\n  }\n}\n","import z from 'zod';\n\nimport { PathFinder } from '../../utils/index.js';\nimport { BaseSelection } from '../base.js';\n\nconst BlockSelectionSchema = z.object({\n  path: z.array(z.string()),\n});\n\nexport class BlockSelection extends BaseSelection {\n  static override type = 'block';\n  static override group = 'note';\n\n  override equals(other: BaseSelection): boolean {\n    if (other instanceof BlockSelection) {\n      return PathFinder.equals(this.path, other.path);\n    }\n    return false;\n  }\n\n  override toJSON(): Record<string, unknown> {\n    return {\n      type: 'block',\n      path: this.path,\n    };\n  }\n\n  static override fromJSON(json: Record<string, unknown>): BlockSelection {\n    BlockSelectionSchema.parse(json);\n    return new BlockSelection({\n      path: json.path as string[],\n    });\n  }\n}\n\ndeclare global {\n  namespace BlockSuite {\n    interface Selection {\n      block: typeof BlockSelection;\n    }\n  }\n}\n","import z from 'zod';\n\nimport { BaseSelection } from '../base.js';\n\nconst CursorSelectionSchema = z.object({\n  x: z.number(),\n  y: z.number(),\n});\n\nexport class CursorSelection extends BaseSelection {\n  static override type = 'cursor';\n  static override group = 'edgeless';\n\n  readonly x: number;\n  readonly y: number;\n\n  constructor(x: number, y: number) {\n    super({ path: [] });\n    this.x = x;\n    this.y = y;\n  }\n\n  override equals(other: BaseSelection): boolean {\n    if (other instanceof CursorSelection) {\n      return this.x === other.x && this.y === other.y;\n    }\n\n    return false;\n  }\n\n  override toJSON(): Record<string, unknown> {\n    return {\n      type: 'cursor',\n      x: this.x,\n      y: this.y,\n    };\n  }\n\n  static override fromJSON(json: Record<string, unknown>): CursorSelection {\n    CursorSelectionSchema.parse(json);\n    return new CursorSelection(json.x as number, json.y as number);\n  }\n}\n\ndeclare global {\n  namespace BlockSuite {\n    interface Selection {\n      cursor: typeof CursorSelection;\n    }\n  }\n}\n","import z from 'zod';\n\nimport { BaseSelection } from '../base.js';\n\nconst SurfaceSelectionSchema = z.object({\n  elements: z.array(z.string()),\n  editing: z.boolean(),\n});\n\nexport class SurfaceSelection extends BaseSelection {\n  static override type = 'surface';\n  static override group = 'edgeless';\n\n  readonly elements: string[];\n  readonly editing: boolean;\n\n  constructor(path: string[], elements: string[], editing: boolean) {\n    super({ path });\n\n    this.elements = elements;\n    this.editing = editing;\n  }\n\n  isEmpty() {\n    return this.elements.length === 0 && !this.editing;\n  }\n\n  override equals(other: BaseSelection): boolean {\n    if (other instanceof SurfaceSelection) {\n      return (\n        this.blockId === other.blockId &&\n        this.elements.length === other.elements.length &&\n        this.elements.every((id, idx) => id === other.elements[idx]) &&\n        this.editing === other.editing\n      );\n    }\n\n    return false;\n  }\n\n  override toJSON(): Record<string, unknown> {\n    return {\n      type: 'surface',\n      path: this.path,\n      elements: this.elements,\n      editing: this.editing,\n    };\n  }\n\n  static override fromJSON(\n    json:\n      | Record<string, unknown>\n      | { path: string[]; elements: string[]; editing: boolean }\n  ): SurfaceSelection {\n    SurfaceSelectionSchema.parse(json);\n    return new SurfaceSelection(\n      json.path as string[],\n      json.elements as string[],\n      json.editing as boolean\n    );\n  }\n}\n\ndeclare global {\n  namespace BlockSuite {\n    interface Selection {\n      surface: typeof SurfaceSelection;\n    }\n  }\n}\n","import z from 'zod';\n\nimport { PathFinder } from '../../utils/path-finder.js';\nimport { BaseSelection } from '../base.js';\n\nexport type TextRangePoint = {\n  path: string[];\n  index: number;\n  length: number;\n};\n\nexport type TextSelectionProps = {\n  from: TextRangePoint;\n  to: TextRangePoint | null;\n  isReverse?: boolean;\n};\n\nconst TextSelectionSchema = z.object({\n  from: z.object({\n    path: z.array(z.string()),\n    index: z.number(),\n    length: z.number(),\n  }),\n  to: z\n    .object({\n      path: z.array(z.string()),\n      index: z.number(),\n      length: z.number(),\n    })\n    .nullable(),\n  // The `optional()` is for backward compatibility,\n  // since `isReverse` may not exist in remote selection.\n  isReverse: z.boolean().optional(),\n});\n\nexport class TextSelection extends BaseSelection {\n  static override type = 'text';\n  static override group = 'note';\n\n  from: TextRangePoint;\n\n  to: TextRangePoint | null;\n\n  isReverse: boolean;\n\n  constructor({ from, to, isReverse }: TextSelectionProps) {\n    super({\n      path: from.path,\n    });\n    this.from = from;\n\n    this.to = this._equalPoint(from, to) ? null : to;\n\n    this.isReverse = !!isReverse;\n  }\n\n  get start(): TextRangePoint {\n    return this.isReverse ? this.to ?? this.from : this.from;\n  }\n\n  get end(): TextRangePoint {\n    return this.isReverse ? this.from : this.to ?? this.from;\n  }\n\n  empty(): boolean {\n    return !!this.to;\n  }\n\n  private _equalPoint(\n    a: TextRangePoint | null,\n    b: TextRangePoint | null\n  ): boolean {\n    if (a && b) {\n      return (\n        PathFinder.equals(a.path, b.path) &&\n        a.index === b.index &&\n        a.length === b.length\n      );\n    }\n\n    return a === b;\n  }\n\n  override equals(other: BaseSelection): boolean {\n    if (other instanceof TextSelection) {\n      return (\n        PathFinder.equals(this.path, other.path) &&\n        this._equalPoint(other.from, this.from) &&\n        this._equalPoint(other.to, this.to)\n      );\n    }\n    return false;\n  }\n  override toJSON(): Record<string, unknown> {\n    return {\n      type: 'text',\n      from: this.from,\n      to: this.to,\n      isReverse: this.isReverse,\n    };\n  }\n\n  static override fromJSON(json: Record<string, unknown>): TextSelection {\n    TextSelectionSchema.parse(json);\n    return new TextSelection({\n      from: json.from as TextRangePoint,\n      to: json.to as TextRangePoint | null,\n      isReverse: !!json.isReverse,\n    });\n  }\n\n  isCollapsed(): boolean {\n    return this.to === null && this.from.length === 0;\n  }\n\n  isInSameBlock(): boolean {\n    return this.to === null || PathFinder.equals(this.from.path, this.to.path);\n  }\n}\n\ndeclare global {\n  namespace BlockSuite {\n    interface Selection {\n      text: typeof TextSelection;\n    }\n  }\n}\n","import { DisposableGroup, Slot } from '@blocksuite/global/utils';\nimport type { StackItem } from '@blocksuite/store';\n\nimport type { BaseSelection } from './base.js';\nimport {\n  BlockSelection,\n  CursorSelection,\n  SurfaceSelection,\n  TextSelection,\n} from './variants/index.js';\n\ninterface SelectionConstructor {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  new (...args: any[]): BaseSelection;\n\n  type: string;\n  fromJSON(json: Record<string, unknown>): BaseSelection;\n}\n\nexport class SelectionManager {\n  disposables = new DisposableGroup();\n  private _selectionConstructors: Record<string, SelectionConstructor> = {};\n\n  slots = {\n    changed: new Slot<BaseSelection[]>(),\n    remoteChanged: new Slot<Map<number, BaseSelection[]>>(),\n  };\n\n  constructor(public std: BlockSuite.Std) {\n    this._setupDefaultSelections();\n  }\n\n  register(ctor: SelectionConstructor | SelectionConstructor[]) {\n    [ctor].flat().forEach(ctor => {\n      this._selectionConstructors[ctor.type] = ctor;\n    });\n    return this;\n  }\n\n  private get _store() {\n    return this.std.workspace.awarenessStore;\n  }\n\n  private _setupDefaultSelections() {\n    this.register([\n      TextSelection,\n      BlockSelection,\n      SurfaceSelection,\n      CursorSelection,\n    ]);\n  }\n\n  private _jsonToSelection = (json: Record<string, unknown>) => {\n    const ctor = this._selectionConstructors[json.type as string];\n    if (!ctor) {\n      throw new Error(`Unknown selection type: ${json.type}`);\n    }\n    return ctor.fromJSON(json);\n  };\n\n  create<T extends BlockSuite.SelectionType>(\n    type: T,\n    ...args: ConstructorParameters<BlockSuite.Selection[T]>\n  ): BlockSuite.SelectionInstance[T] {\n    const ctor = this._selectionConstructors[type];\n    if (!ctor) {\n      throw new Error(`Unknown selection type: ${type}`);\n    }\n    return new ctor(...args) as BlockSuite.SelectionInstance[T];\n  }\n\n  get value() {\n    return this._store.getLocalSelection().map(json => {\n      return this._jsonToSelection(json);\n    });\n  }\n\n  fromJSON(json: Record<string, unknown>[]) {\n    const selections = json.map(json => {\n      return this._jsonToSelection(json);\n    });\n    return this.set(selections);\n  }\n\n  set(selections: BaseSelection[]) {\n    this._store.setLocalSelection(selections.map(s => s.toJSON()));\n    this.slots.changed.emit(selections);\n  }\n\n  setGroup(group: string, selections: BaseSelection[]) {\n    const current = this.value.filter(s => s.group !== group);\n    this.set([...current, ...selections]);\n  }\n\n  getGroup(group: string) {\n    return this.value.filter(s => s.group === group);\n  }\n\n  update(fn: (currentSelections: BaseSelection[]) => BaseSelection[]) {\n    const selections = fn(this.value);\n    this.set(selections);\n  }\n\n  clear(types?: string[]) {\n    if (types) {\n      const values = this.value.filter(\n        selection => !types.includes(selection.type)\n      );\n      this.set(values);\n    } else {\n      this.set([]);\n    }\n  }\n\n  find<T extends BlockSuite.SelectionType>(type: T) {\n    return this.value.find((sel): sel is BlockSuite.SelectionInstance[T] =>\n      sel.is(type)\n    );\n  }\n\n  filter<T extends BlockSuite.SelectionType>(type: T) {\n    return this.value.filter((sel): sel is BlockSuite.SelectionInstance[T] =>\n      sel.is(type)\n    );\n  }\n\n  get remoteSelections() {\n    const map = new Map<number, BaseSelection[]>();\n    this._store.getStates().forEach((state, id) => {\n      if (id === this._store.awareness.clientID) return;\n      const selections = state.selection\n        .map(json => {\n          try {\n            return this._jsonToSelection(json);\n          } catch (error) {\n            console.error('Parse remote selection failed:', id, json, error);\n            return null;\n          }\n        })\n        .filter((sel): sel is BaseSelection => !!sel);\n      map.set(id, selections);\n    });\n    return map;\n  }\n\n  private _itemAdded = (event: { stackItem: StackItem }) => {\n    event.stackItem.meta.set('selection-state', this.value);\n  };\n\n  private _itemPopped = (event: { stackItem: StackItem }) => {\n    const selection = event.stackItem.meta.get('selection-state');\n    if (selection) {\n      this.set(selection as BaseSelection[]);\n    }\n  };\n\n  mount() {\n    if (this.disposables.disposed) {\n      this.disposables = new DisposableGroup();\n    }\n    this.std.page.history.on('stack-item-added', this._itemAdded);\n    this.std.page.history.on('stack-item-popped', this._itemPopped);\n    this.disposables.add(\n      this._store.slots.update.on(({ id }) => {\n        if (id === this._store.awareness.clientID) return;\n        this.slots.remoteChanged.emit(this.remoteSelections);\n      })\n    );\n  }\n\n  unmount() {\n    this.std.page.history.off('stack-item-added', this._itemAdded);\n    this.std.page.history.off('stack-item-popped', this._itemPopped);\n    this.slots.changed.dispose();\n    this.disposables.dispose();\n    this.clear();\n  }\n\n  dispose() {\n    Object.values(this.slots).forEach(slot => slot.dispose());\n    this.disposables.dispose();\n  }\n}\n","import type { BlockService } from '../service/index.js';\nimport type { BlockSpec } from './index.js';\n\nexport class SpecStore {\n  private _specs: Map<string, BlockSpec> = new Map();\n  private _services: Map<string, BlockService> = new Map();\n\n  constructor(public std: BlockSuite.Std) {}\n\n  dispose() {\n    this._services.forEach(service => {\n      service.dispose();\n      service.unmounted();\n    });\n    this._services.clear();\n  }\n\n  applySpecs(specs: BlockSpec[]) {\n    const oldSpecs = this._specs;\n    const newSpecs = this._buildSpecMap(specs);\n    this._diffServices(oldSpecs, newSpecs);\n    this._specs = newSpecs;\n  }\n\n  getView(flavour: string) {\n    const spec = this._specs.get(flavour);\n    if (!spec) {\n      return null;\n    }\n\n    return spec.view;\n  }\n\n  getService(flavour: string) {\n    return this._services.get(flavour);\n  }\n\n  private _diffServices(\n    oldSpecs: Map<string, BlockSpec>,\n    newSpecs: Map<string, BlockSpec>\n  ) {\n    oldSpecs.forEach((oldSpec, flavour) => {\n      if (\n        newSpecs.has(flavour) &&\n        newSpecs.get(flavour)?.service === oldSpec.service\n      ) {\n        return;\n      }\n\n      const service = this._services.get(flavour);\n      if (service) {\n        service.dispose();\n        service.unmounted();\n      }\n      this._services.delete(flavour);\n    });\n    newSpecs.forEach((newSpec, flavour) => {\n      if (this._services.has(flavour)) {\n        return;\n      }\n\n      if (!newSpec.service) {\n        return;\n      }\n\n      const service = new newSpec.service({\n        flavour,\n        std: this.std,\n      });\n      this._services.set(flavour, service);\n      service.mounted();\n    });\n  }\n\n  private _buildSpecMap(specs: Array<BlockSpec>) {\n    const specMap = new Map<string, BlockSpec>();\n    specs.forEach(spec => {\n      specMap.set(spec.schema.model.flavour, spec);\n    });\n    return specMap;\n  }\n}\n","import { assertExists } from '@blocksuite/global/utils';\n\nimport { PathFinder } from '../utils/index.js';\nimport type { NodeView, NodeViewTree, SpecToNodeView } from './type.js';\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport interface BlockSuiteViewSpec<T = any> {\n  type: BlockSuite.ViewType;\n  fromDOM: (node: Node) => null | NodeView<T>;\n  toDOM: (nodeView: NodeView<T>) => Element;\n  getChildren: (node: Element) => Element[];\n}\n\nconst observeOptions = {\n  childList: true,\n  subtree: true,\n};\n\nexport class ViewStore {\n  private _cachedTree: NodeViewTree | null = null;\n  private _cachedPath: Map<Node, NodeView[]> = new Map();\n  private _observer: MutationObserver;\n  readonly viewSpec = new Set<BlockSuiteViewSpec>();\n\n  constructor(public std: BlockSuite.Std) {\n    this._observer = new MutationObserver(() => {\n      this._cachedPath.clear();\n      this._cachedTree = null;\n    });\n  }\n\n  getChildren = (path: string[]): NodeViewTree[] => {\n    const node = this.fromPath(path);\n    if (!node) {\n      return [];\n    }\n    return node.children;\n  };\n\n  register<T extends BlockSuite.ViewType>(spec: BlockSuite.View[T]) {\n    this.viewSpec.add(spec);\n  }\n\n  getNodeView = (node: Node): NodeView | null => {\n    for (const [_, spec] of this.viewSpec.entries()) {\n      const view = spec.fromDOM(node);\n      if (view) {\n        return {\n          ...view,\n        } as NodeView;\n      }\n    }\n    return null;\n  };\n\n  calculatePath = (node: Node) => {\n    const path = this._calculateNodeViewPath(node);\n    return path.map(x => x.id);\n  };\n\n  private _getViewSpec = (type: string) => {\n    return Array.from(this.viewSpec).find(spec => spec.type === type);\n  };\n\n  private _calculateNodeViewPath = (node: Node) => {\n    if (this._cachedPath.has(node)) {\n      return this._cachedPath.get(node) as NodeView[];\n    }\n    const host = this.std.host;\n\n    const iterate = (\n      node: Node | null,\n      path: Array<NodeView>\n    ): Array<NodeView> => {\n      if (!node || node === host) return path;\n      const nodeView = this.getNodeView(node);\n      if (!nodeView) {\n        return path;\n      }\n      const spec = this._getViewSpec(nodeView.type);\n      assertExists(spec);\n      const next = spec.toDOM(nodeView as never).parentElement;\n      if (!next) {\n        return path;\n      }\n      return iterate(next, path.concat(nodeView));\n    };\n\n    const path = iterate(node, []).reverse();\n    this._cachedPath.set(node, path);\n    return path;\n  };\n\n  getNodeViewTree = (): NodeViewTree => {\n    if (this._cachedTree) {\n      return this._cachedTree;\n    }\n\n    const iterate = (node: Node): NodeViewTree => {\n      const nodeView = this.getNodeView(node);\n      if (!nodeView) {\n        throw new Error('nodeView not found');\n      }\n\n      const spec = this._getViewSpec(nodeView.type);\n      assertExists(spec);\n\n      const children = spec\n        .getChildren(spec.toDOM(nodeView as never))\n        .map((child: Node) => iterate(child));\n\n      return {\n        ...nodeView,\n        children,\n      };\n    };\n    const firstBlock = this.std.host.querySelector('[data-block-id]');\n    assertExists(firstBlock);\n\n    const tree = {\n      id: '__root__',\n      path: [],\n      children: [iterate(firstBlock)],\n    } as Partial<NodeViewTree> as NodeViewTree;\n    this._cachedTree = tree;\n    return tree;\n  };\n\n  fromPath = (path: string[]) => {\n    const tree = this.getNodeViewTree();\n    return path.reduce((curr: NodeViewTree | null, id) => {\n      if (!curr) {\n        return null;\n      }\n      const child = curr.children.find(x => x.id === id);\n      if (!child) {\n        return null;\n      }\n      return child;\n    }, tree);\n  };\n\n  viewFromPath<T extends BlockSuite.ViewType>(\n    type: T,\n    path: string[]\n  ): null | SpecToNodeView<BlockSuite.View[T]>;\n  viewFromPath<T extends BlockSuiteViewSpec>(\n    type: string,\n    path: string[]\n  ): null | SpecToNodeView<T>;\n  viewFromPath(\n    type: string,\n    path: string[]\n  ): null | SpecToNodeView<BlockSuiteViewSpec> {\n    const tree = this.fromPath(path);\n    if (!tree || tree.type !== type) {\n      return null;\n    }\n    return tree.view as SpecToNodeView<BlockSuiteViewSpec>;\n  }\n\n  walkThrough = (\n    fn: (\n      nodeView: NodeViewTree,\n      index: number,\n      parent: NodeViewTree\n    ) => undefined | null | true,\n    path: string[] = []\n  ) => {\n    const tree = this.fromPath(path);\n    assertExists(tree, `Invalid path to get node in view: ${path}`);\n\n    const iterate =\n      (parent: NodeViewTree) => (node: NodeViewTree, index: number) => {\n        const result = fn(node, index, parent);\n        if (result === true) {\n          return;\n        }\n        node.children.forEach(iterate(node));\n      };\n\n    tree.children.forEach(iterate(tree));\n  };\n\n  getParent = (path: string[]) => {\n    if (path.length === 0) {\n      return null;\n    }\n    return this.fromPath(PathFinder.parent(path));\n  };\n\n  findPrev = (\n    path: string[],\n    fn: (\n      nodeView: NodeViewTree,\n      index: number,\n      parent: NodeViewTree\n    ) => undefined | null | boolean\n  ): NodeViewTree | null => {\n    const getPrev = (path: string[]) => {\n      const parent = this.getParent(path);\n      if (!parent) {\n        return null;\n      }\n      const index = this._indexOf(path, parent);\n      if (index === -1) {\n        return null;\n      }\n      if (index === 0) {\n        const grandParent = this.getParent(PathFinder.parent(path));\n        if (!grandParent) return null;\n        return {\n          nodeView: parent,\n          parent: grandParent,\n          index: this._indexOf(PathFinder.parent(path), grandParent),\n        };\n      }\n      return {\n        nodeView: parent.children[index - 1],\n        parent,\n        index: index - 1,\n      };\n    };\n\n    let output: null | NodeViewTree = null;\n    const iterate = (path: string[]) => {\n      const state = getPrev(path);\n      if (!state) {\n        return;\n      }\n      const { nodeView, parent, index } = state;\n      const result = fn(nodeView, index, parent);\n      if (result) {\n        output = nodeView;\n\n        return;\n      }\n\n      iterate(nodeView.path);\n    };\n\n    iterate(path);\n\n    return output;\n  };\n\n  findNext = (\n    path: string[],\n    fn: (\n      nodeView: NodeViewTree,\n      index: number,\n      parent: NodeViewTree\n    ) => undefined | null | true\n  ): NodeViewTree | null => {\n    const getNext = (path: string[]) => {\n      const parent = this.getParent(path);\n      if (!parent) {\n        return null;\n      }\n      const index = this._indexOf(path, parent);\n      if (index === -1) {\n        return null;\n      }\n      if (index === parent.children.length - 1) {\n        const grandParent = this.getParent(PathFinder.parent(path));\n        if (!grandParent) return null;\n        return {\n          nodeView: parent,\n          parent: grandParent,\n          index: this._indexOf(PathFinder.parent(path), grandParent),\n        };\n      }\n      return {\n        nodeView: parent.children[index + 1],\n        parent,\n        index: index + 1,\n      };\n    };\n\n    let output: null | NodeViewTree = null;\n    const iterate = (path: string[]) => {\n      const state = getNext(path);\n      if (!state) {\n        return;\n      }\n      const { nodeView, parent, index } = state;\n      const result = fn(nodeView, index, parent);\n      if (result) {\n        output = nodeView;\n\n        return;\n      }\n\n      iterate(nodeView.path);\n    };\n\n    iterate(path);\n\n    return output;\n  };\n\n  indexOf = (path: string[]) => {\n    const parent = this.getParent(path);\n    if (!parent) {\n      return -1;\n    }\n    return this._indexOf(path, parent);\n  };\n\n  mount() {\n    this._observer.observe(this.std.host, observeOptions);\n  }\n\n  unmount() {\n    this._cachedPath.clear();\n    this._cachedTree = null;\n    this._observer.disconnect();\n    this.viewSpec.clear();\n  }\n\n  private _indexOf = (path: string[], parent: NodeViewTree) => {\n    return parent.children.findIndex(x => x.id === path[path.length - 1]);\n  };\n}\n\ndeclare global {\n  namespace BlockSuite {\n    type View = {\n      [P in keyof NodeViewType]: BlockSuiteViewSpec<NodeViewType[P]>;\n    };\n\n    type ViewType = keyof View;\n  }\n}\n","import type { Page, Workspace } from '@blocksuite/store';\n\nimport { Clipboard } from '../clipboard/index.js';\nimport { CommandManager } from '../command/index.js';\nimport { UIEventDispatcher } from '../event/index.js';\nimport { SelectionManager } from '../selection/index.js';\nimport { SpecStore } from '../spec/index.js';\nimport { ViewStore } from '../view/index.js';\n\nexport interface BlockStdOptions {\n  host: HTMLElement;\n  workspace: Workspace;\n  page: Page;\n}\n\nexport class BlockStdScope {\n  readonly page: Page;\n  readonly workspace: Workspace;\n  readonly event: UIEventDispatcher;\n  readonly selection: SelectionManager;\n  readonly command: CommandManager;\n  readonly host: HTMLElement;\n  readonly spec: SpecStore;\n  readonly view: ViewStore;\n  readonly clipboard: Clipboard;\n\n  constructor(options: BlockStdOptions) {\n    this.host = options.host;\n    this.workspace = options.workspace;\n    this.page = options.page;\n    this.event = new UIEventDispatcher(this);\n    this.selection = new SelectionManager(this);\n    this.command = new CommandManager(this);\n    this.spec = new SpecStore(this);\n    this.view = new ViewStore(this);\n    this.clipboard = new Clipboard(this);\n  }\n\n  mount() {\n    this.selection.mount();\n    this.event.mount();\n    this.view.mount();\n  }\n\n  unmount() {\n    this.event.unmount();\n    this.selection.unmount();\n    this.view.unmount();\n    this.spec.dispose();\n  }\n}\n\ntype Values<T> = T[keyof T] extends never ? unknown : T[keyof T];\n\ndeclare global {\n  namespace BlockSuite {\n    interface ComponentType {}\n    interface NodeViewType {}\n\n    type Component = Values<ComponentType>;\n    type NodeView = Values<NodeViewType>;\n\n    type Std = BlockStdScope;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t=globalThis,e=t.ShadowRoot&&(void 0===t.ShadyCSS||t.ShadyCSS.nativeShadow)&&\"adoptedStyleSheets\"in Document.prototype&&\"replace\"in CSSStyleSheet.prototype,s=Symbol(),o=new WeakMap;class n{constructor(t,e,o){if(this._$cssResult$=!0,o!==s)throw Error(\"CSSResult is not constructable. Use `unsafeCSS` or `css` instead.\");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const s=this.t;if(e&&void 0===t){const e=void 0!==s&&1===s.length;e&&(t=o.get(s)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),e&&o.set(s,t))}return t}toString(){return this.cssText}}const r=t=>new n(\"string\"==typeof t?t:t+\"\",void 0,s),i=(t,...e)=>{const o=1===t.length?t[0]:e.reduce(((e,s,o)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if(\"number\"==typeof t)return t;throw Error(\"Value passed to 'css' function must be a 'css' function result: \"+t+\". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.\")})(s)+t[o+1]),t[0]);return new n(o,t,s)},S=(s,o)=>{if(e)s.adoptedStyleSheets=o.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet));else for(const e of o){const o=document.createElement(\"style\"),n=t.litNonce;void 0!==n&&o.setAttribute(\"nonce\",n),o.textContent=e.cssText,s.appendChild(o)}},c=e?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e=\"\";for(const s of t.cssRules)e+=s.cssText;return r(e)})(t):t;export{n as CSSResult,S as adoptStyles,i as css,c as getCompatibleStyle,e as supportsAdoptingStyleSheets,r as unsafeCSS};\n//# sourceMappingURL=css-tag.js.map\n","import{getCompatibleStyle as t,adoptStyles as s}from\"./css-tag.js\";export{CSSResult,adoptStyles,css,getCompatibleStyle,supportsAdoptingStyleSheets,unsafeCSS}from\"./css-tag.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const{is:i,defineProperty:e,getOwnPropertyDescriptor:r,getOwnPropertyNames:h,getOwnPropertySymbols:o,getPrototypeOf:n}=Object,a=globalThis,c=a.trustedTypes,l=c?c.emptyScript:\"\",p=a.reactiveElementPolyfillSupport,d=(t,s)=>t,u={toAttribute(t,s){switch(s){case Boolean:t=t?l:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,s){let i=t;switch(s){case Boolean:i=null!==t;break;case Number:i=null===t?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch(t){i=null}}return i}},f=(t,s)=>!i(t,s),y={attribute:!0,type:String,converter:u,reflect:!1,hasChanged:f};Symbol.metadata??=Symbol(\"metadata\"),a.litPropertyMetadata??=new WeakMap;class b extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,s=y){if(s.state&&(s.attribute=!1),this._$Ei(),this.elementProperties.set(t,s),!s.noAccessor){const i=Symbol(),r=this.getPropertyDescriptor(t,i,s);void 0!==r&&e(this.prototype,t,r)}}static getPropertyDescriptor(t,s,i){const{get:e,set:h}=r(this.prototype,t)??{get(){return this[s]},set(t){this[s]=t}};return{get(){return e?.call(this)},set(s){const r=e?.call(this);h.call(this,s),this.requestUpdate(t,r,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??y}static _$Ei(){if(this.hasOwnProperty(d(\"elementProperties\")))return;const t=n(this);t.finalize(),void 0!==t.l&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(d(\"finalized\")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(d(\"properties\"))){const t=this.properties,s=[...h(t),...o(t)];for(const i of s)this.createProperty(i,t[i])}const t=this[Symbol.metadata];if(null!==t){const s=litPropertyMetadata.get(t);if(void 0!==s)for(const[t,i]of s)this.elementProperties.set(t,i)}this._$Eh=new Map;for(const[t,s]of this.elementProperties){const i=this._$Eu(t,s);void 0!==i&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(s){const i=[];if(Array.isArray(s)){const e=new Set(s.flat(1/0).reverse());for(const s of e)i.unshift(t(s))}else void 0!==s&&i.push(t(s));return i}static _$Eu(t,s){const i=s.attribute;return!1===i?void 0:\"string\"==typeof i?i:\"string\"==typeof t?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$Eg=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$ES(),this.requestUpdate(),this.constructor.l?.forEach((t=>t(this)))}addController(t){(this._$E_??=new Set).add(t),void 0!==this.renderRoot&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$E_?.delete(t)}_$ES(){const t=new Map,s=this.constructor.elementProperties;for(const i of s.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return s(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$E_?.forEach((t=>t.hostConnected?.()))}enableUpdating(t){}disconnectedCallback(){this._$E_?.forEach((t=>t.hostDisconnected?.()))}attributeChangedCallback(t,s,i){this._$AK(t,i)}_$EO(t,s){const i=this.constructor.elementProperties.get(t),e=this.constructor._$Eu(t,i);if(void 0!==e&&!0===i.reflect){const r=(void 0!==i.converter?.toAttribute?i.converter:u).toAttribute(s,i.type);this._$Em=t,null==r?this.removeAttribute(e):this.setAttribute(e,r),this._$Em=null}}_$AK(t,s){const i=this.constructor,e=i._$Eh.get(t);if(void 0!==e&&this._$Em!==e){const t=i.getPropertyOptions(e),r=\"function\"==typeof t.converter?{fromAttribute:t.converter}:void 0!==t.converter?.fromAttribute?t.converter:u;this._$Em=e,this[e]=r.fromAttribute(s,t.type),this._$Em=null}}requestUpdate(t,s,i){if(void 0!==t){if(i??=this.constructor.getPropertyOptions(t),!(i.hasChanged??f)(this[t],s))return;this.C(t,s,i)}!1===this.isUpdatePending&&(this._$Eg=this._$EP())}C(t,s,i){this._$AL.has(t)||this._$AL.set(t,s),!0===i.reflect&&this._$Em!==t&&(this._$ET??=new Set).add(t)}async _$EP(){this.isUpdatePending=!0;try{await this._$Eg}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[t,s]of this._$Ep)this[t]=s;this._$Ep=void 0}const t=this.constructor.elementProperties;if(t.size>0)for(const[s,i]of t)!0!==i.wrapped||this._$AL.has(s)||void 0===this[s]||this.C(s,this[s],i)}let t=!1;const s=this._$AL;try{t=this.shouldUpdate(s),t?(this.willUpdate(s),this._$E_?.forEach((t=>t.hostUpdate?.())),this.update(s)):this._$Ej()}catch(s){throw t=!1,this._$Ej(),s}t&&this._$AE(s)}willUpdate(t){}_$AE(t){this._$E_?.forEach((t=>t.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$Ej(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Eg}shouldUpdate(t){return!0}update(t){this._$ET&&=this._$ET.forEach((t=>this._$EO(t,this[t]))),this._$Ej()}updated(t){}firstUpdated(t){}}b.elementStyles=[],b.shadowRootOptions={mode:\"open\"},b[d(\"elementProperties\")]=new Map,b[d(\"finalized\")]=new Map,p?.({ReactiveElement:b}),(a.reactiveElementVersions??=[]).push(\"2.0.3\");export{b as ReactiveElement,u as defaultConverter,f as notEqual};\n//# sourceMappingURL=reactive-element.js.map\n","import{ReactiveElement as t}from\"@lit/reactive-element\";export*from\"@lit/reactive-element\";import{render as e,noChange as i}from\"lit-html\";export*from\"lit-html\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */class s extends t{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const i=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=e(i,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return i}}s._$litElement$=!0,s[(\"finalized\",\"finalized\")]=!0,globalThis.litElementHydrateSupport?.({LitElement:s});const r=globalThis.litElementPolyfillSupport;r?.({LitElement:s});const o={_$AK:(t,e,i)=>{t._$AK(e,i)},_$AL:t=>t._$AL};(globalThis.litElementVersions??=[]).push(\"4.0.3\");export{s as LitElement,o as _$LE};\n//# sourceMappingURL=lit-element.js.map\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t=t=>(e,o)=>{void 0!==o?o.addInitializer((()=>{customElements.define(t,e)})):customElements.define(t,e)};export{t as customElement};\n//# sourceMappingURL=custom-element.js.map\n","import{defaultConverter as t,notEqual as e}from\"../reactive-element.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const o={attribute:!0,type:String,converter:t,reflect:!1,hasChanged:e},r=(t=o,e,r)=>{const{kind:n,metadata:i}=r;let s=globalThis.litPropertyMetadata.get(i);if(void 0===s&&globalThis.litPropertyMetadata.set(i,s=new Map),s.set(r.name,t),\"accessor\"===n){const{name:o}=r;return{set(r){const n=e.get.call(this);e.set.call(this,r),this.requestUpdate(o,n,t)},init(e){return void 0!==e&&this.C(o,void 0,t),e}}}if(\"setter\"===n){const{name:o}=r;return function(r){const n=this[o];e.call(this,r),this.requestUpdate(o,n,t)}}throw Error(\"Unsupported decorator location: \"+n)};function n(t){return(e,o)=>\"object\"==typeof o?r(t,e,o):((t,e,o)=>{const r=e.hasOwnProperty(o);return e.constructor.createProperty(o,r?{...t,wrapped:!0}:t),r?Object.getOwnPropertyDescriptor(e,o):void 0})(t,e,o)}export{n as property,r as standardProperty};\n//# sourceMappingURL=property.js.map\n","import{property as t}from\"./property.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */function r(r){return t({...r,state:!0,attribute:!1})}export{r as state};\n//# sourceMappingURL=state.js.map\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst e=(e,t,c)=>(c.configurable=!0,c.enumerable=!0,Reflect.decorate&&\"object\"!=typeof t&&Object.defineProperty(e,t,c),c);export{e as desc};\n//# sourceMappingURL=base.js.map\n","import{desc as t}from\"./base.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */function e(e,r){return(n,s,i)=>{const o=t=>t.renderRoot?.querySelector(e)??null;if(r){const{get:e,set:r}=\"object\"==typeof s?n:i??(()=>{const t=Symbol();return{get(){return this[t]},set(e){this[t]=e}}})();return t(n,s,{get(){let t=e.call(this);return void 0===t&&(t=o(this),(null!==t||this.hasUpdated)&&r.call(this,t)),t}})}return t(n,s,{get(){return o(this)}})}}export{e as query};\n//# sourceMappingURL=query.js.map\n","import{desc as t}from\"./base.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nfunction r(r){return(n,e)=>t(n,e,{async get(){return await this.updateComplete,this.renderRoot?.querySelector(r)??null}})}export{r as queryAsync};\n//# sourceMappingURL=query-async.js.map\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},e=t=>(...e)=>({_$litDirective$:t,values:e});class i{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,i){this._$Ct=t,this._$AM=e,this._$Ci=i}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}export{i as Directive,t as PartType,e as directive};\n//# sourceMappingURL=directive.js.map\n","import{noChange as t}from\"../lit-html.js\";import{directive as e,Directive as r,PartType as s}from\"../directive.js\";\n/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const n=\"important\",i=\" !\"+n,o=e(class extends r{constructor(t){if(super(t),t.type!==s.ATTRIBUTE||\"style\"!==t.name||t.strings?.length>2)throw Error(\"The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.\")}render(t){return Object.keys(t).reduce(((e,r)=>{const s=t[r];return null==s?e:e+`${r=r.includes(\"-\")?r:r.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,\"-$&\").toLowerCase()}:${s};`}),\"\")}update(e,[r]){const{style:s}=e.element;if(void 0===this.ut)return this.ut=new Set(Object.keys(r)),this.render(r);for(const t of this.ut)null==r[t]&&(this.ut.delete(t),t.includes(\"-\")?s.removeProperty(t):s[t]=null);for(const t in r){const e=r[t];if(null!=e){this.ut.add(t);const r=\"string\"==typeof e&&e.endsWith(i);t.includes(\"-\")||r?s.setProperty(t,r?e.slice(0,-11):e,r?n:\"\"):s[t]=e}}return t}});export{o as styleMap};\n//# sourceMappingURL=style-map.js.map\n","export const ZERO_WIDTH_SPACE = '\\u200B';\n// see https://en.wikipedia.org/wiki/Zero-width_non-joiner\nexport const ZERO_WIDTH_NON_JOINER = '\\u200C';\n\nexport const INLINE_ROOT_ATTR = 'data-v-root';\n","import { assertExists } from '@blocksuite/global/utils';\n\nimport { INLINE_ROOT_ATTR } from '../consts.js';\nimport type { InlineEditor, InlineRootElement } from '../inline-editor.js';\nimport type { BaseTextAttributes } from './base-attributes.js';\n\nexport function findDocumentOrShadowRoot<\n  TextAttributes extends BaseTextAttributes,\n>(editor: InlineEditor<TextAttributes>): Document {\n  const el = editor.rootElement;\n\n  if (!el) {\n    throw new Error('editor root element not found');\n  }\n\n  const root = el.getRootNode();\n\n  if (\n    (root instanceof Document || root instanceof ShadowRoot) &&\n    'getSelection' in root\n  ) {\n    return root;\n  }\n\n  return el.ownerDocument;\n}\n\nexport function getInlineEditorInsideRoot(element: Element): InlineEditor {\n  const rootElement = element.closest(\n    `[${INLINE_ROOT_ATTR}]`\n  ) as InlineRootElement;\n  assertExists(rootElement, 'element must be inside a v-root');\n  const inlineEditor = rootElement.inlineEditor;\n  assertExists(\n    inlineEditor,\n    'element must be inside a v-root with inline-editor'\n  );\n  return inlineEditor;\n}\n","import { html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { ZERO_WIDTH_SPACE } from '../consts.js';\nimport type { DeltaInsert } from '../types.js';\nimport type { BaseTextAttributes } from '../utils/base-attributes.js';\nimport { getInlineEditorInsideRoot } from '../utils/query.js';\n\n@customElement('v-element')\nexport class VElement<\n  T extends BaseTextAttributes = BaseTextAttributes,\n> extends LitElement {\n  @property({ type: Object })\n  delta: DeltaInsert<T> = {\n    insert: ZERO_WIDTH_SPACE,\n  };\n\n  @property({ attribute: false })\n  selected!: boolean;\n\n  override render() {\n    const inlineEditor = getInlineEditorInsideRoot(this);\n    const attributeRenderer = inlineEditor.attributeService.attributeRenderer;\n\n    const isEmbed = inlineEditor.isEmbed(this.delta);\n    if (isEmbed) {\n      if (this.delta.insert.length !== 1) {\n        throw new Error(`The length of embed node should only be 1.\n          This seems to be an internal issue with inline editor.\n          Please go to https://github.com/toeverything/blocksuite/issues\n          to report it.`);\n      }\n\n      return html`<span\n        data-v-embed=\"true\"\n        data-v-element=\"true\"\n        contenteditable=\"false\"\n        style=${styleMap({ userSelect: 'none' })}\n        >${attributeRenderer(this.delta, this.selected)}</span\n      >`;\n    }\n\n    // we need to avoid \\n appearing before and after the span element, which will\n    // cause the unexpected space\n    return html`<span data-v-element=\"true\"\n      >${attributeRenderer(this.delta, this.selected)}</span\n    >`;\n  }\n\n  override createRenderRoot() {\n    return this;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'v-element': VElement;\n  }\n}\n","import { html } from 'lit';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nexport const EmbedGap = html`<span\n  data-v-embed-gap=\"true\"\n  style=${styleMap({\n    userSelect: 'text',\n    padding: '0 0.5px',\n    outline: 'none',\n  })}\n  ><v-text></v-text\n></span>`;\n","import { assertExists } from '@blocksuite/global/utils';\nimport { html, LitElement, type TemplateResult } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { INLINE_ROOT_ATTR, ZERO_WIDTH_SPACE } from '../consts.js';\nimport type { InlineRootElement } from '../inline-editor.js';\nimport type { DeltaInsert } from '../types.js';\nimport { EmbedGap } from './embed-gap.js';\n\n@customElement('v-line')\nexport class VLine extends LitElement {\n  @property({ attribute: false })\n  elements: [TemplateResult<1>, DeltaInsert][] = [];\n\n  get vElements() {\n    return Array.from(this.querySelectorAll('v-element'));\n  }\n\n  get vTexts() {\n    return Array.from(this.querySelectorAll('v-text'));\n  }\n\n  get textLength() {\n    return this.vElements.reduce((acc, el) => acc + el.delta.insert.length, 0);\n  }\n\n  override get textContent() {\n    return this.vElements.reduce((acc, el) => acc + el.delta.insert, '');\n  }\n\n  override async getUpdateComplete() {\n    const result = await super.getUpdateComplete();\n    await Promise.all(this.vElements.map(el => el.updateComplete));\n    await Promise.all(this.vTexts.map(el => el.updateComplete));\n    return result;\n  }\n\n  protected override firstUpdated(): void {\n    this.style.display = 'block';\n  }\n\n  override render() {\n    if (this.elements.length === 0) {\n      return html`<div><v-text .str=${ZERO_WIDTH_SPACE}></v-text></div>`;\n    }\n\n    if (!this.isConnected) return;\n\n    const rootElement = this.closest(\n      `[${INLINE_ROOT_ATTR}]`\n    ) as InlineRootElement;\n    assertExists(rootElement, 'v-line must be inside a v-root');\n    const inlineEditor = rootElement.inlineEditor;\n    assertExists(\n      inlineEditor,\n      'v-line must be inside a v-root with inline-editor'\n    );\n\n    const renderElements = this.elements.flatMap(([template, delta], index) => {\n      if (inlineEditor.isEmbed(delta)) {\n        if (delta.insert.length !== 1) {\n          throw new Error(`The length of embed node should only be 1.\n            This seems to be an internal issue with inline editor.\n            Please go to https://github.com/toeverything/blocksuite/issues\n            to report it.`);\n        }\n        // we add `EmbedGap` to make cursor can be placed between embed elements\n        if (index === 0) {\n          const nextDelta = this.elements[index + 1]?.[1];\n          if (!nextDelta || inlineEditor.isEmbed(nextDelta)) {\n            return [EmbedGap, template, EmbedGap];\n          } else {\n            return [EmbedGap, template];\n          }\n        } else {\n          const nextDelta = this.elements[index + 1]?.[1];\n          if (!nextDelta || inlineEditor.isEmbed(nextDelta)) {\n            return [template, EmbedGap];\n          } else {\n            return [template];\n          }\n        }\n      }\n      return template;\n    });\n\n    // prettier will generate \\n and cause unexpected space and line break\n    // prettier-ignore\n    return html`<div style=${styleMap({\n      // this padding is used to make cursor can be placed at the\n      // start and end of the line when the first and last element is embed element\n      padding: '0 0.5px',\n    })}>${renderElements}</div>`;\n  }\n\n  override createRenderRoot() {\n    return this;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'v-line': VLine;\n  }\n}\n","import { html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { type StyleInfo, styleMap } from 'lit/directives/style-map.js';\n\nimport { ZERO_WIDTH_SPACE } from '../consts.js';\n\n@customElement('v-text')\nexport class VText extends LitElement {\n  @property({ attribute: false })\n  str: string = ZERO_WIDTH_SPACE;\n\n  @property({ attribute: false })\n  styles: StyleInfo = {\n    'word-wrap': 'break-word',\n    'white-space': 'break-spaces',\n  };\n\n  override render() {\n    // we need to avoid \\n appearing before and after the span element, which will\n    // cause the sync problem about the cursor position\n    return html`<span style=${styleMap(this.styles)} data-v-text=\"true\"\n      >${this.str}</span\n    >`;\n  }\n\n  override createRenderRoot() {\n    return this;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'v-text': VText;\n  }\n}\n","import type { InlineEditor } from '../inline-editor.js';\nimport type { InlineRange } from '../types.js';\nimport type { BaseTextAttributes } from '../utils/base-attributes.js';\n\nexport interface BeforeinputHookCtx<TextAttributes extends BaseTextAttributes> {\n  inlineEditor: InlineEditor<TextAttributes>;\n  raw: InputEvent;\n  inlineRange: InlineRange;\n  data: string | null;\n  attributes: TextAttributes;\n}\nexport interface CompositionEndHookCtx<\n  TextAttributes extends BaseTextAttributes,\n> {\n  inlineEditor: InlineEditor<TextAttributes>;\n  raw: CompositionEvent;\n  inlineRange: InlineRange;\n  data: string | null;\n  attributes: TextAttributes;\n}\n\nexport type HookContext<TextAttributes extends BaseTextAttributes> =\n  | BeforeinputHookCtx<TextAttributes>\n  | CompositionEndHookCtx<TextAttributes>;\n\nexport class InlineHookService<TextAttributes extends BaseTextAttributes> {\n  constructor(\n    public readonly editor: InlineEditor<TextAttributes>,\n    public readonly hooks: {\n      beforeinput?: (\n        props: BeforeinputHookCtx<TextAttributes>\n      ) => BeforeinputHookCtx<TextAttributes> | null;\n      compositionEnd?: (\n        props: CompositionEndHookCtx<TextAttributes>\n      ) => CompositionEndHookCtx<TextAttributes> | null;\n    } = {}\n  ) {}\n}\n","import { html } from 'lit';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { AttributeRenderer } from '../types.js';\nimport type { BaseTextAttributes } from './base-attributes.js';\n\nfunction inlineTextStyles(\n  props: BaseTextAttributes\n): ReturnType<typeof styleMap> {\n  let textDecorations = '';\n  if (props.underline) {\n    textDecorations += 'underline';\n  }\n  if (props.strike) {\n    textDecorations += ' line-through';\n  }\n\n  let inlineCodeStyle = {};\n  if (props.code) {\n    inlineCodeStyle = {\n      'font-family':\n        '\"SFMono-Regular\", Menlo, Consolas, \"PT Mono\", \"Liberation Mono\", Courier, monospace',\n      'line-height': 'normal',\n      background: 'rgba(135,131,120,0.15)',\n      color: '#EB5757',\n      'border-radius': '3px',\n      'font-size': '85%',\n      padding: '0.2em 0.4em',\n    };\n  }\n\n  return styleMap({\n    'word-wrap': 'break-word',\n    'white-space': 'break-spaces',\n    'font-weight': props.bold ? 'bold' : 'normal',\n    'font-style': props.italic ? 'italic' : 'normal',\n    'text-decoration': textDecorations.length > 0 ? textDecorations : 'none',\n    ...inlineCodeStyle,\n  });\n}\n\nexport const getDefaultAttributeRenderer =\n  <T extends BaseTextAttributes>(): AttributeRenderer<T> =>\n  delta => {\n    const style = delta.attributes\n      ? inlineTextStyles(delta.attributes)\n      : styleMap({});\n    return html`<span style=${style}\n      ><v-text .str=${delta.insert}></v-text\n    ></span>`;\n  };\n","import { z } from 'zod';\n\nexport const baseTextAttributes = z.object({\n  bold: z.literal(true).optional().nullable().catch(undefined),\n  italic: z.literal(true).optional().nullable().catch(undefined),\n  underline: z.literal(true).optional().nullable().catch(undefined),\n  strike: z.literal(true).optional().nullable().catch(undefined),\n  code: z.literal(true).optional().nullable().catch(undefined),\n  link: z.string().optional().nullable().catch(undefined),\n});\n\nexport type BaseTextAttributes = z.infer<typeof baseTextAttributes>;\n","import type { DeltaInsert } from '../types.js';\nimport type { BaseTextAttributes } from './base-attributes.js';\n\nexport function transformDelta<TextAttributes extends BaseTextAttributes>(\n  delta: DeltaInsert<TextAttributes>\n): (DeltaInsert<TextAttributes> | '\\n')[] {\n  const result: (DeltaInsert<TextAttributes> | '\\n')[] = [];\n\n  let tmpString = delta.insert;\n  while (tmpString.length > 0) {\n    const index = tmpString.indexOf('\\n');\n    if (index === -1) {\n      result.push({\n        insert: tmpString,\n        attributes: delta.attributes,\n      });\n      break;\n    }\n\n    if (tmpString.slice(0, index).length > 0) {\n      result.push({\n        insert: tmpString.slice(0, index),\n        attributes: delta.attributes,\n      });\n    }\n\n    result.push('\\n');\n    tmpString = tmpString.slice(index + 1);\n  }\n\n  return result;\n}\n\n/**\n * convert a delta insert array to chunks, each chunk is a line\n */\nexport function deltaInsertsToChunks<TextAttributes extends BaseTextAttributes>(\n  delta: DeltaInsert<TextAttributes>[]\n): DeltaInsert<TextAttributes>[][] {\n  if (delta.length === 0) {\n    return [[]];\n  }\n\n  const transformedDelta = delta.flatMap(transformDelta);\n\n  function* chunksGenerator(arr: (DeltaInsert<TextAttributes> | '\\n')[]) {\n    let start = 0;\n    for (let i = 0; i < arr.length; i++) {\n      if (arr[i] === '\\n') {\n        const chunk = arr.slice(start, i);\n        start = i + 1;\n        yield chunk as DeltaInsert<TextAttributes>[];\n      } else if (i === arr.length - 1) {\n        yield arr.slice(start) as DeltaInsert<TextAttributes>[];\n      }\n    }\n\n    if (arr.at(-1) === '\\n') {\n      yield [];\n    }\n  }\n\n  return Array.from(chunksGenerator(transformedDelta));\n}\n","import { VElement } from '../components/v-element.js';\nimport type { InlineEditor } from '../inline-editor.js';\nimport type { DeltaInsert } from '../types.js';\nimport type { BaseTextAttributes } from './base-attributes.js';\n\nexport function isInEmbedElement(node: Node): boolean {\n  if (node instanceof Element) {\n    if (node instanceof VElement) {\n      return node.querySelector('[data-v-embed=\"true\"]') !== null;\n    }\n    const vElement = node.closest('[data-v-embed=\"true\"]');\n    return !!vElement;\n  } else {\n    const vElement = node.parentElement?.closest('[data-v-embed=\"true\"]');\n    return !!vElement;\n  }\n}\n\nexport function isInEmbedGap(node: Node): boolean {\n  if (node instanceof Element) {\n    const vText = node.closest('[data-v-text=\"true\"]');\n    if (vText && (vText as HTMLElement).dataset.vEmbedGap === 'true') {\n      return true;\n    }\n    return false;\n  } else {\n    const vText = node.parentElement?.closest('[data-v-text=\"true\"]');\n    if (vText && (vText as HTMLElement).dataset.vEmbedGap === 'true') {\n      return true;\n    }\n    return false;\n  }\n}\n\nexport function transformDeltasToEmbedDeltas<\n  TextAttributes extends BaseTextAttributes = BaseTextAttributes,\n>(\n  editor: InlineEditor<TextAttributes>,\n  deltas: DeltaInsert<TextAttributes>[]\n): DeltaInsert<TextAttributes>[] {\n  // According to our regulations, the length of each \"embed\" node should only be 1.\n  // Therefore, if the length of an \"embed\" type node is greater than 1,\n  // we will divide it into multiple parts.\n  const result: DeltaInsert<TextAttributes>[] = [];\n  for (const delta of deltas) {\n    if (editor.isEmbed(delta)) {\n      const dividedDeltas = [...delta.insert].map(subInsert => ({\n        insert: subInsert,\n        attributes: delta.attributes,\n      }));\n      result.push(...dividedDeltas);\n    } else {\n      result.push(delta);\n    }\n  }\n  return result;\n}\n","import { VElement, VLine } from '../components/index.js';\n\nexport function isNativeTextInVText(text: unknown): text is Text {\n  return text instanceof Text && text.parentElement?.dataset.vText === 'true';\n}\n\nexport function isVElement(element: unknown): element is HTMLElement {\n  return (\n    element instanceof HTMLElement &&\n    (element.dataset.vElement === 'true' || element instanceof VElement)\n  );\n}\n\nexport function isVLine(element: unknown): element is HTMLElement {\n  return (\n    element instanceof HTMLElement &&\n    (element instanceof VLine || element.parentElement instanceof VLine)\n  );\n}\n\nexport function isInlineRoot(element: unknown): element is HTMLElement {\n  return element instanceof HTMLElement && element.dataset.vRoot === 'true';\n}\n","import { IS_IOS, IS_MAC } from '@blocksuite/global/env';\n\nimport type { InlineEditor } from '../inline-editor.js';\nimport type { InlineRange } from '../types.js';\nimport type { BaseTextAttributes } from './base-attributes.js';\n\nconst SHORT_KEY_PROPERTY = IS_IOS || IS_MAC ? 'metaKey' : 'ctrlKey';\n\nexport const KEYBOARD_PREVENT_DEFAULT = false;\nexport const KEYBOARD_ALLOW_DEFAULT = true;\n\nexport interface KeyboardBinding {\n  key: number | string | string[];\n  handler: KeyboardBindingHandler;\n  prefix?: RegExp;\n  suffix?: RegExp;\n  shortKey?: boolean;\n  shiftKey?: boolean;\n  altKey?: boolean;\n  metaKey?: boolean;\n  ctrlKey?: boolean;\n}\nexport type KeyboardBindingRecord = Record<string, KeyboardBinding>;\n\nexport interface KeyboardBindingContext<\n  TextAttributes extends BaseTextAttributes = BaseTextAttributes,\n> {\n  inlineRange: InlineRange;\n  inlineEditor: InlineEditor<TextAttributes>;\n  collapsed: boolean;\n  prefixText: string;\n  suffixText: string;\n  raw: KeyboardEvent;\n}\nexport type KeyboardBindingHandler = (\n  context: KeyboardBindingContext\n) => typeof KEYBOARD_PREVENT_DEFAULT | typeof KEYBOARD_ALLOW_DEFAULT;\n\nexport function createInlineKeyDownHandler(\n  inlineEditor: InlineEditor,\n  bindings: KeyboardBindingRecord\n): (evt: KeyboardEvent) => void {\n  const bindingStore: Record<string, KeyboardBinding[]> = {};\n\n  function normalize(binding: KeyboardBinding): KeyboardBinding {\n    if (binding.shortKey) {\n      binding[SHORT_KEY_PROPERTY] = binding.shortKey;\n      delete binding.shortKey;\n    }\n    return binding;\n  }\n\n  function keyMatch(evt: KeyboardEvent, binding: KeyboardBinding) {\n    if (\n      (['altKey', 'ctrlKey', 'metaKey', 'shiftKey'] as const).some(\n        key => Object.hasOwn(binding, key) && binding[key] !== evt[key]\n      )\n    ) {\n      return false;\n    }\n    return binding.key === evt.key;\n  }\n\n  function addBinding(keyBinding: KeyboardBinding) {\n    const binding = normalize(keyBinding);\n    const keys = Array.isArray(binding.key) ? binding.key : [binding.key];\n    keys.forEach(key => {\n      const singleBinding = {\n        ...binding,\n        key,\n      };\n      bindingStore[key] = bindingStore[key] ?? [];\n      bindingStore[key].push(singleBinding);\n    });\n  }\n\n  Object.values(bindings).forEach(binding => {\n    addBinding(binding);\n  });\n\n  function keyDownHandler(evt: KeyboardEvent) {\n    if (evt.defaultPrevented || evt.isComposing) return;\n    const keyBindings = bindingStore[evt.key] ?? [];\n\n    const keyMatches = keyBindings.filter(binding => keyMatch(evt, binding));\n    if (keyMatches.length === 0) return;\n\n    const inlineRange = inlineEditor.getInlineRange();\n    if (!inlineRange) return;\n\n    const [leafStart, offsetStart] = inlineEditor.getTextPoint(\n      inlineRange.index\n    );\n    const [leafEnd, offsetEnd] =\n      inlineRange.length === 0\n        ? [leafStart, offsetStart]\n        : inlineEditor.getTextPoint(inlineRange.index + inlineRange.length);\n    const prefixText = leafStart.textContent\n      ? leafStart.textContent.slice(0, offsetStart)\n      : '';\n    const suffixText = leafEnd.textContent\n      ? leafEnd.textContent.slice(offsetEnd)\n      : '';\n    const currContext: KeyboardBindingContext = {\n      inlineRange,\n      inlineEditor: inlineEditor,\n      collapsed: inlineRange.length === 0,\n      prefixText,\n      suffixText,\n      raw: evt,\n    };\n    const prevented = keyMatches.some(binding => {\n      if (binding.prefix && !binding.prefix.test(currContext.prefixText)) {\n        return false;\n      }\n      if (binding.suffix && !binding.suffix.test(currContext.suffixText)) {\n        return false;\n      }\n      return binding.handler(currContext) === KEYBOARD_PREVENT_DEFAULT;\n    });\n    if (prevented) {\n      evt.preventDefault();\n    }\n  }\n\n  return keyDownHandler;\n}\n","import { ZERO_WIDTH_SPACE } from '../consts.js';\n\nexport function calculateTextLength(text: Text): number {\n  if (text.wholeText === ZERO_WIDTH_SPACE) {\n    return 0;\n  } else {\n    return text.wholeText.length;\n  }\n}\n\nexport function getTextNodesFromElement(element: Element): Text[] {\n  const textSpanElements = Array.from(\n    element.querySelectorAll('[data-v-text=\"true\"]')\n  );\n  const textNodes = textSpanElements.map(textSpanElement => {\n    const textNode = Array.from(textSpanElement.childNodes).find(\n      (node): node is Text => node instanceof Text\n    );\n\n    if (!textNode) {\n      throw new Error('text node not found');\n    }\n\n    return textNode;\n  });\n\n  return textNodes;\n}\n","import type { VElement, VLine } from '../components/index.js';\nimport { INLINE_ROOT_ATTR, ZERO_WIDTH_SPACE } from '../consts.js';\nimport type { DomPoint, TextPoint } from '../types.js';\nimport {\n  isInlineRoot,\n  isNativeTextInVText,\n  isVElement,\n  isVLine,\n} from './guard.js';\nimport { calculateTextLength, getTextNodesFromElement } from './text.js';\n\nexport function nativePointToTextPoint(\n  node: unknown,\n  offset: number\n): TextPoint | null {\n  if (isNativeTextInVText(node)) {\n    return [node, offset];\n  }\n\n  if (isVElement(node)) {\n    const texts = getTextNodesFromElement(node);\n    if (texts.length === 1) {\n      const vElement = texts[0].parentElement?.closest(\n        '[data-v-element=\"true\"]'\n      );\n      if (\n        vElement instanceof HTMLElement &&\n        vElement.dataset.vEmbed === 'true'\n      ) {\n        return [texts[0], 0];\n      }\n    }\n    return texts[offset] ? [texts[offset], 0] : null;\n  }\n\n  if (isVLine(node) || isInlineRoot(node)) {\n    return getTextPointRoughlyFromElementByOffset(node, offset, true);\n  }\n\n  if (!(node instanceof Node)) {\n    return null;\n  }\n\n  const vNodes = getVNodesFromNode(node);\n\n  if (vNodes) {\n    return getTextPointFromVNodes(vNodes, node, offset);\n  }\n\n  return null;\n}\n\nexport function textPointToDomPoint(\n  text: Text,\n  offset: number,\n  rootElement: HTMLElement\n): DomPoint | null {\n  if (rootElement.dataset.vRoot !== 'true') {\n    throw new Error(\n      'textRangeToDomPoint should be called with editor root element'\n    );\n  }\n\n  if (!rootElement.contains(text)) {\n    return null;\n  }\n\n  const texts = getTextNodesFromElement(rootElement);\n  const goalIndex = texts.indexOf(text);\n  let index = 0;\n  for (const text of texts.slice(0, goalIndex)) {\n    index += calculateTextLength(text);\n  }\n\n  if (text.wholeText !== ZERO_WIDTH_SPACE) {\n    index += offset;\n  }\n\n  const textParentElement = text.parentElement;\n  if (!textParentElement) {\n    throw new Error('text element parent not found');\n  }\n\n  const lineElement = textParentElement.closest('v-line');\n\n  if (!lineElement) {\n    throw new Error('line element not found');\n  }\n\n  const lineIndex = Array.from(rootElement.querySelectorAll('v-line')).indexOf(\n    lineElement\n  );\n\n  return { text, index: index + lineIndex };\n}\n\nfunction getVNodesFromNode(node: Node): VElement[] | VLine[] | null {\n  const vLine = node.parentElement?.closest('v-line');\n\n  if (vLine) {\n    return Array.from(vLine.querySelectorAll('v-element'));\n  }\n\n  const container =\n    node instanceof Element\n      ? node.closest(`[${INLINE_ROOT_ATTR}]`)\n      : node.parentElement?.closest(`[${INLINE_ROOT_ATTR}]`);\n\n  if (container) {\n    return Array.from(container.querySelectorAll('v-line'));\n  }\n\n  return null;\n}\n\nfunction getTextPointFromVNodes(\n  vNodes: VLine[] | VElement[],\n  node: Node,\n  offset: number\n): TextPoint | null {\n  const first = vNodes[0];\n  for (let i = 0; i < vNodes.length; i++) {\n    const vNode = vNodes[i];\n\n    if (i === 0 && AFollowedByB(node, vNode)) {\n      return getTextPointRoughlyFromElementByOffset(first, offset, true);\n    }\n\n    if (AInsideB(node, vNode)) {\n      return getTextPointRoughlyFromElementByOffset(first, offset, false);\n    }\n\n    if (i === vNodes.length - 1 && APrecededByB(node, vNode)) {\n      return getTextPointRoughlyFromElement(vNode);\n    }\n\n    if (\n      i < vNodes.length - 1 &&\n      APrecededByB(node, vNode) &&\n      AFollowedByB(node, vNodes[i + 1])\n    ) {\n      return getTextPointRoughlyFromElement(vNode);\n    }\n  }\n\n  return null;\n}\n\nfunction getTextPointRoughlyFromElement(element: Element): TextPoint | null {\n  const texts = getTextNodesFromElement(element);\n  if (texts.length === 0) return null;\n  const text = texts[texts.length - 1];\n  return [text, calculateTextLength(text)];\n}\n\nfunction getTextPointRoughlyFromElementByOffset(\n  element: Element,\n  offset: number,\n  fromStart: boolean\n): TextPoint | null {\n  const texts = getTextNodesFromElement(element);\n  if (texts.length === 0) return null;\n  const text = fromStart ? texts[0] : texts[texts.length - 1];\n  return [text, offset === 0 ? offset : text.length];\n}\n\nfunction AInsideB(a: Node, b: Node): boolean {\n  return (\n    b.compareDocumentPosition(a) === Node.DOCUMENT_POSITION_CONTAINED_BY ||\n    b.compareDocumentPosition(a) ===\n      (Node.DOCUMENT_POSITION_CONTAINED_BY | Node.DOCUMENT_POSITION_FOLLOWING)\n  );\n}\n\nfunction AFollowedByB(a: Node, b: Node): boolean {\n  return a.compareDocumentPosition(b) === Node.DOCUMENT_POSITION_FOLLOWING;\n}\n\nfunction APrecededByB(a: Node, b: Node): boolean {\n  return a.compareDocumentPosition(b) === Node.DOCUMENT_POSITION_PRECEDING;\n}\n","import type * as Y from 'yjs';\n\nimport { VElement } from '../components/v-element.js';\nimport type { InlineRange } from '../types.js';\nimport { isInEmbedElement } from './embed.js';\nimport {\n  nativePointToTextPoint,\n  textPointToDomPoint,\n} from './point-conversion.js';\nimport { calculateTextLength, getTextNodesFromElement } from './text.js';\n\ntype InlineRangeRunnerContext = {\n  rootElement: HTMLElement;\n  range: Range;\n  yText: Y.Text;\n  startNode: Node | null;\n  startOffset: number;\n  startText: Text;\n  startTextOffset: number;\n  endNode: Node | null;\n  endOffset: number;\n  endText: Text;\n  endTextOffset: number;\n};\n\ntype Predict = (context: InlineRangeRunnerContext) => boolean;\ntype Handler = (context: InlineRangeRunnerContext) => InlineRange | null;\n\nconst rangeHasAnchorAndFocus: Predict = ({\n  rootElement,\n  startText,\n  endText,\n}) => {\n  return rootElement.contains(startText) && rootElement.contains(endText);\n};\n\nconst rangeHasAnchorAndFocusHandler: Handler = ({\n  rootElement,\n  startText,\n  endText,\n  startTextOffset,\n  endTextOffset,\n}) => {\n  const anchorDomPoint = textPointToDomPoint(\n    startText,\n    startTextOffset,\n    rootElement\n  );\n  const focusDomPoint = textPointToDomPoint(\n    endText,\n    endTextOffset,\n    rootElement\n  );\n\n  if (!anchorDomPoint || !focusDomPoint) {\n    return null;\n  }\n\n  return {\n    index: Math.min(anchorDomPoint.index, focusDomPoint.index),\n    length: Math.abs(anchorDomPoint.index - focusDomPoint.index),\n  };\n};\n\nconst rangeOnlyHasFocus: Predict = ({ rootElement, startText, endText }) => {\n  return !rootElement.contains(startText) && rootElement.contains(endText);\n};\n\nconst rangeOnlyHasFocusHandler: Handler = ({\n  rootElement,\n  endText,\n  endTextOffset,\n}) => {\n  const focusDomPoint = textPointToDomPoint(\n    endText,\n    endTextOffset,\n    rootElement\n  );\n\n  if (!focusDomPoint) {\n    return null;\n  }\n\n  return {\n    index: 0,\n    length: focusDomPoint.index,\n  };\n};\n\nconst rangeOnlyHasAnchor: Predict = ({ rootElement, startText, endText }) => {\n  return rootElement.contains(startText) && !rootElement.contains(endText);\n};\n\nconst rangeOnlyHasAnchorHandler: Handler = ({\n  yText,\n  rootElement,\n  startText,\n  startTextOffset,\n}) => {\n  const startDomPoint = textPointToDomPoint(\n    startText,\n    startTextOffset,\n    rootElement\n  );\n\n  if (!startDomPoint) {\n    return null;\n  }\n\n  return {\n    index: startDomPoint.index,\n    length: yText.length - startDomPoint.index,\n  };\n};\n\nconst rangeHasNoAnchorAndFocus: Predict = ({\n  rootElement,\n  startText,\n  endText,\n  range,\n}) => {\n  return (\n    !rootElement.contains(startText) &&\n    !rootElement.contains(endText) &&\n    range.intersectsNode(rootElement)\n  );\n};\n\nconst rangeHasNoAnchorAndFocusHandler: Handler = ({ yText }) => {\n  return {\n    index: 0,\n    length: yText.length,\n  };\n};\n\nconst buildContext = (\n  range: Range,\n  rootElement: HTMLElement,\n  yText: Y.Text\n): InlineRangeRunnerContext | null => {\n  const { startContainer, startOffset, endContainer, endOffset } = range;\n\n  const startTextPoint = nativePointToTextPoint(startContainer, startOffset);\n  const endTextPoint = nativePointToTextPoint(endContainer, endOffset);\n\n  if (!startTextPoint || !endTextPoint) {\n    return null;\n  }\n\n  const [startText, startTextOffset] = startTextPoint;\n  const [endText, endTextOffset] = endTextPoint;\n\n  return {\n    rootElement,\n    range,\n    yText,\n    startNode: startContainer,\n    startOffset,\n    endNode: endContainer,\n    endOffset,\n    startText,\n    startTextOffset,\n    endText,\n    endTextOffset,\n  };\n};\n\n/**\n * calculate the inline range from dom selection for **this Editor**\n * there are three cases when the inline range of this Editor is not null:\n * (In the following, \"|\" mean anchor and focus, each line is a separate Editor)\n * 1. anchor and focus are in this Editor\n *    aaaaaa\n *    b|bbbb|b\n *    cccccc\n *    the inline range of second Editor is {index: 1, length: 4}, the others are null\n * 2. anchor and focus one in this Editor, one in another Editor\n *    aaa|aaa    aaaaaa\n *    bbbbb|b or bbbbb|b\n *    cccccc     cc|cccc\n *    2.1\n *        the inline range of first Editor is {index: 3, length: 3}, the second is {index: 0, length: 5},\n *        the third is null\n *    2.2\n *        the inline range of first Editor is null, the second is {index: 5, length: 1},\n *        the third is {index: 0, length: 2}\n * 3. anchor and focus are in another Editor\n *    aa|aaaa\n *    bbbbbb\n *    cccc|cc\n *    the inline range of first Editor is {index: 2, length: 4},\n *    the second is {index: 0, length: 6}, the third is {index: 0, length: 4}\n */\nexport function domRangeToInlineRange(\n  range: Range,\n  rootElement: HTMLElement,\n  yText: Y.Text\n): InlineRange | null {\n  const context = buildContext(range, rootElement, yText);\n\n  if (!context) return null;\n\n  // handle embed\n  if (\n    context.startNode &&\n    context.startNode === context.endNode &&\n    isInEmbedElement(context.startNode)\n  ) {\n    const anchorDomPoint = textPointToDomPoint(\n      context.startText,\n      context.startTextOffset,\n      rootElement\n    );\n\n    if (anchorDomPoint) {\n      return {\n        index: anchorDomPoint.index,\n        length: 1,\n      };\n    }\n  }\n\n  // case 1\n  if (rangeHasAnchorAndFocus(context)) {\n    return rangeHasAnchorAndFocusHandler(context);\n  }\n\n  // case 2.1\n  if (rangeOnlyHasFocus(context)) {\n    return rangeOnlyHasFocusHandler(context);\n  }\n\n  // case 2.2\n  if (rangeOnlyHasAnchor(context)) {\n    return rangeOnlyHasAnchorHandler(context);\n  }\n\n  // case 3\n  if (rangeHasNoAnchorAndFocus(context)) {\n    return rangeHasNoAnchorAndFocusHandler(context);\n  }\n\n  return null;\n}\n\n/**\n * calculate the dom selection from inline range for **this Editor**\n */\nexport function inlineRangeToDomRange(\n  rootElement: HTMLElement,\n  inlineRange: InlineRange\n): Range | null {\n  const lineElements = Array.from(rootElement.querySelectorAll('v-line'));\n\n  // calculate anchorNode and focusNode\n  let startText: Text | null = null;\n  let endText: Text | null = null;\n  let anchorOffset = 0;\n  let focusOffset = 0;\n  let index = 0;\n\n  for (let i = 0; i < lineElements.length; i++) {\n    if (startText && endText) {\n      break;\n    }\n\n    const texts = getTextNodesFromElement(lineElements[i]);\n    for (const text of texts) {\n      const textLength = calculateTextLength(text);\n\n      if (!startText && index + textLength >= inlineRange.index) {\n        startText = text;\n        anchorOffset = inlineRange.index - index;\n      }\n      if (\n        !endText &&\n        index + textLength >= inlineRange.index + inlineRange.length\n      ) {\n        endText = text;\n        focusOffset = inlineRange.index + inlineRange.length - index;\n      }\n\n      if (startText && endText) {\n        break;\n      }\n\n      index += textLength;\n    }\n\n    // the one because of the line break\n    index += 1;\n  }\n\n  if (!startText || !endText) {\n    return null;\n  }\n\n  if (isInEmbedElement(startText)) {\n    const anchorVElement = startText.parentElement?.closest('v-element');\n    if (!anchorVElement) {\n      throw new Error(\n        'failed to find vElement for a text note in an embed element'\n      );\n    }\n    const nextSibling = anchorVElement.nextElementSibling;\n    if (!nextSibling) {\n      throw new Error('failed to find nextSibling sibling of an embed element');\n    }\n\n    const texts = getTextNodesFromElement(nextSibling);\n    if (nextSibling instanceof VElement) {\n      startText = texts[texts.length - 1];\n      anchorOffset = calculateTextLength(startText);\n    } else {\n      // nextSibling is a gap\n      startText = texts[0];\n      anchorOffset = 0;\n    }\n  }\n  if (isInEmbedElement(endText)) {\n    const focusVElement = endText.parentElement?.closest('v-element');\n    if (!focusVElement) {\n      throw new Error(\n        'failed to find vElement for a text note in an embed element'\n      );\n    }\n    const nextSibling = focusVElement.nextElementSibling;\n    if (!nextSibling) {\n      throw new Error('failed to find nextSibling sibling of an embed element');\n    }\n\n    const texts = getTextNodesFromElement(nextSibling);\n    endText = texts[0];\n    focusOffset = 0;\n  }\n\n  const range = document.createRange();\n  range.setStart(startText, anchorOffset);\n  range.setEnd(endText, focusOffset);\n\n  return range;\n}\n","import { html, type TemplateResult } from 'lit';\n\nimport type { DeltaInsert } from '../types.js';\nimport type { BaseTextAttributes } from './base-attributes.js';\n\nexport function renderElement<TextAttributes extends BaseTextAttributes>(\n  delta: DeltaInsert<TextAttributes>,\n  parseAttributes: (\n    textAttributes?: TextAttributes\n  ) => TextAttributes | undefined,\n  selected: boolean\n): TemplateResult<1> {\n  return html`<v-element\n    .selected=${selected}\n    .delta=${{\n      insert: delta.insert,\n      attributes: parseAttributes(delta.attributes),\n    }}\n  ></v-element>`;\n}\n","import type { InlineEditor } from '../inline-editor.js';\nimport type { InlineRange } from '../types.js';\nimport type { BaseTextAttributes } from './base-attributes.js';\n\nfunction handleInsertText<TextAttributes extends BaseTextAttributes>(\n  inlineRange: InlineRange,\n  data: string | null,\n  editor: InlineEditor,\n  attributes: TextAttributes\n) {\n  if (!data) return;\n  editor.insertText(inlineRange, data, attributes);\n  editor.setInlineRange({\n    index: inlineRange.index + data.length,\n    length: 0,\n  });\n}\n\nfunction handleInsertParagraph(inlineRange: InlineRange, editor: InlineEditor) {\n  editor.insertLineBreak(inlineRange);\n  editor.setInlineRange({\n    index: inlineRange.index + 1,\n    length: 0,\n  });\n}\n\nfunction handleDelete(inlineRange: InlineRange, editor: InlineEditor) {\n  editor.deleteText(inlineRange);\n  editor.setInlineRange({\n    index: inlineRange.index,\n    length: 0,\n  });\n}\n\nexport function transformInput<TextAttributes extends BaseTextAttributes>(\n  inputType: string,\n  data: string | null,\n  attributes: TextAttributes,\n  inlineRange: InlineRange,\n  editor: InlineEditor\n) {\n  if (!editor.isValidInlineRange(inlineRange)) return;\n\n  if (inputType === 'insertText') {\n    handleInsertText(inlineRange, data, editor, attributes);\n  } else if (\n    inputType === 'insertParagraph' ||\n    inputType === 'insertLineBreak'\n  ) {\n    handleInsertParagraph(inlineRange, editor);\n  } else if (inputType.startsWith('delete')) {\n    handleDelete(inlineRange, editor);\n  } else {\n    return;\n  }\n}\n","import type { z, ZodTypeDef } from 'zod';\n\nimport type { InlineEditor } from '../inline-editor.js';\nimport type { AttributeRenderer } from '../types.js';\nimport type { InlineRange } from '../types.js';\nimport type { BaseTextAttributes } from '../utils/index.js';\nimport {\n  baseTextAttributes,\n  getDefaultAttributeRenderer,\n} from '../utils/index.js';\n\nexport class AttributeService<TextAttributes extends BaseTextAttributes> {\n  private _marks: TextAttributes | null = null;\n\n  private _attributeRenderer: AttributeRenderer<TextAttributes> =\n    getDefaultAttributeRenderer<TextAttributes>();\n\n  private _attributeSchema: z.ZodSchema<TextAttributes, ZodTypeDef, unknown> =\n    baseTextAttributes as z.ZodSchema<TextAttributes, ZodTypeDef, unknown>;\n\n  constructor(public readonly editor: InlineEditor<TextAttributes>) {}\n\n  get marks() {\n    return this._marks;\n  }\n\n  get attributeRenderer() {\n    return this._attributeRenderer;\n  }\n\n  setMarks = (marks: TextAttributes): void => {\n    this._marks = marks;\n  };\n\n  resetMarks = (): void => {\n    this._marks = null;\n  };\n\n  setAttributeSchema = (\n    schema: z.ZodSchema<TextAttributes, ZodTypeDef, unknown>\n  ) => {\n    this._attributeSchema = schema;\n  };\n\n  setAttributeRenderer = (renderer: AttributeRenderer<TextAttributes>) => {\n    this._attributeRenderer = renderer;\n  };\n\n  getFormat = (inlineRange: InlineRange, loose = false): TextAttributes => {\n    const deltas = this.editor.deltaService\n      .getDeltasByInlineRange(inlineRange)\n      .filter(\n        ([_, position]) =>\n          position.index + position.length > inlineRange.index &&\n          position.index <= inlineRange.index + inlineRange.length\n      );\n    const maybeAttributesList = deltas.map(([delta]) => delta.attributes);\n    if (loose) {\n      return maybeAttributesList.reduce(\n        (acc, cur) => ({ ...acc, ...cur }),\n        {}\n      ) as TextAttributes;\n    }\n    if (\n      !maybeAttributesList.length ||\n      // some text does not have any attribute\n      maybeAttributesList.some(attributes => !attributes)\n    ) {\n      return {} as TextAttributes;\n    }\n    const attributesList = maybeAttributesList as TextAttributes[];\n    return attributesList.reduce((acc, cur) => {\n      const newFormat = {} as TextAttributes;\n      for (const key in acc) {\n        const typedKey = key as keyof TextAttributes;\n        // If the given range contains multiple different formats\n        // such as links with different values,\n        // we will treat it as having no format\n        if (acc[typedKey] === cur[typedKey]) {\n          // This cast is secure because we have checked that the value of the key is the same.\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          newFormat[typedKey] = acc[typedKey] as any;\n        }\n      }\n      return newFormat;\n    });\n  };\n\n  normalizeAttributes = (textAttributes?: TextAttributes) => {\n    if (!textAttributes) {\n      return undefined;\n    }\n    const attributeResult = this._attributeSchema.safeParse(textAttributes);\n    if (!attributeResult.success) {\n      console.error(attributeResult.error);\n      return undefined;\n    }\n    return Object.fromEntries(\n      // filter out undefined values\n      Object.entries(attributeResult.data).filter(([_, v]) => v || v === null)\n    ) as TextAttributes;\n  };\n}\n","import{_$LH as o}from\"./lit-html.js\";\n/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const{D:t}=o,i=o=>null===o||\"object\"!=typeof o&&\"function\"!=typeof o,n={HTML:1,SVG:2},e=(o,t)=>void 0===t?void 0!==o?._$litType$:o?._$litType$===t,l=o=>null!=o?._$litType$?.h,c=o=>void 0!==o?._$litDirective$,d=o=>o?._$litDirective$,f=o=>void 0===o.strings,s=()=>document.createComment(\"\"),r=(o,i,n)=>{const e=o._$AA.parentNode,l=void 0===i?o._$AB:i._$AA;if(void 0===n){const i=e.insertBefore(s(),l),c=e.insertBefore(s(),l);n=new t(i,c,o,o.options)}else{const t=n._$AB.nextSibling,i=n._$AM,c=i!==o;if(c){let t;n._$AQ?.(o),n._$AM=o,void 0!==n._$AP&&(t=o._$AU)!==i._$AU&&n._$AP(t)}if(t!==l||c){let o=n._$AA;for(;o!==t;){const t=o.nextSibling;e.insertBefore(o,l),o=t}}}return n},v=(o,t,i=o)=>(o._$AI(t,i),o),u={},m=(o,t=u)=>o._$AH=t,p=o=>o._$AH,h=o=>{o._$AP?.(!1,!0);let t=o._$AA;const i=o._$AB.nextSibling;for(;t!==i;){const o=t.nextSibling;t.remove(),t=o}},j=o=>{o._$AR()};export{n as TemplateResultType,j as clearPart,p as getCommittedValue,d as getDirectiveClass,r as insertPart,l as isCompiledTemplateResult,c as isDirectiveResult,i as isPrimitive,f as isSingleExpression,e as isTemplateResult,h as removePart,v as setChildPartValue,m as setCommittedValue};\n//# sourceMappingURL=directive-helpers.js.map\n","import{noChange as e}from\"../lit-html.js\";import{directive as s,Directive as t,PartType as r}from\"../directive.js\";import{getCommittedValue as l,setChildPartValue as o,insertPart as i,removePart as n,setCommittedValue as f}from\"../directive-helpers.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst u=(e,s,t)=>{const r=new Map;for(let l=s;l<=t;l++)r.set(e[l],l);return r},c=s(class extends t{constructor(e){if(super(e),e.type!==r.CHILD)throw Error(\"repeat() can only be used in text expressions\")}ht(e,s,t){let r;void 0===t?t=s:void 0!==s&&(r=s);const l=[],o=[];let i=0;for(const s of e)l[i]=r?r(s,i):i,o[i]=t(s,i),i++;return{values:o,keys:l}}render(e,s,t){return this.ht(e,s,t).values}update(s,[t,r,c]){const d=l(s),{values:p,keys:a}=this.ht(t,r,c);if(!Array.isArray(d))return this.dt=a,p;const h=this.dt??=[],v=[];let m,y,x=0,j=d.length-1,k=0,w=p.length-1;for(;x<=j&&k<=w;)if(null===d[x])x++;else if(null===d[j])j--;else if(h[x]===a[k])v[k]=o(d[x],p[k]),x++,k++;else if(h[j]===a[w])v[w]=o(d[j],p[w]),j--,w--;else if(h[x]===a[w])v[w]=o(d[x],p[w]),i(s,v[w+1],d[x]),x++,w--;else if(h[j]===a[k])v[k]=o(d[j],p[k]),i(s,d[x],d[j]),j--,k++;else if(void 0===m&&(m=u(a,k,w),y=u(h,x,j)),m.has(h[x]))if(m.has(h[j])){const e=y.get(a[k]),t=void 0!==e?d[e]:null;if(null===t){const e=i(s,d[x]);o(e,p[k]),v[k]=e}else v[k]=o(t,p[k]),i(s,d[x],t),d[e]=null;k++}else n(d[j]),j--;else n(d[x]),x++;for(;k<=w;){const e=i(s,v[w+1]);o(e,p[k]),v[k++]=e}for(;x<=j;){const e=d[x++];null!==e&&n(e)}return this.dt=a,f(s,v),e}});export{c as repeat};\n//# sourceMappingURL=repeat.js.map\n","import { html, render } from 'lit';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { VLine } from '../index.js';\nimport type { InlineEditor } from '../inline-editor.js';\nimport type { DeltaInsert } from '../types.js';\nimport type { DeltaEntry, InlineRange } from '../types.js';\nimport type { BaseTextAttributes } from '../utils/index.js';\nimport {\n  deltaInsertsToChunks,\n  renderElement,\n  transformDeltasToEmbedDeltas,\n} from '../utils/index.js';\n\nexport class DeltaService<TextAttributes extends BaseTextAttributes> {\n  constructor(public readonly editor: InlineEditor<TextAttributes>) {}\n\n  get deltas() {\n    return this.editor.yText.toDelta() as DeltaInsert<TextAttributes>[];\n  }\n\n  mapDeltasInInlineRange = <Result>(\n    inlineRange: InlineRange,\n    callback: (\n      delta: DeltaInsert<TextAttributes>,\n      rangeIndex: number,\n      deltaIndex: number\n    ) => Result,\n    normalize = false\n  ) => {\n    const deltas = normalize\n      ? transformDeltasToEmbedDeltas(this.editor, this.deltas)\n      : this.deltas;\n    const result: Result[] = [];\n\n    deltas.reduce((rangeIndex, delta, deltaIndex) => {\n      const length = delta.insert.length;\n      const from = inlineRange.index - length;\n      const to = inlineRange.index + inlineRange.length;\n\n      const deltaInRange =\n        rangeIndex >= from &&\n        (rangeIndex < to ||\n          (inlineRange.length === 0 && rangeIndex === inlineRange.index));\n\n      if (deltaInRange) {\n        const value = callback(delta, rangeIndex, deltaIndex);\n        result.push(value);\n      }\n\n      return rangeIndex + length;\n    }, 0);\n\n    return result;\n  };\n\n  isNormalizedDeltaSelected(\n    normalizedDeltaIndex: number,\n    inlineRange: InlineRange\n  ): boolean {\n    let result = false;\n    if (inlineRange.length >= 1) {\n      this.editor.mapDeltasInInlineRange(\n        inlineRange,\n        (_, rangeIndex, deltaIndex) => {\n          if (\n            deltaIndex === normalizedDeltaIndex &&\n            rangeIndex >= inlineRange.index\n          ) {\n            result = true;\n          }\n        },\n        // we need to normalize the delta here,\n        true\n      );\n    }\n\n    return result;\n  }\n\n  /**\n   * Here are examples of how this function computes and gets the delta.\n   *\n   * We have such a text:\n   * ```\n   * [\n   *   {\n   *      insert: 'aaa',\n   *      attributes: { bold: true },\n   *   },\n   *   {\n   *      insert: 'bbb',\n   *      attributes: { italic: true },\n   *   },\n   * ]\n   * ```\n   *\n   * `getDeltaByRangeIndex(0)` returns `{ insert: 'aaa', attributes: { bold: true } }`.\n   *\n   * `getDeltaByRangeIndex(1)` returns `{ insert: 'aaa', attributes: { bold: true } }`.\n   *\n   * `getDeltaByRangeIndex(3)` returns `{ insert: 'aaa', attributes: { bold: true } }`.\n   *\n   * `getDeltaByRangeIndex(4)` returns `{ insert: 'bbb', attributes: { italic: true } }`.\n   */\n  getDeltaByRangeIndex = (rangeIndex: number) => {\n    const deltas = this.deltas;\n\n    let index = 0;\n    for (const delta of deltas) {\n      if (index + delta.insert.length >= rangeIndex) {\n        return delta;\n      }\n      index += delta.insert.length;\n    }\n\n    return null;\n  };\n\n  /**\n   * Here are examples of how this function computes and gets the deltas.\n   *\n   * We have such a text:\n   * ```\n   * [\n   *   {\n   *      insert: 'aaa',\n   *      attributes: { bold: true },\n   *   },\n   *   {\n   *      insert: 'bbb',\n   *      attributes: { italic: true },\n   *   },\n   *   {\n   *      insert: 'ccc',\n   *      attributes: { underline: true },\n   *   },\n   * ]\n   * ```\n   *\n   * `getDeltasByInlineRange({ index: 0, length: 0 })` returns\n   * ```\n   * [{ insert: 'aaa', attributes: { bold: true }, }, { index: 0, length: 3, }]]\n   * ```\n   *\n   * `getDeltasByInlineRange({ index: 0, length: 1 })` returns\n   * ```\n   * [{ insert: 'aaa', attributes: { bold: true }, }, { index: 0, length: 3, }]]\n   * ```\n   *\n   * `getDeltasByInlineRange({ index: 0, length: 4 })` returns\n   * ```\n   * [{ insert: 'aaa', attributes: { bold: true }, }, { index: 0, length: 3, }],\n   *  [{ insert: 'bbb', attributes: { italic: true }, }, { index: 3, length: 3, }]]\n   * ```\n   *\n   * `getDeltasByInlineRange({ index: 3, length: 1 })` returns\n   * ```\n   * [{ insert: 'aaa', attributes: { bold: true }, }, { index: 0, length: 3, }],\n   *  [{ insert: 'bbb', attributes: { italic: true }, }, { index: 3, length: 3, }]]\n   * ```\n   *\n   * `getDeltasByInlineRange({ index: 3, length: 3 })` returns\n   * ```\n   * [{ insert: 'aaa', attributes: { bold: true }, }, { index: 0, length: 3, }],\n   *  [{ insert: 'bbb', attributes: { italic: true }, }, { index: 3, length: 3, }]]\n   * ```\n   *\n   *  `getDeltasByInlineRange({ index: 3, length: 4 })` returns\n   * ```\n   * [{ insert: 'aaa', attributes: { bold: true }, }, { index: 0, length: 3, }],\n   *  [{ insert: 'bbb', attributes: { italic: true }, }, { index: 3, length: 3, }],\n   *  [{ insert: 'ccc', attributes: { underline: true }, }, { index: 6, length: 3, }]]\n   * ```\n   */\n  getDeltasByInlineRange = (\n    inlineRange: InlineRange\n  ): DeltaEntry<TextAttributes>[] => {\n    return this.mapDeltasInInlineRange(\n      inlineRange,\n      (delta, index): DeltaEntry<TextAttributes> => [\n        delta,\n        { index, length: delta.insert.length },\n      ]\n    );\n  };\n\n  // render current deltas to VLines\n  render = async (syncInlineRange = true) => {\n    if (!this.editor.mounted) return;\n\n    this.editor.slots.render.emit();\n\n    const rootElement = this.editor.rootElement;\n\n    const normalizedDeltas = transformDeltasToEmbedDeltas(\n      this.editor,\n      this.deltas\n    );\n    const chunks = deltaInsertsToChunks(normalizedDeltas);\n\n    let normalizedDeltaIndex = 0;\n    // every chunk is a line\n    const lines = chunks.map(chunk => {\n      if (chunk.length > 0) {\n        const lineDeltas: [DeltaInsert<TextAttributes>, number][] = [];\n        chunk.forEach(delta => {\n          lineDeltas.push([delta, normalizedDeltaIndex]);\n          normalizedDeltaIndex++;\n        });\n\n        const elements: VLine['elements'] = lineDeltas.map(\n          ([delta, normalizedDeltaIndex]) => {\n            let selected = false;\n            const inlineRange = this.editor.getInlineRange();\n            if (inlineRange) {\n              selected = this.isNormalizedDeltaSelected(\n                normalizedDeltaIndex,\n                inlineRange\n              );\n            }\n\n            return [\n              renderElement(\n                delta,\n                this.editor.attributeService.normalizeAttributes,\n                selected\n              ),\n              delta,\n            ];\n          }\n        );\n\n        return html`<v-line .elements=${elements}></v-line>`;\n      } else {\n        return html`<v-line .elements=${[]}></v-line>`;\n      }\n    });\n\n    try {\n      render(\n        repeat(\n          lines.map((line, i) => ({ line, index: i })),\n          entry => entry.index,\n          entry => entry.line\n        ),\n        rootElement\n      );\n    } catch (_) {\n      // Lit may be crashed by IME input and we need to rerender whole editor for it\n      this.editor.rerenderWholeEditor();\n      await this.editor.waitForUpdate();\n    }\n\n    await this.editor.waitForUpdate();\n\n    if (syncInlineRange) {\n      // We need to synchronize the selection immediately after rendering is completed,\n      // otherwise there is a possibility of an error in the cursor position\n      this.editor.rangeService.syncInlineRange();\n    }\n\n    this.editor.slots.renderComplete.emit();\n  };\n}\n","import type { InlineRange } from '../types.js';\n\nexport function isMaybeInlineRangeEqual(\n  a: InlineRange | null,\n  b: InlineRange | null\n): boolean {\n  return a === b || (a && b ? isInlineRangeEqual(a, b) : false);\n}\n\nexport function isInlineRangeContain(a: InlineRange, b: InlineRange): boolean {\n  return a.index <= b.index && a.index + a.length >= b.index + b.length;\n}\n\nexport function isInlineRangeEqual(a: InlineRange, b: InlineRange): boolean {\n  return a.index === b.index && a.length === b.length;\n}\n\nexport function isInlineRangeIntersect(\n  a: InlineRange,\n  b: InlineRange\n): boolean {\n  return a.index <= b.index + b.length && a.index + a.length >= b.index;\n}\n\nexport function isInlineRangeBefore(a: InlineRange, b: InlineRange): boolean {\n  return a.index + a.length <= b.index;\n}\n\nexport function isInlineRangeAfter(a: InlineRange, b: InlineRange): boolean {\n  return a.index >= b.index + b.length;\n}\n\nexport function isInlineRangeEdge(\n  index: InlineRange['index'],\n  range: InlineRange\n): boolean {\n  return index === range.index || index === range.index + range.length;\n}\n\nexport function isInlineRangeEdgeBefore(\n  index: InlineRange['index'],\n  range: InlineRange\n): boolean {\n  return index === range.index;\n}\n\nexport function isInlineRangeEdgeAfter(\n  index: InlineRange['index'],\n  range: InlineRange\n): boolean {\n  return index === range.index + range.length;\n}\n\nexport function isPoint(range: InlineRange): boolean {\n  return range.length === 0;\n}\n\nexport function mergeInlineRange(a: InlineRange, b: InlineRange): InlineRange {\n  const index = Math.min(a.index, b.index);\n  const length = Math.max(a.index + a.length, b.index + b.length) - index;\n  return { index, length };\n}\n\nexport function intersectInlineRange(\n  a: InlineRange,\n  b: InlineRange\n): InlineRange | null {\n  if (!isInlineRangeIntersect(a, b)) {\n    return null;\n  }\n  const index = Math.max(a.index, b.index);\n  const length = Math.min(a.index + a.length, b.index + b.length) - index;\n  return { index, length };\n}\n","import { ZERO_WIDTH_SPACE } from '../consts.js';\nimport type { InlineEditor } from '../inline-editor.js';\nimport type { InlineRange, NativePoint } from '../types.js';\nimport {\n  type BaseTextAttributes,\n  findDocumentOrShadowRoot,\n  isInEmbedElement,\n} from '../utils/index.js';\nimport { isMaybeInlineRangeEqual } from '../utils/inline-range.js';\nimport { transformInput } from '../utils/transform-input.js';\nimport type { BeforeinputHookCtx, CompositionEndHookCtx } from './hook.js';\n\nexport class EventService<TextAttributes extends BaseTextAttributes> {\n  private _isComposing = false;\n  get isComposing() {\n    return this._isComposing;\n  }\n\n  private _previousAnchor: NativePoint | null = null;\n  private _previousFocus: NativePoint | null = null;\n\n  constructor(public readonly editor: InlineEditor<TextAttributes>) {}\n\n  get inlineRangeProvider() {\n    return this.editor.inlineRangeProvider;\n  }\n\n  mount = () => {\n    const eventSource = this.editor.eventSource;\n    const rootElement = this.editor.rootElement;\n\n    if (!this.inlineRangeProvider) {\n      this.editor.disposables.addFromEvent(\n        document,\n        'selectionchange',\n        this._onSelectionChange\n      );\n    }\n\n    this.editor.disposables.addFromEvent(\n      eventSource,\n      'beforeinput',\n      this._onBeforeInput\n    );\n    this.editor.disposables.addFromEvent(\n      eventSource,\n      'compositionstart',\n      this._onCompositionStart\n    );\n    this.editor.disposables.addFromEvent(\n      eventSource,\n      'compositionupdate',\n      this._onCompositionUpdate\n    );\n    this.editor.disposables.addFromEvent(\n      eventSource,\n      'compositionend',\n      (event: CompositionEvent) => {\n        this._onCompositionEnd(event).catch(console.error);\n      }\n    );\n    this.editor.disposables.addFromEvent(\n      eventSource,\n      'keydown',\n      this._onKeyDown\n    );\n    this.editor.disposables.addFromEvent(rootElement, 'click', this._onClick);\n  };\n\n  private _isRangeCompletelyInRoot = (range: Range) => {\n    const rootElement = this.editor.rootElement;\n    const rootRange = document.createRange();\n    rootRange.selectNode(rootElement);\n\n    if (\n      range.startContainer.compareDocumentPosition(range.endContainer) &\n      Node.DOCUMENT_POSITION_FOLLOWING\n    ) {\n      return (\n        rootRange.comparePoint(range.startContainer, range.startOffset) >= 0 &&\n        rootRange.comparePoint(range.endContainer, range.endOffset) <= 0\n      );\n    } else {\n      return (\n        rootRange.comparePoint(range.endContainer, range.startOffset) >= 0 &&\n        rootRange.comparePoint(range.startContainer, range.endOffset) <= 0\n      );\n    }\n  };\n\n  private _onSelectionChange = () => {\n    const rootElement = this.editor.rootElement;\n    const previousInlineRange = this.editor.getInlineRange();\n    if (this._isComposing) {\n      return;\n    }\n\n    const selectionRoot = findDocumentOrShadowRoot(this.editor);\n    const selection = selectionRoot.getSelection();\n    if (!selection) return;\n    if (selection.rangeCount === 0) {\n      if (previousInlineRange !== null) {\n        this.editor.setInlineRange(null, false);\n      }\n\n      return;\n    }\n\n    const range = selection.getRangeAt(0);\n\n    if (\n      range.startContainer === range.endContainer &&\n      range.startContainer.textContent === ZERO_WIDTH_SPACE &&\n      range.startOffset === 1\n    ) {\n      range.setStart(range.startContainer, 0);\n      range.setEnd(range.endContainer, 0);\n      selection.removeAllRanges();\n      selection.addRange(range);\n      return;\n    }\n\n    if (!range.intersectsNode(rootElement)) {\n      const isContainerSelected =\n        range.endContainer.contains(rootElement) &&\n        Array.from(range.endContainer.childNodes).filter(\n          node => node instanceof HTMLElement\n        ).length === 1 &&\n        range.startContainer.contains(rootElement) &&\n        Array.from(range.startContainer.childNodes).filter(\n          node => node instanceof HTMLElement\n        ).length === 1;\n      if (isContainerSelected) {\n        this.editor.focusEnd();\n        return;\n      } else {\n        if (previousInlineRange !== null) {\n          this.editor.setInlineRange(null, false);\n        }\n        return;\n      }\n    }\n\n    this._previousAnchor = [range.startContainer, range.startOffset];\n    this._previousFocus = [range.endContainer, range.endOffset];\n\n    const inlineRange = this.editor.toInlineRange(selection.getRangeAt(0));\n    if (!isMaybeInlineRangeEqual(previousInlineRange, inlineRange)) {\n      this.editor.setInlineRange(inlineRange, false);\n    }\n\n    // avoid infinite syncInlineRange\n    if (\n      ((range.startContainer.nodeType !== Node.TEXT_NODE ||\n        range.endContainer.nodeType !== Node.TEXT_NODE) &&\n        range.startContainer !== this._previousAnchor[0] &&\n        range.endContainer !== this._previousFocus[0] &&\n        range.startOffset !== this._previousAnchor[1] &&\n        range.endOffset !== this._previousFocus[1]) ||\n      range.startContainer.nodeType === Node.COMMENT_NODE ||\n      range.endContainer.nodeType === Node.COMMENT_NODE\n    ) {\n      this.editor.syncInlineRange();\n    }\n  };\n\n  private _compositionInlineRange: InlineRange | null = null;\n  private _onCompositionStart = () => {\n    this._isComposing = true;\n    // embeds is not editable and it will break IME\n    const embeds = this.editor.rootElement.querySelectorAll(\n      '[data-v-embed=\"true\"]'\n    );\n    embeds.forEach(embed => {\n      embed.removeAttribute('contenteditable');\n    });\n\n    const range = this.editor.rangeService.getNativeRange();\n    if (range) {\n      this._compositionInlineRange = this.editor.toInlineRange(range);\n    } else {\n      this._compositionInlineRange = null;\n    }\n  };\n\n  private _onCompositionUpdate = () => {\n    if (!this.editor.rootElement.isConnected) return;\n\n    const range = this.editor.rangeService.getNativeRange();\n    if (\n      this.editor.isReadonly ||\n      !range ||\n      !this._isRangeCompletelyInRoot(range)\n    )\n      return;\n\n    this.editor.slots.inputting.emit();\n  };\n\n  private _onCompositionEnd = async (event: CompositionEvent) => {\n    this._isComposing = false;\n    if (!this.editor.rootElement.isConnected) return;\n\n    const range = this.editor.rangeService.getNativeRange();\n    if (\n      this.editor.isReadonly ||\n      !range ||\n      !this._isRangeCompletelyInRoot(range)\n    )\n      return;\n\n    this.editor.rerenderWholeEditor();\n    await this.editor.waitForUpdate();\n\n    const inlineRange = this._compositionInlineRange;\n    if (!inlineRange) return;\n\n    event.preventDefault();\n\n    let ctx: CompositionEndHookCtx<TextAttributes> | null = {\n      inlineEditor: this.editor,\n      raw: event,\n      inlineRange,\n      data: event.data,\n      attributes: {} as TextAttributes,\n    };\n    const hook = this.editor.hooks.compositionEnd;\n    if (hook) {\n      ctx = hook(ctx);\n    }\n    if (!ctx) return;\n\n    const { inlineRange: newInlineRange, data: newData } = ctx;\n    if (newData && newData.length > 0) {\n      this.editor.insertText(newInlineRange, newData, ctx.attributes);\n      this.editor.setInlineRange(\n        {\n          index: newInlineRange.index + newData.length,\n          length: 0,\n        },\n        false\n      );\n    }\n\n    this.editor.slots.inputting.emit();\n  };\n\n  private _onBeforeInput = (event: InputEvent) => {\n    const range = this.editor.rangeService.getNativeRange();\n    if (\n      this.editor.isReadonly ||\n      this._isComposing ||\n      !range ||\n      !this._isRangeCompletelyInRoot(range)\n    )\n      return;\n\n    if (!this.editor.getInlineRange()) return;\n\n    const targetRanges = event.getTargetRanges();\n    if (targetRanges.length > 0) {\n      const staticRange = targetRanges[0];\n      const range = document.createRange();\n      range.setStart(staticRange.startContainer, staticRange.startOffset);\n      range.setEnd(staticRange.endContainer, staticRange.endOffset);\n      const inlineRange = this.editor.toInlineRange(range);\n\n      if (!isMaybeInlineRangeEqual(this.editor.getInlineRange(), inlineRange)) {\n        this.editor.setInlineRange(inlineRange, false);\n      }\n    }\n\n    const inlineRange = this.editor.getInlineRange();\n    if (!inlineRange) return;\n\n    event.preventDefault();\n\n    let ctx: BeforeinputHookCtx<TextAttributes> | null = {\n      inlineEditor: this.editor,\n      raw: event,\n      inlineRange: inlineRange,\n      data: event.data,\n      attributes: {} as TextAttributes,\n    };\n    const hook = this.editor.hooks.beforeinput;\n    if (hook) {\n      ctx = hook(ctx);\n    }\n    if (!ctx) return;\n\n    const { raw: newEvent, data, inlineRange: newInlineRange } = ctx;\n    transformInput<TextAttributes>(\n      newEvent.inputType,\n      data,\n      ctx.attributes,\n      newInlineRange,\n      this.editor as InlineEditor\n    );\n\n    this.editor.slots.inputting.emit();\n  };\n\n  private _onKeyDown = (event: KeyboardEvent) => {\n    const inlineRange = this.editor.getInlineRange();\n    if (!inlineRange) return;\n\n    this.editor.slots.keydown.emit(event);\n\n    if (\n      !event.shiftKey &&\n      (event.key === 'ArrowLeft' || event.key === 'ArrowRight')\n    ) {\n      if (inlineRange.length !== 0) return;\n\n      const prevent = () => {\n        event.preventDefault();\n        event.stopPropagation();\n      };\n\n      const deltas = this.editor.getDeltasByInlineRange(inlineRange);\n      if (deltas.length === 2) {\n        if (event.key === 'ArrowLeft' && this.editor.isEmbed(deltas[0][0])) {\n          prevent();\n          this.editor.setInlineRange({\n            index: inlineRange.index - 1,\n            length: 1,\n          });\n        } else if (\n          event.key === 'ArrowRight' &&\n          this.editor.isEmbed(deltas[1][0])\n        ) {\n          prevent();\n          this.editor.setInlineRange({\n            index: inlineRange.index,\n            length: 1,\n          });\n        }\n      } else if (deltas.length === 1) {\n        const delta = deltas[0][0];\n        if (this.editor.isEmbed(delta)) {\n          if (event.key === 'ArrowLeft' && inlineRange.index - 1 >= 0) {\n            prevent();\n            this.editor.setInlineRange({\n              index: inlineRange.index - 1,\n              length: 1,\n            });\n          } else if (\n            event.key === 'ArrowRight' &&\n            inlineRange.index + 1 <= this.editor.yTextLength\n          ) {\n            prevent();\n            this.editor.setInlineRange({\n              index: inlineRange.index,\n              length: 1,\n            });\n          }\n        }\n      }\n    }\n  };\n\n  private _onClick = (event: MouseEvent) => {\n    // select embed element when click on it\n    if (event.target instanceof Node && isInEmbedElement(event.target)) {\n      const selectionRoot = findDocumentOrShadowRoot(this.editor);\n      const selection = selectionRoot.getSelection();\n      if (!selection) return;\n      if (event.target instanceof HTMLElement) {\n        const vElement = event.target.closest('v-element');\n        if (vElement) {\n          selection.selectAllChildren(vElement);\n        }\n      } else {\n        const vElement = event.target.parentElement?.closest('v-element');\n        if (vElement) {\n          selection.selectAllChildren(vElement);\n        }\n      }\n    }\n  };\n}\n","import { assertExists } from '@blocksuite/global/utils';\nimport * as Y from 'yjs';\n\nimport type { VLine } from '../components/v-line.js';\nimport type { InlineEditor } from '../inline-editor.js';\nimport type {\n  InlineRange,\n  InlineRangeUpdatedProp,\n  TextPoint,\n} from '../types.js';\nimport type { BaseTextAttributes } from '../utils/base-attributes.js';\nimport { isMaybeInlineRangeEqual } from '../utils/inline-range.js';\nimport { findDocumentOrShadowRoot } from '../utils/query.js';\nimport {\n  domRangeToInlineRange,\n  inlineRangeToDomRange,\n} from '../utils/range-conversion.js';\nimport { calculateTextLength, getTextNodesFromElement } from '../utils/text.js';\n\nexport class RangeService<TextAttributes extends BaseTextAttributes> {\n  private _inlineRange: InlineRange | null = null;\n  private _lastStartRelativePosition: Y.RelativePosition | null = null;\n  private _lastEndRelativePosition: Y.RelativePosition | null = null;\n\n  constructor(public readonly editor: InlineEditor<TextAttributes>) {}\n\n  get yText() {\n    return this.editor.yText;\n  }\n\n  get inlineRangeProvider() {\n    return this.editor.inlineRangeProvider;\n  }\n\n  get rootElement() {\n    return this.editor.rootElement;\n  }\n\n  get lastStartRelativePosition() {\n    return this._lastStartRelativePosition;\n  }\n  get lastEndRelativePosition() {\n    return this._lastEndRelativePosition;\n  }\n\n  onInlineRangeUpdated = async ([\n    newInlineRange,\n    sync,\n  ]: InlineRangeUpdatedProp) => {\n    const eq = isMaybeInlineRangeEqual(this._inlineRange, newInlineRange);\n    if (eq) {\n      return;\n    }\n\n    this._inlineRange = newInlineRange;\n\n    if (newInlineRange) {\n      this._lastStartRelativePosition = Y.createRelativePositionFromTypeIndex(\n        this.yText,\n        newInlineRange.index\n      );\n      this._lastEndRelativePosition = Y.createRelativePositionFromTypeIndex(\n        this.yText,\n        newInlineRange.index + newInlineRange.length\n      );\n    } else {\n      this._lastStartRelativePosition = null;\n      this._lastEndRelativePosition = null;\n    }\n\n    // try to trigger update because the `selected` state of inline editor element may change\n    if (this.editor.mounted) {\n      // range change may happen before the editor is prepared\n      await this.editor.waitForUpdate();\n      this.editor.requestUpdate(false);\n    }\n\n    if (!sync) {\n      return;\n    }\n\n    if (this._inlineRange === null) {\n      const selectionRoot = findDocumentOrShadowRoot(this.editor);\n      const selection = selectionRoot.getSelection();\n      if (selection && selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        if (range.intersectsNode(this.editor.rootElement)) {\n          selection.removeAllRanges();\n        }\n      }\n      return;\n    }\n\n    const fn = () => {\n      // There may be multiple range update events in one frame,\n      // so we need to obtain the latest inline ranage.\n      // see https://github.com/toeverything/blocksuite/issues/2982\n      // when using input method inline ranage will return to the starting point,\n      // so we need to re-sync\n      this.syncInlineRange();\n    };\n\n    // updates in lit are performed asynchronously\n    requestAnimationFrame(fn);\n  };\n\n  getNativeSelection(): Selection | null {\n    const selectionRoot = findDocumentOrShadowRoot(this.editor);\n    const selection = selectionRoot.getSelection();\n    if (!selection) return null;\n    if (selection.rangeCount === 0) return null;\n\n    return selection;\n  }\n\n  getNativeRange(): Range | null {\n    const selection = this.getNativeSelection();\n    if (!selection) return null;\n    return selection.getRangeAt(0);\n  }\n\n  getInlineRange = (): InlineRange | null => {\n    if (this.inlineRangeProvider) {\n      return this.inlineRangeProvider.getInlineRange();\n    }\n\n    return this._inlineRange;\n  };\n\n  getInlineRangeFromElement = (element: Element): InlineRange | null => {\n    const range = document.createRange();\n    const text = element.querySelector('[data-v-text');\n    if (!text) {\n      return null;\n    }\n    const textNode = text.childNodes[1];\n    assertExists(textNode instanceof Text);\n    range.setStart(textNode, 0);\n    range.setEnd(textNode, textNode.textContent?.length ?? 0);\n    const inlineRange = this.toInlineRange(range);\n    return inlineRange;\n  };\n\n  getTextPoint(rangeIndex: InlineRange['index']): TextPoint {\n    const vLines = Array.from(this.rootElement.querySelectorAll('v-line'));\n\n    let index = 0;\n    for (const vLine of vLines) {\n      const texts = getTextNodesFromElement(vLine);\n\n      for (const text of texts) {\n        if (!text.textContent) {\n          throw new Error('text element should have textContent');\n        }\n        if (index + text.textContent.length >= rangeIndex) {\n          return [text, rangeIndex - index];\n        }\n        index += calculateTextLength(text);\n      }\n\n      index += 1;\n    }\n\n    throw new Error('failed to find leaf');\n  }\n\n  // the number is related to the VLine's textLength\n  getLine(rangeIndex: InlineRange['index']): readonly [VLine, number] {\n    const lineElements = Array.from(\n      this.rootElement.querySelectorAll('v-line')\n    );\n\n    let index = 0;\n    for (const lineElement of lineElements) {\n      if (rangeIndex >= index && rangeIndex <= index + lineElement.textLength) {\n        return [lineElement, rangeIndex - index] as const;\n      }\n      if (\n        rangeIndex === index + lineElement.textLength &&\n        rangeIndex === this.editor.yTextLength\n      ) {\n        return [lineElement, rangeIndex - index] as const;\n      }\n      index += lineElement.textLength + 1;\n    }\n\n    throw new Error('failed to find line');\n  }\n\n  isValidInlineRange = (inlineRange: InlineRange | null): boolean => {\n    return !(\n      inlineRange &&\n      (inlineRange.index < 0 ||\n        inlineRange.index + inlineRange.length > this.editor.yText.length)\n    );\n  };\n\n  /**\n   * There are two cases to have the second line:\n   * 1. long text auto wrap in span element\n   * 2. soft break\n   */\n  isFirstLine = (inlineRange: InlineRange | null): boolean => {\n    if (!inlineRange) return false;\n\n    if (inlineRange.length > 0) {\n      throw new Error('Inline range should be collapsed');\n    }\n\n    const range = this.toDomRange(inlineRange);\n    if (!range) {\n      throw new Error('failed to convert inline range to domRange');\n    }\n\n    // check case 1:\n    const beforeText = this.editor.yTextString.slice(0, inlineRange.index);\n    if (beforeText.includes('\\n')) {\n      return false;\n    }\n\n    // check case 2:\n    // If there is a wrapped text, there are two possible positions for\n    // cursor: (in first line and in second line)\n    // aaaaaaaa| or aaaaaaaa\n    // bb           |bb\n    // We have no way to distinguish them and we just assume that the cursor\n    // can not in the first line because if we apply the inline ranage manually the\n    // cursor will jump to the second line.\n    const container = range.commonAncestorContainer.parentElement;\n    assertExists(container);\n    const containerRect = container.getBoundingClientRect();\n    // There will be two rects if the cursor is at the edge of the line:\n    // aaaaaaaa| or aaaaaaaa\n    // bb           |bb\n    const rangeRects = range.getClientRects();\n    // We use last rect here to make sure we get the second rect.\n    // (Based on the assumption that the cursor can not in the first line)\n    const rangeRect = rangeRects[rangeRects.length - 1];\n    return rangeRect.top === containerRect.top;\n  };\n\n  /**\n   * There are two cases to have the second line:\n   * 1. long text auto wrap in span element\n   * 2. soft break\n   */\n  isLastLine = (inlineRange: InlineRange | null): boolean => {\n    if (!inlineRange) return false;\n\n    if (inlineRange.length > 0) {\n      throw new Error('Inline range should be collapsed');\n    }\n\n    // check case 1:\n    const afterText = this.editor.yTextString.slice(inlineRange.index);\n    if (afterText.includes('\\n')) {\n      return false;\n    }\n\n    const range = this.toDomRange(inlineRange);\n    if (!range) {\n      throw new Error('failed to convert inline range to domRange');\n    }\n\n    // check case 2:\n    // If there is a wrapped text, there are two possible positions for\n    // cursor: (in first line and in second line)\n    // aaaaaaaa| or aaaaaaaa\n    // bb           |bb\n    // We have no way to distinguish them and we just assume that the cursor\n    // can not in the first line because if we apply the inline ranage manually the\n    // cursor will jump to the second line.\n    const container = range.commonAncestorContainer.parentElement;\n    assertExists(container);\n    const containerRect = container.getBoundingClientRect();\n    // There will be two rects if the cursor is at the edge of the line:\n    // aaaaaaaa| or aaaaaaaa\n    // bb           |bb\n    const rangeRects = range.getClientRects();\n    // We use last rect here to make sure we get the second rect.\n    // (Based on the assumption that the cursor can not in the first line)\n    const rangeRect = rangeRects[rangeRects.length - 1];\n    return rangeRect.bottom === containerRect.bottom;\n  };\n\n  /**\n   * the inline ranage is synced to the native selection asynchronically\n   * if sync is true, the native selection will be synced immediately\n   */\n  setInlineRange = (inlineRange: InlineRange | null, sync = true): void => {\n    if (!this.isValidInlineRange(inlineRange)) {\n      throw new Error('invalid inline range');\n    }\n\n    if (this.inlineRangeProvider) {\n      this.inlineRangeProvider.setInlineRange(inlineRange, sync);\n      return;\n    }\n\n    this.editor.slots.inlineRangeUpdate.emit([inlineRange, sync]);\n  };\n\n  focusEnd = (): void => {\n    this.setInlineRange({\n      index: this.editor.yTextLength,\n      length: 0,\n    });\n  };\n\n  focusStart = (): void => {\n    this.setInlineRange({\n      index: 0,\n      length: 0,\n    });\n  };\n\n  selectAll = (): void => {\n    this.setInlineRange({\n      index: 0,\n      length: this.editor.yTextLength,\n    });\n  };\n\n  focusIndex = (index: number): void => {\n    this.setInlineRange({\n      index,\n      length: 0,\n    });\n  };\n\n  /**\n   * sync the dom selection from inline ranage for **this Editor**\n   */\n  syncInlineRange = (): void => {\n    const inlineRange = this.getInlineRange();\n    if (inlineRange && this.editor.mounted) {\n      this._applyInlineRange(inlineRange);\n    }\n  };\n\n  /**\n   * calculate the dom selection from inline ranage for **this Editor**\n   */\n  toDomRange = (inlineRange: InlineRange): Range | null => {\n    const rootElement = this.editor.rootElement;\n    return inlineRangeToDomRange(rootElement, inlineRange);\n  };\n\n  /**\n   * calculate the inline ranage from dom selection for **this Editor**\n   * there are three cases when the inline ranage of this Editor is not null:\n   * (In the following, \"|\" mean anchor and focus, each line is a separate Editor)\n   * 1. anchor and focus are in this Editor\n   *    ```\n   *    aaaaaa\n   *    b|bbbb|b\n   *    cccccc\n   *    ```\n   *    the inline ranage of second Editor is `{index: 1, length: 4}`, the others are null\n   * 2. anchor and focus one in this Editor, one in another Editor\n   *    ```\n   *    aaa|aaa    aaaaaa\n   *    bbbbb|b or bbbbb|b\n   *    cccccc     cc|cccc\n   *    ```\n   *    2.1\n   *        the inline ranage of first Editor is `{index: 3, length: 3}`, the second is `{index: 0, length: 5}`,\n   *        the third is null\n   *    2.2\n   *        the inline ranage of first Editor is null, the second is `{index: 5, length: 1}`,\n   *        the third is `{index: 0, length: 2}`\n   * 3. anchor and focus are in another Editor\n   *    ```\n   *    aa|aaaa\n   *    bbbbbb\n   *    cccc|cc\n   *    ```\n   *    the inline range of first Editor is `{index: 2, length: 4}`,\n   *    the second is `{index: 0, length: 6}`, the third is `{index: 0, length: 4}`\n   */\n  toInlineRange = (range: Range): InlineRange | null => {\n    const { rootElement, yText } = this.editor;\n\n    return domRangeToInlineRange(range, rootElement, yText);\n  };\n\n  private _applyInlineRange = (inlineRange: InlineRange): void => {\n    const selectionRoot = findDocumentOrShadowRoot(this.editor);\n    const selection = selectionRoot.getSelection();\n    if (!selection) {\n      return;\n    }\n    const newRange = this.toDomRange(inlineRange);\n\n    if (!newRange) {\n      return;\n    }\n\n    selection.removeAllRanges();\n    selection.addRange(newRange);\n    this.editor.slots.inlineRangeApply.emit(newRange);\n  };\n}\n","import type { InlineEditor } from '../inline-editor.js';\nimport type { DeltaInsert, InlineRange } from '../types.js';\nimport type { BaseTextAttributes } from '../utils/base-attributes.js';\nimport { intersectInlineRange } from '../utils/inline-range.js';\n\nexport class InlineTextService<TextAttributes extends BaseTextAttributes> {\n  constructor(public readonly editor: InlineEditor<TextAttributes>) {}\n\n  readonly transact = this.editor.transact;\n\n  get yText() {\n    return this.editor.yText;\n  }\n\n  deleteText = (inlineRange: InlineRange): void => {\n    this.transact(() => {\n      this.yText.delete(inlineRange.index, inlineRange.length);\n    });\n  };\n\n  insertText = (\n    inlineRange: InlineRange,\n    text: string,\n    attributes: TextAttributes = {} as TextAttributes\n  ): void => {\n    if (this.editor.attributeService.marks) {\n      attributes = { ...attributes, ...this.editor.attributeService.marks };\n    }\n    const normalizedAttributes =\n      this.editor.attributeService.normalizeAttributes(attributes);\n\n    if (!text || !text.length) {\n      throw new Error('text must not be empty');\n    }\n\n    this.transact(() => {\n      this.yText.delete(inlineRange.index, inlineRange.length);\n      this.yText.insert(inlineRange.index, text, normalizedAttributes);\n    });\n  };\n\n  insertLineBreak = (inlineRange: InlineRange): void => {\n    this.transact(() => {\n      this.yText.delete(inlineRange.index, inlineRange.length);\n      this.yText.insert(inlineRange.index, '\\n');\n    });\n  };\n\n  formatText = (\n    inlineRange: InlineRange,\n    attributes: TextAttributes,\n    options: {\n      match?: (delta: DeltaInsert, deltaInlineRange: InlineRange) => boolean;\n      mode?: 'replace' | 'merge';\n    } = {}\n  ): void => {\n    const { match = () => true, mode = 'merge' } = options;\n    const deltas = this.editor.deltaService.getDeltasByInlineRange(inlineRange);\n\n    deltas\n      .filter(([delta, deltaInlineRange]) => match(delta, deltaInlineRange))\n      .forEach(([_delta, deltaInlineRange]) => {\n        const normalizedAttributes =\n          this.editor.attributeService.normalizeAttributes(attributes);\n        if (!normalizedAttributes) return;\n\n        const targetInlineRange = intersectInlineRange(\n          inlineRange,\n          deltaInlineRange\n        );\n        if (!targetInlineRange) return;\n\n        if (mode === 'replace') {\n          this.resetText(targetInlineRange);\n        }\n\n        this.transact(() => {\n          this.yText.format(\n            targetInlineRange.index,\n            targetInlineRange.length,\n            normalizedAttributes\n          );\n        });\n      });\n  };\n\n  resetText = (inlineRange: InlineRange): void => {\n    const coverDeltas: DeltaInsert[] = [];\n    for (\n      let i = inlineRange.index;\n      i <= inlineRange.index + inlineRange.length;\n      i++\n    ) {\n      const delta = this.editor.getDeltaByRangeIndex(i);\n      if (delta) {\n        coverDeltas.push(delta);\n      }\n    }\n\n    const unset = Object.fromEntries(\n      coverDeltas.flatMap(delta =>\n        delta.attributes\n          ? Object.keys(delta.attributes).map(key => [key, null])\n          : []\n      )\n    );\n\n    this.transact(() => {\n      this.yText.format(inlineRange.index, inlineRange.length, {\n        ...unset,\n      });\n    });\n  };\n\n  setText = (\n    text: string,\n    attributes: TextAttributes = {} as TextAttributes\n  ): void => {\n    this.transact(() => {\n      this.yText.delete(0, this.yText.length);\n      this.yText.insert(0, text, attributes);\n    });\n  };\n}\n","import { assertExists, DisposableGroup, Slot } from '@blocksuite/global/utils';\nimport { nothing, render } from 'lit';\nimport * as Y from 'yjs';\n\nimport { INLINE_ROOT_ATTR } from './consts.js';\nimport { InlineHookService } from './services/hook.js';\nimport {\n  AttributeService,\n  DeltaService,\n  EventService,\n  RangeService,\n} from './services/index.js';\nimport { InlineTextService } from './services/text.js';\nimport type {\n  DeltaInsert,\n  InlineRange,\n  InlineRangeUpdatedProp,\n} from './types.js';\nimport {\n  type BaseTextAttributes,\n  nativePointToTextPoint,\n  textPointToDomPoint,\n} from './utils/index.js';\nimport { getTextNodesFromElement } from './utils/text.js';\n\nexport type InlineRootElement<\n  T extends BaseTextAttributes = BaseTextAttributes,\n> = HTMLElement & {\n  inlineEditor: InlineEditor<T>;\n};\n\nexport interface InlineRangeProvider {\n  getInlineRange(): InlineRange | null;\n  setInlineRange(inlineRange: InlineRange | null, sync: boolean): void;\n  inlineRangeUpdated: Slot<InlineRangeUpdatedProp>;\n}\n\nexport class InlineEditor<\n  TextAttributes extends BaseTextAttributes = BaseTextAttributes,\n> {\n  static nativePointToTextPoint = nativePointToTextPoint;\n  static textPointToDomPoint = textPointToDomPoint;\n  static getTextNodesFromElement = getTextNodesFromElement;\n\n  private _disposables = new DisposableGroup();\n  get disposables() {\n    return this._disposables;\n  }\n\n  private readonly _yText: Y.Text;\n  private _rootElement: InlineRootElement<TextAttributes> | null = null;\n  private _eventSource: HTMLElement | null = null;\n  private _isReadonly = false;\n\n  private _eventService: EventService<TextAttributes> =\n    new EventService<TextAttributes>(this);\n\n  private _rangeService: RangeService<TextAttributes> =\n    new RangeService<TextAttributes>(this);\n\n  private _attributeService: AttributeService<TextAttributes> =\n    new AttributeService<TextAttributes>(this);\n\n  private _deltaService: DeltaService<TextAttributes> =\n    new DeltaService<TextAttributes>(this);\n\n  private _textService: InlineTextService<TextAttributes> =\n    new InlineTextService<TextAttributes>(this);\n\n  private _hooksService: InlineHookService<TextAttributes>;\n\n  private _mounted = false;\n\n  readonly isEmbed: (delta: DeltaInsert<TextAttributes>) => boolean;\n  readonly inlineRangeProvider: InlineRangeProvider | null;\n\n  readonly slots = {\n    mounted: new Slot(),\n    unmounted: new Slot(),\n    textChange: new Slot(),\n    render: new Slot(),\n    renderComplete: new Slot(),\n    inlineRangeUpdate: new Slot<InlineRangeUpdatedProp>(),\n    inlineRangeApply: new Slot<Range>(),\n    /**\n     * Corresponding to the `compositionUpdate` and `beforeInput` events, and triggered only when the `inlineRange` is not null.\n     */\n    inputting: new Slot(),\n    /**\n     * Triggered only when the `inlineRange` is not null.\n     */\n    keydown: new Slot<KeyboardEvent>(),\n  };\n\n  get yText() {\n    return this._yText;\n  }\n\n  get yTextString() {\n    return this.yText.toString();\n  }\n\n  get yTextLength() {\n    return this.yText.length;\n  }\n\n  get yTextDeltas() {\n    return this.yText.toDelta();\n  }\n\n  get rootElement() {\n    assertExists(this._rootElement);\n    return this._rootElement;\n  }\n\n  get eventSource() {\n    assertExists(this._eventSource);\n    return this._eventSource;\n  }\n\n  get eventService() {\n    return this._eventService;\n  }\n\n  get rangeService() {\n    return this._rangeService;\n  }\n\n  get attributeService() {\n    return this._attributeService;\n  }\n\n  get deltaService() {\n    return this._deltaService;\n  }\n\n  get mounted() {\n    return this._mounted;\n  }\n\n  // Expose attribute service API\n  get marks() {\n    return this._attributeService.marks;\n  }\n\n  setAttributeSchema = this._attributeService.setAttributeSchema;\n  setAttributeRenderer = this._attributeService.setAttributeRenderer;\n  setMarks = this._attributeService.setMarks;\n  resetMarks = this._attributeService.resetMarks;\n  getFormat = this._attributeService.getFormat;\n\n  // Expose range service API\n  toDomRange = this.rangeService.toDomRange;\n  toInlineRange = this.rangeService.toInlineRange;\n  getInlineRange = this.rangeService.getInlineRange;\n  getInlineRangeFromElement = this.rangeService.getInlineRangeFromElement;\n  getNativeSelection = this.rangeService.getNativeSelection;\n  getTextPoint = this.rangeService.getTextPoint;\n  getLine = this.rangeService.getLine;\n  isValidInlineRange = this.rangeService.isValidInlineRange;\n  isFirstLine = this.rangeService.isFirstLine;\n  isLastLine = this.rangeService.isLastLine;\n  setInlineRange = this.rangeService.setInlineRange;\n  focusStart = this.rangeService.focusStart;\n  focusEnd = this.rangeService.focusEnd;\n  selectAll = this.rangeService.selectAll;\n  focusIndex = this.rangeService.focusIndex;\n  syncInlineRange = this.rangeService.syncInlineRange;\n\n  // Expose delta service API\n  getDeltasByInlineRange = this.deltaService.getDeltasByInlineRange;\n  getDeltaByRangeIndex = this.deltaService.getDeltaByRangeIndex;\n  mapDeltasInInlineRange = this.deltaService.mapDeltasInInlineRange;\n  isNormalizedDeltaSelected = this.deltaService.isNormalizedDeltaSelected;\n\n  // Expose text service API\n  deleteText = this._textService.deleteText;\n  insertText = this._textService.insertText;\n  insertLineBreak = this._textService.insertLineBreak;\n  formatText = this._textService.formatText;\n  resetText = this._textService.resetText;\n  setText = this._textService.setText;\n\n  // Expose hook service API\n  get hooks() {\n    return this._hooksService.hooks;\n  }\n\n  // Expose event service API\n  get isComposing() {\n    return this._eventService.isComposing;\n  }\n\n  constructor(\n    yText: InlineEditor['yText'],\n    ops: {\n      isEmbed?: (delta: DeltaInsert<TextAttributes>) => boolean;\n      hooks?: InlineHookService<TextAttributes>['hooks'];\n      inlineRangeProvider?: InlineRangeProvider;\n    } = {}\n  ) {\n    if (!yText.doc) {\n      throw new Error('yText must be attached to a Y.Doc');\n    }\n\n    if (yText.toString().includes('\\r')) {\n      throw new Error(\n        'yText must not contain \"\\\\r\" because it will break the range synchronization'\n      );\n    }\n\n    const {\n      isEmbed = () => false,\n      hooks = {},\n      inlineRangeProvider = null,\n    } = ops;\n    this._yText = yText;\n    this.isEmbed = isEmbed;\n    this._hooksService = new InlineHookService(this, hooks);\n    this.inlineRangeProvider = inlineRangeProvider;\n\n    if (inlineRangeProvider) {\n      inlineRangeProvider.inlineRangeUpdated.on(prop => {\n        this.slots.inlineRangeUpdate.emit(prop);\n      });\n    }\n    this.slots.inlineRangeUpdate.on(this.rangeService.onInlineRangeUpdated);\n  }\n\n  mount(rootElement: HTMLElement, eventSource: HTMLElement = rootElement) {\n    const inlineRoot = rootElement as InlineRootElement<TextAttributes>;\n    inlineRoot.inlineEditor = this;\n    this._rootElement = inlineRoot;\n    this._eventSource = eventSource;\n    render(nothing, this._rootElement);\n    this._rootElement.contentEditable = 'true';\n    this._rootElement.style.outline = 'none';\n    this._eventSource.contentEditable = 'true';\n    this._eventSource.style.outline = 'none';\n    this._rootElement.dataset.vRoot = 'true';\n\n    this._bindYTextObserver();\n\n    this._eventService.mount();\n\n    this._mounted = true;\n    this.slots.mounted.emit();\n    this._deltaService.render().catch(console.error);\n  }\n\n  unmount() {\n    if (this.rootElement.isConnected) {\n      render(nothing, this.rootElement);\n    }\n    this.rootElement.removeAttribute(INLINE_ROOT_ATTR);\n    this._rootElement = null;\n    this._mounted = false;\n    this.disposables.dispose();\n    this.slots.unmounted.emit();\n  }\n\n  requestUpdate(syncInlineRange = true): void {\n    this._deltaService.render(syncInlineRange).catch(console.error);\n  }\n\n  async waitForUpdate() {\n    const vLines = Array.from(this.rootElement.querySelectorAll('v-line'));\n    await Promise.all(vLines.map(line => line.updateComplete));\n  }\n\n  setReadonly(isReadonly: boolean): void {\n    this.rootElement.contentEditable = isReadonly ? 'false' : 'true';\n    this._isReadonly = isReadonly;\n  }\n\n  get isReadonly() {\n    return this._isReadonly;\n  }\n\n  rerenderWholeEditor() {\n    if (!this.rootElement.isConnected) return;\n    render(nothing, this.rootElement);\n    this._deltaService.render().catch(console.error);\n  }\n\n  transact(fn: () => void): void {\n    const doc = this.yText.doc;\n    if (!doc) {\n      throw new Error('yText is not attached to a doc');\n    }\n\n    doc.transact(fn, doc.clientID);\n  }\n\n  private _onYTextChange = (_: Y.YTextEvent, _transaction: Y.Transaction) => {\n    if (this.yText.toString().includes('\\r')) {\n      throw new Error(\n        'yText must not contain \"\\\\r\" because it will break the range synchronization'\n      );\n    }\n\n    this.slots.textChange.emit();\n\n    Promise.resolve()\n      .then(() => {\n        this.deltaService.render().catch(console.error);\n\n        const inlineRange = this.rangeService.getInlineRange();\n        if (!inlineRange) return;\n\n        const lastStartRelativePosition =\n          this.rangeService.lastStartRelativePosition;\n        const lastEndRelativePosition =\n          this.rangeService.lastEndRelativePosition;\n        if (!lastStartRelativePosition || !lastEndRelativePosition) return;\n\n        const doc = this.yText.doc;\n        assertExists(doc);\n        const absoluteStart = Y.createAbsolutePositionFromRelativePosition(\n          lastStartRelativePosition,\n          doc\n        );\n        const absoluteEnd = Y.createAbsolutePositionFromRelativePosition(\n          lastEndRelativePosition,\n          doc\n        );\n        console.log(\n          '🚀 ~ .then ~ absoluteEnd:',\n          absoluteEnd,\n          Y.encodeRelativePosition(lastStartRelativePosition)\n        );\n\n        const startIndex = absoluteStart?.index;\n        const endIndex = absoluteEnd?.index;\n        if (!startIndex || !endIndex) return;\n\n        const newInlineRange: InlineRange = {\n          index: startIndex,\n          length: endIndex - startIndex,\n        };\n        if (!this.isValidInlineRange(newInlineRange)) return;\n\n        this.setInlineRange(newInlineRange);\n      })\n      .catch(console.error);\n  };\n\n  private _bindYTextObserver() {\n    this.yText.observe(this._onYTextChange);\n    this.disposables.add({\n      dispose: () => {\n        this.yText.unobserve(this._onYTextChange);\n      },\n    });\n  }\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nfunction n(n,r,t){return n?r(n):t?.(n)}export{n as when};\n//# sourceMappingURL=when.js.map\n","import { type Constructor, DisposableGroup } from '@blocksuite/global/utils';\nimport type { LitElement } from 'lit';\n\n// See https://lit.dev/docs/composition/mixins/#mixins-in-typescript\n// This definition should be exported, see https://github.com/microsoft/TypeScript/issues/30355#issuecomment-839834550\nexport declare class DisposableClass {\n  readonly disposables: DisposableGroup;\n  protected _disposables: DisposableGroup;\n}\n\n/**\n * Mixin that adds a `_disposables: DisposableGroup` property to the class.\n *\n * The `_disposables` property is initialized in `connectedCallback` and disposed in `disconnectedCallback`.\n *\n * see https://lit.dev/docs/composition/mixins/\n *\n * @example\n * ```ts\n * class MyElement extends WithDisposable(ShadowlessElement) {\n *   onClick() {\n *     this._disposables.add(...);\n *   }\n * }\n * ```\n */\nexport function WithDisposable<T extends Constructor<LitElement>>(\n  SuperClass: T\n) {\n  class DerivedClass extends SuperClass {\n    protected _disposables = new DisposableGroup();\n\n    get disposables() {\n      return this._disposables;\n    }\n\n    override connectedCallback() {\n      super.connectedCallback();\n      if (this._disposables.disposed) {\n        this._disposables = new DisposableGroup();\n      }\n    }\n\n    override disconnectedCallback() {\n      super.disconnectedCallback();\n      this._disposables.dispose();\n    }\n  }\n  return DerivedClass as unknown as T & Constructor<DisposableClass>;\n}\n","import type { CSSResultGroup, CSSResultOrNative } from 'lit';\nimport { CSSResult, LitElement } from 'lit';\n\nexport class ShadowlessElement extends LitElement {\n  static disableShadowRoot = true;\n\n  protected static override finalizeStyles(\n    styles?: CSSResultGroup\n  ): CSSResultOrNative[] {\n    let elementStyles = super.finalizeStyles(styles);\n    if (this.disableShadowRoot) {\n      // XXX: This breaks component encapsulation and applies styles to the document.\n      // These styles should be manually scoped.\n      elementStyles.forEach((s: CSSResultOrNative) => {\n        if (s instanceof CSSResult && typeof document !== 'undefined') {\n          const styleRoot = document.head;\n          const style = document.createElement('style');\n          style.textContent = s.cssText;\n          styleRoot.appendChild(style);\n        } else {\n          console.error('unreachable');\n        }\n      });\n      elementStyles = [];\n    }\n    return elementStyles;\n  }\n\n  override createRenderRoot() {\n    return (this.constructor as typeof ShadowlessElement).disableShadowRoot\n      ? this\n      : super.createRenderRoot();\n  }\n}\n","import type { BlockService } from '@blocksuite/block-std';\nimport type { EventName, UIEventHandler } from '@blocksuite/block-std';\nimport type { BaseSelection } from '@blocksuite/block-std';\nimport { PathFinder } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { BlockModel } from '@blocksuite/store';\nimport type { Page } from '@blocksuite/store';\nimport { nothing, type PropertyValues, render, type TemplateResult } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { when } from 'lit/directives/when.js';\nimport { html } from 'lit/static-html.js';\n\nimport { WithDisposable } from '../with-disposable.js';\nimport type { EditorHost } from './lit-host.js';\nimport { ShadowlessElement } from './shadowless-element.js';\nimport type { WidgetElement } from './widget-element.js';\n\nexport class BlockElement<\n  Model extends BlockModel = BlockModel,\n  Service extends BlockService = BlockService,\n  WidgetName extends string = string,\n> extends WithDisposable(ShadowlessElement) {\n  @property({ attribute: false })\n  host!: EditorHost;\n\n  @property({ attribute: false })\n  model!: Model;\n\n  @property({ attribute: false })\n  content: TemplateResult | null = null;\n\n  @property({\n    attribute: false,\n    hasChanged(value, oldValue) {\n      if (!value || !oldValue) {\n        return value !== oldValue;\n      }\n      // Is empty object\n      if (!Object.keys(value).length && !Object.keys(oldValue).length) {\n        return false;\n      }\n      return value !== oldValue;\n    },\n  })\n  widgets!: Record<WidgetName, TemplateResult>;\n\n  @property({ attribute: false })\n  page!: Page;\n\n  @property({ attribute: false })\n  dirty = false;\n\n  @state({\n    hasChanged(value: BaseSelection | null, oldValue: BaseSelection | null) {\n      if (!value || !oldValue) {\n        return value !== oldValue;\n      }\n\n      return !value?.equals(oldValue);\n    },\n  })\n  selected: BaseSelection | null = null;\n\n  path!: string[];\n\n  get parentPath(): string[] {\n    return this.path.slice(0, -1);\n  }\n\n  get parentBlockElement() {\n    const parentElement = this.parentElement;\n    assertExists(parentElement);\n    const nodeView = this.host.view.getNodeView(parentElement);\n    assertExists(nodeView);\n    return nodeView.view as BlockElement;\n  }\n\n  get childBlockElements() {\n    const children = this.host.view.getChildren(this.path);\n    return children\n      .filter(child => child.type === 'block')\n      .map(child => child.view as BlockElement);\n  }\n\n  get rootBlockElement() {\n    const rootElement = this.host.view.viewFromPath(\n      'block',\n      this.path.slice(0, 1)\n    );\n    assertExists(rootElement);\n    return rootElement;\n  }\n\n  get topContenteditableElement(): BlockElement | null {\n    return this.rootBlockElement;\n  }\n\n  get flavour(): string {\n    return this.model.flavour;\n  }\n\n  get widgetElements(): Partial<Record<WidgetName, WidgetElement>> {\n    return Object.keys(this.widgets).reduce((mapping, key) => {\n      return {\n        ...mapping,\n        [key]: this.host.view.viewFromPath('widget', [...this.path, key]),\n      };\n    }, {});\n  }\n\n  get service(): Service | undefined {\n    return this.host.std.spec.getService(this.model.flavour) as\n      | Service\n      | undefined;\n  }\n\n  get selection() {\n    return this.host.selection;\n  }\n\n  get std() {\n    return this.host.std;\n  }\n\n  get isVersionMismatch() {\n    const schema = this.page.schema.flavourSchemaMap.get(this.model.flavour);\n    assertExists(\n      schema,\n      `Cannot find schema for flavour ${this.model.flavour}`\n    );\n    const expectedVersion = schema.version;\n    const actualVersion = this.model.version;\n    if (expectedVersion !== actualVersion) {\n      console.warn(\n        `Version mismatch for block ${this.model.id}, expected ${expectedVersion}, actual ${actualVersion}`\n      );\n      return true;\n    }\n\n    return false;\n  }\n\n  handleEvent = (\n    name: EventName,\n    handler: UIEventHandler,\n    options?: { global?: boolean; flavour?: boolean }\n  ) => {\n    assertExists(this.path, 'Cannot bind block level hotkey without path');\n    const config = {\n      flavour: options?.global\n        ? undefined\n        : options?.flavour\n          ? this.model.flavour\n          : undefined,\n      path: options?.global || options?.flavour ? undefined : this.path,\n    };\n    this._disposables.add(this.host.event.add(name, handler, config));\n  };\n\n  bindHotKey(\n    keymap: Record<string, UIEventHandler>,\n    options?: { global?: boolean; flavour?: boolean }\n  ) {\n    assertExists(this.path, 'Cannot bind block level hotkey without path');\n    const config = {\n      flavour: options?.global\n        ? undefined\n        : options?.flavour\n          ? this.model.flavour\n          : undefined,\n      path: options?.global || options?.flavour ? undefined : this.path,\n    };\n    this._disposables.add(this.host.event.bindHotkey(keymap, config));\n  }\n\n  renderModel = (model: BlockModel): TemplateResult => {\n    return this.host.renderModel(model);\n  };\n\n  renderModelChildren = (model: BlockModel): TemplateResult => {\n    return this.host.renderModelChildren(model);\n  };\n\n  protected override async getUpdateComplete(): Promise<boolean> {\n    const result = await super.getUpdateComplete();\n    await Promise.all(this.childBlockElements.map(el => el.updateComplete));\n    return result;\n  }\n  protected override update(changedProperties: PropertyValues): void {\n    // In some cases, the DOM structure is directly modified, causing Lit to lose synchronization with the DOM structure.\n    // We can restore this state through the `dirty` property.\n    if (this.dirty) {\n      //@ts-ignore\n      this.__reflectingProperties &&= this.__reflectingProperties.forEach(p =>\n        //@ts-ignore\n        this.__propertyToAttribute(p, this[p as keyof this])\n      ) as undefined;\n      //@ts-ignore\n      this._$changedProperties = new Map();\n      this.isUpdatePending = false;\n      //@ts-ignore\n      this.__childPart = render(nothing, this.renderRoot);\n\n      this.updateComplete\n        .then(() => {\n          this.dirty = false;\n        })\n        .catch(console.error);\n    } else {\n      super.update(changedProperties);\n    }\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this.path = this.host.view.calculatePath(this);\n\n    this._disposables.add(\n      this.model.propsUpdated.on(() => {\n        this.requestUpdate();\n      })\n    );\n\n    this._disposables.add(\n      this.model.childrenUpdated.on(() => {\n        this.requestUpdate();\n      })\n    );\n\n    this._disposables.add(\n      this.host.selection.slots.changed.on(selections => {\n        const selection = selections.find(selection => {\n          return PathFinder.equals(selection.path, this.path);\n        });\n\n        if (!selection) {\n          this.selected = null;\n          return;\n        }\n\n        this.selected = selection;\n      })\n    );\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n  }\n\n  renderBlock(): unknown {\n    return nothing;\n  }\n\n  renderVersionMismatch(\n    expectedVersion: number,\n    actualVersion: number\n  ): TemplateResult {\n    return html`\n      <dl class=\"version-mismatch-warning\" contenteditable=\"false\">\n        <dt>\n          <h4>Block Version Mismatched</h4>\n        </dt>\n        <dd>\n          <p>\n            We can not render this <var>${this.model.flavour}</var> block\n            because the version is mismatched.\n          </p>\n          <p>Editor version: <var>${expectedVersion}</var></p>\n          <p>Data version: <var>${actualVersion}</var></p>\n        </dd>\n      </dl>\n    `;\n  }\n\n  override render() {\n    return when(\n      this.isVersionMismatch,\n      () => {\n        const schema = this.page.schema.flavourSchemaMap.get(\n          this.model.flavour\n        );\n        assertExists(\n          schema,\n          `Cannot find schema for flavour ${this.model.flavour}`\n        );\n        const expectedVersion = schema.version;\n        const actualVersion = this.model.version;\n        return this.renderVersionMismatch(expectedVersion, actualVersion);\n      },\n      () => this.renderBlock()\n    );\n  }\n}\n","import type { BaseSelection, TextSelection } from '@blocksuite/block-std';\nimport { PathFinder } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\n\nimport { BlockElement } from '../element/block-element.js';\nimport type { RangeManager } from './range-manager.js';\n\n/**\n * Two-way binding between native range and text selection\n */\nexport class RangeBinding {\n  get selectionManager() {\n    return this.host.selection;\n  }\n\n  get rangeManager() {\n    assertExists(this.host.rangeManager);\n    return this.host.rangeManager;\n  }\n\n  get host() {\n    return this.manager.host;\n  }\n\n  constructor(public manager: RangeManager) {\n    this.host.disposables.add(\n      this.selectionManager.slots.changed.on(this._onStdSelectionChanged)\n    );\n\n    this.host.disposables.add(\n      this.host.event.add('selectionChange', () => {\n        this._onNativeSelectionChanged().catch(console.error);\n      })\n    );\n\n    this.host.disposables.add(\n      this.host.event.add('beforeInput', ctx => {\n        const event = ctx.get('defaultState').event as InputEvent;\n        this._onBeforeInput(event);\n      })\n    );\n\n    this.host.disposables.add(\n      this.host.event.add('compositionStart', this._onCompositionStart)\n    );\n    this.host.disposables.add(\n      this.host.event.add('compositionEnd', ctx => {\n        const event = ctx.get('defaultState').event as CompositionEvent;\n        this._onCompositionEnd(event);\n      })\n    );\n  }\n\n  isComposing = false;\n  private _prevSelection: BaseSelection | null = null;\n  private _onStdSelectionChanged = (selections: BaseSelection[]) => {\n    // wait for lit updated\n    this.host.updateComplete\n      .then(() => {\n        const text =\n          selections.find((selection): selection is TextSelection =>\n            selection.is('text')\n          ) ?? null;\n\n        const eq =\n          text && this._prevSelection\n            ? text.equals(this._prevSelection)\n            : text === this._prevSelection;\n        if (eq) {\n          return;\n        }\n\n        this._prevSelection = text;\n        if (text) {\n          this.rangeManager.syncTextSelectionToRange(text);\n        } else {\n          this.rangeManager.clear();\n        }\n      })\n      .catch(console.error);\n  };\n\n  private _onNativeSelectionChanged = async () => {\n    if (this.isComposing) return;\n\n    await this.host.updateComplete;\n\n    const selection = document.getSelection();\n    if (!selection) {\n      this.selectionManager.clear(['text']);\n      return;\n    }\n    const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\n    const isRangeReversed =\n      !!selection.anchorNode &&\n      !!selection.focusNode &&\n      (selection.anchorNode === selection.focusNode\n        ? selection.anchorOffset > selection.focusOffset\n        : selection.anchorNode.compareDocumentPosition(selection.focusNode) ===\n          Node.DOCUMENT_POSITION_PRECEDING);\n\n    if (range) {\n      const inlineEditor = this.rangeManager.getClosestInlineEditor(\n        range.commonAncestorContainer\n      );\n      if (inlineEditor && inlineEditor.isComposing) return;\n\n      this._prevSelection = this.rangeManager.rangeToTextSelection(\n        range,\n        isRangeReversed\n      );\n      this.rangeManager.syncRangeToTextSelection(range, isRangeReversed);\n    } else {\n      this._prevSelection = null;\n      this.selectionManager.clear(['text']);\n    }\n  };\n\n  private _onBeforeInput = (event: InputEvent) => {\n    const selection = this.selectionManager.find('text');\n    if (!selection) return;\n\n    if (event.isComposing) return;\n\n    const { from, to } = selection;\n    if (!to || PathFinder.equals(from.path, to.path)) return;\n\n    const range = this.rangeManager.value;\n    if (!range) return;\n\n    const blocks = this.rangeManager.getSelectedBlockElementsByRange(range, {\n      mode: 'flat',\n    });\n\n    const start = blocks.at(0);\n    const end = blocks.at(-1);\n    if (!start || !end) return;\n\n    const startText = start.model.text;\n    const endText = end.model.text;\n    if (!startText || !endText) return;\n\n    event.preventDefault();\n\n    this.host.page.transact(() => {\n      startText.delete(from.index, from.length);\n      startText.insert(event.data ?? '', from.index);\n      endText.delete(0, to.length);\n      startText.join(endText);\n\n      blocks\n        .slice(1)\n        // delete from lowest to highest\n        .reverse()\n        .forEach(block => {\n          const parent = this.host.page.getParent(block.model);\n          assertExists(parent);\n          this.host.page.deleteBlock(block.model, {\n            bringChildrenTo: parent,\n          });\n        });\n    });\n\n    const newSelection = this.selectionManager.create('text', {\n      from: {\n        path: from.path,\n        index: from.index + (event.data?.length ?? 0),\n        length: 0,\n      },\n      to: null,\n    });\n    this.selectionManager.set([newSelection]);\n  };\n\n  private _compositionStartCallback:\n    | ((event: CompositionEvent) => Promise<void>)\n    | null = null;\n  private _onCompositionStart = () => {\n    const selection = this.selectionManager.find('text');\n    if (!selection) return;\n\n    const { from, to } = selection;\n    if (!to) return;\n\n    this.isComposing = true;\n\n    const range = this.rangeManager.value;\n    if (!range) return;\n\n    const blocks = this.rangeManager.getSelectedBlockElementsByRange(range, {\n      mode: 'flat',\n    });\n    const highestBlocks = this.rangeManager.getSelectedBlockElementsByRange(\n      range,\n      {\n        mode: 'highest',\n        match: block => block.model.role === 'content',\n      }\n    );\n\n    const start = blocks.at(0);\n    const end = blocks.at(-1);\n    if (!start || !end) return;\n\n    const startText = start.model.text;\n    const endText = end.model.text;\n    if (!startText || !endText) return;\n\n    this._compositionStartCallback = async event => {\n      this.isComposing = false;\n\n      const parents: BlockElement[] = [];\n      for (const highestBlock of highestBlocks) {\n        const parent = this.host.view.getParent(highestBlock.path)?.view;\n        if (!(parent instanceof BlockElement) || parents.includes(parent))\n          continue;\n\n        // Restore the DOM structure damaged by the composition\n        parent.dirty = true;\n        await parent.updateComplete;\n        await parent.updateComplete;\n        parents.push(parent);\n      }\n\n      this.host.page.transact(() => {\n        endText.delete(0, to.length);\n        startText.join(endText);\n\n        blocks\n          .slice(1)\n          // delete from lowest to highest\n          .reverse()\n          .forEach(block => {\n            const parent = this.host.page.getParent(block.model);\n            assertExists(parent);\n            this.host.page.deleteBlock(block.model, {\n              bringChildrenTo: parent,\n            });\n          });\n      });\n\n      await this.host.updateComplete;\n\n      const selection = this.selectionManager.create('text', {\n        from: {\n          path: from.path,\n          index: from.index + (event.data?.length ?? 0),\n          length: 0,\n        },\n        to: null,\n      });\n      this.host.selection.set([selection]);\n      this.rangeManager.syncTextSelectionToRange(selection);\n    };\n  };\n  private _onCompositionEnd = (event: CompositionEvent) => {\n    if (this._compositionStartCallback) {\n      event.preventDefault();\n      this._compositionStartCallback(event).catch(console.error);\n      this._compositionStartCallback = null;\n    }\n  };\n}\n","import type { TextSelection } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { INLINE_ROOT_ATTR, type InlineRootElement } from '@blocksuite/inline';\n\nimport type { BlockElement } from '../element/block-element.js';\nimport type { EditorHost } from '../element/lit-host.js';\nimport { RangeBinding } from './range-binding.js';\n\n/**\n * CRUD for Range and TextSelection\n */\nexport class RangeManager {\n  static rangeSyncExcludeAttr = 'data-range-sync-exclude';\n  static rangeQueryExcludeAttr = 'data-range-query-exclude';\n\n  readonly binding = new RangeBinding(this);\n\n  constructor(public host: EditorHost) {}\n\n  get value() {\n    const selection = document.getSelection();\n    assertExists(selection);\n    if (selection.rangeCount === 0) return null;\n    return selection.getRangeAt(0);\n  }\n\n  clear() {\n    const selection = document.getSelection();\n    assertExists(selection);\n    selection.removeAllRanges();\n\n    const topContenteditableElement = this.host.querySelector(\n      `[contenteditable=\"true\"]`\n    );\n    if (topContenteditableElement instanceof HTMLElement) {\n      topContenteditableElement.blur();\n    }\n  }\n\n  set(range: Range) {\n    const selection = document.getSelection();\n    assertExists(selection);\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }\n\n  syncTextSelectionToRange(selection: TextSelection) {\n    const range = this.textSelectionToRange(selection);\n    if (range) {\n      this.set(range);\n    } else {\n      this.clear();\n    }\n  }\n\n  syncRangeToTextSelection(range: Range, isRangeReversed: boolean) {\n    const selectionManager = this.host.selection;\n\n    if (!range) {\n      selectionManager.clear(['text']);\n      return;\n    }\n\n    const textSelection = this.rangeToTextSelection(range, isRangeReversed);\n    if (textSelection) {\n      selectionManager.setGroup('note', [textSelection]);\n    } else {\n      selectionManager.clear(['text']);\n    }\n  }\n\n  /**\n   * @example\n   * aaa\n   *   b[bb\n   *     ccc\n   * ddd\n   *   ee]e\n   *\n   * all mode: [aaa, bbb, ccc, ddd, eee]\n   * flat mode: [bbb, ccc, ddd, eee]\n   * highest mode: [bbb, ddd]\n   *\n   * match function will be evaluated before filtering using mode\n   */\n  getSelectedBlockElementsByRange(\n    range: Range,\n    options: {\n      match?: (el: BlockElement) => boolean;\n      mode?: 'all' | 'flat' | 'highest';\n    } = {}\n  ): BlockElement[] {\n    const { mode = 'all', match = () => true } = options;\n\n    let result = Array.from<BlockElement>(\n      this.host.querySelectorAll(\n        `[${this.host.blockIdAttr}]:not([${RangeManager.rangeQueryExcludeAttr}=\"true\"])`\n      )\n    ).filter(el => range.intersectsNode(el) && match(el));\n\n    if (result.length === 0) {\n      return [];\n    }\n\n    const firstElement = this.getClosestBlock(range.startContainer);\n    assertExists(firstElement);\n\n    if (mode === 'flat') {\n      result = result.filter(\n        el =>\n          firstElement.compareDocumentPosition(el) &\n            Node.DOCUMENT_POSITION_FOLLOWING || el === firstElement\n      );\n    } else if (mode === 'highest') {\n      let parent = result[0];\n      result = result.filter((node, index) => {\n        if (index === 0) return true;\n        if (\n          parent.compareDocumentPosition(node) &\n          Node.DOCUMENT_POSITION_CONTAINED_BY\n        ) {\n          return false;\n        } else {\n          parent = node;\n          return true;\n        }\n      });\n    }\n\n    return result;\n  }\n\n  textSelectionToRange(selection: TextSelection): Range | null {\n    const { from, to, isReverse } = selection;\n\n    const fromInlineEditor = this.queryInlineEditorByPath(from.path);\n    if (!fromInlineEditor) return null;\n\n    if (selection.isInSameBlock()) {\n      return fromInlineEditor.toDomRange({\n        index: from.index,\n        length: from.length,\n      });\n    } else {\n      assertExists(to);\n      const toInlineEditor = this.queryInlineEditorByPath(to.path);\n      if (!toInlineEditor) return null;\n\n      const fromRange = fromInlineEditor.toDomRange({\n        index: from.index,\n        length: from.length,\n      });\n      const toRange = toInlineEditor.toDomRange({\n        index: to.index,\n        length: to.length,\n      });\n\n      if (!fromRange || !toRange) return null;\n\n      const range = document.createRange();\n      if (!isReverse) {\n        const startContainer = fromRange.startContainer;\n        const startOffset = fromRange.startOffset;\n        const endContainer = toRange.endContainer;\n        const endOffset = toRange.endOffset;\n        range.setStart(startContainer, startOffset);\n        range.setEnd(endContainer, endOffset);\n      } else {\n        const startContainer = toRange.endContainer;\n        const startOffset = toRange.endOffset;\n        const endContainer = fromRange.startContainer;\n        const endOffset = fromRange.startOffset;\n        range.setStart(startContainer, startOffset);\n        range.setEnd(endContainer, endOffset);\n      }\n      return range;\n    }\n  }\n\n  rangeToTextSelection(range: Range, reverse = false): TextSelection | null {\n    const { startContainer, endContainer } = range;\n\n    const startBlock = this.getClosestBlock(startContainer);\n    const endBlock = this.getClosestBlock(endContainer);\n    if (!startBlock || !endBlock) {\n      return null;\n    }\n\n    const startInlineEditor = this.getClosestInlineEditor(startContainer);\n    const endInlineEditor = this.getClosestInlineEditor(endContainer);\n    if (!startInlineEditor || !endInlineEditor) {\n      return null;\n    }\n\n    const startInlineRange = startInlineEditor.toInlineRange(range);\n    const endInlineRange = endInlineEditor.toInlineRange(range);\n    if (!startInlineRange || !endInlineRange) {\n      return null;\n    }\n\n    return this.host.selection.create('text', {\n      from: {\n        path: startBlock.path,\n        index: startInlineRange.index,\n        length: startInlineRange.length,\n      },\n      to:\n        startBlock === endBlock\n          ? null\n          : {\n              path: endBlock.path,\n              index: endInlineRange.index,\n              length: endInlineRange.length,\n            },\n      isReverse: reverse,\n    });\n  }\n\n  getClosestBlock(node: Node) {\n    const el = node instanceof Element ? node : node.parentElement;\n    if (!el) return null;\n    const block = el.closest<BlockElement>(`[${this.host.blockIdAttr}]`);\n    if (!block) return null;\n    if (block.getAttribute(RangeManager.rangeSyncExcludeAttr) === 'true')\n      return null;\n    return block;\n  }\n  getClosestInlineEditor(node: Node) {\n    const el = node instanceof Element ? node : node.parentElement;\n    if (!el) return null;\n    const inlineRoot = el.closest<InlineRootElement>(`[${INLINE_ROOT_ATTR}]`);\n    if (!inlineRoot) return null;\n\n    // check range exclude attr\n    const closestBlock = this.getClosestBlock(inlineRoot);\n    if (!closestBlock) return null;\n\n    return inlineRoot.inlineEditor;\n  }\n\n  queryInlineEditorByPath(path: string[]) {\n    const block = this.host.view.viewFromPath('block', path);\n    if (!block) return null;\n\n    const inlineRoot = block.querySelector<InlineRootElement>(\n      `[${INLINE_ROOT_ATTR}]`\n    );\n    if (!inlineRoot) return null;\n\n    // check range exclude attr\n    const closestBlock = this.getClosestBlock(inlineRoot);\n    if (!closestBlock) return null;\n\n    return inlineRoot.inlineEditor;\n  }\n}\n","/* eslint-disable lit/binding-positions, lit/no-invalid-html */\n\nimport type {\n  BlockSpec,\n  CommandManager,\n  SelectionManager,\n  SpecStore,\n  UIEventDispatcher,\n  ViewStore,\n} from '@blocksuite/block-std';\nimport { BlockStdScope } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { BlockModel, Page } from '@blocksuite/store';\nimport {\n  LitElement,\n  nothing,\n  type PropertyValues,\n  type TemplateResult,\n} from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport type { StaticValue } from 'lit/static-html.js';\nimport { html, unsafeStatic } from 'lit/static-html.js';\n\nimport { RangeManager } from '../utils/range-manager.js';\nimport { WithDisposable } from '../with-disposable.js';\nimport type { BlockElement } from './block-element.js';\nimport { ShadowlessElement } from './shadowless-element.js';\nimport type { WidgetElement } from './widget-element.js';\n\n@customElement('editor-host')\nexport class EditorHost extends WithDisposable(ShadowlessElement) {\n  @property({ attribute: false })\n  specs!: BlockSpec[];\n\n  @property({ attribute: false })\n  page!: Page;\n\n  @property({ attribute: false })\n  blockIdAttr = 'data-block-id';\n\n  @property({ attribute: false })\n  widgetIdAttr = 'data-widget-id';\n\n  std!: BlockSuite.Std;\n\n  rangeManager: RangeManager | null = null;\n\n  get command(): CommandManager {\n    return this.std.command;\n  }\n\n  get event(): UIEventDispatcher {\n    return this.std.event;\n  }\n\n  get selection(): SelectionManager {\n    return this.std.selection;\n  }\n\n  get view(): ViewStore {\n    return this.std.view;\n  }\n\n  get spec(): SpecStore {\n    return this.std.spec;\n  }\n\n  override willUpdate(changedProperties: PropertyValues) {\n    if (changedProperties.has('specs')) {\n      this.std.spec.applySpecs(this.specs);\n    }\n    super.willUpdate(changedProperties);\n  }\n\n  override async getUpdateComplete(): Promise<boolean> {\n    const result = await super.getUpdateComplete();\n    const root = this.page.root;\n    assertExists(root);\n    const view = this.std.spec.getView(root.flavour);\n    assertExists(view);\n    const widgetTags = Object.values(view.widgets ?? {});\n    const elementsTags = [view.component, ...widgetTags];\n    await Promise.all(\n      elementsTags.map(tag => {\n        const element = this.renderRoot.querySelector(tag._$litStatic$);\n        if (element instanceof LitElement) {\n          return element.updateComplete;\n        }\n        return;\n      })\n    );\n    return result;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    if (!this.page.root) {\n      throw new Error(\n        'This page is missing root block. Please initialize the default block structure before connecting the editor to DOM.'\n      );\n    }\n\n    this.std = new BlockStdScope({\n      host: this,\n      workspace: this.page.workspace,\n      page: this.page,\n    });\n    this._registerView();\n\n    this.std.mount();\n    this.std.spec.applySpecs(this.specs);\n    this.rangeManager = new RangeManager(this);\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.std.unmount();\n    this.rangeManager = null;\n  }\n\n  override render() {\n    const { root } = this.page;\n    if (!root) return nothing;\n\n    return this.renderModel(root);\n  }\n\n  renderModel = (model: BlockModel): TemplateResult => {\n    const { flavour } = model;\n    const schema = this.page.schema.flavourSchemaMap.get(flavour);\n    if (!schema) {\n      console.warn(`Cannot find schema for ${flavour}.`);\n      return html`${nothing}`;\n    }\n\n    const view = this.std.spec.getView(flavour);\n    if (!view) {\n      console.warn(`Cannot find view for ${flavour}.`);\n      return html`${nothing}`;\n    }\n\n    const tag = view.component;\n    const widgets: Record<string, TemplateResult> = view.widgets\n      ? Object.entries(view.widgets).reduce((mapping, [key, tag]) => {\n          const template = html`<${tag} ${unsafeStatic(\n            this.widgetIdAttr\n          )}=${key} .host=${this} .page=${this.page}></${tag}>`;\n\n          return {\n            ...mapping,\n            [key]: template,\n          };\n        }, {})\n      : {};\n\n    return html`<${tag}\n      ${unsafeStatic(this.blockIdAttr)}=${model.id}\n      .host=${this}\n      .page=${this.page}\n      .model=${model}\n      .widgets=${widgets}\n    ></${tag}>`;\n  };\n\n  renderModelChildren = (model: BlockModel): TemplateResult => {\n    return html`${repeat(\n      model.children,\n      child => child.id,\n      child => this.renderModel(child)\n    )}`;\n  };\n\n  private _registerView = () => {\n    const blockSelector = `[${this.blockIdAttr}]`;\n    const widgetSelector = `[${this.widgetIdAttr}]`;\n\n    this.std.view.register<'block'>({\n      type: 'block',\n      fromDOM: node =>\n        fromDOM<BlockElement>(\n          node,\n          this.blockIdAttr,\n          this.widgetIdAttr,\n          'block'\n        ),\n      toDOM: ({ view }) => view,\n      getChildren: node =>\n        getChildren(node, blockSelector, widgetSelector, 'block'),\n    });\n\n    this.std.view.register<'widget'>({\n      type: 'widget',\n      fromDOM: node =>\n        fromDOM<WidgetElement>(\n          node,\n          this.widgetIdAttr,\n          this.blockIdAttr,\n          'widget'\n        ),\n      toDOM: ({ view }) => view,\n      getChildren: node =>\n        getChildren(node, blockSelector, widgetSelector, 'widget'),\n    });\n  };\n}\n\nfunction fromDOM<T extends Element & { path: string[] }>(\n  node: Node,\n  target: string,\n  notInside: string,\n  type: BlockSuite.ViewType\n) {\n  const selector = `[${target}]`;\n  const notInSelector = `[${notInside}]`;\n  const element =\n    node && node instanceof HTMLElement ? node : node.parentElement;\n  if (!element) return null;\n\n  const view = element.closest<T>(selector);\n  if (!view) {\n    return null;\n  }\n  const not = element.closest(notInSelector);\n  if (view.contains(not)) {\n    return null;\n  }\n\n  const id = view.getAttribute(target);\n  assertExists(id);\n\n  return {\n    id,\n    path: view.path,\n    view,\n    type,\n  };\n}\n\nfunction getChildren(\n  node: Element,\n  blockSelector: string,\n  widgetSelector: string,\n  type: BlockSuite.ViewType\n) {\n  const selector = `${blockSelector},${widgetSelector}`;\n  return Array.from(\n    node.querySelectorAll<BlockElement | WidgetElement>(selector)\n  ).filter(\n    x =>\n      x.parentElement?.closest(\n        type === 'block' ? blockSelector : widgetSelector\n      ) === node\n  );\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'editor-host': EditorHost;\n  }\n\n  namespace BlockSuite {\n    interface ComponentType {\n      lit: StaticValue;\n    }\n\n    interface NodeViewType {\n      block: BlockElement;\n      widget: WidgetElement;\n    }\n  }\n}\n","import type { EventName, UIEventHandler } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { Page } from '@blocksuite/store';\nimport { LitElement } from 'lit';\nimport { property } from 'lit/decorators.js';\n\nimport { WithDisposable } from '../with-disposable.js';\nimport type { BlockElement } from './block-element.js';\nimport type { EditorHost } from './lit-host.js';\n\nexport class WidgetElement<\n  B extends BlockElement = BlockElement,\n> extends WithDisposable(LitElement) {\n  @property({ attribute: false })\n  host!: EditorHost;\n\n  @property({ attribute: false })\n  page!: Page;\n\n  path!: string[];\n\n  get widgetName(): string {\n    return this.path[this.path.length - 1];\n  }\n\n  get hostPath() {\n    return this.path.slice(0, -1);\n  }\n\n  get blockElement(): B {\n    const parentElement = this.parentElement;\n    assertExists(parentElement);\n    const nodeView = this.host.view.getNodeView(parentElement);\n    assertExists(nodeView);\n    return nodeView.view as B;\n  }\n\n  get flavour(): string {\n    assertExists(this.blockElement);\n    return this.blockElement.model.flavour;\n  }\n\n  get std() {\n    return this.host.std;\n  }\n\n  handleEvent = (\n    name: EventName,\n    handler: UIEventHandler,\n    options?: { global?: boolean }\n  ) => {\n    this._disposables.add(\n      this.host.event.add(name, handler, {\n        flavour: options?.global ? undefined : this.flavour,\n      })\n    );\n  };\n\n  bindHotKey(\n    keymap: Record<string, UIEventHandler>,\n    options?: { global: boolean }\n  ) {\n    this._disposables.add(\n      this.host.event.bindHotkey(keymap, {\n        flavour: options?.global ? undefined : this.flavour,\n      })\n    );\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.path = this.host.view.calculatePath(this);\n  }\n\n  override render(): unknown {\n    return null;\n  }\n}\n","/**\n * Custom positioning reference element.\n * @see https://floating-ui.com/docs/virtual-elements\n */\n\nconst sides = ['top', 'right', 'bottom', 'left'];\nconst alignments = ['start', 'end'];\nconst placements = /*#__PURE__*/sides.reduce((acc, side) => acc.concat(side, side + \"-\" + alignments[0], side + \"-\" + alignments[1]), []);\nconst min = Math.min;\nconst max = Math.max;\nconst round = Math.round;\nconst floor = Math.floor;\nconst createCoords = v => ({\n  x: v,\n  y: v\n});\nconst oppositeSideMap = {\n  left: 'right',\n  right: 'left',\n  bottom: 'top',\n  top: 'bottom'\n};\nconst oppositeAlignmentMap = {\n  start: 'end',\n  end: 'start'\n};\nfunction clamp(start, value, end) {\n  return max(start, min(value, end));\n}\nfunction evaluate(value, param) {\n  return typeof value === 'function' ? value(param) : value;\n}\nfunction getSide(placement) {\n  return placement.split('-')[0];\n}\nfunction getAlignment(placement) {\n  return placement.split('-')[1];\n}\nfunction getOppositeAxis(axis) {\n  return axis === 'x' ? 'y' : 'x';\n}\nfunction getAxisLength(axis) {\n  return axis === 'y' ? 'height' : 'width';\n}\nfunction getSideAxis(placement) {\n  return ['top', 'bottom'].includes(getSide(placement)) ? 'y' : 'x';\n}\nfunction getAlignmentAxis(placement) {\n  return getOppositeAxis(getSideAxis(placement));\n}\nfunction getAlignmentSides(placement, rects, rtl) {\n  if (rtl === void 0) {\n    rtl = false;\n  }\n  const alignment = getAlignment(placement);\n  const alignmentAxis = getAlignmentAxis(placement);\n  const length = getAxisLength(alignmentAxis);\n  let mainAlignmentSide = alignmentAxis === 'x' ? alignment === (rtl ? 'end' : 'start') ? 'right' : 'left' : alignment === 'start' ? 'bottom' : 'top';\n  if (rects.reference[length] > rects.floating[length]) {\n    mainAlignmentSide = getOppositePlacement(mainAlignmentSide);\n  }\n  return [mainAlignmentSide, getOppositePlacement(mainAlignmentSide)];\n}\nfunction getExpandedPlacements(placement) {\n  const oppositePlacement = getOppositePlacement(placement);\n  return [getOppositeAlignmentPlacement(placement), oppositePlacement, getOppositeAlignmentPlacement(oppositePlacement)];\n}\nfunction getOppositeAlignmentPlacement(placement) {\n  return placement.replace(/start|end/g, alignment => oppositeAlignmentMap[alignment]);\n}\nfunction getSideList(side, isStart, rtl) {\n  const lr = ['left', 'right'];\n  const rl = ['right', 'left'];\n  const tb = ['top', 'bottom'];\n  const bt = ['bottom', 'top'];\n  switch (side) {\n    case 'top':\n    case 'bottom':\n      if (rtl) return isStart ? rl : lr;\n      return isStart ? lr : rl;\n    case 'left':\n    case 'right':\n      return isStart ? tb : bt;\n    default:\n      return [];\n  }\n}\nfunction getOppositeAxisPlacements(placement, flipAlignment, direction, rtl) {\n  const alignment = getAlignment(placement);\n  let list = getSideList(getSide(placement), direction === 'start', rtl);\n  if (alignment) {\n    list = list.map(side => side + \"-\" + alignment);\n    if (flipAlignment) {\n      list = list.concat(list.map(getOppositeAlignmentPlacement));\n    }\n  }\n  return list;\n}\nfunction getOppositePlacement(placement) {\n  return placement.replace(/left|right|bottom|top/g, side => oppositeSideMap[side]);\n}\nfunction expandPaddingObject(padding) {\n  return {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0,\n    ...padding\n  };\n}\nfunction getPaddingObject(padding) {\n  return typeof padding !== 'number' ? expandPaddingObject(padding) : {\n    top: padding,\n    right: padding,\n    bottom: padding,\n    left: padding\n  };\n}\nfunction rectToClientRect(rect) {\n  return {\n    ...rect,\n    top: rect.y,\n    left: rect.x,\n    right: rect.x + rect.width,\n    bottom: rect.y + rect.height\n  };\n}\n\nexport { alignments, clamp, createCoords, evaluate, expandPaddingObject, floor, getAlignment, getAlignmentAxis, getAlignmentSides, getAxisLength, getExpandedPlacements, getOppositeAlignmentPlacement, getOppositeAxis, getOppositeAxisPlacements, getOppositePlacement, getPaddingObject, getSide, getSideAxis, max, min, placements, rectToClientRect, round, sides };\n","import { getSideAxis, getAlignmentAxis, getAxisLength, getSide, getAlignment, evaluate, getPaddingObject, rectToClientRect, min, clamp, placements, getAlignmentSides, getOppositeAlignmentPlacement, getOppositePlacement, getExpandedPlacements, getOppositeAxisPlacements, sides, max, getOppositeAxis } from '@floating-ui/utils';\nexport { rectToClientRect } from '@floating-ui/utils';\n\nfunction computeCoordsFromPlacement(_ref, placement, rtl) {\n  let {\n    reference,\n    floating\n  } = _ref;\n  const sideAxis = getSideAxis(placement);\n  const alignmentAxis = getAlignmentAxis(placement);\n  const alignLength = getAxisLength(alignmentAxis);\n  const side = getSide(placement);\n  const isVertical = sideAxis === 'y';\n  const commonX = reference.x + reference.width / 2 - floating.width / 2;\n  const commonY = reference.y + reference.height / 2 - floating.height / 2;\n  const commonAlign = reference[alignLength] / 2 - floating[alignLength] / 2;\n  let coords;\n  switch (side) {\n    case 'top':\n      coords = {\n        x: commonX,\n        y: reference.y - floating.height\n      };\n      break;\n    case 'bottom':\n      coords = {\n        x: commonX,\n        y: reference.y + reference.height\n      };\n      break;\n    case 'right':\n      coords = {\n        x: reference.x + reference.width,\n        y: commonY\n      };\n      break;\n    case 'left':\n      coords = {\n        x: reference.x - floating.width,\n        y: commonY\n      };\n      break;\n    default:\n      coords = {\n        x: reference.x,\n        y: reference.y\n      };\n  }\n  switch (getAlignment(placement)) {\n    case 'start':\n      coords[alignmentAxis] -= commonAlign * (rtl && isVertical ? -1 : 1);\n      break;\n    case 'end':\n      coords[alignmentAxis] += commonAlign * (rtl && isVertical ? -1 : 1);\n      break;\n  }\n  return coords;\n}\n\n/**\n * Computes the `x` and `y` coordinates that will place the floating element\n * next to a given reference element.\n *\n * This export does not have any `platform` interface logic. You will need to\n * write one for the platform you are using Floating UI with.\n */\nconst computePosition = async (reference, floating, config) => {\n  const {\n    placement = 'bottom',\n    strategy = 'absolute',\n    middleware = [],\n    platform\n  } = config;\n  const validMiddleware = middleware.filter(Boolean);\n  const rtl = await (platform.isRTL == null ? void 0 : platform.isRTL(floating));\n  let rects = await platform.getElementRects({\n    reference,\n    floating,\n    strategy\n  });\n  let {\n    x,\n    y\n  } = computeCoordsFromPlacement(rects, placement, rtl);\n  let statefulPlacement = placement;\n  let middlewareData = {};\n  let resetCount = 0;\n  for (let i = 0; i < validMiddleware.length; i++) {\n    const {\n      name,\n      fn\n    } = validMiddleware[i];\n    const {\n      x: nextX,\n      y: nextY,\n      data,\n      reset\n    } = await fn({\n      x,\n      y,\n      initialPlacement: placement,\n      placement: statefulPlacement,\n      strategy,\n      middlewareData,\n      rects,\n      platform,\n      elements: {\n        reference,\n        floating\n      }\n    });\n    x = nextX != null ? nextX : x;\n    y = nextY != null ? nextY : y;\n    middlewareData = {\n      ...middlewareData,\n      [name]: {\n        ...middlewareData[name],\n        ...data\n      }\n    };\n    if (reset && resetCount <= 50) {\n      resetCount++;\n      if (typeof reset === 'object') {\n        if (reset.placement) {\n          statefulPlacement = reset.placement;\n        }\n        if (reset.rects) {\n          rects = reset.rects === true ? await platform.getElementRects({\n            reference,\n            floating,\n            strategy\n          }) : reset.rects;\n        }\n        ({\n          x,\n          y\n        } = computeCoordsFromPlacement(rects, statefulPlacement, rtl));\n      }\n      i = -1;\n      continue;\n    }\n  }\n  return {\n    x,\n    y,\n    placement: statefulPlacement,\n    strategy,\n    middlewareData\n  };\n};\n\n/**\n * Resolves with an object of overflow side offsets that determine how much the\n * element is overflowing a given clipping boundary on each side.\n * - positive = overflowing the boundary by that number of pixels\n * - negative = how many pixels left before it will overflow\n * - 0 = lies flush with the boundary\n * @see https://floating-ui.com/docs/detectOverflow\n */\nasync function detectOverflow(state, options) {\n  var _await$platform$isEle;\n  if (options === void 0) {\n    options = {};\n  }\n  const {\n    x,\n    y,\n    platform,\n    rects,\n    elements,\n    strategy\n  } = state;\n  const {\n    boundary = 'clippingAncestors',\n    rootBoundary = 'viewport',\n    elementContext = 'floating',\n    altBoundary = false,\n    padding = 0\n  } = evaluate(options, state);\n  const paddingObject = getPaddingObject(padding);\n  const altContext = elementContext === 'floating' ? 'reference' : 'floating';\n  const element = elements[altBoundary ? altContext : elementContext];\n  const clippingClientRect = rectToClientRect(await platform.getClippingRect({\n    element: ((_await$platform$isEle = await (platform.isElement == null ? void 0 : platform.isElement(element))) != null ? _await$platform$isEle : true) ? element : element.contextElement || (await (platform.getDocumentElement == null ? void 0 : platform.getDocumentElement(elements.floating))),\n    boundary,\n    rootBoundary,\n    strategy\n  }));\n  const rect = elementContext === 'floating' ? {\n    ...rects.floating,\n    x,\n    y\n  } : rects.reference;\n  const offsetParent = await (platform.getOffsetParent == null ? void 0 : platform.getOffsetParent(elements.floating));\n  const offsetScale = (await (platform.isElement == null ? void 0 : platform.isElement(offsetParent))) ? (await (platform.getScale == null ? void 0 : platform.getScale(offsetParent))) || {\n    x: 1,\n    y: 1\n  } : {\n    x: 1,\n    y: 1\n  };\n  const elementClientRect = rectToClientRect(platform.convertOffsetParentRelativeRectToViewportRelativeRect ? await platform.convertOffsetParentRelativeRectToViewportRelativeRect({\n    rect,\n    offsetParent,\n    strategy\n  }) : rect);\n  return {\n    top: (clippingClientRect.top - elementClientRect.top + paddingObject.top) / offsetScale.y,\n    bottom: (elementClientRect.bottom - clippingClientRect.bottom + paddingObject.bottom) / offsetScale.y,\n    left: (clippingClientRect.left - elementClientRect.left + paddingObject.left) / offsetScale.x,\n    right: (elementClientRect.right - clippingClientRect.right + paddingObject.right) / offsetScale.x\n  };\n}\n\n/**\n * Provides data to position an inner element of the floating element so that it\n * appears centered to the reference element.\n * @see https://floating-ui.com/docs/arrow\n */\nconst arrow = options => ({\n  name: 'arrow',\n  options,\n  async fn(state) {\n    const {\n      x,\n      y,\n      placement,\n      rects,\n      platform,\n      elements,\n      middlewareData\n    } = state;\n    // Since `element` is required, we don't Partial<> the type.\n    const {\n      element,\n      padding = 0\n    } = evaluate(options, state) || {};\n    if (element == null) {\n      return {};\n    }\n    const paddingObject = getPaddingObject(padding);\n    const coords = {\n      x,\n      y\n    };\n    const axis = getAlignmentAxis(placement);\n    const length = getAxisLength(axis);\n    const arrowDimensions = await platform.getDimensions(element);\n    const isYAxis = axis === 'y';\n    const minProp = isYAxis ? 'top' : 'left';\n    const maxProp = isYAxis ? 'bottom' : 'right';\n    const clientProp = isYAxis ? 'clientHeight' : 'clientWidth';\n    const endDiff = rects.reference[length] + rects.reference[axis] - coords[axis] - rects.floating[length];\n    const startDiff = coords[axis] - rects.reference[axis];\n    const arrowOffsetParent = await (platform.getOffsetParent == null ? void 0 : platform.getOffsetParent(element));\n    let clientSize = arrowOffsetParent ? arrowOffsetParent[clientProp] : 0;\n\n    // DOM platform can return `window` as the `offsetParent`.\n    if (!clientSize || !(await (platform.isElement == null ? void 0 : platform.isElement(arrowOffsetParent)))) {\n      clientSize = elements.floating[clientProp] || rects.floating[length];\n    }\n    const centerToReference = endDiff / 2 - startDiff / 2;\n\n    // If the padding is large enough that it causes the arrow to no longer be\n    // centered, modify the padding so that it is centered.\n    const largestPossiblePadding = clientSize / 2 - arrowDimensions[length] / 2 - 1;\n    const minPadding = min(paddingObject[minProp], largestPossiblePadding);\n    const maxPadding = min(paddingObject[maxProp], largestPossiblePadding);\n\n    // Make sure the arrow doesn't overflow the floating element if the center\n    // point is outside the floating element's bounds.\n    const min$1 = minPadding;\n    const max = clientSize - arrowDimensions[length] - maxPadding;\n    const center = clientSize / 2 - arrowDimensions[length] / 2 + centerToReference;\n    const offset = clamp(min$1, center, max);\n\n    // If the reference is small enough that the arrow's padding causes it to\n    // to point to nothing for an aligned placement, adjust the offset of the\n    // floating element itself. To ensure `shift()` continues to take action,\n    // a single reset is performed when this is true.\n    const shouldAddOffset = !middlewareData.arrow && getAlignment(placement) != null && center != offset && rects.reference[length] / 2 - (center < min$1 ? minPadding : maxPadding) - arrowDimensions[length] / 2 < 0;\n    const alignmentOffset = shouldAddOffset ? center < min$1 ? center - min$1 : center - max : 0;\n    return {\n      [axis]: coords[axis] + alignmentOffset,\n      data: {\n        [axis]: offset,\n        centerOffset: center - offset - alignmentOffset,\n        ...(shouldAddOffset && {\n          alignmentOffset\n        })\n      },\n      reset: shouldAddOffset\n    };\n  }\n});\n\nfunction getPlacementList(alignment, autoAlignment, allowedPlacements) {\n  const allowedPlacementsSortedByAlignment = alignment ? [...allowedPlacements.filter(placement => getAlignment(placement) === alignment), ...allowedPlacements.filter(placement => getAlignment(placement) !== alignment)] : allowedPlacements.filter(placement => getSide(placement) === placement);\n  return allowedPlacementsSortedByAlignment.filter(placement => {\n    if (alignment) {\n      return getAlignment(placement) === alignment || (autoAlignment ? getOppositeAlignmentPlacement(placement) !== placement : false);\n    }\n    return true;\n  });\n}\n/**\n * Optimizes the visibility of the floating element by choosing the placement\n * that has the most space available automatically, without needing to specify a\n * preferred placement. Alternative to `flip`.\n * @see https://floating-ui.com/docs/autoPlacement\n */\nconst autoPlacement = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'autoPlacement',\n    options,\n    async fn(state) {\n      var _middlewareData$autoP, _middlewareData$autoP2, _placementsThatFitOnE;\n      const {\n        rects,\n        middlewareData,\n        placement,\n        platform,\n        elements\n      } = state;\n      const {\n        crossAxis = false,\n        alignment,\n        allowedPlacements = placements,\n        autoAlignment = true,\n        ...detectOverflowOptions\n      } = evaluate(options, state);\n      const placements$1 = alignment !== undefined || allowedPlacements === placements ? getPlacementList(alignment || null, autoAlignment, allowedPlacements) : allowedPlacements;\n      const overflow = await detectOverflow(state, detectOverflowOptions);\n      const currentIndex = ((_middlewareData$autoP = middlewareData.autoPlacement) == null ? void 0 : _middlewareData$autoP.index) || 0;\n      const currentPlacement = placements$1[currentIndex];\n      if (currentPlacement == null) {\n        return {};\n      }\n      const alignmentSides = getAlignmentSides(currentPlacement, rects, await (platform.isRTL == null ? void 0 : platform.isRTL(elements.floating)));\n\n      // Make `computeCoords` start from the right place.\n      if (placement !== currentPlacement) {\n        return {\n          reset: {\n            placement: placements$1[0]\n          }\n        };\n      }\n      const currentOverflows = [overflow[getSide(currentPlacement)], overflow[alignmentSides[0]], overflow[alignmentSides[1]]];\n      const allOverflows = [...(((_middlewareData$autoP2 = middlewareData.autoPlacement) == null ? void 0 : _middlewareData$autoP2.overflows) || []), {\n        placement: currentPlacement,\n        overflows: currentOverflows\n      }];\n      const nextPlacement = placements$1[currentIndex + 1];\n\n      // There are more placements to check.\n      if (nextPlacement) {\n        return {\n          data: {\n            index: currentIndex + 1,\n            overflows: allOverflows\n          },\n          reset: {\n            placement: nextPlacement\n          }\n        };\n      }\n      const placementsSortedByMostSpace = allOverflows.map(d => {\n        const alignment = getAlignment(d.placement);\n        return [d.placement, alignment && crossAxis ?\n        // Check along the mainAxis and main crossAxis side.\n        d.overflows.slice(0, 2).reduce((acc, v) => acc + v, 0) :\n        // Check only the mainAxis.\n        d.overflows[0], d.overflows];\n      }).sort((a, b) => a[1] - b[1]);\n      const placementsThatFitOnEachSide = placementsSortedByMostSpace.filter(d => d[2].slice(0,\n      // Aligned placements should not check their opposite crossAxis\n      // side.\n      getAlignment(d[0]) ? 2 : 3).every(v => v <= 0));\n      const resetPlacement = ((_placementsThatFitOnE = placementsThatFitOnEachSide[0]) == null ? void 0 : _placementsThatFitOnE[0]) || placementsSortedByMostSpace[0][0];\n      if (resetPlacement !== placement) {\n        return {\n          data: {\n            index: currentIndex + 1,\n            overflows: allOverflows\n          },\n          reset: {\n            placement: resetPlacement\n          }\n        };\n      }\n      return {};\n    }\n  };\n};\n\n/**\n * Optimizes the visibility of the floating element by flipping the `placement`\n * in order to keep it in view when the preferred placement(s) will overflow the\n * clipping boundary. Alternative to `autoPlacement`.\n * @see https://floating-ui.com/docs/flip\n */\nconst flip = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'flip',\n    options,\n    async fn(state) {\n      var _middlewareData$arrow, _middlewareData$flip;\n      const {\n        placement,\n        middlewareData,\n        rects,\n        initialPlacement,\n        platform,\n        elements\n      } = state;\n      const {\n        mainAxis: checkMainAxis = true,\n        crossAxis: checkCrossAxis = true,\n        fallbackPlacements: specifiedFallbackPlacements,\n        fallbackStrategy = 'bestFit',\n        fallbackAxisSideDirection = 'none',\n        flipAlignment = true,\n        ...detectOverflowOptions\n      } = evaluate(options, state);\n\n      // If a reset by the arrow was caused due to an alignment offset being\n      // added, we should skip any logic now since `flip()` has already done its\n      // work.\n      // https://github.com/floating-ui/floating-ui/issues/2549#issuecomment-1719601643\n      if ((_middlewareData$arrow = middlewareData.arrow) != null && _middlewareData$arrow.alignmentOffset) {\n        return {};\n      }\n      const side = getSide(placement);\n      const isBasePlacement = getSide(initialPlacement) === initialPlacement;\n      const rtl = await (platform.isRTL == null ? void 0 : platform.isRTL(elements.floating));\n      const fallbackPlacements = specifiedFallbackPlacements || (isBasePlacement || !flipAlignment ? [getOppositePlacement(initialPlacement)] : getExpandedPlacements(initialPlacement));\n      if (!specifiedFallbackPlacements && fallbackAxisSideDirection !== 'none') {\n        fallbackPlacements.push(...getOppositeAxisPlacements(initialPlacement, flipAlignment, fallbackAxisSideDirection, rtl));\n      }\n      const placements = [initialPlacement, ...fallbackPlacements];\n      const overflow = await detectOverflow(state, detectOverflowOptions);\n      const overflows = [];\n      let overflowsData = ((_middlewareData$flip = middlewareData.flip) == null ? void 0 : _middlewareData$flip.overflows) || [];\n      if (checkMainAxis) {\n        overflows.push(overflow[side]);\n      }\n      if (checkCrossAxis) {\n        const sides = getAlignmentSides(placement, rects, rtl);\n        overflows.push(overflow[sides[0]], overflow[sides[1]]);\n      }\n      overflowsData = [...overflowsData, {\n        placement,\n        overflows\n      }];\n\n      // One or more sides is overflowing.\n      if (!overflows.every(side => side <= 0)) {\n        var _middlewareData$flip2, _overflowsData$filter;\n        const nextIndex = (((_middlewareData$flip2 = middlewareData.flip) == null ? void 0 : _middlewareData$flip2.index) || 0) + 1;\n        const nextPlacement = placements[nextIndex];\n        if (nextPlacement) {\n          // Try next placement and re-run the lifecycle.\n          return {\n            data: {\n              index: nextIndex,\n              overflows: overflowsData\n            },\n            reset: {\n              placement: nextPlacement\n            }\n          };\n        }\n\n        // First, find the candidates that fit on the mainAxis side of overflow,\n        // then find the placement that fits the best on the main crossAxis side.\n        let resetPlacement = (_overflowsData$filter = overflowsData.filter(d => d.overflows[0] <= 0).sort((a, b) => a.overflows[1] - b.overflows[1])[0]) == null ? void 0 : _overflowsData$filter.placement;\n\n        // Otherwise fallback.\n        if (!resetPlacement) {\n          switch (fallbackStrategy) {\n            case 'bestFit':\n              {\n                var _overflowsData$map$so;\n                const placement = (_overflowsData$map$so = overflowsData.map(d => [d.placement, d.overflows.filter(overflow => overflow > 0).reduce((acc, overflow) => acc + overflow, 0)]).sort((a, b) => a[1] - b[1])[0]) == null ? void 0 : _overflowsData$map$so[0];\n                if (placement) {\n                  resetPlacement = placement;\n                }\n                break;\n              }\n            case 'initialPlacement':\n              resetPlacement = initialPlacement;\n              break;\n          }\n        }\n        if (placement !== resetPlacement) {\n          return {\n            reset: {\n              placement: resetPlacement\n            }\n          };\n        }\n      }\n      return {};\n    }\n  };\n};\n\nfunction getSideOffsets(overflow, rect) {\n  return {\n    top: overflow.top - rect.height,\n    right: overflow.right - rect.width,\n    bottom: overflow.bottom - rect.height,\n    left: overflow.left - rect.width\n  };\n}\nfunction isAnySideFullyClipped(overflow) {\n  return sides.some(side => overflow[side] >= 0);\n}\n/**\n * Provides data to hide the floating element in applicable situations, such as\n * when it is not in the same clipping context as the reference element.\n * @see https://floating-ui.com/docs/hide\n */\nconst hide = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'hide',\n    options,\n    async fn(state) {\n      const {\n        rects\n      } = state;\n      const {\n        strategy = 'referenceHidden',\n        ...detectOverflowOptions\n      } = evaluate(options, state);\n      switch (strategy) {\n        case 'referenceHidden':\n          {\n            const overflow = await detectOverflow(state, {\n              ...detectOverflowOptions,\n              elementContext: 'reference'\n            });\n            const offsets = getSideOffsets(overflow, rects.reference);\n            return {\n              data: {\n                referenceHiddenOffsets: offsets,\n                referenceHidden: isAnySideFullyClipped(offsets)\n              }\n            };\n          }\n        case 'escaped':\n          {\n            const overflow = await detectOverflow(state, {\n              ...detectOverflowOptions,\n              altBoundary: true\n            });\n            const offsets = getSideOffsets(overflow, rects.floating);\n            return {\n              data: {\n                escapedOffsets: offsets,\n                escaped: isAnySideFullyClipped(offsets)\n              }\n            };\n          }\n        default:\n          {\n            return {};\n          }\n      }\n    }\n  };\n};\n\nfunction getBoundingRect(rects) {\n  const minX = min(...rects.map(rect => rect.left));\n  const minY = min(...rects.map(rect => rect.top));\n  const maxX = max(...rects.map(rect => rect.right));\n  const maxY = max(...rects.map(rect => rect.bottom));\n  return {\n    x: minX,\n    y: minY,\n    width: maxX - minX,\n    height: maxY - minY\n  };\n}\nfunction getRectsByLine(rects) {\n  const sortedRects = rects.slice().sort((a, b) => a.y - b.y);\n  const groups = [];\n  let prevRect = null;\n  for (let i = 0; i < sortedRects.length; i++) {\n    const rect = sortedRects[i];\n    if (!prevRect || rect.y - prevRect.y > prevRect.height / 2) {\n      groups.push([rect]);\n    } else {\n      groups[groups.length - 1].push(rect);\n    }\n    prevRect = rect;\n  }\n  return groups.map(rect => rectToClientRect(getBoundingRect(rect)));\n}\n/**\n * Provides improved positioning for inline reference elements that can span\n * over multiple lines, such as hyperlinks or range selections.\n * @see https://floating-ui.com/docs/inline\n */\nconst inline = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'inline',\n    options,\n    async fn(state) {\n      const {\n        placement,\n        elements,\n        rects,\n        platform,\n        strategy\n      } = state;\n      // A MouseEvent's client{X,Y} coords can be up to 2 pixels off a\n      // ClientRect's bounds, despite the event listener being triggered. A\n      // padding of 2 seems to handle this issue.\n      const {\n        padding = 2,\n        x,\n        y\n      } = evaluate(options, state);\n      const nativeClientRects = Array.from((await (platform.getClientRects == null ? void 0 : platform.getClientRects(elements.reference))) || []);\n      const clientRects = getRectsByLine(nativeClientRects);\n      const fallback = rectToClientRect(getBoundingRect(nativeClientRects));\n      const paddingObject = getPaddingObject(padding);\n      function getBoundingClientRect() {\n        // There are two rects and they are disjoined.\n        if (clientRects.length === 2 && clientRects[0].left > clientRects[1].right && x != null && y != null) {\n          // Find the first rect in which the point is fully inside.\n          return clientRects.find(rect => x > rect.left - paddingObject.left && x < rect.right + paddingObject.right && y > rect.top - paddingObject.top && y < rect.bottom + paddingObject.bottom) || fallback;\n        }\n\n        // There are 2 or more connected rects.\n        if (clientRects.length >= 2) {\n          if (getSideAxis(placement) === 'y') {\n            const firstRect = clientRects[0];\n            const lastRect = clientRects[clientRects.length - 1];\n            const isTop = getSide(placement) === 'top';\n            const top = firstRect.top;\n            const bottom = lastRect.bottom;\n            const left = isTop ? firstRect.left : lastRect.left;\n            const right = isTop ? firstRect.right : lastRect.right;\n            const width = right - left;\n            const height = bottom - top;\n            return {\n              top,\n              bottom,\n              left,\n              right,\n              width,\n              height,\n              x: left,\n              y: top\n            };\n          }\n          const isLeftSide = getSide(placement) === 'left';\n          const maxRight = max(...clientRects.map(rect => rect.right));\n          const minLeft = min(...clientRects.map(rect => rect.left));\n          const measureRects = clientRects.filter(rect => isLeftSide ? rect.left === minLeft : rect.right === maxRight);\n          const top = measureRects[0].top;\n          const bottom = measureRects[measureRects.length - 1].bottom;\n          const left = minLeft;\n          const right = maxRight;\n          const width = right - left;\n          const height = bottom - top;\n          return {\n            top,\n            bottom,\n            left,\n            right,\n            width,\n            height,\n            x: left,\n            y: top\n          };\n        }\n        return fallback;\n      }\n      const resetRects = await platform.getElementRects({\n        reference: {\n          getBoundingClientRect\n        },\n        floating: elements.floating,\n        strategy\n      });\n      if (rects.reference.x !== resetRects.reference.x || rects.reference.y !== resetRects.reference.y || rects.reference.width !== resetRects.reference.width || rects.reference.height !== resetRects.reference.height) {\n        return {\n          reset: {\n            rects: resetRects\n          }\n        };\n      }\n      return {};\n    }\n  };\n};\n\n// For type backwards-compatibility, the `OffsetOptions` type was also\n// Derivable.\n\nasync function convertValueToCoords(state, options) {\n  const {\n    placement,\n    platform,\n    elements\n  } = state;\n  const rtl = await (platform.isRTL == null ? void 0 : platform.isRTL(elements.floating));\n  const side = getSide(placement);\n  const alignment = getAlignment(placement);\n  const isVertical = getSideAxis(placement) === 'y';\n  const mainAxisMulti = ['left', 'top'].includes(side) ? -1 : 1;\n  const crossAxisMulti = rtl && isVertical ? -1 : 1;\n  const rawValue = evaluate(options, state);\n\n  // eslint-disable-next-line prefer-const\n  let {\n    mainAxis,\n    crossAxis,\n    alignmentAxis\n  } = typeof rawValue === 'number' ? {\n    mainAxis: rawValue,\n    crossAxis: 0,\n    alignmentAxis: null\n  } : {\n    mainAxis: 0,\n    crossAxis: 0,\n    alignmentAxis: null,\n    ...rawValue\n  };\n  if (alignment && typeof alignmentAxis === 'number') {\n    crossAxis = alignment === 'end' ? alignmentAxis * -1 : alignmentAxis;\n  }\n  return isVertical ? {\n    x: crossAxis * crossAxisMulti,\n    y: mainAxis * mainAxisMulti\n  } : {\n    x: mainAxis * mainAxisMulti,\n    y: crossAxis * crossAxisMulti\n  };\n}\n\n/**\n * Modifies the placement by translating the floating element along the\n * specified axes.\n * A number (shorthand for `mainAxis` or distance), or an axes configuration\n * object may be passed.\n * @see https://floating-ui.com/docs/offset\n */\nconst offset = function (options) {\n  if (options === void 0) {\n    options = 0;\n  }\n  return {\n    name: 'offset',\n    options,\n    async fn(state) {\n      var _middlewareData$offse, _middlewareData$arrow;\n      const {\n        x,\n        y,\n        placement,\n        middlewareData\n      } = state;\n      const diffCoords = await convertValueToCoords(state, options);\n\n      // If the placement is the same and the arrow caused an alignment offset\n      // then we don't need to change the positioning coordinates.\n      if (placement === ((_middlewareData$offse = middlewareData.offset) == null ? void 0 : _middlewareData$offse.placement) && (_middlewareData$arrow = middlewareData.arrow) != null && _middlewareData$arrow.alignmentOffset) {\n        return {};\n      }\n      return {\n        x: x + diffCoords.x,\n        y: y + diffCoords.y,\n        data: {\n          ...diffCoords,\n          placement\n        }\n      };\n    }\n  };\n};\n\n/**\n * Optimizes the visibility of the floating element by shifting it in order to\n * keep it in view when it will overflow the clipping boundary.\n * @see https://floating-ui.com/docs/shift\n */\nconst shift = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'shift',\n    options,\n    async fn(state) {\n      const {\n        x,\n        y,\n        placement\n      } = state;\n      const {\n        mainAxis: checkMainAxis = true,\n        crossAxis: checkCrossAxis = false,\n        limiter = {\n          fn: _ref => {\n            let {\n              x,\n              y\n            } = _ref;\n            return {\n              x,\n              y\n            };\n          }\n        },\n        ...detectOverflowOptions\n      } = evaluate(options, state);\n      const coords = {\n        x,\n        y\n      };\n      const overflow = await detectOverflow(state, detectOverflowOptions);\n      const crossAxis = getSideAxis(getSide(placement));\n      const mainAxis = getOppositeAxis(crossAxis);\n      let mainAxisCoord = coords[mainAxis];\n      let crossAxisCoord = coords[crossAxis];\n      if (checkMainAxis) {\n        const minSide = mainAxis === 'y' ? 'top' : 'left';\n        const maxSide = mainAxis === 'y' ? 'bottom' : 'right';\n        const min = mainAxisCoord + overflow[minSide];\n        const max = mainAxisCoord - overflow[maxSide];\n        mainAxisCoord = clamp(min, mainAxisCoord, max);\n      }\n      if (checkCrossAxis) {\n        const minSide = crossAxis === 'y' ? 'top' : 'left';\n        const maxSide = crossAxis === 'y' ? 'bottom' : 'right';\n        const min = crossAxisCoord + overflow[minSide];\n        const max = crossAxisCoord - overflow[maxSide];\n        crossAxisCoord = clamp(min, crossAxisCoord, max);\n      }\n      const limitedCoords = limiter.fn({\n        ...state,\n        [mainAxis]: mainAxisCoord,\n        [crossAxis]: crossAxisCoord\n      });\n      return {\n        ...limitedCoords,\n        data: {\n          x: limitedCoords.x - x,\n          y: limitedCoords.y - y\n        }\n      };\n    }\n  };\n};\n/**\n * Built-in `limiter` that will stop `shift()` at a certain point.\n */\nconst limitShift = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    options,\n    fn(state) {\n      const {\n        x,\n        y,\n        placement,\n        rects,\n        middlewareData\n      } = state;\n      const {\n        offset = 0,\n        mainAxis: checkMainAxis = true,\n        crossAxis: checkCrossAxis = true\n      } = evaluate(options, state);\n      const coords = {\n        x,\n        y\n      };\n      const crossAxis = getSideAxis(placement);\n      const mainAxis = getOppositeAxis(crossAxis);\n      let mainAxisCoord = coords[mainAxis];\n      let crossAxisCoord = coords[crossAxis];\n      const rawOffset = evaluate(offset, state);\n      const computedOffset = typeof rawOffset === 'number' ? {\n        mainAxis: rawOffset,\n        crossAxis: 0\n      } : {\n        mainAxis: 0,\n        crossAxis: 0,\n        ...rawOffset\n      };\n      if (checkMainAxis) {\n        const len = mainAxis === 'y' ? 'height' : 'width';\n        const limitMin = rects.reference[mainAxis] - rects.floating[len] + computedOffset.mainAxis;\n        const limitMax = rects.reference[mainAxis] + rects.reference[len] - computedOffset.mainAxis;\n        if (mainAxisCoord < limitMin) {\n          mainAxisCoord = limitMin;\n        } else if (mainAxisCoord > limitMax) {\n          mainAxisCoord = limitMax;\n        }\n      }\n      if (checkCrossAxis) {\n        var _middlewareData$offse, _middlewareData$offse2;\n        const len = mainAxis === 'y' ? 'width' : 'height';\n        const isOriginSide = ['top', 'left'].includes(getSide(placement));\n        const limitMin = rects.reference[crossAxis] - rects.floating[len] + (isOriginSide ? ((_middlewareData$offse = middlewareData.offset) == null ? void 0 : _middlewareData$offse[crossAxis]) || 0 : 0) + (isOriginSide ? 0 : computedOffset.crossAxis);\n        const limitMax = rects.reference[crossAxis] + rects.reference[len] + (isOriginSide ? 0 : ((_middlewareData$offse2 = middlewareData.offset) == null ? void 0 : _middlewareData$offse2[crossAxis]) || 0) - (isOriginSide ? computedOffset.crossAxis : 0);\n        if (crossAxisCoord < limitMin) {\n          crossAxisCoord = limitMin;\n        } else if (crossAxisCoord > limitMax) {\n          crossAxisCoord = limitMax;\n        }\n      }\n      return {\n        [mainAxis]: mainAxisCoord,\n        [crossAxis]: crossAxisCoord\n      };\n    }\n  };\n};\n\n/**\n * Provides data that allows you to change the size of the floating element —\n * for instance, prevent it from overflowing the clipping boundary or match the\n * width of the reference element.\n * @see https://floating-ui.com/docs/size\n */\nconst size = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'size',\n    options,\n    async fn(state) {\n      const {\n        placement,\n        rects,\n        platform,\n        elements\n      } = state;\n      const {\n        apply = () => {},\n        ...detectOverflowOptions\n      } = evaluate(options, state);\n      const overflow = await detectOverflow(state, detectOverflowOptions);\n      const side = getSide(placement);\n      const alignment = getAlignment(placement);\n      const isYAxis = getSideAxis(placement) === 'y';\n      const {\n        width,\n        height\n      } = rects.floating;\n      let heightSide;\n      let widthSide;\n      if (side === 'top' || side === 'bottom') {\n        heightSide = side;\n        widthSide = alignment === ((await (platform.isRTL == null ? void 0 : platform.isRTL(elements.floating))) ? 'start' : 'end') ? 'left' : 'right';\n      } else {\n        widthSide = side;\n        heightSide = alignment === 'end' ? 'top' : 'bottom';\n      }\n      const overflowAvailableHeight = height - overflow[heightSide];\n      const overflowAvailableWidth = width - overflow[widthSide];\n      const noShift = !state.middlewareData.shift;\n      let availableHeight = overflowAvailableHeight;\n      let availableWidth = overflowAvailableWidth;\n      if (isYAxis) {\n        const maximumClippingWidth = width - overflow.left - overflow.right;\n        availableWidth = alignment || noShift ? min(overflowAvailableWidth, maximumClippingWidth) : maximumClippingWidth;\n      } else {\n        const maximumClippingHeight = height - overflow.top - overflow.bottom;\n        availableHeight = alignment || noShift ? min(overflowAvailableHeight, maximumClippingHeight) : maximumClippingHeight;\n      }\n      if (noShift && !alignment) {\n        const xMin = max(overflow.left, 0);\n        const xMax = max(overflow.right, 0);\n        const yMin = max(overflow.top, 0);\n        const yMax = max(overflow.bottom, 0);\n        if (isYAxis) {\n          availableWidth = width - 2 * (xMin !== 0 || xMax !== 0 ? xMin + xMax : max(overflow.left, overflow.right));\n        } else {\n          availableHeight = height - 2 * (yMin !== 0 || yMax !== 0 ? yMin + yMax : max(overflow.top, overflow.bottom));\n        }\n      }\n      await apply({\n        ...state,\n        availableWidth,\n        availableHeight\n      });\n      const nextDimensions = await platform.getDimensions(elements.floating);\n      if (width !== nextDimensions.width || height !== nextDimensions.height) {\n        return {\n          reset: {\n            rects: true\n          }\n        };\n      }\n      return {};\n    }\n  };\n};\n\nexport { arrow, autoPlacement, computePosition, detectOverflow, flip, hide, inline, limitShift, offset, shift, size };\n","function getNodeName(node) {\n  if (isNode(node)) {\n    return (node.nodeName || '').toLowerCase();\n  }\n  // Mocked nodes in testing environments may not be instances of Node. By\n  // returning `#document` an infinite loop won't occur.\n  // https://github.com/floating-ui/floating-ui/issues/2317\n  return '#document';\n}\nfunction getWindow(node) {\n  var _node$ownerDocument;\n  return (node == null || (_node$ownerDocument = node.ownerDocument) == null ? void 0 : _node$ownerDocument.defaultView) || window;\n}\nfunction getDocumentElement(node) {\n  var _ref;\n  return (_ref = (isNode(node) ? node.ownerDocument : node.document) || window.document) == null ? void 0 : _ref.documentElement;\n}\nfunction isNode(value) {\n  return value instanceof Node || value instanceof getWindow(value).Node;\n}\nfunction isElement(value) {\n  return value instanceof Element || value instanceof getWindow(value).Element;\n}\nfunction isHTMLElement(value) {\n  return value instanceof HTMLElement || value instanceof getWindow(value).HTMLElement;\n}\nfunction isShadowRoot(value) {\n  // Browsers without `ShadowRoot` support.\n  if (typeof ShadowRoot === 'undefined') {\n    return false;\n  }\n  return value instanceof ShadowRoot || value instanceof getWindow(value).ShadowRoot;\n}\nfunction isOverflowElement(element) {\n  const {\n    overflow,\n    overflowX,\n    overflowY,\n    display\n  } = getComputedStyle(element);\n  return /auto|scroll|overlay|hidden|clip/.test(overflow + overflowY + overflowX) && !['inline', 'contents'].includes(display);\n}\nfunction isTableElement(element) {\n  return ['table', 'td', 'th'].includes(getNodeName(element));\n}\nfunction isContainingBlock(element) {\n  const webkit = isWebKit();\n  const css = getComputedStyle(element);\n\n  // https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block\n  return css.transform !== 'none' || css.perspective !== 'none' || (css.containerType ? css.containerType !== 'normal' : false) || !webkit && (css.backdropFilter ? css.backdropFilter !== 'none' : false) || !webkit && (css.filter ? css.filter !== 'none' : false) || ['transform', 'perspective', 'filter'].some(value => (css.willChange || '').includes(value)) || ['paint', 'layout', 'strict', 'content'].some(value => (css.contain || '').includes(value));\n}\nfunction getContainingBlock(element) {\n  let currentNode = getParentNode(element);\n  while (isHTMLElement(currentNode) && !isLastTraversableNode(currentNode)) {\n    if (isContainingBlock(currentNode)) {\n      return currentNode;\n    } else {\n      currentNode = getParentNode(currentNode);\n    }\n  }\n  return null;\n}\nfunction isWebKit() {\n  if (typeof CSS === 'undefined' || !CSS.supports) return false;\n  return CSS.supports('-webkit-backdrop-filter', 'none');\n}\nfunction isLastTraversableNode(node) {\n  return ['html', 'body', '#document'].includes(getNodeName(node));\n}\nfunction getComputedStyle(element) {\n  return getWindow(element).getComputedStyle(element);\n}\nfunction getNodeScroll(element) {\n  if (isElement(element)) {\n    return {\n      scrollLeft: element.scrollLeft,\n      scrollTop: element.scrollTop\n    };\n  }\n  return {\n    scrollLeft: element.pageXOffset,\n    scrollTop: element.pageYOffset\n  };\n}\nfunction getParentNode(node) {\n  if (getNodeName(node) === 'html') {\n    return node;\n  }\n  const result =\n  // Step into the shadow DOM of the parent of a slotted node.\n  node.assignedSlot ||\n  // DOM Element detected.\n  node.parentNode ||\n  // ShadowRoot detected.\n  isShadowRoot(node) && node.host ||\n  // Fallback.\n  getDocumentElement(node);\n  return isShadowRoot(result) ? result.host : result;\n}\nfunction getNearestOverflowAncestor(node) {\n  const parentNode = getParentNode(node);\n  if (isLastTraversableNode(parentNode)) {\n    return node.ownerDocument ? node.ownerDocument.body : node.body;\n  }\n  if (isHTMLElement(parentNode) && isOverflowElement(parentNode)) {\n    return parentNode;\n  }\n  return getNearestOverflowAncestor(parentNode);\n}\nfunction getOverflowAncestors(node, list, traverseIframes) {\n  var _node$ownerDocument2;\n  if (list === void 0) {\n    list = [];\n  }\n  if (traverseIframes === void 0) {\n    traverseIframes = true;\n  }\n  const scrollableAncestor = getNearestOverflowAncestor(node);\n  const isBody = scrollableAncestor === ((_node$ownerDocument2 = node.ownerDocument) == null ? void 0 : _node$ownerDocument2.body);\n  const win = getWindow(scrollableAncestor);\n  if (isBody) {\n    return list.concat(win, win.visualViewport || [], isOverflowElement(scrollableAncestor) ? scrollableAncestor : [], win.frameElement && traverseIframes ? getOverflowAncestors(win.frameElement) : []);\n  }\n  return list.concat(scrollableAncestor, getOverflowAncestors(scrollableAncestor, [], traverseIframes));\n}\n\nexport { getComputedStyle, getContainingBlock, getDocumentElement, getNearestOverflowAncestor, getNodeName, getNodeScroll, getOverflowAncestors, getParentNode, getWindow, isContainingBlock, isElement, isHTMLElement, isLastTraversableNode, isNode, isOverflowElement, isShadowRoot, isTableElement, isWebKit };\n","import { rectToClientRect, autoPlacement as autoPlacement$1, shift as shift$1, flip as flip$1, size as size$1, hide as hide$1, arrow as arrow$1, inline as inline$1, limitShift as limitShift$1, computePosition as computePosition$1 } from '@floating-ui/core';\nexport { detectOverflow, offset } from '@floating-ui/core';\nimport { round, createCoords, max, min, floor } from '@floating-ui/utils';\nimport { getComputedStyle, isHTMLElement, isElement, getWindow, isWebKit, getDocumentElement, getNodeName, isOverflowElement, getNodeScroll, getOverflowAncestors, getParentNode, isLastTraversableNode, isContainingBlock, isTableElement, getContainingBlock } from '@floating-ui/utils/dom';\nexport { getOverflowAncestors } from '@floating-ui/utils/dom';\n\nfunction getCssDimensions(element) {\n  const css = getComputedStyle(element);\n  // In testing environments, the `width` and `height` properties are empty\n  // strings for SVG elements, returning NaN. Fallback to `0` in this case.\n  let width = parseFloat(css.width) || 0;\n  let height = parseFloat(css.height) || 0;\n  const hasOffset = isHTMLElement(element);\n  const offsetWidth = hasOffset ? element.offsetWidth : width;\n  const offsetHeight = hasOffset ? element.offsetHeight : height;\n  const shouldFallback = round(width) !== offsetWidth || round(height) !== offsetHeight;\n  if (shouldFallback) {\n    width = offsetWidth;\n    height = offsetHeight;\n  }\n  return {\n    width,\n    height,\n    $: shouldFallback\n  };\n}\n\nfunction unwrapElement(element) {\n  return !isElement(element) ? element.contextElement : element;\n}\n\nfunction getScale(element) {\n  const domElement = unwrapElement(element);\n  if (!isHTMLElement(domElement)) {\n    return createCoords(1);\n  }\n  const rect = domElement.getBoundingClientRect();\n  const {\n    width,\n    height,\n    $\n  } = getCssDimensions(domElement);\n  let x = ($ ? round(rect.width) : rect.width) / width;\n  let y = ($ ? round(rect.height) : rect.height) / height;\n\n  // 0, NaN, or Infinity should always fallback to 1.\n\n  if (!x || !Number.isFinite(x)) {\n    x = 1;\n  }\n  if (!y || !Number.isFinite(y)) {\n    y = 1;\n  }\n  return {\n    x,\n    y\n  };\n}\n\nconst noOffsets = /*#__PURE__*/createCoords(0);\nfunction getVisualOffsets(element) {\n  const win = getWindow(element);\n  if (!isWebKit() || !win.visualViewport) {\n    return noOffsets;\n  }\n  return {\n    x: win.visualViewport.offsetLeft,\n    y: win.visualViewport.offsetTop\n  };\n}\nfunction shouldAddVisualOffsets(element, isFixed, floatingOffsetParent) {\n  if (isFixed === void 0) {\n    isFixed = false;\n  }\n  if (!floatingOffsetParent || isFixed && floatingOffsetParent !== getWindow(element)) {\n    return false;\n  }\n  return isFixed;\n}\n\nfunction getBoundingClientRect(element, includeScale, isFixedStrategy, offsetParent) {\n  if (includeScale === void 0) {\n    includeScale = false;\n  }\n  if (isFixedStrategy === void 0) {\n    isFixedStrategy = false;\n  }\n  const clientRect = element.getBoundingClientRect();\n  const domElement = unwrapElement(element);\n  let scale = createCoords(1);\n  if (includeScale) {\n    if (offsetParent) {\n      if (isElement(offsetParent)) {\n        scale = getScale(offsetParent);\n      }\n    } else {\n      scale = getScale(element);\n    }\n  }\n  const visualOffsets = shouldAddVisualOffsets(domElement, isFixedStrategy, offsetParent) ? getVisualOffsets(domElement) : createCoords(0);\n  let x = (clientRect.left + visualOffsets.x) / scale.x;\n  let y = (clientRect.top + visualOffsets.y) / scale.y;\n  let width = clientRect.width / scale.x;\n  let height = clientRect.height / scale.y;\n  if (domElement) {\n    const win = getWindow(domElement);\n    const offsetWin = offsetParent && isElement(offsetParent) ? getWindow(offsetParent) : offsetParent;\n    let currentIFrame = win.frameElement;\n    while (currentIFrame && offsetParent && offsetWin !== win) {\n      const iframeScale = getScale(currentIFrame);\n      const iframeRect = currentIFrame.getBoundingClientRect();\n      const css = getComputedStyle(currentIFrame);\n      const left = iframeRect.left + (currentIFrame.clientLeft + parseFloat(css.paddingLeft)) * iframeScale.x;\n      const top = iframeRect.top + (currentIFrame.clientTop + parseFloat(css.paddingTop)) * iframeScale.y;\n      x *= iframeScale.x;\n      y *= iframeScale.y;\n      width *= iframeScale.x;\n      height *= iframeScale.y;\n      x += left;\n      y += top;\n      currentIFrame = getWindow(currentIFrame).frameElement;\n    }\n  }\n  return rectToClientRect({\n    width,\n    height,\n    x,\n    y\n  });\n}\n\nfunction convertOffsetParentRelativeRectToViewportRelativeRect(_ref) {\n  let {\n    rect,\n    offsetParent,\n    strategy\n  } = _ref;\n  const isOffsetParentAnElement = isHTMLElement(offsetParent);\n  const documentElement = getDocumentElement(offsetParent);\n  if (offsetParent === documentElement) {\n    return rect;\n  }\n  let scroll = {\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n  let scale = createCoords(1);\n  const offsets = createCoords(0);\n  if (isOffsetParentAnElement || !isOffsetParentAnElement && strategy !== 'fixed') {\n    if (getNodeName(offsetParent) !== 'body' || isOverflowElement(documentElement)) {\n      scroll = getNodeScroll(offsetParent);\n    }\n    if (isHTMLElement(offsetParent)) {\n      const offsetRect = getBoundingClientRect(offsetParent);\n      scale = getScale(offsetParent);\n      offsets.x = offsetRect.x + offsetParent.clientLeft;\n      offsets.y = offsetRect.y + offsetParent.clientTop;\n    }\n  }\n  return {\n    width: rect.width * scale.x,\n    height: rect.height * scale.y,\n    x: rect.x * scale.x - scroll.scrollLeft * scale.x + offsets.x,\n    y: rect.y * scale.y - scroll.scrollTop * scale.y + offsets.y\n  };\n}\n\nfunction getClientRects(element) {\n  return Array.from(element.getClientRects());\n}\n\nfunction getWindowScrollBarX(element) {\n  // If <html> has a CSS width greater than the viewport, then this will be\n  // incorrect for RTL.\n  return getBoundingClientRect(getDocumentElement(element)).left + getNodeScroll(element).scrollLeft;\n}\n\n// Gets the entire size of the scrollable document area, even extending outside\n// of the `<html>` and `<body>` rect bounds if horizontally scrollable.\nfunction getDocumentRect(element) {\n  const html = getDocumentElement(element);\n  const scroll = getNodeScroll(element);\n  const body = element.ownerDocument.body;\n  const width = max(html.scrollWidth, html.clientWidth, body.scrollWidth, body.clientWidth);\n  const height = max(html.scrollHeight, html.clientHeight, body.scrollHeight, body.clientHeight);\n  let x = -scroll.scrollLeft + getWindowScrollBarX(element);\n  const y = -scroll.scrollTop;\n  if (getComputedStyle(body).direction === 'rtl') {\n    x += max(html.clientWidth, body.clientWidth) - width;\n  }\n  return {\n    width,\n    height,\n    x,\n    y\n  };\n}\n\nfunction getViewportRect(element, strategy) {\n  const win = getWindow(element);\n  const html = getDocumentElement(element);\n  const visualViewport = win.visualViewport;\n  let width = html.clientWidth;\n  let height = html.clientHeight;\n  let x = 0;\n  let y = 0;\n  if (visualViewport) {\n    width = visualViewport.width;\n    height = visualViewport.height;\n    const visualViewportBased = isWebKit();\n    if (!visualViewportBased || visualViewportBased && strategy === 'fixed') {\n      x = visualViewport.offsetLeft;\n      y = visualViewport.offsetTop;\n    }\n  }\n  return {\n    width,\n    height,\n    x,\n    y\n  };\n}\n\n// Returns the inner client rect, subtracting scrollbars if present.\nfunction getInnerBoundingClientRect(element, strategy) {\n  const clientRect = getBoundingClientRect(element, true, strategy === 'fixed');\n  const top = clientRect.top + element.clientTop;\n  const left = clientRect.left + element.clientLeft;\n  const scale = isHTMLElement(element) ? getScale(element) : createCoords(1);\n  const width = element.clientWidth * scale.x;\n  const height = element.clientHeight * scale.y;\n  const x = left * scale.x;\n  const y = top * scale.y;\n  return {\n    width,\n    height,\n    x,\n    y\n  };\n}\nfunction getClientRectFromClippingAncestor(element, clippingAncestor, strategy) {\n  let rect;\n  if (clippingAncestor === 'viewport') {\n    rect = getViewportRect(element, strategy);\n  } else if (clippingAncestor === 'document') {\n    rect = getDocumentRect(getDocumentElement(element));\n  } else if (isElement(clippingAncestor)) {\n    rect = getInnerBoundingClientRect(clippingAncestor, strategy);\n  } else {\n    const visualOffsets = getVisualOffsets(element);\n    rect = {\n      ...clippingAncestor,\n      x: clippingAncestor.x - visualOffsets.x,\n      y: clippingAncestor.y - visualOffsets.y\n    };\n  }\n  return rectToClientRect(rect);\n}\nfunction hasFixedPositionAncestor(element, stopNode) {\n  const parentNode = getParentNode(element);\n  if (parentNode === stopNode || !isElement(parentNode) || isLastTraversableNode(parentNode)) {\n    return false;\n  }\n  return getComputedStyle(parentNode).position === 'fixed' || hasFixedPositionAncestor(parentNode, stopNode);\n}\n\n// A \"clipping ancestor\" is an `overflow` element with the characteristic of\n// clipping (or hiding) child elements. This returns all clipping ancestors\n// of the given element up the tree.\nfunction getClippingElementAncestors(element, cache) {\n  const cachedResult = cache.get(element);\n  if (cachedResult) {\n    return cachedResult;\n  }\n  let result = getOverflowAncestors(element, [], false).filter(el => isElement(el) && getNodeName(el) !== 'body');\n  let currentContainingBlockComputedStyle = null;\n  const elementIsFixed = getComputedStyle(element).position === 'fixed';\n  let currentNode = elementIsFixed ? getParentNode(element) : element;\n\n  // https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block\n  while (isElement(currentNode) && !isLastTraversableNode(currentNode)) {\n    const computedStyle = getComputedStyle(currentNode);\n    const currentNodeIsContaining = isContainingBlock(currentNode);\n    if (!currentNodeIsContaining && computedStyle.position === 'fixed') {\n      currentContainingBlockComputedStyle = null;\n    }\n    const shouldDropCurrentNode = elementIsFixed ? !currentNodeIsContaining && !currentContainingBlockComputedStyle : !currentNodeIsContaining && computedStyle.position === 'static' && !!currentContainingBlockComputedStyle && ['absolute', 'fixed'].includes(currentContainingBlockComputedStyle.position) || isOverflowElement(currentNode) && !currentNodeIsContaining && hasFixedPositionAncestor(element, currentNode);\n    if (shouldDropCurrentNode) {\n      // Drop non-containing blocks.\n      result = result.filter(ancestor => ancestor !== currentNode);\n    } else {\n      // Record last containing block for next iteration.\n      currentContainingBlockComputedStyle = computedStyle;\n    }\n    currentNode = getParentNode(currentNode);\n  }\n  cache.set(element, result);\n  return result;\n}\n\n// Gets the maximum area that the element is visible in due to any number of\n// clipping ancestors.\nfunction getClippingRect(_ref) {\n  let {\n    element,\n    boundary,\n    rootBoundary,\n    strategy\n  } = _ref;\n  const elementClippingAncestors = boundary === 'clippingAncestors' ? getClippingElementAncestors(element, this._c) : [].concat(boundary);\n  const clippingAncestors = [...elementClippingAncestors, rootBoundary];\n  const firstClippingAncestor = clippingAncestors[0];\n  const clippingRect = clippingAncestors.reduce((accRect, clippingAncestor) => {\n    const rect = getClientRectFromClippingAncestor(element, clippingAncestor, strategy);\n    accRect.top = max(rect.top, accRect.top);\n    accRect.right = min(rect.right, accRect.right);\n    accRect.bottom = min(rect.bottom, accRect.bottom);\n    accRect.left = max(rect.left, accRect.left);\n    return accRect;\n  }, getClientRectFromClippingAncestor(element, firstClippingAncestor, strategy));\n  return {\n    width: clippingRect.right - clippingRect.left,\n    height: clippingRect.bottom - clippingRect.top,\n    x: clippingRect.left,\n    y: clippingRect.top\n  };\n}\n\nfunction getDimensions(element) {\n  const {\n    width,\n    height\n  } = getCssDimensions(element);\n  return {\n    width,\n    height\n  };\n}\n\nfunction getRectRelativeToOffsetParent(element, offsetParent, strategy) {\n  const isOffsetParentAnElement = isHTMLElement(offsetParent);\n  const documentElement = getDocumentElement(offsetParent);\n  const isFixed = strategy === 'fixed';\n  const rect = getBoundingClientRect(element, true, isFixed, offsetParent);\n  let scroll = {\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n  const offsets = createCoords(0);\n  if (isOffsetParentAnElement || !isOffsetParentAnElement && !isFixed) {\n    if (getNodeName(offsetParent) !== 'body' || isOverflowElement(documentElement)) {\n      scroll = getNodeScroll(offsetParent);\n    }\n    if (isOffsetParentAnElement) {\n      const offsetRect = getBoundingClientRect(offsetParent, true, isFixed, offsetParent);\n      offsets.x = offsetRect.x + offsetParent.clientLeft;\n      offsets.y = offsetRect.y + offsetParent.clientTop;\n    } else if (documentElement) {\n      offsets.x = getWindowScrollBarX(documentElement);\n    }\n  }\n  return {\n    x: rect.left + scroll.scrollLeft - offsets.x,\n    y: rect.top + scroll.scrollTop - offsets.y,\n    width: rect.width,\n    height: rect.height\n  };\n}\n\nfunction getTrueOffsetParent(element, polyfill) {\n  if (!isHTMLElement(element) || getComputedStyle(element).position === 'fixed') {\n    return null;\n  }\n  if (polyfill) {\n    return polyfill(element);\n  }\n  return element.offsetParent;\n}\n\n// Gets the closest ancestor positioned element. Handles some edge cases,\n// such as table ancestors and cross browser bugs.\nfunction getOffsetParent(element, polyfill) {\n  const window = getWindow(element);\n  if (!isHTMLElement(element)) {\n    return window;\n  }\n  let offsetParent = getTrueOffsetParent(element, polyfill);\n  while (offsetParent && isTableElement(offsetParent) && getComputedStyle(offsetParent).position === 'static') {\n    offsetParent = getTrueOffsetParent(offsetParent, polyfill);\n  }\n  if (offsetParent && (getNodeName(offsetParent) === 'html' || getNodeName(offsetParent) === 'body' && getComputedStyle(offsetParent).position === 'static' && !isContainingBlock(offsetParent))) {\n    return window;\n  }\n  return offsetParent || getContainingBlock(element) || window;\n}\n\nconst getElementRects = async function (_ref) {\n  let {\n    reference,\n    floating,\n    strategy\n  } = _ref;\n  const getOffsetParentFn = this.getOffsetParent || getOffsetParent;\n  const getDimensionsFn = this.getDimensions;\n  return {\n    reference: getRectRelativeToOffsetParent(reference, await getOffsetParentFn(floating), strategy),\n    floating: {\n      x: 0,\n      y: 0,\n      ...(await getDimensionsFn(floating))\n    }\n  };\n};\n\nfunction isRTL(element) {\n  return getComputedStyle(element).direction === 'rtl';\n}\n\nconst platform = {\n  convertOffsetParentRelativeRectToViewportRelativeRect,\n  getDocumentElement,\n  getClippingRect,\n  getOffsetParent,\n  getElementRects,\n  getClientRects,\n  getDimensions,\n  getScale,\n  isElement,\n  isRTL\n};\n\n// https://samthor.au/2021/observing-dom/\nfunction observeMove(element, onMove) {\n  let io = null;\n  let timeoutId;\n  const root = getDocumentElement(element);\n  function cleanup() {\n    clearTimeout(timeoutId);\n    io && io.disconnect();\n    io = null;\n  }\n  function refresh(skip, threshold) {\n    if (skip === void 0) {\n      skip = false;\n    }\n    if (threshold === void 0) {\n      threshold = 1;\n    }\n    cleanup();\n    const {\n      left,\n      top,\n      width,\n      height\n    } = element.getBoundingClientRect();\n    if (!skip) {\n      onMove();\n    }\n    if (!width || !height) {\n      return;\n    }\n    const insetTop = floor(top);\n    const insetRight = floor(root.clientWidth - (left + width));\n    const insetBottom = floor(root.clientHeight - (top + height));\n    const insetLeft = floor(left);\n    const rootMargin = -insetTop + \"px \" + -insetRight + \"px \" + -insetBottom + \"px \" + -insetLeft + \"px\";\n    const options = {\n      rootMargin,\n      threshold: max(0, min(1, threshold)) || 1\n    };\n    let isFirstUpdate = true;\n    function handleObserve(entries) {\n      const ratio = entries[0].intersectionRatio;\n      if (ratio !== threshold) {\n        if (!isFirstUpdate) {\n          return refresh();\n        }\n        if (!ratio) {\n          timeoutId = setTimeout(() => {\n            refresh(false, 1e-7);\n          }, 100);\n        } else {\n          refresh(false, ratio);\n        }\n      }\n      isFirstUpdate = false;\n    }\n\n    // Older browsers don't support a `document` as the root and will throw an\n    // error.\n    try {\n      io = new IntersectionObserver(handleObserve, {\n        ...options,\n        // Handle <iframe>s\n        root: root.ownerDocument\n      });\n    } catch (e) {\n      io = new IntersectionObserver(handleObserve, options);\n    }\n    io.observe(element);\n  }\n  refresh(true);\n  return cleanup;\n}\n\n/**\n * Automatically updates the position of the floating element when necessary.\n * Should only be called when the floating element is mounted on the DOM or\n * visible on the screen.\n * @returns cleanup function that should be invoked when the floating element is\n * removed from the DOM or hidden from the screen.\n * @see https://floating-ui.com/docs/autoUpdate\n */\nfunction autoUpdate(reference, floating, update, options) {\n  if (options === void 0) {\n    options = {};\n  }\n  const {\n    ancestorScroll = true,\n    ancestorResize = true,\n    elementResize = typeof ResizeObserver === 'function',\n    layoutShift = typeof IntersectionObserver === 'function',\n    animationFrame = false\n  } = options;\n  const referenceEl = unwrapElement(reference);\n  const ancestors = ancestorScroll || ancestorResize ? [...(referenceEl ? getOverflowAncestors(referenceEl) : []), ...getOverflowAncestors(floating)] : [];\n  ancestors.forEach(ancestor => {\n    ancestorScroll && ancestor.addEventListener('scroll', update, {\n      passive: true\n    });\n    ancestorResize && ancestor.addEventListener('resize', update);\n  });\n  const cleanupIo = referenceEl && layoutShift ? observeMove(referenceEl, update) : null;\n  let reobserveFrame = -1;\n  let resizeObserver = null;\n  if (elementResize) {\n    resizeObserver = new ResizeObserver(_ref => {\n      let [firstEntry] = _ref;\n      if (firstEntry && firstEntry.target === referenceEl && resizeObserver) {\n        // Prevent update loops when using the `size` middleware.\n        // https://github.com/floating-ui/floating-ui/issues/1740\n        resizeObserver.unobserve(floating);\n        cancelAnimationFrame(reobserveFrame);\n        reobserveFrame = requestAnimationFrame(() => {\n          resizeObserver && resizeObserver.observe(floating);\n        });\n      }\n      update();\n    });\n    if (referenceEl && !animationFrame) {\n      resizeObserver.observe(referenceEl);\n    }\n    resizeObserver.observe(floating);\n  }\n  let frameId;\n  let prevRefRect = animationFrame ? getBoundingClientRect(reference) : null;\n  if (animationFrame) {\n    frameLoop();\n  }\n  function frameLoop() {\n    const nextRefRect = getBoundingClientRect(reference);\n    if (prevRefRect && (nextRefRect.x !== prevRefRect.x || nextRefRect.y !== prevRefRect.y || nextRefRect.width !== prevRefRect.width || nextRefRect.height !== prevRefRect.height)) {\n      update();\n    }\n    prevRefRect = nextRefRect;\n    frameId = requestAnimationFrame(frameLoop);\n  }\n  update();\n  return () => {\n    ancestors.forEach(ancestor => {\n      ancestorScroll && ancestor.removeEventListener('scroll', update);\n      ancestorResize && ancestor.removeEventListener('resize', update);\n    });\n    cleanupIo && cleanupIo();\n    resizeObserver && resizeObserver.disconnect();\n    resizeObserver = null;\n    if (animationFrame) {\n      cancelAnimationFrame(frameId);\n    }\n  };\n}\n\n/**\n * Optimizes the visibility of the floating element by choosing the placement\n * that has the most space available automatically, without needing to specify a\n * preferred placement. Alternative to `flip`.\n * @see https://floating-ui.com/docs/autoPlacement\n */\nconst autoPlacement = autoPlacement$1;\n\n/**\n * Optimizes the visibility of the floating element by shifting it in order to\n * keep it in view when it will overflow the clipping boundary.\n * @see https://floating-ui.com/docs/shift\n */\nconst shift = shift$1;\n\n/**\n * Optimizes the visibility of the floating element by flipping the `placement`\n * in order to keep it in view when the preferred placement(s) will overflow the\n * clipping boundary. Alternative to `autoPlacement`.\n * @see https://floating-ui.com/docs/flip\n */\nconst flip = flip$1;\n\n/**\n * Provides data that allows you to change the size of the floating element —\n * for instance, prevent it from overflowing the clipping boundary or match the\n * width of the reference element.\n * @see https://floating-ui.com/docs/size\n */\nconst size = size$1;\n\n/**\n * Provides data to hide the floating element in applicable situations, such as\n * when it is not in the same clipping context as the reference element.\n * @see https://floating-ui.com/docs/hide\n */\nconst hide = hide$1;\n\n/**\n * Provides data to position an inner element of the floating element so that it\n * appears centered to the reference element.\n * @see https://floating-ui.com/docs/arrow\n */\nconst arrow = arrow$1;\n\n/**\n * Provides improved positioning for inline reference elements that can span\n * over multiple lines, such as hyperlinks or range selections.\n * @see https://floating-ui.com/docs/inline\n */\nconst inline = inline$1;\n\n/**\n * Built-in `limiter` that will stop `shift()` at a certain point.\n */\nconst limitShift = limitShift$1;\n\n/**\n * Computes the `x` and `y` coordinates that will place the floating element\n * next to a given reference element.\n */\nconst computePosition = (reference, floating, options) => {\n  // This caches the expensive `getClippingElementAncestors` function so that\n  // multiple lifecycle resets re-use the same result. It only lives for a\n  // single call. If other functions become expensive, we can add them as well.\n  const cache = new Map();\n  const mergedOptions = {\n    platform,\n    ...options\n  };\n  const platformWithCache = {\n    ...mergedOptions.platform,\n    _c: cache\n  };\n  return computePosition$1(reference, floating, {\n    ...mergedOptions,\n    platform: platformWithCache\n  });\n};\n\nexport { arrow, autoPlacement, autoUpdate, computePosition, flip, hide, inline, limitShift, platform, shift, size };\n","import{noChange as t}from\"../lit-html.js\";import{directive as s,Directive as i,PartType as r}from\"../directive.js\";\n/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const e=s(class extends i{constructor(t){if(super(t),t.type!==r.ATTRIBUTE||\"class\"!==t.name||t.strings?.length>2)throw Error(\"`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.\")}render(t){return\" \"+Object.keys(t).filter((s=>t[s])).join(\" \")+\" \"}update(s,[i]){if(void 0===this.it){this.it=new Set,void 0!==s.strings&&(this.st=new Set(s.strings.join(\" \").split(/\\s/).filter((t=>\"\"!==t))));for(const t in i)i[t]&&!this.st?.has(t)&&this.it.add(t);return this.render(i)}const r=s.element.classList;for(const t of this.it)t in i||(r.remove(t),this.it.delete(t));for(const t in i){const s=!!i[t];s===this.it.has(t)||this.st?.has(t)||(s?(r.add(t),this.it.add(t)):(r.remove(t),this.it.delete(t)))}return t}});export{e as classMap};\n//# sourceMappingURL=class-map.js.map\n","import{nothing as t}from\"../lit-html.js\";\n/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const o=o=>o??t;export{o as ifDefined};\n//# sourceMappingURL=if-defined.js.map\n","import{isSingleExpression as i}from\"./directive-helpers.js\";import{Directive as t,PartType as e}from\"./directive.js\";export{Directive,PartType,directive}from\"./directive.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const s=(i,t)=>{const e=i._$AN;if(void 0===e)return!1;for(const i of e)i._$AO?.(t,!1),s(i,t);return!0},o=i=>{let t,e;do{if(void 0===(t=i._$AM))break;e=t._$AN,e.delete(i),i=t}while(0===e?.size)},r=i=>{for(let t;t=i._$AM;i=t){let e=t._$AN;if(void 0===e)t._$AN=e=new Set;else if(e.has(i))break;e.add(i),c(t)}};function h(i){void 0!==this._$AN?(o(this),this._$AM=i,r(this)):this._$AM=i}function n(i,t=!1,e=0){const r=this._$AH,h=this._$AN;if(void 0!==h&&0!==h.size)if(t)if(Array.isArray(r))for(let i=e;i<r.length;i++)s(r[i],!1),o(r[i]);else null!=r&&(s(r,!1),o(r));else s(this,i)}const c=i=>{i.type==e.CHILD&&(i._$AP??=n,i._$AQ??=h)};class f extends t{constructor(){super(...arguments),this._$AN=void 0}_$AT(i,t,e){super._$AT(i,t,e),r(this),this.isConnected=i._$AU}_$AO(i,t=!0){i!==this.isConnected&&(this.isConnected=i,i?this.reconnected?.():this.disconnected?.()),t&&(s(this,i),o(this))}setValue(t){if(i(this._$Ct))this._$Ct._$AI(t,this);else{const i=[...this._$Ct._$AH];i[this._$Ci]=t,this._$Ct._$AI(i,this,0)}}disconnected(){}reconnected(){}}export{f as AsyncDirective};\n//# sourceMappingURL=async-directive.js.map\n","import{nothing as t}from\"../lit-html.js\";import{AsyncDirective as i}from\"../async-directive.js\";import{directive as s}from\"../directive.js\";\n/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const e=()=>new h;class h{}const o=new WeakMap,n=s(class extends i{render(i){return t}update(i,[s]){const e=s!==this.G;return e&&void 0!==this.G&&this.ot(void 0),(e||this.rt!==this.lt)&&(this.G=s,this.ct=i.options?.host,this.ot(this.lt=i.element)),t}ot(t){if(\"function\"==typeof this.G){const i=this.ct??globalThis;let s=o.get(i);void 0===s&&(s=new WeakMap,o.set(i,s)),void 0!==s.get(this.G)&&this.G.call(this.ct,void 0),s.set(this.G,t),void 0!==t&&this.G.call(this.ct,t)}else this.G.value=t}get rt(){return\"function\"==typeof this.G?o.get(this.ct??globalThis)?.get(this.G):this.G?.value}disconnected(){this.rt===this.lt&&this.ot(void 0)}reconnected(){this.ot(this.lt)}});export{e as createRef,n as ref};\n//# sourceMappingURL=ref.js.map\n"],"names":["LZString","f","keyStrBase64","keyStrUriSafe","baseReverseDic","getBaseValue","alphabet","character","i","input","res","a","index","compressed","uncompressed","buf","TotalLen","current_value","result","c","bitsPerChar","getCharFromInt","value","context_dictionary","context_dictionaryToCreate","context_c","context_wc","context_w","context_enlargeIn","context_dictSize","context_numBits","context_data","context_data_val","context_data_position","ii","length","resetValue","getNextValue","dictionary","enlargeIn","dictSize","numBits","entry","w","bits","resb","maxpower","power","data","module","Clipboard","std","middleware","m","mimeType","adapter","priority","clipboardData","type","item","files","getItem","page","parent","byPriority","b","job","payload","sliceSnapshot","slice","event","json","assertExists","getDataByType","snapshot","adapterKeys","_items","items","Job","adapterItem","updateItems","text","innerHTML","png","html","lz.compressToEncodedURIComponent","clipboardItems","textBlob","pngBlob","dom","lz.decompressFromEncodedURIComponent","cmdSymbol","CommandManager","methods","_cmds","getCommandCtx","createChain","pipe","runCmds","ctx","cmd","rest","success","cmds","_","next","err","command","fn","beforeCtx","chains","chain","branchCtx","allFail","name","chainCtx","UIEventState","UIEventStateContext","state","states","context","PathFinder","path","key","path1","path2","ClipboardEventState","EventScopeSourceType","EventSourceState","sourceType","ClipboardControl","_dispatcher","clipboardEventState","clipboardState","base","shift","mac","ie","code","keyName","ignoreKey","normalizeKeyName","parts","alt","ctrl","meta","mod","modifiers","normalize","map","copy","prop","bindKeymap","bindings","direct","noShift","special","baseName","fromCode","KeyboardEventState","composing","PointerEventState","rect","startX","startY","last","offsetX","offsetY","KeyboardControl","keyboardEventState","keyboardState","keymap","options","isFarEnough","dx","dy","toLowerCase","str","PointerControl","pointerEventState","pointerState","RangeControl","scope","eventName","selection","range","paths","blockView","flavours","blockId","flavour","start","end","ancestor","getBlockView","leaf","nodes","startRecorded","dfsDOMSearch","current","blocks","node","bypassEventNames","eventNames","UIEventDispatcher","DisposableGroup","prevDispatcher","args","sourceState","runner","handler","x","output","handlers","globalEvents","pathEvents","_path","flavourEvents","target","selections","seen","BaseSelection","BlockSelectionSchema","z","BlockSelection","other","CursorSelectionSchema","CursorSelection","y","SurfaceSelectionSchema","SurfaceSelection","elements","editing","id","idx","TextSelectionSchema","TextSelection","from","to","isReverse","SelectionManager","Slot","ctor","s","group","types","values","sel","error","slot","SpecStore","service","specs","oldSpecs","newSpecs","spec","oldSpec","newSpec","specMap","observeOptions","ViewStore","view","host","iterate","nodeView","children","child","firstBlock","tree","curr","getPrev","grandParent","getNext","BlockStdScope","t","e","o","n$6","r","n","S","h","l","p","d","u","s$2","i$1","ZERO_WIDTH_SPACE","ZERO_WIDTH_NON_JOINER","INLINE_ROOT_ATTR","findDocumentOrShadowRoot","editor","el","root","getInlineEditorInsideRoot","element","rootElement","inlineEditor","VElement","LitElement","attributeRenderer","styleMap","__decorateClass","property","customElement","EmbedGap","VLine","acc","renderElements","template","delta","nextDelta","VText","InlineHookService","hooks","inlineTextStyles","props","textDecorations","inlineCodeStyle","getDefaultAttributeRenderer","style","baseTextAttributes","transformDelta","tmpString","deltaInsertsToChunks","transformedDelta","chunksGenerator","arr","chunk","isInEmbedElement","transformDeltasToEmbedDeltas","deltas","dividedDeltas","subInsert","isNativeTextInVText","isVElement","isVLine","isInlineRoot","SHORT_KEY_PROPERTY","IS_IOS","IS_MAC","KEYBOARD_PREVENT_DEFAULT","KEYBOARD_ALLOW_DEFAULT","createInlineKeyDownHandler","bindingStore","binding","keyMatch","evt","addBinding","keyBinding","singleBinding","keyDownHandler","keyMatches","inlineRange","leafStart","offsetStart","leafEnd","offsetEnd","prefixText","suffixText","currContext","calculateTextLength","getTextNodesFromElement","textSpanElement","textNode","nativePointToTextPoint","offset","texts","vElement","getTextPointRoughlyFromElementByOffset","vNodes","getVNodesFromNode","getTextPointFromVNodes","textPointToDomPoint","goalIndex","textParentElement","lineElement","lineIndex","vLine","container","first","vNode","AFollowedByB","AInsideB","APrecededByB","getTextPointRoughlyFromElement","fromStart","rangeHasAnchorAndFocus","startText","endText","rangeHasAnchorAndFocusHandler","startTextOffset","endTextOffset","anchorDomPoint","focusDomPoint","rangeOnlyHasFocus","rangeOnlyHasFocusHandler","rangeOnlyHasAnchor","rangeOnlyHasAnchorHandler","yText","startDomPoint","rangeHasNoAnchorAndFocus","rangeHasNoAnchorAndFocusHandler","buildContext","startContainer","startOffset","endContainer","endOffset","startTextPoint","endTextPoint","domRangeToInlineRange","inlineRangeToDomRange","lineElements","anchorOffset","focusOffset","textLength","anchorVElement","nextSibling","focusVElement","renderElement","parseAttributes","selected","handleInsertText","attributes","handleInsertParagraph","handleDelete","transformInput","inputType","AttributeService","marks","schema","renderer","loose","maybeAttributesList","position","cur","newFormat","typedKey","textAttributes","attributeResult","v","j","k","DeltaService","callback","rangeIndex","deltaIndex","syncInlineRange","normalizedDeltas","chunks","normalizedDeltaIndex","lines","lineDeltas","render","repeat","line","isMaybeInlineRangeEqual","isInlineRangeEqual","isInlineRangeIntersect","intersectInlineRange","EventService","eventSource","rootRange","previousInlineRange","embed","hook","newInlineRange","newData","targetRanges","staticRange","newEvent","prevent","RangeService","sync","Y.createRelativePositionFromTypeIndex","containerRect","rangeRects","newRange","vLines","InlineTextService","normalizedAttributes","match","mode","deltaInlineRange","_delta","targetInlineRange","coverDeltas","unset","InlineEditor","ops","_transaction","lastStartRelativePosition","lastEndRelativePosition","doc","absoluteStart","Y.createAbsolutePositionFromRelativePosition","absoluteEnd","Y.encodeRelativePosition","startIndex","endIndex","isEmbed","inlineRangeProvider","inlineRoot","nothing","isReadonly","WithDisposable","SuperClass","DerivedClass","ShadowlessElement","styles","elementStyles","CSSResult","styleRoot","BlockElement","config","model","parentElement","mapping","expectedVersion","actualVersion","changedProperties","when","oldValue","RangeBinding","manager","isRangeReversed","block","newSelection","highestBlocks","parents","highestBlock","RangeManager","topContenteditableElement","selectionManager","textSelection","firstElement","fromInlineEditor","toInlineEditor","fromRange","toRange","reverse","startBlock","endBlock","startInlineEditor","endInlineEditor","startInlineRange","endInlineRange","EditorHost","tag","widgets","unsafeStatic","blockSelector","widgetSelector","fromDOM","getChildren","widgetTags","elementsTags","notInside","selector","notInSelector","not","WidgetElement","sides","alignments","placements","side","min","max","round","floor","createCoords","oppositeSideMap","oppositeAlignmentMap","clamp","evaluate","param","getSide","placement","getAlignment","getOppositeAxis","axis","getAxisLength","getSideAxis","getAlignmentAxis","getAlignmentSides","rects","rtl","alignment","alignmentAxis","mainAlignmentSide","getOppositePlacement","getExpandedPlacements","oppositePlacement","getOppositeAlignmentPlacement","getSideList","isStart","lr","rl","tb","bt","getOppositeAxisPlacements","flipAlignment","direction","list","expandPaddingObject","padding","getPaddingObject","rectToClientRect","computeCoordsFromPlacement","_ref","reference","floating","sideAxis","alignLength","isVertical","commonX","commonY","commonAlign","coords","computePosition","strategy","platform","validMiddleware","statefulPlacement","middlewareData","resetCount","nextX","nextY","reset","detectOverflow","_await$platform$isEle","boundary","rootBoundary","elementContext","altBoundary","paddingObject","clippingClientRect","offsetParent","offsetScale","elementClientRect","arrow","arrowDimensions","isYAxis","minProp","maxProp","clientProp","endDiff","startDiff","arrowOffsetParent","clientSize","centerToReference","largestPossiblePadding","minPadding","maxPadding","min$1","center","shouldAddOffset","alignmentOffset","getPlacementList","autoAlignment","allowedPlacements","autoPlacement","_middlewareData$autoP","_middlewareData$autoP2","_placementsThatFitOnE","crossAxis","detectOverflowOptions","placements$1","overflow","currentIndex","currentPlacement","alignmentSides","currentOverflows","allOverflows","nextPlacement","placementsSortedByMostSpace","resetPlacement","flip","_middlewareData$arrow","_middlewareData$flip","initialPlacement","checkMainAxis","checkCrossAxis","specifiedFallbackPlacements","fallbackStrategy","fallbackAxisSideDirection","isBasePlacement","fallbackPlacements","overflows","overflowsData","_middlewareData$flip2","_overflowsData$filter","nextIndex","_overflowsData$map$so","getBoundingRect","minX","minY","maxX","maxY","getRectsByLine","sortedRects","groups","prevRect","inline","nativeClientRects","clientRects","fallback","getBoundingClientRect","firstRect","lastRect","isTop","top","bottom","left","right","width","height","isLeftSide","maxRight","minLeft","measureRects","resetRects","convertValueToCoords","mainAxisMulti","crossAxisMulti","rawValue","mainAxis","_middlewareData$offse","diffCoords","limiter","mainAxisCoord","crossAxisCoord","minSide","maxSide","limitedCoords","limitShift","rawOffset","computedOffset","len","limitMin","limitMax","_middlewareData$offse2","isOriginSide","size","apply","heightSide","widthSide","overflowAvailableHeight","overflowAvailableWidth","availableHeight","availableWidth","maximumClippingWidth","maximumClippingHeight","xMin","xMax","yMin","yMax","nextDimensions","getNodeName","isNode","getWindow","_node$ownerDocument","getDocumentElement","isElement","isHTMLElement","isShadowRoot","isOverflowElement","overflowX","overflowY","display","getComputedStyle","isTableElement","isContainingBlock","webkit","isWebKit","css","getContainingBlock","currentNode","getParentNode","isLastTraversableNode","getNodeScroll","getNearestOverflowAncestor","parentNode","getOverflowAncestors","traverseIframes","_node$ownerDocument2","scrollableAncestor","isBody","win","getCssDimensions","hasOffset","offsetWidth","offsetHeight","shouldFallback","unwrapElement","getScale","domElement","$","noOffsets","getVisualOffsets","shouldAddVisualOffsets","isFixed","floatingOffsetParent","includeScale","isFixedStrategy","clientRect","scale","visualOffsets","offsetWin","currentIFrame","iframeScale","iframeRect","convertOffsetParentRelativeRectToViewportRelativeRect","isOffsetParentAnElement","documentElement","scroll","offsets","offsetRect","getClientRects","getWindowScrollBarX","getDocumentRect","body","getViewportRect","visualViewport","visualViewportBased","getInnerBoundingClientRect","getClientRectFromClippingAncestor","clippingAncestor","hasFixedPositionAncestor","stopNode","getClippingElementAncestors","cache","cachedResult","currentContainingBlockComputedStyle","elementIsFixed","computedStyle","currentNodeIsContaining","getClippingRect","clippingAncestors","firstClippingAncestor","clippingRect","accRect","getDimensions","getRectRelativeToOffsetParent","getTrueOffsetParent","polyfill","getOffsetParent","window","getElementRects","getOffsetParentFn","getDimensionsFn","isRTL","observeMove","onMove","io","timeoutId","cleanup","refresh","skip","threshold","insetTop","insetRight","insetBottom","insetLeft","isFirstUpdate","handleObserve","entries","ratio","autoUpdate","update","ancestorScroll","ancestorResize","elementResize","layoutShift","animationFrame","referenceEl","ancestors","cleanupIo","reobserveFrame","resizeObserver","firstEntry","frameId","prevRefRect","frameLoop","nextRefRect","autoPlacement$1","shift$1","flip$1","size$1","arrow$1","inline$1","limitShift$1","mergedOptions","platformWithCache","computePosition$1"],"mappings":"yNASA,IAAIA,EAAY,UAAW,CAG3B,IAAIC,EAAI,OAAO,aACXC,EAAe,oEACfC,EAAgB,oEAChBC,EAAiB,CAAA,EAErB,SAASC,EAAaC,EAAUC,EAAW,CACzC,GAAI,CAACH,EAAeE,CAAQ,EAAG,CAC7BF,EAAeE,CAAQ,EAAI,GAC3B,QAASE,EAAE,EAAIA,EAAEF,EAAS,OAASE,IACjCJ,EAAeE,CAAQ,EAAEA,EAAS,OAAOE,CAAC,CAAC,EAAIA,CAElD,CACD,OAAOJ,EAAeE,CAAQ,EAAEC,CAAS,CAC1C,CAED,IAAIP,EAAW,CACb,iBAAmB,SAAUS,EAAO,CAClC,GAAIA,GAAS,KAAM,MAAO,GAC1B,IAAIC,EAAMV,EAAS,UAAUS,EAAO,EAAG,SAASE,EAAE,CAAC,OAAOT,EAAa,OAAOS,CAAC,CAAE,CAAC,EAClF,OAAQD,EAAI,OAAS,EAAC,CACtB,QACA,IAAK,GAAI,OAAOA,EAChB,IAAK,GAAI,OAAOA,EAAI,MACpB,IAAK,GAAI,OAAOA,EAAI,KACpB,IAAK,GAAI,OAAOA,EAAI,GACnB,CACF,EAED,qBAAuB,SAAUD,EAAO,CACtC,OAAIA,GAAS,KAAa,GACtBA,GAAS,GAAW,KACjBT,EAAS,YAAYS,EAAM,OAAQ,GAAI,SAASG,EAAO,CAAE,OAAOP,EAAaH,EAAcO,EAAM,OAAOG,CAAK,CAAC,CAAE,CAAE,CAC1H,EAED,gBAAkB,SAAUH,EAAO,CACjC,OAAIA,GAAS,KAAa,GACnBT,EAAS,UAAUS,EAAO,GAAI,SAASE,EAAE,CAAC,OAAOV,EAAEU,EAAE,EAAE,CAAE,CAAC,EAAI,GACtE,EAED,oBAAqB,SAAUE,EAAY,CACzC,OAAIA,GAAc,KAAa,GAC3BA,GAAc,GAAW,KACtBb,EAAS,YAAYa,EAAW,OAAQ,MAAO,SAASD,EAAO,CAAE,OAAOC,EAAW,WAAWD,CAAK,EAAI,EAAK,CAAA,CACpH,EAGD,qBAAsB,SAAUE,EAAc,CAI5C,QAHID,EAAab,EAAS,SAASc,CAAY,EAC3CC,EAAI,IAAI,WAAWF,EAAW,OAAO,CAAC,EAEjCL,EAAE,EAAGQ,EAASH,EAAW,OAAQL,EAAEQ,EAAUR,IAAK,CACzD,IAAIS,EAAgBJ,EAAW,WAAWL,CAAC,EAC3CO,EAAIP,EAAE,CAAC,EAAIS,IAAkB,EAC7BF,EAAIP,EAAE,EAAE,CAAC,EAAIS,EAAgB,GAC9B,CACD,OAAOF,CACR,EAGD,yBAAyB,SAAUF,EAAY,CAC7C,GAAIA,GAAa,KACb,OAAOb,EAAS,WAAWa,CAAU,EAGrC,QADIE,EAAI,IAAI,MAAMF,EAAW,OAAO,CAAC,EAC5BL,EAAE,EAAGQ,EAASD,EAAI,OAAQP,EAAEQ,EAAUR,IAC7CO,EAAIP,CAAC,EAAEK,EAAWL,EAAE,CAAC,EAAE,IAAIK,EAAWL,EAAE,EAAE,CAAC,EAG7C,IAAIU,EAAS,CAAA,EACb,OAAAH,EAAI,QAAQ,SAAUI,EAAG,CACvBD,EAAO,KAAKjB,EAAEkB,CAAC,CAAC,CAC1B,CAAS,EACMnB,EAAS,WAAWkB,EAAO,KAAK,EAAE,CAAC,CAI/C,EAID,8BAA+B,SAAUT,EAAO,CAC9C,OAAIA,GAAS,KAAa,GACnBT,EAAS,UAAUS,EAAO,EAAG,SAASE,EAAE,CAAC,OAAOR,EAAc,OAAOQ,CAAC,CAAE,CAAC,CACjF,EAGD,kCAAkC,SAAUF,EAAO,CACjD,OAAIA,GAAS,KAAa,GACtBA,GAAS,GAAW,MACxBA,EAAQA,EAAM,QAAQ,KAAM,GAAG,EACxBT,EAAS,YAAYS,EAAM,OAAQ,GAAI,SAASG,EAAO,CAAE,OAAOP,EAAaF,EAAeM,EAAM,OAAOG,CAAK,CAAC,CAAE,CAAE,EAC3H,EAED,SAAU,SAAUE,EAAc,CAChC,OAAOd,EAAS,UAAUc,EAAc,GAAI,SAASH,EAAE,CAAC,OAAOV,EAAEU,CAAC,CAAE,CAAC,CACtE,EACD,UAAW,SAAUG,EAAcM,EAAaC,EAAgB,CAC9D,GAAIP,GAAgB,KAAM,MAAO,GACjC,IAAIN,EAAGc,EACHC,EAAoB,CAAE,EACtBC,EAA4B,CAAE,EAC9BC,EAAU,GACVC,EAAW,GACXC,EAAU,GACVC,EAAmB,EACnBC,EAAkB,EAClBC,EAAiB,EACjBC,EAAa,CAAE,EACfC,EAAiB,EACjBC,EAAsB,EACtBC,EAEJ,IAAKA,EAAK,EAAGA,EAAKpB,EAAa,OAAQoB,GAAM,EAQ3C,GAPAT,EAAYX,EAAa,OAAOoB,CAAE,EAC7B,OAAO,UAAU,eAAe,KAAKX,EAAmBE,CAAS,IACpEF,EAAmBE,CAAS,EAAII,IAChCL,EAA2BC,CAAS,EAAI,IAG1CC,EAAaC,EAAYF,EACrB,OAAO,UAAU,eAAe,KAAKF,EAAmBG,CAAU,EACpEC,EAAYD,MACP,CACL,GAAI,OAAO,UAAU,eAAe,KAAKF,EAA2BG,CAAS,EAAG,CAC9E,GAAIA,EAAU,WAAW,CAAC,EAAE,IAAK,CAC/B,IAAKnB,EAAE,EAAIA,EAAEsB,EAAkBtB,IAC7BwB,EAAoBA,GAAoB,EACpCC,GAAyBb,EAAY,GACvCa,EAAwB,EACxBF,EAAa,KAAKV,EAAeW,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAIJ,IADAX,EAAQK,EAAU,WAAW,CAAC,EACzBnB,EAAE,EAAIA,EAAE,EAAIA,IACfwB,EAAoBA,GAAoB,EAAMV,EAAM,EAChDW,GAAyBb,EAAY,GACvCa,EAAwB,EACxBF,EAAa,KAAKV,EAAeW,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFX,EAAQA,GAAS,CAE/B,KAAiB,CAEL,IADAA,EAAQ,EACHd,EAAE,EAAIA,EAAEsB,EAAkBtB,IAC7BwB,EAAoBA,GAAoB,EAAKV,EACzCW,GAAwBb,EAAY,GACtCa,EAAwB,EACxBF,EAAa,KAAKV,EAAeW,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFX,EAAQ,EAGV,IADAA,EAAQK,EAAU,WAAW,CAAC,EACzBnB,EAAE,EAAIA,EAAE,GAAKA,IAChBwB,EAAoBA,GAAoB,EAAMV,EAAM,EAChDW,GAAyBb,EAAY,GACvCa,EAAwB,EACxBF,EAAa,KAAKV,EAAeW,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFX,EAAQA,GAAS,CAEpB,CACDM,IACIA,GAAqB,IACvBA,EAAoB,KAAK,IAAI,EAAGE,CAAe,EAC/CA,KAEF,OAAON,EAA2BG,CAAS,CACrD,KAEU,KADAL,EAAQC,EAAmBI,CAAS,EAC/BnB,EAAE,EAAIA,EAAEsB,EAAkBtB,IAC7BwB,EAAoBA,GAAoB,EAAMV,EAAM,EAChDW,GAAyBb,EAAY,GACvCa,EAAwB,EACxBF,EAAa,KAAKV,EAAeW,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFX,EAAQA,GAAS,EAKrBM,IACIA,GAAqB,IACvBA,EAAoB,KAAK,IAAI,EAAGE,CAAe,EAC/CA,KAGFP,EAAmBG,CAAU,EAAIG,IACjCF,EAAY,OAAOF,CAAS,CAC7B,CAIH,GAAIE,IAAc,GAAI,CACpB,GAAI,OAAO,UAAU,eAAe,KAAKH,EAA2BG,CAAS,EAAG,CAC9E,GAAIA,EAAU,WAAW,CAAC,EAAE,IAAK,CAC/B,IAAKnB,EAAE,EAAIA,EAAEsB,EAAkBtB,IAC7BwB,EAAoBA,GAAoB,EACpCC,GAAyBb,EAAY,GACvCa,EAAwB,EACxBF,EAAa,KAAKV,EAAeW,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAIJ,IADAX,EAAQK,EAAU,WAAW,CAAC,EACzBnB,EAAE,EAAIA,EAAE,EAAIA,IACfwB,EAAoBA,GAAoB,EAAMV,EAAM,EAChDW,GAAyBb,EAAY,GACvCa,EAAwB,EACxBF,EAAa,KAAKV,EAAeW,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFX,EAAQA,GAAS,CAE7B,KAAe,CAEL,IADAA,EAAQ,EACHd,EAAE,EAAIA,EAAEsB,EAAkBtB,IAC7BwB,EAAoBA,GAAoB,EAAKV,EACzCW,GAAyBb,EAAY,GACvCa,EAAwB,EACxBF,EAAa,KAAKV,EAAeW,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFX,EAAQ,EAGV,IADAA,EAAQK,EAAU,WAAW,CAAC,EACzBnB,EAAE,EAAIA,EAAE,GAAKA,IAChBwB,EAAoBA,GAAoB,EAAMV,EAAM,EAChDW,GAAyBb,EAAY,GACvCa,EAAwB,EACxBF,EAAa,KAAKV,EAAeW,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFX,EAAQA,GAAS,CAEpB,CACDM,IACIA,GAAqB,IACvBA,EAAoB,KAAK,IAAI,EAAGE,CAAe,EAC/CA,KAEF,OAAON,EAA2BG,CAAS,CACnD,KAEQ,KADAL,EAAQC,EAAmBI,CAAS,EAC/BnB,EAAE,EAAIA,EAAEsB,EAAkBtB,IAC7BwB,EAAoBA,GAAoB,EAAMV,EAAM,EAChDW,GAAyBb,EAAY,GACvCa,EAAwB,EACxBF,EAAa,KAAKV,EAAeW,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFX,EAAQA,GAAS,EAKrBM,IACIA,GAAqB,IACvBA,EAAoB,KAAK,IAAI,EAAGE,CAAe,EAC/CA,IAEH,CAID,IADAR,EAAQ,EACHd,EAAE,EAAIA,EAAEsB,EAAkBtB,IAC7BwB,EAAoBA,GAAoB,EAAMV,EAAM,EAChDW,GAAyBb,EAAY,GACvCa,EAAwB,EACxBF,EAAa,KAAKV,EAAeW,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFX,EAAQA,GAAS,EAInB,OAEE,GADAU,EAAoBA,GAAoB,EACpCC,GAAyBb,EAAY,EAAG,CAC1CW,EAAa,KAAKV,EAAeW,CAAgB,CAAC,EAClD,KACD,MACIC,IAEP,OAAOF,EAAa,KAAK,EAAE,CAC5B,EAED,WAAY,SAAUlB,EAAY,CAChC,OAAIA,GAAc,KAAa,GAC3BA,GAAc,GAAW,KACtBb,EAAS,YAAYa,EAAW,OAAQ,MAAO,SAASD,EAAO,CAAE,OAAOC,EAAW,WAAWD,CAAK,CAAI,CAAA,CAC/G,EAED,YAAa,SAAUuB,EAAQC,EAAYC,EAAc,CACvD,IAAIC,EAAa,CAAA,EAEbC,EAAY,EACZC,EAAW,EACXC,EAAU,EACVC,EAAQ,GACRxB,EAAS,CAAA,EACTV,EACAmC,EACAC,EAAMC,EAAMC,EAAUC,EACtB5B,EACA6B,EAAO,CAAC,IAAIX,EAAa,CAAC,EAAG,SAASD,EAAY,MAAM,CAAC,EAE7D,IAAK5B,EAAI,EAAGA,EAAI,EAAGA,GAAK,EACtB8B,EAAW9B,CAAC,EAAIA,EAMlB,IAHAoC,EAAO,EACPE,EAAW,KAAK,IAAI,EAAE,CAAC,EACvBC,EAAM,EACCA,GAAOD,GACZD,EAAOG,EAAK,IAAMA,EAAK,SACvBA,EAAK,WAAa,EACdA,EAAK,UAAY,IACnBA,EAAK,SAAWZ,EAChBY,EAAK,IAAMX,EAAaW,EAAK,OAAO,GAEtCJ,IAASC,EAAK,EAAI,EAAI,GAAKE,EAC3BA,IAAU,EAGZ,OAAeH,EAAI,CACjB,IAAK,GAID,IAHAA,EAAO,EACPE,EAAW,KAAK,IAAI,EAAE,CAAC,EACvBC,EAAM,EACCA,GAAOD,GACZD,EAAOG,EAAK,IAAMA,EAAK,SACvBA,EAAK,WAAa,EACdA,EAAK,UAAY,IACnBA,EAAK,SAAWZ,EAChBY,EAAK,IAAMX,EAAaW,EAAK,OAAO,GAEtCJ,IAASC,EAAK,EAAI,EAAI,GAAKE,EAC3BA,IAAU,EAEd5B,EAAIlB,EAAE2C,CAAI,EACV,MACF,IAAK,GAID,IAHAA,EAAO,EACPE,EAAW,KAAK,IAAI,EAAE,EAAE,EACxBC,EAAM,EACCA,GAAOD,GACZD,EAAOG,EAAK,IAAMA,EAAK,SACvBA,EAAK,WAAa,EACdA,EAAK,UAAY,IACnBA,EAAK,SAAWZ,EAChBY,EAAK,IAAMX,EAAaW,EAAK,OAAO,GAEtCJ,IAASC,EAAK,EAAI,EAAI,GAAKE,EAC3BA,IAAU,EAEd5B,EAAIlB,EAAE2C,CAAI,EACV,MACF,IAAK,GACH,MAAO,EACV,CAID,IAHAN,EAAW,CAAC,EAAInB,EAChBwB,EAAIxB,EACJD,EAAO,KAAKC,CAAC,IACA,CACX,GAAI6B,EAAK,MAAQb,EACf,MAAO,GAMT,IAHAS,EAAO,EACPE,EAAW,KAAK,IAAI,EAAEL,CAAO,EAC7BM,EAAM,EACCA,GAAOD,GACZD,EAAOG,EAAK,IAAMA,EAAK,SACvBA,EAAK,WAAa,EACdA,EAAK,UAAY,IACnBA,EAAK,SAAWZ,EAChBY,EAAK,IAAMX,EAAaW,EAAK,OAAO,GAEtCJ,IAASC,EAAK,EAAI,EAAI,GAAKE,EAC3BA,IAAU,EAGZ,OAAQ5B,EAAIyB,EAAI,CACd,IAAK,GAIH,IAHAA,EAAO,EACPE,EAAW,KAAK,IAAI,EAAE,CAAC,EACvBC,EAAM,EACCA,GAAOD,GACZD,EAAOG,EAAK,IAAMA,EAAK,SACvBA,EAAK,WAAa,EACdA,EAAK,UAAY,IACnBA,EAAK,SAAWZ,EAChBY,EAAK,IAAMX,EAAaW,EAAK,OAAO,GAEtCJ,IAASC,EAAK,EAAI,EAAI,GAAKE,EAC3BA,IAAU,EAGZT,EAAWE,GAAU,EAAIvC,EAAE2C,CAAI,EAC/BzB,EAAIqB,EAAS,EACbD,IACA,MACF,IAAK,GAIH,IAHAK,EAAO,EACPE,EAAW,KAAK,IAAI,EAAE,EAAE,EACxBC,EAAM,EACCA,GAAOD,GACZD,EAAOG,EAAK,IAAMA,EAAK,SACvBA,EAAK,WAAa,EACdA,EAAK,UAAY,IACnBA,EAAK,SAAWZ,EAChBY,EAAK,IAAMX,EAAaW,EAAK,OAAO,GAEtCJ,IAASC,EAAK,EAAI,EAAI,GAAKE,EAC3BA,IAAU,EAEZT,EAAWE,GAAU,EAAIvC,EAAE2C,CAAI,EAC/BzB,EAAIqB,EAAS,EACbD,IACA,MACF,IAAK,GACH,OAAOrB,EAAO,KAAK,EAAE,CACxB,CAOD,GALIqB,GAAa,IACfA,EAAY,KAAK,IAAI,EAAGE,CAAO,EAC/BA,KAGEH,EAAWnB,CAAC,EACduB,EAAQJ,EAAWnB,CAAC,UAEhBA,IAAMqB,EACRE,EAAQC,EAAIA,EAAE,OAAO,CAAC,MAEtB,QAAO,KAGXzB,EAAO,KAAKwB,CAAK,EAGjBJ,EAAWE,GAAU,EAAIG,EAAID,EAAM,OAAO,CAAC,EAC3CH,IAEAI,EAAID,EAEAH,GAAa,IACfA,EAAY,KAAK,IAAI,EAAGE,CAAO,EAC/BA,IAGH,CACF,CACH,EACE,OAAOzC,CACT,IAI4CiD,GAAU,KACpDA,UAAiBjD,EACR,OAAO,QAAY,KAAe,SAAW,MACtD,QAAQ,OAAO,WAAY,EAAE,EAC5B,QAAQ,WAAY,UAAY,CAC/B,OAAOA,CACX,CAAG,0BCreI,MAAMkD,EAAU,CAIrB,YAAmBC,EAAqB,CAArB,KAAA,IAAAA,EAHnB,KAAQ,gBAAmC,GACnC,KAAA,gBAA8B,IAItC,KAAA,IAAOC,GAA8B,CAC9B,KAAA,gBAAgB,KAAKA,CAAU,CAAA,EAGtC,KAAA,MAASA,GAA8B,CACrC,KAAK,gBAAkB,KAAK,gBAAgB,OAAOC,GAAKA,IAAMD,CAAU,CAAA,EAG1E,KAAA,gBAAkB,CAACE,EAAkBC,EAAsBC,EAAW,IAAM,CAC1E,KAAK,YAAY,IAAIF,EAAU,CAAE,QAAAC,EAAS,SAAAC,EAAU,CAAA,EAGtD,KAAA,kBAAqBF,GAAqB,CACnC,KAAA,YAAY,OAAOA,CAAQ,CAAA,EAY1B,KAAA,eAAkBG,GAAgC,CAClD,MAAAT,MAAW,IACN,UAAAU,KAAQD,EAAc,MAC3BC,IAAS,QACXV,EAAK,IAAIU,EAAM,MAAM,KAAKD,EAAc,KAAK,CAAC,EAE9CT,EAAK,IAAIU,EAAMD,EAAc,QAAQC,CAAI,CAAC,EAG9C,OAAQA,GAAiB,CACjB,MAAAC,EAAOX,EAAK,IAAIU,CAAI,EAC1B,GAAIC,EACK,OAAAA,EAET,MAAMC,GAAUZ,EAAK,IAAI,OAAO,GAAK,CAAA,GAAe,OAClD/C,GAAKA,EAAE,OAASyD,CAAA,EAEd,OAAAE,EAAM,OAAS,EACVA,EAEF,EAAA,CACT,EAeF,KAAQ,uBAAyB,MAC/BC,EACAC,EACAC,EACAnD,IACG,CACH,MAAMoD,EAAa,MAAM,KAAK,KAAK,YAAY,QAAS,CAAA,EAAE,KACxD,CAACrD,EAAGsD,IAAMA,EAAE,CAAC,EAAE,SAAWtD,EAAE,CAAC,EAAE,QAAA,EAEjC,SAAW,CAAC+C,EAAM,CAAE,QAAAH,CAAS,CAAA,IAAKS,EAAY,CACtC,MAAAL,EAAOE,EAAQH,CAAI,EACrB,GAAA,QAAM,QAAQC,CAAI,IAChBA,EAAK,SAAW,GAGhB,CAACA,EAAK,IAAI1D,GAAKA,EAAE,OAASyD,CAAI,EAAE,OAAO,CAAC/C,EAAGsD,IAAMtD,GAAKsD,EAAG,EAAK,KAIhEN,EAAM,CACF,MAAAO,EAAM,KAAK,UACTX,EAAA,aAAaW,EAAI,cAAc,EACvC,MAAMC,EAAU,CACd,KAAMR,EACN,OAAQO,EAAI,cACZ,cAAeJ,EAAK,UAAU,KAAK,cACnC,YAAaA,EAAK,UAAU,KAAK,YACjC,iBAAkBA,EAAK,UAAU,KAAK,iBACtC,YAAaA,EAAK,UAAU,GAC5B,OAAQA,EAAK,EAAA,EAETM,EAAgB,MAAMb,EAAQ,gBAAgBY,CAAO,EAC3D,GAAIC,EACF,OAAOF,EAAI,gBAAgBE,EAAeN,EAAMC,EAAQnD,CAAK,CAEjE,CACF,CACO,OAAA,IAAA,EAGT,KAAA,KAAO,MAAOyD,GACL,KAAK,UAAUA,CAAK,EAG7B,KAAA,MAAQ,MACNC,EACAR,EACAC,EACAnD,IACG,CACH,MAAMoC,EAAOsB,EAAM,cACnB,GAAKtB,EAED,GAAA,CACI,MAAAuB,EAAO,KAAK,kBAAkBvB,CAAI,EAClCqB,EAAQ,MAAM,KAAK,uBACvBX,GAAQa,EAAKb,CAAI,EACjBI,EACAC,EACAnD,CAAA,EAEF,OAAA4D,EAAaH,CAAK,EACXA,CAAA,MACD,CACA,MAAAI,EAAgB,KAAK,eAAezB,CAAI,EAQvC,OAPO,MAAM,KAAK,uBACvBU,GAAQe,EAAcf,CAAI,EAC1BI,EACAC,EACAnD,CAAA,CAIJ,CAAA,EAgEF,KAAA,mBAAqB,MACnB8D,EACAZ,EACAC,EACAnD,IAEY,KAAK,UACN,gBAAgB8D,EAAUZ,EAAMC,EAAQnD,CAAK,EAG1D,KAAA,UAAY,MAAOyD,GAAiB,CAClC,MAAMM,EAAc,MAAM,KAAK,KAAK,YAAY,MAAM,EAEhD,MAAA,KAAK,iBAAiB,MAAMC,GAAU,CACpC,MAAAC,EAAQ,CAAE,GAAGD,GAEnB,aAAM,QAAQ,IACZD,EAAY,IAAI,MAAMjB,GAAQ,CAC5B,MAAMC,EAAO,MAAM,KAAK,kBAAkBU,EAAOX,CAAI,EACjD,OAAOC,GAAS,WAClBkB,EAAMnB,CAAI,EAAIC,EAChB,CACD,CAAA,EAEIkB,CAAA,CACR,CAAA,CAjOsC,CAkBjC,SAAU,CAChB,OAAO,IAAIC,GAAI,CACb,YAAa,KAAK,gBAClB,UAAW,KAAK,IAAI,SAAA,CACrB,CACH,CA4BA,MAAc,kBAAkBT,EAAcX,EAAc,CACpD,MAAAQ,EAAM,KAAK,UACXa,EAAc,KAAK,YAAY,IAAIrB,CAAI,EAC7Cc,EAAaO,CAAW,EAClB,KAAA,CAAE,QAAAxB,CAAY,EAAAwB,EACdL,EAAW,MAAMR,EAAI,gBAAgBG,CAAK,EACxC,OAAAd,EAAA,aAAaW,EAAI,cAAc,GAErC,MAAMX,EAAQ,kBAAkB,CAAE,SAAAmB,EAAU,OAAQR,EAAI,cAAe,GACvE,IACJ,CA8EA,MAAM,iBACJc,EAGA,CAOM,MAAAH,EAAQ,MAAMG,EANL,CACb,aAAc,GACd,YAAa,GACb,YAAa,EAAA,CAGuB,EAEhCC,EAAOJ,EAAM,YAAY,EACzBK,EAAYL,EAAM,WAAW,EAC7BM,EAAMN,EAAM,WAAW,EAE7B,OAAOA,EAAM,YAAY,EACzB,OAAOA,EAAM,WAAW,EACxB,OAAOA,EAAM,WAAW,EAGxB,MAAMO,EAAO,iCADIC,GAAAA,8BAAiC,KAAK,UAAUR,CAAK,CAAC,CACjB,IAAIK,CAAS,SAI7DI,EAAuC,CAC3C,YAJe,IAAI,KAAK,CAACF,CAAI,EAAG,CAChC,KAAM,WAAA,CACP,CAEc,EAEX,GAAAH,EAAK,OAAS,EAAG,CACnB,MAAMM,EAAW,IAAI,KAAK,CAACN,CAAI,EAAG,CAChC,KAAM,YAAA,CACP,EACDK,EAAe,YAAY,EAAIC,CACjC,CAEA,GAAIJ,aAAe,KACjBG,EAAe,WAAW,EAAIH,UACrBA,EAAI,OAAS,EAAG,CACzB,MAAMK,EAAU,IAAI,KAAK,CAACL,CAAG,EAAG,CAC9B,KAAM,WAAA,CACP,EACDG,EAAe,WAAW,EAAIE,CAChC,CACM,MAAA,UAAU,UAAU,MAAM,CAAC,IAAI,cAAcF,CAAc,CAAC,CAAC,CACrE,CAEA,kBAAkB7B,EAA6B,CACvC,MAAAoB,EAAQpB,EAAc,QAAQ,WAAW,EAGzCgC,EAFY,IAAI,YACA,gBAAgBZ,EAAO,WAAW,EACxC,cAA8B,4BAA4B,EAC1E,OAAAL,EAAaiB,CAAG,EACH,KAAK,MAChBC,GAAG,kCACDD,EAAI,QAAQ,kBACd,CAAA,CAGJ,CA6BF,CCxMA,MAAME,EAAY,OAAO,MAAM,EAaxB,MAAMC,EAAe,CAG1B,YAAmBzC,EAAqB,CAArB,KAAA,IAAAA,EAFX,KAAA,cAAgB,IAIxB,KAAQ,eAAiB,KAChB,CACL,IAAK,KAAK,GAAA,GAaA,KAAA,YAAA,CACZ0C,EACAC,IACU,CACV,MAAMC,EAAgB,KAAK,eACrBC,EAAc,KAAK,YACnBC,EAAO,KAAK,KACZC,EAAU,CACdC,EACA,CAACC,MAAY,IACV,CACCA,GACEA,EAAAD,EAAanD,GAAAkD,EAAQ,CAAE,GAAGC,EAAK,GAAGnD,CAAA,EAAQqD,CAAI,CAAC,CACrD,EAGK,MAAA,CACL,CAACV,CAAS,EAAGG,EACb,IAAK,UAAuB,CAC1B,MAAMK,EAAMJ,IACZ,IAAIO,EAAU,GACV,GAAA,CACI,MAAAC,EAAO,KAAKZ,CAAS,EAC3BO,EAAQC,EAAkC,CACxC,GAAGI,EACH,CAACC,EAAGC,IAAS,CACDH,EAAA,GACLG,GACP,CAAA,CACD,QACMC,EAAK,CACZ,QAAQ,MAAMA,CAAG,CACnB,CAEO,OAAAJ,CACT,EACA,KAAM,SAAuBhF,EAAO,CAC5B,MAAAiF,EAAO,KAAKZ,CAAS,EAC3B,OAAOK,EAAYH,EAAS,CAC1B,GAAGU,EACH,CAACC,EAAGC,IAASA,EAAKnF,CAAK,CAAA,CACxB,CACH,EACA,OAAQ,SAAuBqF,EAAS,CAChC,MAAAJ,EAAO,KAAKZ,CAAS,EAC3B,OAAOK,EAAYH,EAAS,CAAC,GAAGU,EAAMI,CAAO,CAAC,CAChD,EACA,IAAK,SAAuBC,EAAI,CACxB,MAAAL,EAAO,KAAKZ,CAAS,EAC3B,OAAOK,EAAYH,EAAS,CAC1B,GAAGU,EACH,CAACM,EAAWJ,IAAS,CACnB,IAAIN,EAAMU,EACJ,MAAAC,EAASF,EAAGX,EAAA,CAAM,EAExB,UAAWc,KAASD,EAelB,GAbAC,EAAMpB,CAAS,EAAI,CACjB,CAACa,EAAGC,IAAS,CACXA,EAAKN,CAAG,CACV,EACA,GAAGY,EAAMpB,CAAS,CAAA,EAGJoB,EACb,OAAO,CAACC,EAAWP,IAAS,CAC3BN,EAAM,CAAE,GAAGA,EAAK,GAAGa,CAAU,EAC7BP,GAAK,CACN,EACA,IAAI,EACM,CACXA,EAAKN,CAAG,EACR,KACF,CAEJ,CAAA,CACD,CACH,EACA,OAAQ,SAAuBS,EAAI,CAC3B,MAAAL,EAAO,KAAKZ,CAAS,EAC3B,OAAOK,EAAYH,EAAS,CAC1B,GAAGU,EACH,CAACM,EAAWJ,IAAS,CACnB,IAAIN,EAAMU,EACJ,MAAAC,EAASF,EAAGX,EAAA,CAAM,EAExB,IAAIgB,EAAU,GACd,UAAWF,KAASD,EAElBC,EAAMpB,CAAS,EAAI,CACjB,CAACa,EAAGC,IAAS,CACXA,EAAKN,CAAG,CACV,EACA,GAAGY,EAAMpB,CAAS,CAAA,EAGJoB,EACb,OAAO,CAACC,EAAWP,IAAS,CAC3BN,EAAM,CAAE,GAAGA,EAAK,GAAGa,CAAU,EAC7BP,GAAK,CACN,EACA,IAAI,IAEKQ,EAAA,IAGTA,GACHR,EAAKN,CAAG,CAEZ,CAAA,CACD,CACH,EACA,GAAGN,CAAA,CACL,EAEF,KAAA,KAAO,IAA6B,CAClC,MAAMA,EAAU,CAAA,EAIVG,EAAc,KAAK,YACzB,SAAW,CAACkB,EAAMP,CAAO,IAAK,KAAK,UAAU,UACnCd,EAAAqB,CAAI,EAAI,SAEdlE,EACA,CACM,MAAAuD,EAAO,KAAKZ,CAAS,EAC3B,OAAOK,EAAYH,EAAS,CAC1B,GAAGU,EACH,CAACJ,EAAKM,IAASE,EAAQ,CAAE,GAAGR,EAAK,GAAGnD,CAAK,EAAGyD,CAAI,CAAA,CACjD,CAAA,EAIE,OAAAT,EAAYH,EAAS,CAAA,CAAE,CAAA,EAEhC,KAAA,YAAoDkB,GAAoB,CACtE,MAAMZ,EAAM,CAAA,EAET,OAAAY,EAAA,OAAO,CAACI,EAAUV,IAAS,CACnB,OAAA,OAAON,EAAKgB,CAAQ,EACtBV,GAAA,CACN,EACA,IAAI,EACAN,CAAA,CAjKgC,CAYzC,IAAIe,EAAcP,EAAkB,CAC7B,YAAA,UAAU,IAAIO,EAAMP,CAAO,EACzB,IACT,CAoJF,CC/NO,MAAMS,EAAa,CAIxB,YAAmB9C,EAAc,CAAd,KAAA,MAAAA,EAFZ,KAAA,KAAA,cAE2B,CACpC,CAEO,MAAM+C,EAAoB,CAA1B,aAAA,CACL,KAAQ,KAAqC,GAU7C,KAAA,IAAkDC,GAAiB,CACjE,MAAMJ,EAAOI,EAAM,KACf,KAAK,KAAKJ,CAAI,GACR,QAAA,KAAK,6CAA8CA,CAAI,EAG5D,KAAA,KAAKA,CAAI,EAAII,CAAA,EAGpB,KAAA,IAAO5D,GACE,CAAC,CAAC,KAAK,KAAKA,CAAI,EAGzB,KAAA,IACEA,GACqB,CACf,MAAA4D,EAAQ,KAAK,KAAK5D,CAAI,EACf,OAAAc,EAAA8C,EAAO,8BAA8B5D,CAAI,YAAY,EAC3D4D,CAAA,CACT,CA3BA,OAAO,QAAQC,EAAwB,CAC/B,MAAAC,EAAU,IAAIH,GACpB,OAAAE,EAAO,QAAiBD,GAAA,CACtBE,EAAQ,IAAIF,CAAK,CAAA,CAClB,EACME,CACT,CAsBF,CC5CO,MAAMC,CAAW,CACd,aAAc,CAEtB,CAEA,MAAA,CAAO,KAAA,GAAMC,GACJA,EAAKA,EAAK,OAAS,CAAC,CAC7B,CAEA,MAAA,CAAO,KAAA,OAAUA,GACRA,EAAK,MAAM,EAAGA,EAAK,OAAS,CAAC,CACtC,CAEA,MAAA,CAAO,KAAA,UAAaA,GACXA,EAAK,KAAK,GAAG,CACtB,CAEA,MAAA,CAAO,KAAA,UAAaC,GACXA,EAAI,MAAM,GAAG,CACtB,CAEA,MAAA,CAAO,KAAA,OAAS,CAACC,EAA0BC,IAClCJ,EAAW,UAAUG,CAAK,IAAMH,EAAW,UAAUI,CAAK,CACnE,CAGA,MAAA,CAAO,KAAA,SAAW,CAACD,EAAiBC,IAC3BJ,EAAW,UAAUG,CAAK,EAAE,WAAWH,EAAW,UAAUI,CAAK,CAAC,CAC3E,CACF,CCvBO,MAAMC,WAA4BV,EAAa,CAKpD,YAAY,CAAE,MAAA9C,GAAqC,CACjD,MAAMA,CAAK,EALb,KAAS,KAAO,iBAOd,KAAK,IAAMA,CACb,CACF,CCdY,IAAAyD,IAAAA,IAEVA,EAAA,UAAY,YAGZA,EAAA,OAAS,SALCA,IAAAA,IAAA,CAAA,CAAA,EAaL,MAAMC,WAAyBZ,EAAa,CAGjD,YAAY,CAAE,MAAA9C,EAAO,WAAA2D,GAAuC,CAC1D,MAAM3D,CAAK,EAHb,KAAS,KAAO,cAId,KAAK,WAAa2D,CACpB,CACF,CCjBO,MAAMC,EAAiB,CAC5B,YAAoBC,EAAgC,CAAhC,KAAA,YAAAA,EAmBZ,KAAA,KAAQ7D,GAA0B,CACpC,GAAA,CAAC,KAAK,YAAY,SAAU,OAE1B,MAAA8D,EAAsB,IAAIN,GAAoB,CAClD,MAAAxD,CAAA,CACD,EACD,KAAK,YAAY,IACf,MACA,KAAK,eAAeA,EAAO8D,CAAmB,CAAA,CAChD,EAGM,KAAA,MAAS9D,GAA0B,CACrC,GAAA,CAAC,KAAK,YAAY,SAAU,OAE1B,MAAA8D,EAAsB,IAAIN,GAAoB,CAClD,MAAAxD,CAAA,CACD,EACD,KAAK,YAAY,IACf,OACA,KAAK,eAAeA,EAAO8D,CAAmB,CAAA,CAChD,EAGM,KAAA,OAAU9D,GAA0B,CACtC,GAAA,CAAC,KAAK,YAAY,SAAU,OAE1B,MAAA8D,EAAsB,IAAIN,GAAoB,CAClD,MAAAxD,CAAA,CACD,EAED,KAAK,YAAY,IACf,QACA,KAAK,eAAeA,EAAO8D,CAAmB,CAAA,CAChD,CArDmD,CAE7C,eAAe9D,EAAc+D,EAAqC,CACxE,OAAOhB,GAAoB,KACzB,IAAID,GAAa9C,CAAK,EACtB,IAAI0D,GAAiB,CACnB,MAAA1D,EACA,WAAYyD,GAAqB,SAAA,CAClC,EACDM,CAAA,CAEJ,CAEA,QAAS,CACP,KAAK,YAAY,YAAY,aAAa,SAAU,MAAO,KAAK,IAAI,EACpE,KAAK,YAAY,YAAY,aAAa,SAAU,OAAQ,KAAK,KAAK,EACtE,KAAK,YAAY,YAAY,aAAa,SAAU,QAAS,KAAK,MAAM,CAC1E,CAsCF,CC7DO,IAAIC,GAAO,CAChB,EAAG,YACH,EAAG,MACH,GAAI,QACJ,GAAI,UACJ,GAAI,QACJ,GAAI,QACJ,GAAI,UACJ,GAAI,MACJ,GAAI,WACJ,GAAI,SACJ,GAAI,IACJ,GAAI,SACJ,GAAI,WACJ,GAAI,MACJ,GAAI,OACJ,GAAI,YACJ,GAAI,UACJ,GAAI,aACJ,GAAI,YACJ,GAAI,cACJ,GAAI,SACJ,GAAI,SACJ,GAAI,IACJ,GAAI,IACJ,GAAI,OACJ,GAAI,OACJ,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,UACL,IAAK,aACL,IAAK,QACL,IAAK,QACL,IAAK,UACL,IAAK,UACL,IAAK,MACL,IAAK,MACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,KACL,IAAK,IACL,IAAK,GACP,EAEWC,GAAQ,CACjB,GAAI,IACJ,GAAI,IACJ,GAAI,IACJ,GAAI,IACJ,GAAI,IACJ,GAAI,IACJ,GAAI,IACJ,GAAI,IACJ,GAAI,IACJ,GAAI,IACJ,GAAI,IACJ,GAAI,IACJ,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,GACP,EAEIC,GAAM,OAAO,UAAa,KAAe,MAAM,KAAK,UAAU,QAAQ,EACtEC,GAAK,OAAO,UAAa,KAAe,gDAAgD,KAAK,UAAU,SAAS,EAGpH,QAASjI,EAAI,EAAGA,EAAI,GAAIA,IAAK8H,GAAK,GAAK9H,CAAC,EAAI8H,GAAK,GAAK9H,CAAC,EAAI,OAAOA,CAAC,EAGnE,QAASA,EAAI,EAAGA,GAAK,GAAIA,IAAK8H,GAAK9H,EAAI,GAAG,EAAI,IAAMA,EAGpD,QAASA,EAAI,GAAIA,GAAK,GAAIA,IACxB8H,GAAK9H,CAAC,EAAI,OAAO,aAAaA,EAAI,EAAE,EACpC+H,GAAM/H,CAAC,EAAI,OAAO,aAAaA,CAAC,EAIlC,QAASkI,MAAQJ,GAAWC,GAAM,eAAeG,EAAI,IAAGH,GAAMG,EAAI,EAAIJ,GAAKI,EAAI,GAExE,SAASC,GAAQrE,EAAO,CAG7B,IAAIsE,EAAYJ,IAAOlE,EAAM,SAAWA,EAAM,UAAY,CAACA,EAAM,SAAW,CAACA,EAAM,QAC/EmE,IAAMnE,EAAM,UAAYA,EAAM,KAAOA,EAAM,IAAI,QAAU,GACzDA,EAAM,KAAO,eACb4C,EAAQ,CAAC0B,GAAatE,EAAM,MAC7BA,EAAM,SAAWiE,GAAQD,IAAMhE,EAAM,OAAO,GAC7CA,EAAM,KAAO,eAEf,OAAI4C,GAAQ,QAAOA,EAAO,UACtBA,GAAQ,QAAOA,EAAO,UAEtBA,GAAQ,SAAQA,EAAO,aACvBA,GAAQ,OAAMA,EAAO,WACrBA,GAAQ,UAASA,EAAO,cACxBA,GAAQ,SAAQA,EAAO,aACpBA,CACT,CClHA,MAAMsB,GACJ,OAAO,UAAc,IACjB,qBAAqB,KAAK,UAAU,QAAQ,EAC5C,GAEN,SAASK,GAAiB3B,EAAc,CAChC,MAAA4B,EAAQ5B,EAAK,MAAM,QAAQ,EAC7B,IAAAhG,EAAS4H,EAAM,GAAG,EAAE,EACpB5H,IAAW,UACJA,EAAA,KAEP,IAAA6H,EAAKC,EAAMT,EAAOU,EACtB,OAAAH,EAAM,MAAM,EAAG,EAAE,EAAE,QAAeI,GAAA,CAC5B,GAAA,kBAAkB,KAAKA,CAAG,EAAG,CACxBD,EAAA,GACP,MACF,CACI,GAAA,YAAY,KAAKC,CAAG,EAAG,CACnBH,EAAA,GACN,MACF,CACI,GAAA,sBAAsB,KAAKG,CAAG,EAAG,CAC5BF,EAAA,GACP,MACF,CACI,GAAA,cAAc,KAAKE,CAAG,EAAG,CACnBX,EAAA,GACR,MACF,CACI,GAAA,SAAS,KAAKW,CAAG,EAAG,CAClBV,GACKS,EAAA,GAEAD,EAAA,GAET,MACF,CAEM,MAAA,IAAI,MAAM,+BAAiCE,CAAG,CAAA,CACrD,EACGH,IAAK7H,EAAS,OAASA,GACvB8H,IAAM9H,EAAS,QAAUA,GACzB+H,IAAM/H,EAAS,QAAUA,GACzBqH,IAAOrH,EAAS,SAAWA,GACxBA,CACT,CAEA,SAASiI,GAAUjC,EAAc5C,EAAsBiE,EAAQ,GAAM,CACnE,OAAIjE,EAAM,SAAQ4C,EAAO,OAASA,GAC9B5C,EAAM,UAAS4C,EAAO,QAAUA,GAChC5C,EAAM,UAAS4C,EAAO,QAAUA,GAChCqB,GAASjE,EAAM,WAAU4C,EAAO,SAAWA,GACxCA,CACT,CAEA,SAASkC,GAAUC,EAAqC,CAChD,MAAAC,EAA8C,OAAA,OAAO,IAAI,EAC/D,UAAWC,KAAQF,EAAKC,EAAKT,GAAiBU,CAAI,CAAC,EAAIF,EAAIE,CAAI,EACxD,OAAAD,CACT,CAEO,SAASE,GACdC,EACgB,CACV,MAAAJ,EAAMD,GAAUK,CAAQ,EAC9B,OAActD,GAAA,CAEZ,MAAM7B,EADQ6B,EAAI,IAAI,eAAe,EACjB,IACde,EAAOyB,GAAQrE,CAAK,EACpBoF,EAASL,EAAIF,GAAUjC,EAAM5C,CAAK,CAAC,EACrC,GAAAoF,GAAUA,EAAOvD,CAAG,EACf,MAAA,GAET,GAAIe,EAAK,SAAW,GAAKA,IAAS,IACzB,MAAA,GAGT,GAAI5C,EAAM,SAAU,CAClB,MAAMqF,EAAUN,EAAIF,GAAUjC,EAAM5C,EAAO,EAAK,CAAC,EAC7C,GAAAqF,GAAWA,EAAQxD,CAAG,EACjB,MAAA,EAEX,CAGM,MAAAyD,EACJtF,EAAM,UACNA,EAAM,QACNA,EAAM,SACN4C,EAAK,WAAW,CAAC,EAAI,IACjB2C,EAAWvB,GAAKhE,EAAM,OAAO,EAC/B,GAAAsF,GAAWC,GAAYA,IAAa3C,EAAM,CAC5C,MAAM4C,EAAWT,EAAIF,GAAUU,EAAUvF,CAAK,CAAC,EAC3C,GAAAwF,GAAYA,EAAS3D,CAAG,EACnB,MAAA,EAEX,CAEO,MAAA,EAAA,CAEX,CCjGO,MAAM4D,WAA2B3C,EAAa,CAOnD,YAAY,CAAE,MAAA9C,EAAO,UAAA0F,GAAwC,CAC3D,MAAM1F,CAAK,EAPb,KAAS,KAAO,gBASd,KAAK,IAAMA,EACX,KAAK,UAAY0F,CACnB,CACF,CCRO,MAAMC,WAA0B7C,EAAa,CAwBlD,YAAY,CAAE,MAAA9C,EAAO,KAAA4F,EAAM,OAAAC,EAAQ,OAAAC,EAAQ,KAAAC,GAAkC,CAC3E,MAAM/F,CAAK,EAxBb,KAAS,KAAO,eA0BR,MAAAgG,EAAUhG,EAAM,QAAU4F,EAAK,KAC/BK,EAAUjG,EAAM,QAAU4F,EAAK,IAErC,KAAK,IAAM5F,EACX,KAAK,MAAQ,CAAE,EAAGgG,EAAS,EAAGC,GAC9B,KAAK,gBAAkB,CAAE,EAAGL,EAAK,KAAM,EAAGA,EAAK,KAC/C,KAAK,MAAQ,CAAE,EAAGC,EAAQ,EAAGC,GAC7B,KAAK,MAAQC,EACT,CAAE,EAAGC,EAAUD,EAAK,MAAM,EAAG,EAAGE,EAAUF,EAAK,MAAM,CAAE,EACvD,CAAE,EAAG,EAAG,EAAG,GACf,KAAK,KAAO,CACV,MAAO/F,EAAM,SACb,IAAKA,EAAM,SAAWA,EAAM,QAC5B,IAAKA,EAAM,MAAA,EAER,KAAA,OAAS+F,GAAM,QAAU/F,EAAM,OAC/B,KAAA,SAAW,CAAC,CAAC+F,CACpB,CA5BA,IAAI,GAAI,CACN,OAAO,KAAK,MAAM,CACpB,CAEA,IAAI,GAAI,CACN,OAAO,KAAK,MAAM,CACpB,CAuBF,CC/CO,MAAMG,EAAgB,CAE3B,YAAoBrC,EAAgC,CAAhC,KAAA,YAAAA,EADpB,KAAQ,YAAc,GA+Cd,KAAA,MAAS7D,GAAyB,CACpC,GAAA,CAAC,KAAK,YAAY,SAAU,OAE1B,MAAAmG,EAAqB,IAAIV,GAAmB,CAChD,MAAAzF,EACA,UAAW,KAAK,WAAA,CACjB,EACD,KAAK,YAAY,IACf,UACA,KAAK,eAAeA,EAAOmG,CAAkB,CAAA,CAC/C,EAGM,KAAA,IAAOnG,GAAyB,CAClC,GAAA,CAAC,KAAK,YAAY,SAAU,OAE1B,MAAAmG,EAAqB,IAAIV,GAAmB,CAChD,MAAAzF,EACA,UAAW,KAAK,WAAA,CACjB,EAED,KAAK,YAAY,IACf,QACA,KAAK,eAAeA,EAAOmG,CAAkB,CAAA,CAC/C,CAtEmD,CAE7C,eAAenG,EAAcoG,EAAmC,CACtE,OAAOrD,GAAoB,KACzB,IAAID,GAAa9C,CAAK,EACtB,IAAI0D,GAAiB,CACnB,MAAA1D,EACA,WAAYyD,GAAqB,SAAA,CAClC,EACD2C,CAAA,CAEJ,CAEA,QAAS,CACP,KAAK,YAAY,YAAY,aAAa,SAAU,UAAW,KAAK,KAAK,EACzE,KAAK,YAAY,YAAY,aAAa,SAAU,QAAS,KAAK,GAAG,EACrE,KAAK,YAAY,YAAY,aAC3B,SACA,mBACA,IAAM,CACJ,KAAK,YAAc,EACrB,CAAA,EAEF,KAAK,YAAY,YAAY,aAC3B,SACA,iBACA,IAAM,CACJ,KAAK,YAAc,EACrB,CAAA,CAEJ,CAEA,WAAWC,EAAwCC,EAAwB,CACzE,OAAO,KAAK,YAAY,IACtB,UACOzE,GACD,KAAK,YACA,GAEOqD,GAAWmB,CAAM,EAClBxE,CAAG,EAEpByE,CAAA,CAEJ,CA4BF,CCpFgB,SAAAC,GAAYlK,EAAiBsD,EAAiB,CACtD,MAAA6G,EAAKnK,EAAE,EAAIsD,EAAE,EACb8G,EAAKpK,EAAE,EAAIsD,EAAE,EACZ,OAAA,KAAK,IAAI6G,EAAI,CAAC,EAAI,KAAK,IAAIC,EAAI,CAAC,EAAI,CAC7C,CAEO,MAAMC,GAAiCC,GAC5CA,EAAI,YAAY,ECCX,MAAMC,EAAe,CAS1B,YAAoB/C,EAAgC,CAAhC,KAAA,YAAAA,EARpB,KAAQ,sBAA6C,KACrD,KAAQ,gBAA4C,KACpD,KAAQ,eAA2C,KACnD,KAAQ,kBAAoB,EAC5B,KAAQ,UAAY,GACpB,KAAQ,QAAU,KAClB,KAAQ,QAAU,KA0BlB,KAAQ,OAAS,IAAM,CACrB,KAAK,QAAU,KACf,KAAK,QAAU,KACf,KAAK,eAAiB,KACtB,KAAK,UAAY,EAAA,EAcX,KAAA,MAAS7D,GAAwB,CACvC,KAAK,YAAY,WAGf,KAAK,uBACLA,EAAM,UAAY,KAAK,sBAAsB,UAAY,KACzD,CAACuG,GAAYvG,EAAO,KAAK,qBAAqB,EAEzC,KAAA,oBAEL,KAAK,kBAAoB,EAGrB,MAAA6G,EAAoB,IAAIlB,GAAkB,CAC9C,MAAA3F,EACA,KAAM,KAAK,MACX,OAAQ,KAAK,QACb,OAAQ,KAAK,QACb,KAAM,IAAA,CACP,EAEI,KAAA,QAAU6G,EAAkB,MAAM,EAClC,KAAA,QAAUA,EAAkB,MAAM,EACvC,KAAK,gBAAkBA,EACvB,KAAK,eAAiBA,EACtB,KAAK,sBAAwB7G,EAE7B,KAAK,YAAY,IACf,cACA,KAAK,eAAeA,EAAO6G,CAAiB,CAAA,EAG9C,KAAK,YAAY,YAAY,aAC3B,SACA,cACA,KAAK,KAAA,EAEP,KAAK,YAAY,YAAY,aAAa,SAAU,YAAa,KAAK,GAAG,CAAA,EAGnE,KAAA,IAAO7G,GAAwB,CAC/B,MAAA6G,EAAoB,IAAIlB,GAAkB,CAC9C,MAAA3F,EACA,KAAM,KAAK,MACX,OAAQ,KAAK,QACb,OAAQ,KAAK,QACb,KAAM,KAAK,cAAA,CACZ,EACKkD,EAAU,KAAK,eAAelD,EAAO6G,CAAiB,GAEhD,IAAM,CAChB,GAAI,KAAK,UAAW,CACb,KAAA,YAAY,IAAI,UAAW3D,CAAO,EACvC,MACF,CACK,KAAA,YAAY,IAAI,QAASA,CAAO,EACjC,KAAK,oBAAsB,GACxB,KAAA,YAAY,IAAI,cAAeA,CAAO,EAEzC,KAAK,oBAAsB,GACxB,KAAA,YAAY,IAAI,cAAeA,CAAO,CAC7C,KAIG,KAAA,YAAY,IAAI,YAAaA,CAAO,EAEzC,KAAK,OAAO,EACH,SAAA,oBAAoB,cAAe,KAAK,KAAK,EAC7C,SAAA,oBAAoB,YAAa,KAAK,GAAG,CAAA,EAG5C,KAAA,MAASlD,GAAwB,CACvC,MAAM+F,EAAO,KAAK,eACZ/C,EAAQ,IAAI2C,GAAkB,CAClC,MAAA3F,EACA,KAAM,KAAK,MACX,OAAQ,KAAK,QACb,OAAQ,KAAK,QACb,KAAA+F,CAAA,CACD,EACD,KAAK,eAAiB/C,EAEtB9C,EAAa,KAAK,eAAe,EAE7B,CAAC,KAAK,WAAaqG,GAAY,KAAK,gBAAgB,IAAKvD,EAAM,GAAG,IACpE,KAAK,UAAY,GACjB,KAAK,YAAY,IACf,YACA,KAAK,eAAehD,EAAO,KAAK,eAAe,CAAA,GAI/C,KAAK,WACP,KAAK,YAAY,IAAI,WAAY,KAAK,eAAeA,EAAOgD,CAAK,CAAC,CACpE,EAGM,KAAA,QAAWhD,GAAwB,CACnC,MAAAgD,EAAQ,IAAI2C,GAAkB,CAClC,MAAA3F,EACA,KAAM,KAAK,MACX,OAAQ,KAAK,QACb,OAAQ,KAAK,QACb,KAAM,KAAK,cAAA,CACZ,EAED,KAAK,YAAY,IAAI,cAAe,KAAK,eAAeA,EAAOgD,CAAK,CAAC,CAAA,EAG/D,KAAA,KAAQhD,GAAwB,CAChC,MAAAgD,EAAQ,IAAI2C,GAAkB,CAClC,MAAA3F,EACA,KAAM,KAAK,MACX,OAAQ,KACR,OAAQ,KACR,KAAM,IAAA,CACP,EAED,KAAK,YAAY,IAAI,aAAc,KAAK,eAAeA,EAAOgD,CAAK,CAAC,CAAA,CAjKjB,CAErD,QAAS,CACP,KAAK,YAAY,YAAY,aAC3B,KAAK,YAAY,KACjB,cACA,KAAK,KAAA,EAEP,KAAK,YAAY,YAAY,aAC3B,KAAK,YAAY,KACjB,cACA,KAAK,OAAA,EAEP,KAAK,YAAY,YAAY,aAC3B,KAAK,YAAY,KACjB,aACA,KAAK,IAAA,CAET,CAEA,IAAY,OAAQ,CACX,OAAA,KAAK,YAAY,KAAK,sBAAsB,CACrD,CASQ,eAAehD,EAAc8G,EAAiC,CACpE,OAAO/D,GAAoB,KACzB,IAAID,GAAa9C,CAAK,EACtB,IAAI0D,GAAiB,CACnB,MAAA1D,EACA,WAAYyD,GAAqB,MAAA,CAClC,EACDqD,CAAA,CAEJ,CA2HF,CC5KO,MAAMC,EAAa,CAExB,YAAoBlD,EAAgC,CAAhC,KAAA,YAAAA,EADpB,KAAQ,MAAsB,KA0BtB,KAAA,mBAAsB7D,GAAiB,CACvC,MAAAgH,EAAQ,KAAK,YAAY,mBAAmB,EAElD,KAAK,YAAY,IACf,oBACA,KAAK,eAAehH,CAAK,EACzBgH,CAAA,CACF,EAGM,KAAA,kBAAqBhH,GAAiB,CACtC,MAAAgH,EAAQ,KAAK,YAAY,kBAAkB,EAEjD,KAAK,YAAY,IAAI,mBAAoB,KAAK,eAAehH,CAAK,EAAGgH,CAAK,CAAA,EAGpE,KAAA,gBAAmBhH,GAAiB,CACpC,MAAAgH,EAAQ,KAAK,YAAY,gBAAgB,EAE/C,KAAK,YAAY,IAAI,iBAAkB,KAAK,eAAehH,CAAK,EAAGgH,CAAK,CAAA,EAGlE,KAAA,iBAAoBhH,GAAiB,CACvC,GAAA,CAAC,KAAK,YAAY,SAAU,OAE1B,MAAAgH,EAAQ,KAAK,YAAY,iBAAiB,EAEhD,KAAK,YAAY,IAAI,kBAAmB,KAAK,eAAehH,CAAK,EAAGgH,CAAK,CAAA,EAanE,KAAA,YAAeC,GAAyB,CAC1C,IAAAD,EACE,MAAAE,EAAY,SAAS,eACvB,GAAAA,GAAaA,EAAU,WAAa,EAAG,CACnC,MAAAC,EAAQD,EAAU,WAAW,CAAC,EAC5BF,EAAA,KAAK,8BAA8BC,EAAWE,CAAK,EAC3D,KAAK,MAAQA,CAAA,MACJ,KAAK,QAAU,OACxBH,EAAQ,KAAK,8BAA8BC,EAAW,KAAK,KAAK,EAChE,KAAK,MAAQ,MAGR,OAAAD,CAAA,CA7E4C,CAErD,QAAS,CACP,KAAK,YAAY,YAAY,aAC3B,SACA,kBACA,KAAK,gBAAA,EAEP,KAAK,YAAY,YAAY,aAC3B,SACA,mBACA,KAAK,iBAAA,EAEP,KAAK,YAAY,YAAY,aAC3B,SACA,iBACA,KAAK,eAAA,EAEP,KAAK,YAAY,YAAY,aAC3B,SACA,oBACA,KAAK,kBAAA,CAET,CAgCQ,eAAehH,EAAc,CACnC,OAAO+C,GAAoB,KACzB,IAAID,GAAa9C,CAAK,EACtB,IAAI0D,GAAiB,CACnB,MAAA1D,EACA,WAAYyD,GAAqB,SAAA,CAClC,CAAA,CAEL,CAiBQ,8BAA8Bb,EAAiBuE,EAAc,CAE7D,MAAAC,EADS,KAAK,sBAAsBD,CAAK,EAE5C,IAAiBE,GACTA,CACR,EACA,OAAQjE,GAA2B,CAAC,CAACA,CAAI,EACtCkE,EAAW,MAAM,KACrB,IAAI,IACFF,EACG,QAAgBhE,GACRA,EAAK,IAAemE,GAClB,KAAK,YAAY,IAAI,KAAK,aAAaA,CAAO,GAAG,OACzD,CACF,EACA,OAAQC,GACA,CAAC,CAACA,CACV,CACL,GACA,QAAQ,EAEV,OAAO,KAAK,YAAY,gBAAgB5E,EAAM0E,EAAUF,CAAK,CAC/D,CAEQ,sBAAsBD,EAA0B,CACtD,MAAMM,EAAQN,EAAM,eACdO,EAAMP,EAAM,aACZQ,EAAWR,EAAM,wBACjBS,EAAe,KAAK,YAAY,IAAI,KAAK,YAC3C,GAAAD,EAAS,WAAa,KAAK,UAAW,CAClC,MAAAE,EAAOD,EAAaD,CAAQ,EAClC,GAAIE,EACK,MAAA,CAACA,EAAK,IAAI,CAErB,CACM,MAAAC,MAAY,IAElB,IAAIC,EAAgB,GACd,MAAAC,EAAe,CAACC,EAAsBN,IAAmB,CAC7D,GAAKM,GAGDA,IAAYN,EAGhB,IAAIM,IAAYP,EAAK,CACnBI,EAAM,IAAIG,CAAO,EACDF,EAAA,GAChB,MACF,CACIE,IAAYR,IACEM,EAAA,IAEdA,IAEAE,EAAQ,WAAa,KAAK,WAC1BA,EAAQ,WAAa,KAAK,eAE1BH,EAAM,IAAIG,CAAO,EAGRD,EAAAC,EAAQ,WAAYN,CAAQ,EAC5BK,EAAAC,EAAQ,YAAaN,CAAQ,EAAA,EAE/BK,EAAAL,EAAS,WAAYA,CAAQ,EAEpC,MAAAO,MAAa,IACnB,OAAAJ,EAAM,QAAgBK,GAAA,CACd,MAAAd,EAAYO,EAAaO,CAAI,EAC9Bd,IAGDa,EAAO,IAAIb,EAAU,IAAI,GAGtBa,EAAA,IAAIb,EAAU,IAAI,EAAA,CAC1B,EACM,MAAM,KAAKa,CAAM,CAC1B,CACF,CC1JA,MAAME,GAAmB,CACvB,cAEA,OACA,QACA,OACA,cACA,OACF,EAEMC,GAAa,CACjB,QACA,cACA,cAEA,cACA,cACA,YACA,aAEA,YACA,WACA,UAEA,UACA,QAEA,kBACA,mBACA,oBACA,iBAEA,MACA,OACA,QAEA,GAAGD,EACL,EAmBO,MAAME,EAAkB,CAY7B,YAAmBzJ,EAAqB,CAArB,KAAA,IAAAA,EAXnB,KAAA,YAAc,IAAI0J,GAElB,KAAQ,aAAe,OAAO,YAC5BF,GAAW,IAAKzF,GAAiD,CAACA,EAAM,CAAE,CAAA,CAAC,CAAA,EAqB7E,KAAA,SAAW,IAAM,CACf,MAAM4F,EAAiBF,GAAkB,kBACrCE,IAAmB,OACvBF,GAAkB,kBAAoB,KACtBE,GAAA,IAAI,UAAU,QAAM,EAGtC,KAAA,WAAa,IAAM,CACjB,MAAMA,EAAiBF,GAAkB,kBACpCE,GACDA,IAAmB,OACvBF,GAAkB,kBAAoB,KACvBE,EAAA,IAAI,UAAU,QAAM,EAoDrC,KAAA,WAAa,IAAIC,IACf,KAAK,iBAAiB,WAAW,GAAGA,CAAI,EA7EnC,KAAA,gBAAkB,IAAI7B,GAAe,IAAI,EACzC,KAAA,iBAAmB,IAAIV,GAAgB,IAAI,EAC3C,KAAA,cAAgB,IAAIa,GAAa,IAAI,EACrC,KAAA,kBAAoB,IAAInD,GAAiB,IAAI,CACpD,CAEA,MAAA,CAAA,KAAe,kBAA8C,IAAA,CAE7D,IAAI,UAAW,CACb,OAAO0E,GAAkB,oBAAsB,IACjD,CAiBA,OAAQ,CACF,KAAK,YAAY,WACd,KAAA,YAAc,IAAIC,IAEzB,KAAK,YAAY,CACnB,CAEA,SAAU,CACR,KAAK,YAAY,SACnB,CAEA,IAAI,MAAO,CACT,OAAO,KAAK,IAAI,IAClB,CAEA,IAAI3F,EAAiBM,EAA8B8D,EAAoB,CAC/D,MAAA0B,EAAcxF,EAAQ,IAAI,aAAa,EAC7C,GAAI,GAAC8D,IACKA,EAAA,KAAK,eAAepE,EAAM8F,CAAW,EACzC,CAAC1B,IAKI,UAAA2B,KAAU3B,EAAM,QAAS,CAC5B,KAAA,CAAE,GAAA1E,CAAO,EAAAqG,EAEf,GADerG,EAAGY,CAAO,EAEvB,MAEJ,CACF,CAEA,IAAIN,EAAiBgG,EAAyBtC,EAAwB,CACpE,MAAMqC,EAA6B,CACjC,GAAIC,EACJ,QAAStC,GAAS,QAClB,KAAMA,GAAS,IAAA,EAEjB,YAAK,aAAa1D,CAAI,EAAE,QAAQ+F,CAAM,EAC/B,IAAM,CACP,KAAK,aAAa/F,CAAI,EAAE,SAAS+F,CAAM,IACzC,KAAK,aAAa/F,CAAI,EAAI,KAAK,aAAaA,CAAI,EAAE,UAC3CiG,IAAMF,CAAA,EAEf,CAEJ,CAKA,IAAY,oBAAqB,CACxB,OAAA,KAAK,IAAI,UAAU,KAC5B,CAEQ,eAAe/F,EAAiBI,EAAyB,CAE/D,GAAI,CADa,KAAK,aAAaJ,CAAI,EACxB,OAEX,IAAAkG,EAEJ,OAAQ9F,EAAM,WAAY,CACxB,KAAKS,GAAqB,UAAW,CAC1BqF,EAAA,KAAK,4BAA4BlG,CAAI,EAC9C,KACF,CACA,KAAKa,GAAqB,OAAQ,CAChCqF,EAAS,KAAK,yBACZlG,EACAI,EAAM,MAAM,MAAA,EAEd,KACF,CACA,QACE,MAAM,IAAI,MAAM,+BAA+BA,EAAM,UAAU,EAAE,CAErE,CAEO,OAAA8F,CACT,CAEA,gBACElG,EACA0E,EACAF,EACwB,CAClB,MAAA2B,EAAW,KAAK,aAAanG,CAAI,EACvC,GAAI,CAACmG,EAAU,OAEf,MAAMC,EAAeD,EAAS,OACjBH,GAAAA,EAAQ,UAAY,QAAaA,EAAQ,OAAS,MAAA,EAGzDK,EAAaF,EAAS,OAAkBH,GAAA,CAC5C,MAAMM,EAAQN,EAAQ,KACtB,OAAIM,IAAU,OAAkB,GACzB9B,EAAM,KAAKhE,GAAQD,EAAW,SAASC,EAAM8F,CAAK,CAAC,CAAA,CAC3D,EAEKC,EAAgBJ,EAAS,UAClBH,EAAQ,SAAWtB,EAAS,SAASsB,EAAQ,OAAO,CAAA,EAG1D,MAAA,CACL,QAASK,EAAW,OAAOE,CAAa,EAAE,OAAOH,CAAY,EAC7D,SAAA1B,EACA,MAAAF,CAAA,CAEJ,CAEQ,yBAAyBxE,EAAiBwG,EAAc,CAE9D,GAAI,CADa,KAAK,aAAaxG,CAAI,EACxB,OAEf,MAAMQ,EAAO,KAAK,IAAI,KAAK,YAAYgG,CAAM,GAAG,KAChD,GAAI,CAAChG,EACI,OAAA,KAAK,4BAA4BR,CAAI,EAGxC,MAAA0E,EAAWlE,EACd,IAAemE,GACP,KAAK,IAAI,KAAK,aAAaA,CAAO,GAAG,OAC7C,EACA,OAAQC,GACA,CAAC,CAACA,CACV,EACA,QAAQ,EAEX,OAAO,KAAK,gBAAgB5E,EAAM0E,EAAU,CAAClE,CAAI,CAAC,CACpD,CAEQ,4BAA4BR,EAAiB,CAEnD,GAAI,CADa,KAAK,aAAaA,CAAI,EACxB,OAEf,MAAMyG,EAAa,KAAK,mBAClBC,EAAgC,CAAA,EAEhChC,EAAW+B,EACd,IAAInC,GAAaA,EAAU,IAAI,EAC/B,QAAgB9D,GACRA,EAAK,IAAemE,GAClB,KAAK,IAAI,KAAK,aAAaA,CAAO,GAAG,OAC7C,CACF,EACA,OAAQC,GACH,CAACA,GACD8B,EAAK9B,CAAO,EAAU,IAC1B8B,EAAK9B,CAAO,EAAI,GACT,GACR,EACA,QAAQ,EAELJ,EAAQiC,EAAW,IAAInC,GAAaA,EAAU,IAAI,EAExD,OAAO,KAAK,gBAAgBtE,EAAM0E,EAAUF,CAAK,CACnD,CAEQ,aAAc,CACpBgB,GAAiB,QAAqBnB,GAAA,CACpC,KAAK,YAAY,aACf,KAAK,KACLP,GAAYO,CAAS,EACZjH,GAAA,CACF,KAAA,IACHiH,EACAlE,GAAoB,KAClB,IAAID,GAAa9C,CAAK,EACtB,IAAI0D,GAAiB,CACnB,MAAA1D,EACA,WAAYyD,GAAqB,SAAA,CAClC,CACH,CAAA,CAEJ,CAAA,CACF,CACD,EAED,KAAK,gBAAgB,SACrB,KAAK,iBAAiB,SACtB,KAAK,cAAc,SACnB,KAAK,kBAAkB,QACzB,CACF,CC3RO,MAAe8F,EAAc,CAKlC,YAAY,CAAE,KAAAnG,GAA8B,CAC1C,KAAK,KAAOA,CACd,CAEA,IAAI,SAAkB,CACb,OAAAD,EAAW,GAAG,KAAK,IAAI,CAChC,CAEA,GACE/D,EACyC,CACzC,OAAO,KAAK,OAASA,CACvB,CAEA,IAAI,MAAiC,CACnC,OAAQ,KAAK,YACV,IACL,CAEA,IAAI,OAAgB,CAClB,OAAQ,KAAK,YAAqC,KACpD,CAMA,OAAO,SAAS8C,EAA2C,CACnD,MAAA,IAAI,MAAM,+BAA+B,CACjD,CACF,CC1CA,MAAMsH,GAAuBC,EAAE,OAAO,CACpC,KAAMA,EAAE,MAAMA,EAAE,QAAQ,CAC1B,CAAC,EAEM,MAAMC,WAAuBH,EAAc,CAChD,MAAA,CAAA,KAAgB,KAAO,OAAA,CACvB,MAAA,CAAA,KAAgB,MAAQ,MAAA,CAEf,OAAOI,EAA+B,CAC7C,OAAIA,aAAiBD,GACZvG,EAAW,OAAO,KAAK,KAAMwG,EAAM,IAAI,EAEzC,EACT,CAES,QAAkC,CAClC,MAAA,CACL,KAAM,QACN,KAAM,KAAK,IAAA,CAEf,CAEA,OAAgB,SAAS1J,EAA+C,CACtE,OAAAuJ,GAAqB,MAAMvJ,CAAI,EACxB,IAAIyJ,GAAe,CACxB,KAAMzJ,EAAK,IAAA,CACZ,CACH,CACF,CC7BA,MAAM2J,GAAwBH,EAAE,OAAO,CACrC,EAAGA,EAAE,OAAO,EACZ,EAAGA,EAAE,OAAO,CACd,CAAC,EAEM,MAAMI,WAAwBN,EAAc,CACjD,MAAA,CAAA,KAAgB,KAAO,QAAA,CACvB,MAAA,CAAA,KAAgB,MAAQ,UAAA,CAKxB,YAAYV,EAAWiB,EAAW,CAChC,MAAM,CAAE,KAAM,CAAC,CAAA,CAAG,EAClB,KAAK,EAAIjB,EACT,KAAK,EAAIiB,CACX,CAES,OAAOH,EAA+B,CAC7C,OAAIA,aAAiBE,GACZ,KAAK,IAAMF,EAAM,GAAK,KAAK,IAAMA,EAAM,EAGzC,EACT,CAES,QAAkC,CAClC,MAAA,CACL,KAAM,SACN,EAAG,KAAK,EACR,EAAG,KAAK,CAAA,CAEZ,CAEA,OAAgB,SAAS1J,EAAgD,CACvE,OAAA2J,GAAsB,MAAM3J,CAAI,EACzB,IAAI4J,GAAgB5J,EAAK,EAAaA,EAAK,CAAW,CAC/D,CACF,CCtCA,MAAM8J,GAAyBN,EAAE,OAAO,CACtC,SAAUA,EAAE,MAAMA,EAAE,QAAQ,EAC5B,QAASA,EAAE,QAAQ,CACrB,CAAC,EAEM,MAAMO,WAAyBT,EAAc,CAClD,MAAA,CAAA,KAAgB,KAAO,SAAA,CACvB,MAAA,CAAA,KAAgB,MAAQ,UAAA,CAKxB,YAAYnG,EAAgB6G,EAAoBC,EAAkB,CAC1D,MAAA,CAAE,KAAA9G,EAAM,EAEd,KAAK,SAAW6G,EAChB,KAAK,QAAUC,CACjB,CAEA,SAAU,CACR,OAAO,KAAK,SAAS,SAAW,GAAK,CAAC,KAAK,OAC7C,CAES,OAAOP,EAA+B,CAC7C,OAAIA,aAAiBK,GAEjB,KAAK,UAAYL,EAAM,SACvB,KAAK,SAAS,SAAWA,EAAM,SAAS,QACxC,KAAK,SAAS,MAAM,CAACQ,EAAIC,IAAQD,IAAOR,EAAM,SAASS,CAAG,CAAC,GAC3D,KAAK,UAAYT,EAAM,QAIpB,EACT,CAES,QAAkC,CAClC,MAAA,CACL,KAAM,UACN,KAAM,KAAK,KACX,SAAU,KAAK,SACf,QAAS,KAAK,OAAA,CAElB,CAEA,OAAgB,SACd1J,EAGkB,CAClB,OAAA8J,GAAuB,MAAM9J,CAAI,EAC1B,IAAI+J,GACT/J,EAAK,KACLA,EAAK,SACLA,EAAK,OAAA,CAET,CACF,CC5CA,MAAMoK,GAAsBZ,EAAE,OAAO,CACnC,KAAMA,EAAE,OAAO,CACb,KAAMA,EAAE,MAAMA,EAAE,QAAQ,EACxB,MAAOA,EAAE,OAAO,EAChB,OAAQA,EAAE,OAAO,CAAA,CAClB,EACD,GAAIA,EACD,OAAO,CACN,KAAMA,EAAE,MAAMA,EAAE,QAAQ,EACxB,MAAOA,EAAE,OAAO,EAChB,OAAQA,EAAE,OAAO,CAClB,CAAA,EACA,SAAS,EAGZ,UAAWA,EAAE,QAAQ,EAAE,SAAS,CAClC,CAAC,EAEM,MAAMa,WAAsBf,EAAc,CAC/C,MAAA,CAAA,KAAgB,KAAO,MAAA,CACvB,MAAA,CAAA,KAAgB,MAAQ,MAAA,CAQxB,YAAY,CAAE,KAAAgB,EAAM,GAAAC,EAAI,UAAAC,GAAiC,CACjD,MAAA,CACJ,KAAMF,EAAK,IAAA,CACZ,EACD,KAAK,KAAOA,EAEZ,KAAK,GAAK,KAAK,YAAYA,EAAMC,CAAE,EAAI,KAAOA,EAEzC,KAAA,UAAY,CAAC,CAACC,CACrB,CAEA,IAAI,OAAwB,CAC1B,OAAO,KAAK,UAAY,KAAK,IAAM,KAAK,KAAO,KAAK,IACtD,CAEA,IAAI,KAAsB,CACxB,OAAO,KAAK,UAAY,KAAK,KAAO,KAAK,IAAM,KAAK,IACtD,CAEA,OAAiB,CACR,MAAA,CAAC,CAAC,KAAK,EAChB,CAEQ,YACNpO,EACAsD,EACS,CACT,OAAItD,GAAKsD,EAELwD,EAAW,OAAO9G,EAAE,KAAMsD,EAAE,IAAI,GAChCtD,EAAE,QAAUsD,EAAE,OACdtD,EAAE,SAAWsD,EAAE,OAIZtD,IAAMsD,CACf,CAES,OAAOgK,EAA+B,CAC7C,OAAIA,aAAiBW,GAEjBnH,EAAW,OAAO,KAAK,KAAMwG,EAAM,IAAI,GACvC,KAAK,YAAYA,EAAM,KAAM,KAAK,IAAI,GACtC,KAAK,YAAYA,EAAM,GAAI,KAAK,EAAE,EAG/B,EACT,CACS,QAAkC,CAClC,MAAA,CACL,KAAM,OACN,KAAM,KAAK,KACX,GAAI,KAAK,GACT,UAAW,KAAK,SAAA,CAEpB,CAEA,OAAgB,SAAS1J,EAA8C,CACrE,OAAAoK,GAAoB,MAAMpK,CAAI,EACvB,IAAIqK,GAAc,CACvB,KAAMrK,EAAK,KACX,GAAIA,EAAK,GACT,UAAW,CAAC,CAACA,EAAK,SAAA,CACnB,CACH,CAEA,aAAuB,CACrB,OAAO,KAAK,KAAO,MAAQ,KAAK,KAAK,SAAW,CAClD,CAEA,eAAyB,CAChB,OAAA,KAAK,KAAO,MAAQkD,EAAW,OAAO,KAAK,KAAK,KAAM,KAAK,GAAG,IAAI,CAC3E,CACF,CCnGO,MAAMuH,EAAiB,CAS5B,YAAmB7L,EAAqB,CAArB,KAAA,IAAAA,EARnB,KAAA,YAAc,IAAI0J,GAClB,KAAQ,uBAA+D,GAE/D,KAAA,MAAA,CACN,QAAS,IAAIoC,EACb,cAAe,IAAIA,CAAmC,EA2BhD,KAAA,iBAAoB1K,GAAkC,CAC5D,MAAM2K,EAAO,KAAK,uBAAuB3K,EAAK,IAAc,EAC5D,GAAI,CAAC2K,EACH,MAAM,IAAI,MAAM,2BAA2B3K,EAAK,IAAI,EAAE,EAEjD,OAAA2K,EAAK,SAAS3K,CAAI,CAAA,EAwFnB,KAAA,WAAcD,GAAoC,CACxDA,EAAM,UAAU,KAAK,IAAI,kBAAmB,KAAK,KAAK,CAAA,EAGhD,KAAA,YAAeA,GAAoC,CACzD,MAAMkH,EAAYlH,EAAM,UAAU,KAAK,IAAI,iBAAiB,EACxDkH,GACF,KAAK,IAAIA,CAA4B,CACvC,EA5HA,KAAK,wBAAwB,CAC/B,CAEA,SAAS0D,EAAqD,CAC5D,OAACA,CAAI,EAAE,KAAO,EAAA,QAAQA,GAAQ,CACvB,KAAA,uBAAuBA,EAAK,IAAI,EAAIA,CAAA,CAC1C,EACM,IACT,CAEA,IAAY,QAAS,CACZ,OAAA,KAAK,IAAI,UAAU,cAC5B,CAEQ,yBAA0B,CAChC,KAAK,SAAS,CACZN,GACAZ,GACAM,GACAH,EAAA,CACD,CACH,CAUA,OACEzK,KACGqJ,EAC8B,CAC3B,MAAAmC,EAAO,KAAK,uBAAuBxL,CAAI,EAC7C,GAAI,CAACwL,EACH,MAAM,IAAI,MAAM,2BAA2BxL,CAAI,EAAE,EAE5C,OAAA,IAAIwL,EAAK,GAAGnC,CAAI,CACzB,CAEA,IAAI,OAAQ,CACV,OAAO,KAAK,OAAO,kBAAkB,EAAE,IAAYxI,GAC1C,KAAK,iBAAiBA,CAAI,CAClC,CACH,CAEA,SAASA,EAAiC,CACxC,MAAMoJ,EAAapJ,EAAK,IAAIA,GACnB,KAAK,iBAAiBA,CAAI,CAClC,EACM,OAAA,KAAK,IAAIoJ,CAAU,CAC5B,CAEA,IAAIA,EAA6B,CAC1B,KAAA,OAAO,kBAAkBA,EAAW,OAASwB,EAAE,OAAQ,CAAA,CAAC,EACxD,KAAA,MAAM,QAAQ,KAAKxB,CAAU,CACpC,CAEA,SAASyB,EAAezB,EAA6B,CACnD,MAAMpB,EAAU,KAAK,MAAM,OAAY4C,GAAAA,EAAE,QAAUC,CAAK,EACxD,KAAK,IAAI,CAAC,GAAG7C,EAAS,GAAGoB,CAAU,CAAC,CACtC,CAEA,SAASyB,EAAe,CACtB,OAAO,KAAK,MAAM,OAAYD,GAAAA,EAAE,QAAUC,CAAK,CACjD,CAEA,OAAOxI,EAA6D,CAC5D,MAAA+G,EAAa/G,EAAG,KAAK,KAAK,EAChC,KAAK,IAAI+G,CAAU,CACrB,CAEA,MAAM0B,EAAkB,CACtB,GAAIA,EAAO,CACH,MAAAC,EAAS,KAAK,MAAM,OACX9D,GAAA,CAAC6D,EAAM,SAAS7D,EAAU,IAAI,CAAA,EAE7C,KAAK,IAAI8D,CAAM,CAAA,MAEV,KAAA,IAAI,CAAA,CAAE,CAEf,CAEA,KAAyC5L,EAAS,CAChD,OAAO,KAAK,MAAM,KAAM6L,GACtBA,EAAI,GAAG7L,CAAI,CAAA,CAEf,CAEA,OAA2CA,EAAS,CAClD,OAAO,KAAK,MAAM,OAAQ6L,GACxBA,EAAI,GAAG7L,CAAI,CAAA,CAEf,CAEA,IAAI,kBAAmB,CACf,MAAA2F,MAAU,IAChB,YAAK,OAAO,UAAU,EAAE,QAAQ,CAAC/B,EAAOmH,IAAO,CACzC,GAAAA,IAAO,KAAK,OAAO,UAAU,SAAU,OAC3C,MAAMd,EAAarG,EAAM,UACtB,IAAY/C,GAAA,CACP,GAAA,CACK,OAAA,KAAK,iBAAiBA,CAAI,QAC1BiL,EAAO,CACd,eAAQ,MAAM,iCAAkCf,EAAIlK,EAAMiL,CAAK,EACxD,IACT,CACD,CAAA,EACA,OAAQD,GAA8B,CAAC,CAACA,CAAG,EAC1ClG,EAAA,IAAIoF,EAAId,CAAU,CAAA,CACvB,EACMtE,CACT,CAaA,OAAQ,CACF,KAAK,YAAY,WACd,KAAA,YAAc,IAAIwD,IAEzB,KAAK,IAAI,KAAK,QAAQ,GAAG,mBAAoB,KAAK,UAAU,EAC5D,KAAK,IAAI,KAAK,QAAQ,GAAG,oBAAqB,KAAK,WAAW,EAC9D,KAAK,YAAY,IACf,KAAK,OAAO,MAAM,OAAO,GAAG,CAAC,CAAE,GAAA4B,KAAS,CAClCA,IAAO,KAAK,OAAO,UAAU,UACjC,KAAK,MAAM,cAAc,KAAK,KAAK,gBAAgB,CAAA,CACpD,CAAA,CAEL,CAEA,SAAU,CACR,KAAK,IAAI,KAAK,QAAQ,IAAI,mBAAoB,KAAK,UAAU,EAC7D,KAAK,IAAI,KAAK,QAAQ,IAAI,oBAAqB,KAAK,WAAW,EAC1D,KAAA,MAAM,QAAQ,UACnB,KAAK,YAAY,UACjB,KAAK,MAAM,CACb,CAEA,SAAU,CACD,OAAA,OAAO,KAAK,KAAK,EAAE,QAAgBgB,GAAAA,EAAK,SAAS,EACxD,KAAK,YAAY,SACnB,CACF,CCnLO,MAAMC,EAAU,CAIrB,YAAmBvM,EAAqB,CAArB,KAAA,IAAAA,EAHX,KAAA,WAAqC,IACrC,KAAA,cAA2C,GAEV,CAEzC,SAAU,CACH,KAAA,UAAU,QAAmBwM,GAAA,CAChCA,EAAQ,QAAQ,EAChBA,EAAQ,UAAU,CAAA,CACnB,EACD,KAAK,UAAU,OACjB,CAEA,WAAWC,EAAoB,CAC7B,MAAMC,EAAW,KAAK,OAChBC,EAAW,KAAK,cAAcF,CAAK,EACpC,KAAA,cAAcC,EAAUC,CAAQ,EACrC,KAAK,OAASA,CAChB,CAEA,QAAQhE,EAAiB,CACvB,MAAMiE,EAAO,KAAK,OAAO,IAAIjE,CAAO,EACpC,OAAKiE,EAIEA,EAAK,KAHH,IAIX,CAEA,WAAWjE,EAAiB,CACnB,OAAA,KAAK,UAAU,IAAIA,CAAO,CACnC,CAEQ,cACN+D,EACAC,EACA,CACSD,EAAA,QAAQ,CAACG,EAASlE,IAAY,CAEnC,GAAAgE,EAAS,IAAIhE,CAAO,GACpBgE,EAAS,IAAIhE,CAAO,GAAG,UAAYkE,EAAQ,QAE3C,OAGF,MAAML,EAAU,KAAK,UAAU,IAAI7D,CAAO,EACtC6D,IACFA,EAAQ,QAAQ,EAChBA,EAAQ,UAAU,GAEf,KAAA,UAAU,OAAO7D,CAAO,CAAA,CAC9B,EACQgE,EAAA,QAAQ,CAACG,EAASnE,IAAY,CAKjC,GAJA,KAAK,UAAU,IAAIA,CAAO,GAI1B,CAACmE,EAAQ,QACX,OAGI,MAAAN,EAAU,IAAIM,EAAQ,QAAQ,CAClC,QAAAnE,EACA,IAAK,KAAK,GAAA,CACX,EACI,KAAA,UAAU,IAAIA,EAAS6D,CAAO,EACnCA,EAAQ,QAAQ,CAAA,CACjB,CACH,CAEQ,cAAcC,EAAyB,CACvC,MAAAM,MAAc,IACpB,OAAAN,EAAM,QAAgBG,GAAA,CACpBG,EAAQ,IAAIH,EAAK,OAAO,MAAM,QAASA,CAAI,CAAA,CAC5C,EACMG,CACT,CACF,CCpEA,MAAMC,GAAiB,CACrB,UAAW,GACX,QAAS,EACX,EAEO,MAAMC,EAAU,CAMrB,YAAmBjN,EAAqB,CAArB,KAAA,IAAAA,EALnB,KAAQ,YAAmC,KACnC,KAAA,gBAAyC,IAExC,KAAA,aAAe,IASxB,KAAA,YAAeuE,GAAmC,CAC1C,MAAA+E,EAAO,KAAK,SAAS/E,CAAI,EAC/B,OAAK+E,EAGEA,EAAK,SAFH,EAEG,EAOd,KAAA,YAAeA,GAAgC,CAC7C,SAAW,CAACjG,EAAGuJ,CAAI,IAAK,KAAK,SAAS,UAAW,CACzC,MAAAM,EAAON,EAAK,QAAQtD,CAAI,EAC9B,GAAI4D,EACK,MAAA,CACL,GAAGA,CAAA,CAGT,CACO,OAAA,IAAA,EAGT,KAAA,cAAiB5D,GACF,KAAK,uBAAuBA,CAAI,EACjC,IAASU,GAAAA,EAAE,EAAE,EAGnB,KAAA,aAAgBzJ,GACf,MAAM,KAAK,KAAK,QAAQ,EAAE,KAAKqM,GAAQA,EAAK,OAASrM,CAAI,EAG1D,KAAA,uBAA0B+I,GAAe,CAC/C,GAAI,KAAK,YAAY,IAAIA,CAAI,EACpB,OAAA,KAAK,YAAY,IAAIA,CAAI,EAE5B,MAAA6D,EAAO,KAAK,IAAI,KAEhBC,EAAU,CACd9D,EACA/E,IACoB,CAChB,GAAA,CAAC+E,GAAQA,IAAS6D,EAAa5I,OAAAA,EAC7B,MAAA8I,EAAW,KAAK,YAAY/D,CAAI,EACtC,GAAI,CAAC+D,EACI9I,OAAAA,EAET,MAAMqI,EAAO,KAAK,aAAaS,EAAS,IAAI,EAC5ChM,EAAauL,CAAI,EACjB,MAAMtJ,EAAOsJ,EAAK,MAAMS,CAAiB,EAAE,cAC3C,OAAK/J,EAGE8J,EAAQ9J,EAAMiB,EAAK,OAAO8I,CAAQ,CAAC,EAFjC9I,CAEiC,EAGtCA,EAAO6I,EAAQ9D,EAAM,CAAA,CAAE,EAAE,QAAQ,EAClC,YAAA,YAAY,IAAIA,EAAM/E,CAAI,EACxBA,CAAA,EAGT,KAAA,gBAAkB,IAAoB,CACpC,GAAI,KAAK,YACP,OAAO,KAAK,YAGR,MAAA6I,EAAW9D,GAA6B,CACtC,MAAA+D,EAAW,KAAK,YAAY/D,CAAI,EACtC,GAAI,CAAC+D,EACG,MAAA,IAAI,MAAM,oBAAoB,EAGtC,MAAMT,EAAO,KAAK,aAAaS,EAAS,IAAI,EAC5ChM,EAAauL,CAAI,EAEjB,MAAMU,EAAWV,EACd,YAAYA,EAAK,MAAMS,CAAiB,CAAC,EACzC,IAAKE,GAAgBH,EAAQG,CAAK,CAAC,EAE/B,MAAA,CACL,GAAGF,EACH,SAAAC,CAAA,CACF,EAEIE,EAAa,KAAK,IAAI,KAAK,cAAc,iBAAiB,EAChEnM,EAAamM,CAAU,EAEvB,MAAMC,EAAO,CACX,GAAI,WACJ,KAAM,CAAC,EACP,SAAU,CAACL,EAAQI,CAAU,CAAC,CAAA,EAEhC,YAAK,YAAcC,EACZA,CAAA,EAGT,KAAA,SAAYlJ,GAAmB,CACvB,MAAAkJ,EAAO,KAAK,kBAClB,OAAOlJ,EAAK,OAAO,CAACmJ,EAA2BpC,IAAO,CACpD,GAAI,CAACoC,EACI,OAAA,KAET,MAAMH,EAAQG,EAAK,SAAS,KAAU1D,GAAAA,EAAE,KAAOsB,CAAE,EACjD,OAAKiC,GACI,MAGRE,CAAI,CAAA,EAsBT,KAAA,YAAc,CACZhK,EAKAc,EAAiB,CAAA,IACd,CACG,MAAAkJ,EAAO,KAAK,SAASlJ,CAAI,EAClBlD,EAAAoM,EAAM,qCAAqClJ,CAAI,EAAE,EAE9D,MAAM6I,EACHxM,GAAyB,CAAC0I,EAAoB7L,IAAkB,CAChDgG,EAAG6F,EAAM7L,EAAOmD,CAAM,IACtB,IAGf0I,EAAK,SAAS,QAAQ8D,EAAQ9D,CAAI,CAAC,CAAA,EAGvCmE,EAAK,SAAS,QAAQL,EAAQK,CAAI,CAAC,CAAA,EAGrC,KAAA,UAAalJ,GACPA,EAAK,SAAW,EACX,KAEF,KAAK,SAASD,EAAW,OAAOC,CAAI,CAAC,EAGnC,KAAA,SAAA,CACTA,EACAd,IAKwB,CAClB,MAAAkK,EAAWpJ,GAAmB,CAC5B,MAAA3D,EAAS,KAAK,UAAU2D,CAAI,EAClC,GAAI,CAAC3D,EACI,OAAA,KAET,MAAMnD,EAAQ,KAAK,SAAS8G,EAAM3D,CAAM,EACxC,GAAInD,IAAU,GACL,OAAA,KAET,GAAIA,IAAU,EAAG,CACf,MAAMmQ,EAAc,KAAK,UAAUtJ,EAAW,OAAOC,CAAI,CAAC,EAC1D,OAAKqJ,EACE,CACL,SAAUhN,EACV,OAAQgN,EACR,MAAO,KAAK,SAAStJ,EAAW,OAAOC,CAAI,EAAGqJ,CAAW,CAAA,EAJlC,IAM3B,CACO,MAAA,CACL,SAAUhN,EAAO,SAASnD,EAAQ,CAAC,EACnC,OAAAmD,EACA,MAAOnD,EAAQ,CAAA,CACjB,EAGF,IAAIwM,EAA8B,KAC5B,MAAAmD,EAAW7I,GAAmB,CAC5B,MAAAJ,EAAQwJ,EAAQpJ,CAAI,EAC1B,GAAI,CAACJ,EACH,OAEF,KAAM,CAAE,SAAAkJ,EAAU,OAAAzM,EAAQ,MAAAnD,CAAA,EAAU0G,EAEpC,GADeV,EAAG4J,EAAU5P,EAAOmD,CAAM,EAC7B,CACDqJ,EAAAoD,EAET,MACF,CAEAD,EAAQC,EAAS,IAAI,CAAA,EAGvB,OAAAD,EAAQ7I,CAAI,EAEL0F,CAAA,EAGE,KAAA,SAAA,CACT1F,EACAd,IAKwB,CAClB,MAAAoK,EAAWtJ,GAAmB,CAC5B,MAAA3D,EAAS,KAAK,UAAU2D,CAAI,EAClC,GAAI,CAAC3D,EACI,OAAA,KAET,MAAMnD,EAAQ,KAAK,SAAS8G,EAAM3D,CAAM,EACxC,GAAInD,IAAU,GACL,OAAA,KAET,GAAIA,IAAUmD,EAAO,SAAS,OAAS,EAAG,CACxC,MAAMgN,EAAc,KAAK,UAAUtJ,EAAW,OAAOC,CAAI,CAAC,EAC1D,OAAKqJ,EACE,CACL,SAAUhN,EACV,OAAQgN,EACR,MAAO,KAAK,SAAStJ,EAAW,OAAOC,CAAI,EAAGqJ,CAAW,CAAA,EAJlC,IAM3B,CACO,MAAA,CACL,SAAUhN,EAAO,SAASnD,EAAQ,CAAC,EACnC,OAAAmD,EACA,MAAOnD,EAAQ,CAAA,CACjB,EAGF,IAAIwM,EAA8B,KAC5B,MAAAmD,EAAW7I,GAAmB,CAC5B,MAAAJ,EAAQ0J,EAAQtJ,CAAI,EAC1B,GAAI,CAACJ,EACH,OAEF,KAAM,CAAE,SAAAkJ,EAAU,OAAAzM,EAAQ,MAAAnD,CAAA,EAAU0G,EAEpC,GADeV,EAAG4J,EAAU5P,EAAOmD,CAAM,EAC7B,CACDqJ,EAAAoD,EAET,MACF,CAEAD,EAAQC,EAAS,IAAI,CAAA,EAGvB,OAAAD,EAAQ7I,CAAI,EAEL0F,CAAA,EAGT,KAAA,QAAW1F,GAAmB,CACtB,MAAA3D,EAAS,KAAK,UAAU2D,CAAI,EAClC,OAAK3D,EAGE,KAAK,SAAS2D,EAAM3D,CAAM,EAFxB,EAEwB,EAc3B,KAAA,SAAW,CAAC2D,EAAgB3D,IAC3BA,EAAO,SAAS,UAAeoJ,GAAAA,EAAE,KAAOzF,EAAKA,EAAK,OAAS,CAAC,CAAC,EAxS/D,KAAA,UAAY,IAAI,iBAAiB,IAAM,CAC1C,KAAK,YAAY,QACjB,KAAK,YAAc,IAAA,CACpB,CACH,CAUA,SAAwCqI,EAA0B,CAC3D,KAAA,SAAS,IAAIA,CAAI,CACxB,CA6GA,aACErM,EACAgE,EAC2C,CACrC,MAAAkJ,EAAO,KAAK,SAASlJ,CAAI,EAC/B,MAAI,CAACkJ,GAAQA,EAAK,OAASlN,EAClB,KAEFkN,EAAK,IACd,CAsJA,OAAQ,CACN,KAAK,UAAU,QAAQ,KAAK,IAAI,KAAMT,EAAc,CACtD,CAEA,SAAU,CACR,KAAK,YAAY,QACjB,KAAK,YAAc,KACnB,KAAK,UAAU,aACf,KAAK,SAAS,OAChB,CAKF,CCpTO,MAAMc,EAAc,CAWzB,YAAYrG,EAA0B,CACpC,KAAK,KAAOA,EAAQ,KACpB,KAAK,UAAYA,EAAQ,UACzB,KAAK,KAAOA,EAAQ,KACf,KAAA,MAAQ,IAAIgC,GAAkB,IAAI,EAClC,KAAA,UAAY,IAAIoC,GAAiB,IAAI,EACrC,KAAA,QAAU,IAAIpJ,GAAe,IAAI,EACjC,KAAA,KAAO,IAAI8J,GAAU,IAAI,EACzB,KAAA,KAAO,IAAIU,GAAU,IAAI,EACzB,KAAA,UAAY,IAAIlN,GAAU,IAAI,CACrC,CAEA,OAAQ,CACN,KAAK,UAAU,QACf,KAAK,MAAM,QACX,KAAK,KAAK,OACZ,CAEA,SAAU,CACR,KAAK,MAAM,UACX,KAAK,UAAU,UACf,KAAK,KAAK,UACV,KAAK,KAAK,SACZ,CACF,CClDA;AAAA;AAAA;AAAA;AAAA,GAKA,MAAMgO,GAAE,WAAWC,GAAED,GAAE,aAAsBA,GAAE,WAAX,QAAqBA,GAAE,SAAS,eAAe,uBAAuB,SAAS,WAAW,YAAY,cAAc,UAAU/B,GAAE,OAAM,EAAGiC,GAAE,IAAI,QAAQ,IAAAC,GAAA,KAAO,CAAC,YAAYH,EAAEC,EAAEC,EAAE,CAAC,GAAG,KAAK,aAAa,GAAGA,IAAIjC,GAAE,MAAM,MAAM,mEAAmE,EAAE,KAAK,QAAQ+B,EAAE,KAAK,EAAEC,CAAC,CAAC,IAAI,YAAY,CAAC,IAAID,EAAE,KAAK,EAAE,MAAM/B,EAAE,KAAK,EAAE,GAAGgC,IAAYD,IAAT,OAAW,CAAC,MAAMC,EAAWhC,IAAT,QAAgBA,EAAE,SAAN,EAAagC,IAAID,EAAEE,GAAE,IAAIjC,CAAC,GAAY+B,IAAT,UAAc,KAAK,EAAEA,EAAE,IAAI,eAAe,YAAY,KAAK,OAAO,EAAEC,GAAGC,GAAE,IAAIjC,EAAE+B,CAAC,EAAE,CAAC,OAAOA,CAAC,CAAC,UAAU,CAAC,OAAO,KAAK,OAAO,CAAC,EAAM,MAACI,GAAEJ,GAAG,IAAIK,GAAY,OAAOL,GAAjB,SAAmBA,EAAEA,EAAE,GAAG,OAAO/B,EAAC,EAAE3O,GAAE,CAAC0Q,KAAK,IAAI,CAAC,MAAME,EAAMF,EAAE,SAAN,EAAaA,EAAE,CAAC,EAAE,EAAE,OAAQ,CAACC,EAAEhC,EAAEiC,IAAID,GAAGD,GAAG,CAAC,GAAQA,EAAE,eAAP,GAAoB,OAAOA,EAAE,QAAQ,GAAa,OAAOA,GAAjB,SAAmB,OAAOA,EAAE,MAAM,MAAM,mEAAmEA,EAAE,sFAAsF,CAAC,GAAG/B,CAAC,EAAE+B,EAAEE,EAAE,CAAC,EAAGF,EAAE,CAAC,CAAC,EAAE,OAAO,IAAIK,GAAEH,EAAEF,EAAE/B,EAAC,CAAC,EAAEqC,GAAE,CAAC,EAAEJ,IAAI,CAAC,GAAGD,GAAE,EAAE,mBAAmBC,EAAE,IAAK,GAAG,aAAa,cAAc,EAAE,EAAE,UAAY,MAAM,WAAUD,KAAKC,EAAE,CAAC,MAAMA,EAAE,SAAS,cAAc,OAAO,EAAEG,EAAEL,GAAE,SAAkBK,IAAT,QAAYH,EAAE,aAAa,QAAQG,CAAC,EAAEH,EAAE,YAAYD,EAAE,QAAQ,EAAE,YAAYC,CAAC,CAAC,CAAC,EAAEjQ,GAAEgQ,GAAED,GAAGA,EAAEA,GAAGA,aAAa,eAAeA,GAAG,CAAC,IAAIC,EAAE,GAAG,UAAUhC,KAAK+B,EAAE,SAASC,GAAGhC,EAAE,QAAQ,OAAOmC,GAAEH,CAAC,CAAC,GAAGD,CAAC,EAAEA,ECJ3zC;AAAA;AAAA;AAAA;AAAA,GAIO,KAAC,CAAC,GAAG1Q,GAAE,eAAe2Q,GAAE,yBAAyBG,GAAE,oBAAoBG,GAAE,sBAAsBL,GAAE,eAAeG,EAAC,EAAE,OAAO5Q,GAAE,WAAWQ,GAAER,GAAE,aAAa+Q,GAAEvQ,GAAEA,GAAE,YAAY,GAAGwQ,GAAEhR,GAAE,+BAA+BiR,GAAE,CAACV,EAAE/B,IAAI+B,EAAEW,GAAE,CAAC,YAAYX,EAAE/B,EAAE,CAAC,OAAOA,EAAC,CAAE,KAAK,QAAQ+B,EAAEA,EAAEQ,GAAE,KAAK,MAAM,KAAK,OAAO,KAAK,MAAMR,EAAQA,GAAN,KAAQA,EAAE,KAAK,UAAUA,CAAC,CAAC,CAAC,OAAOA,CAAC,EAAE,cAAcA,EAAE/B,EAAE,CAAC,IAAI3O,EAAE0Q,EAAE,OAAO/B,EAAG,CAAA,KAAK,QAAQ3O,EAAS0Q,IAAP,KAAS,MAAM,KAAK,OAAO1Q,EAAS0Q,IAAP,KAAS,KAAK,OAAOA,CAAC,EAAE,MAAM,KAAK,OAAO,KAAK,MAAM,GAAG,CAAC1Q,EAAE,KAAK,MAAM0Q,CAAC,CAAC,MAAS,CAAC1Q,EAAE,IAAI,CAAC,CAAC,OAAOA,CAAC,CAAC,EAAEP,GAAE,CAACiR,EAAE/B,IAAI,CAAC3O,GAAE0Q,EAAE/B,CAAC,EAAEf,GAAE,CAAC,UAAU,GAAG,KAAK,OAAO,UAAUyD,GAAE,QAAQ,GAAG,WAAW5R,EAAC,EAAE,OAAO,WAAW,OAAO,UAAU,EAAEU,GAAE,sBAAsB,IAAI,QAAQ,MAAMsD,WAAU,WAAW,CAAC,OAAO,eAAeiN,EAAE,CAAC,KAAK,KAAI,GAAI,KAAK,IAAI,CAAE,GAAE,KAAKA,CAAC,CAAC,CAAC,WAAW,oBAAoB,CAAC,OAAO,KAAK,SAAQ,EAAG,KAAK,MAAM,CAAC,GAAG,KAAK,KAAK,KAAI,CAAE,CAAC,CAAC,OAAO,eAAeA,EAAE/B,EAAEf,GAAE,CAAC,GAAGe,EAAE,QAAQA,EAAE,UAAU,IAAI,KAAK,KAAI,EAAG,KAAK,kBAAkB,IAAI+B,EAAE/B,CAAC,EAAE,CAACA,EAAE,WAAW,CAAC,MAAM3O,EAAE,OAAQ,EAAC8Q,EAAE,KAAK,sBAAsBJ,EAAE1Q,EAAE2O,CAAC,EAAWmC,IAAT,QAAYH,GAAE,KAAK,UAAUD,EAAEI,CAAC,CAAC,CAAC,CAAC,OAAO,sBAAsBJ,EAAE/B,EAAE3O,EAAE,CAAC,KAAK,CAAC,IAAI2Q,EAAE,IAAIM,CAAC,EAAEH,GAAE,KAAK,UAAUJ,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,KAAK/B,CAAC,CAAC,EAAE,IAAI+B,EAAE,CAAC,KAAK/B,CAAC,EAAE+B,CAAC,CAAC,EAAE,MAAM,CAAC,KAAK,CAAC,OAAOC,GAAG,KAAK,IAAI,CAAC,EAAE,IAAIhC,EAAE,CAAC,MAAMmC,EAAEH,GAAG,KAAK,IAAI,EAAEM,EAAE,KAAK,KAAKtC,CAAC,EAAE,KAAK,cAAc+B,EAAEI,EAAE9Q,CAAC,CAAC,EAAE,aAAa,GAAG,WAAW,EAAE,CAAC,CAAC,OAAO,mBAAmB0Q,EAAE,CAAC,OAAO,KAAK,kBAAkB,IAAIA,CAAC,GAAG9C,EAAC,CAAC,OAAO,MAAM,CAAC,GAAG,KAAK,eAAewD,GAAE,mBAAmB,CAAC,EAAE,OAAO,MAAMV,EAAEK,GAAE,IAAI,EAAEL,EAAE,SAAQ,EAAYA,EAAE,IAAX,SAAe,KAAK,EAAE,CAAC,GAAGA,EAAE,CAAC,GAAG,KAAK,kBAAkB,IAAI,IAAIA,EAAE,iBAAiB,CAAC,CAAC,OAAO,UAAU,CAAC,GAAG,KAAK,eAAeU,GAAE,WAAW,CAAC,EAAE,OAAO,GAAG,KAAK,UAAU,GAAG,KAAK,KAAM,EAAC,KAAK,eAAeA,GAAE,YAAY,CAAC,EAAE,CAAC,MAAM,EAAE,KAAK,WAAWzC,EAAE,CAAC,GAAGsC,GAAE,CAAC,EAAE,GAAGL,GAAE,CAAC,CAAC,EAAE,UAAU,KAAKjC,EAAE,KAAK,eAAe,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,MAAM+B,EAAE,KAAK,OAAO,QAAQ,EAAE,GAAUA,IAAP,KAAS,CAAC,MAAM/B,EAAE,oBAAoB,IAAI+B,CAAC,EAAE,GAAY/B,IAAT,OAAW,SAAS,CAAC+B,EAAE,CAAC,IAAI/B,EAAE,KAAK,kBAAkB,IAAI+B,EAAE,CAAC,CAAC,CAAC,KAAK,KAAK,IAAI,IAAI,SAAS,CAAC,EAAE/B,CAAC,IAAI,KAAK,kBAAkB,CAAC,MAAM,EAAE,KAAK,KAAK,EAAEA,CAAC,EAAW,IAAT,QAAY,KAAK,KAAK,IAAI,EAAE,CAAC,CAAC,CAAC,KAAK,cAAc,KAAK,eAAe,KAAK,MAAM,CAAC,CAAC,OAAO,eAAeA,EAAE,CAAC,MAAM3O,EAAE,CAAE,EAAC,GAAG,MAAM,QAAQ2O,CAAC,EAAE,CAAC,MAAMgC,EAAE,IAAI,IAAIhC,EAAE,KAAK,GAAG,EAAE,QAAS,CAAA,EAAE,UAAUA,KAAKgC,EAAE3Q,EAAE,QAAQ0Q,GAAE/B,CAAC,CAAC,CAAC,MAAeA,IAAT,QAAY3O,EAAE,KAAK0Q,GAAE/B,CAAC,CAAC,EAAE,OAAO3O,CAAC,CAAC,OAAO,KAAK0Q,EAAE/B,EAAE,CAAC,MAAM3O,EAAE2O,EAAE,UAAU,OAAW3O,IAAL,GAAO,OAAiB,OAAOA,GAAjB,SAAmBA,EAAY,OAAO0Q,GAAjB,SAAmBA,EAAE,YAAW,EAAG,MAAM,CAAC,aAAa,CAAC,MAAO,EAAC,KAAK,KAAK,OAAO,KAAK,gBAAgB,GAAG,KAAK,WAAW,GAAG,KAAK,KAAK,KAAK,KAAK,KAAM,CAAA,CAAC,MAAM,CAAC,KAAK,KAAK,IAAI,QAASA,GAAG,KAAK,eAAeA,CAAC,EAAG,KAAK,KAAK,IAAI,IAAI,KAAK,KAAM,EAAC,KAAK,cAAa,EAAG,KAAK,YAAY,GAAG,QAASA,GAAGA,EAAE,IAAI,CAAC,CAAE,CAAC,cAAcA,EAAE,EAAE,KAAK,OAAO,IAAI,KAAK,IAAIA,CAAC,EAAW,KAAK,aAAd,QAA0B,KAAK,aAAaA,EAAE,gBAAiB,CAAA,CAAC,iBAAiBA,EAAE,CAAC,KAAK,MAAM,OAAOA,CAAC,CAAC,CAAC,MAAM,CAAC,MAAMA,EAAE,IAAI,IAAI/B,EAAE,KAAK,YAAY,kBAAkB,UAAU3O,KAAK2O,EAAE,KAAI,EAAG,KAAK,eAAe3O,CAAC,IAAI0Q,EAAE,IAAI1Q,EAAE,KAAKA,CAAC,CAAC,EAAE,OAAO,KAAKA,CAAC,GAAG0Q,EAAE,KAAK,IAAI,KAAK,KAAKA,EAAE,CAAC,kBAAkB,CAAC,MAAMA,EAAE,KAAK,YAAY,KAAK,aAAa,KAAK,YAAY,iBAAiB,EAAE,OAAO/B,GAAE+B,EAAE,KAAK,YAAY,aAAa,EAAEA,CAAC,CAAC,mBAAmB,CAAC,KAAK,aAAa,KAAK,iBAAgB,EAAG,KAAK,eAAe,EAAE,EAAE,KAAK,MAAM,QAASA,GAAGA,EAAE,gBAAiB,CAAA,CAAE,CAAC,eAAeA,EAAE,CAAA,CAAE,sBAAsB,CAAC,KAAK,MAAM,QAASA,GAAGA,EAAE,mBAAoB,CAAA,CAAE,CAAC,yBAAyBA,EAAE/B,EAAE3O,EAAE,CAAC,KAAK,KAAK0Q,EAAE1Q,CAAC,CAAC,CAAC,KAAK0Q,EAAE/B,EAAE,CAAC,MAAM3O,EAAE,KAAK,YAAY,kBAAkB,IAAI0Q,CAAC,EAAEC,EAAE,KAAK,YAAY,KAAKD,EAAE1Q,CAAC,EAAE,GAAY2Q,IAAT,QAAiB3Q,EAAE,UAAP,GAAe,CAAC,MAAM,GAAYA,EAAE,WAAW,cAAtB,OAAkCA,EAAE,UAAUqR,IAAG,YAAY1C,EAAE3O,EAAE,IAAI,EAAE,KAAK,KAAK0Q,EAAQ,GAAN,KAAQ,KAAK,gBAAgBC,CAAC,EAAE,KAAK,aAAaA,EAAE,CAAC,EAAE,KAAK,KAAK,IAAI,CAAC,CAAC,KAAKD,EAAE/B,EAAE,CAAC,MAAM3O,EAAE,KAAK,YAAY2Q,EAAE3Q,EAAE,KAAK,IAAI0Q,CAAC,EAAE,GAAYC,IAAT,QAAY,KAAK,OAAOA,EAAE,CAAC,MAAMD,EAAE1Q,EAAE,mBAAmB2Q,CAAC,EAAEG,EAAc,OAAOJ,EAAE,WAArB,WAA+B,CAAC,cAAcA,EAAE,SAAS,EAAWA,EAAE,WAAW,gBAAtB,OAAoCA,EAAE,UAAUW,GAAE,KAAK,KAAKV,EAAE,KAAKA,CAAC,EAAEG,EAAE,cAAcnC,EAAE+B,EAAE,IAAI,EAAE,KAAK,KAAK,IAAI,CAAC,CAAC,cAAcA,EAAE/B,EAAE3O,EAAE,CAAC,GAAY0Q,IAAT,OAAW,CAAC,GAAG1Q,IAAI,KAAK,YAAY,mBAAmB0Q,CAAC,EAAE,EAAE1Q,EAAE,YAAYP,IAAG,KAAKiR,CAAC,EAAE/B,CAAC,EAAE,OAAO,KAAK,EAAE+B,EAAE/B,EAAE3O,CAAC,CAAC,CAAM,KAAK,kBAAV,KAA4B,KAAK,KAAK,KAAK,KAAI,EAAG,CAAC,EAAE0Q,EAAE/B,EAAE3O,EAAE,CAAC,KAAK,KAAK,IAAI0Q,CAAC,GAAG,KAAK,KAAK,IAAIA,EAAE/B,CAAC,EAAO3O,EAAE,UAAP,IAAgB,KAAK,OAAO0Q,IAAI,KAAK,OAAO,IAAI,KAAK,IAAIA,CAAC,CAAC,CAAC,MAAM,MAAM,CAAC,KAAK,gBAAgB,GAAG,GAAG,CAAC,MAAM,KAAK,IAAI,OAAO,EAAE,CAAC,QAAQ,OAAO,CAAC,CAAC,CAAC,MAAMA,EAAE,KAAK,eAAc,EAAG,OAAaA,GAAN,MAAS,MAAMA,EAAE,CAAC,KAAK,eAAe,CAAC,gBAAgB,CAAC,OAAO,KAAK,cAAa,CAAE,CAAC,eAAe,CAAC,GAAG,CAAC,KAAK,gBAAgB,OAAO,GAAG,CAAC,KAAK,WAAW,CAAC,GAAG,KAAK,aAAa,KAAK,iBAAkB,EAAC,KAAK,KAAK,CAAC,SAAS,CAACA,EAAE/B,CAAC,IAAI,KAAK,KAAK,KAAK+B,CAAC,EAAE/B,EAAE,KAAK,KAAK,MAAM,CAAC,MAAM+B,EAAE,KAAK,YAAY,kBAAkB,GAAGA,EAAE,KAAK,EAAE,SAAS,CAAC/B,EAAE3O,CAAC,IAAI0Q,EAAO1Q,EAAE,UAAP,IAAgB,KAAK,KAAK,IAAI2O,CAAC,GAAY,KAAKA,CAAC,IAAf,QAAkB,KAAK,EAAEA,EAAE,KAAKA,CAAC,EAAE3O,CAAC,CAAC,CAAC,IAAI0Q,EAAE,GAAG,MAAM/B,EAAE,KAAK,KAAK,GAAG,CAAC+B,EAAE,KAAK,aAAa/B,CAAC,EAAE+B,GAAG,KAAK,WAAW/B,CAAC,EAAE,KAAK,MAAM,QAAS+B,GAAGA,EAAE,aAAc,CAAA,EAAG,KAAK,OAAO/B,CAAC,GAAG,KAAK,KAAI,CAAE,OAAOA,EAAE,CAAC,MAAM+B,EAAE,GAAG,KAAK,KAAI,EAAG/B,CAAC,CAAC+B,GAAG,KAAK,KAAK/B,CAAC,CAAC,CAAC,WAAW+B,EAAE,CAAE,CAAA,KAAKA,EAAE,CAAC,KAAK,MAAM,QAAS,GAAG,EAAE,cAAe,CAAA,EAAG,KAAK,aAAa,KAAK,WAAW,GAAG,KAAK,aAAaA,CAAC,GAAG,KAAK,QAAQA,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,KAAK,IAAI,IAAI,KAAK,gBAAgB,EAAE,CAAC,IAAI,gBAAgB,CAAC,OAAO,KAAK,kBAAiB,CAAE,CAAC,mBAAmB,CAAC,OAAO,KAAK,IAAI,CAAC,aAAaA,EAAE,CAAC,MAAM,EAAE,CAAC,OAAOA,EAAE,CAAC,KAAK,OAAO,KAAK,KAAK,QAAS,GAAG,KAAK,KAAK,EAAE,KAAK,CAAC,CAAC,CAAG,EAAC,KAAK,KAAI,CAAE,CAAC,QAAQA,EAAE,CAAA,CAAE,aAAaA,EAAE,CAAA,CAAE,CAACjN,GAAE,cAAc,CAAA,EAAGA,GAAE,kBAAkB,CAAC,KAAK,MAAM,EAAEA,GAAE2N,GAAE,mBAAmB,CAAC,EAAE,IAAI,IAAI3N,GAAE2N,GAAE,WAAW,CAAC,EAAE,IAAI,IAAID,KAAI,CAAC,gBAAgB1N,EAAC,CAAC,GAAGtD,GAAE,0BAA0B,CAAA,GAAI,KAAK,OAAO,ECJx7K;AAAA;AAAA;AAAA;AAAA,GAIG,IAAAmR,EAAA,cAAgBZ,EAAC,CAAC,aAAa,CAAC,MAAM,GAAG,SAAS,EAAE,KAAK,cAAc,CAAC,KAAK,IAAI,EAAE,KAAK,KAAK,MAAM,CAAC,kBAAkB,CAAC,MAAMA,EAAE,MAAM,iBAAkB,EAAC,OAAO,KAAK,cAAc,eAAeA,EAAE,WAAWA,CAAC,CAAC,OAAOA,EAAE,CAAC,MAAM1Q,EAAE,KAAK,OAAQ,EAAC,KAAK,aAAa,KAAK,cAAc,YAAY,KAAK,aAAa,MAAM,OAAO0Q,CAAC,EAAE,KAAK,KAAKC,GAAE3Q,EAAE,KAAK,WAAW,KAAK,aAAa,CAAC,CAAC,mBAAmB,CAAC,MAAM,oBAAoB,KAAK,MAAM,aAAa,EAAE,CAAC,CAAC,sBAAsB,CAAC,MAAM,qBAAoB,EAAG,KAAK,MAAM,aAAa,EAAE,CAAC,CAAC,QAAQ,CAAC,OAAOA,EAAC,CAAC,EAAC2O,EAAE,cAAc,GAAGA,EAAe,UAAc,GAAG,WAAW,2BAA2B,CAAC,WAAWA,CAAC,CAAC,EAAE,MAAMmC,GAAE,WAAW,0BAA0BA,KAAI,CAAC,WAAWnC,CAAC,CAAC,GAAwD,WAAW,qBAAqB,IAAI,KAAK,OAAO,ECLrzB;AAAA;AAAA;AAAA;AAAA,GAKK,MAAC+B,GAAEA,GAAG,CAAC,EAAEE,IAAI,CAAUA,IAAT,OAAWA,EAAE,eAAgB,IAAI,CAAC,eAAe,OAAOF,EAAE,CAAC,CAAC,CAAG,EAAC,eAAe,OAAOA,EAAE,CAAC,CAAC,ECJ7G;AAAA;AAAA;AAAA;AAAA,GAIG,MAAME,GAAE,CAAC,UAAU,GAAG,KAAK,OAAO,UAAUF,GAAE,QAAQ,GAAG,WAAWC,EAAC,EAAEG,GAAE,CAACJ,EAAEE,GAAE,EAAEE,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,SAAS,CAAC,EAAEA,EAAE,IAAInC,EAAE,WAAW,oBAAoB,IAAI,CAAC,EAAE,GAAYA,IAAT,QAAY,WAAW,oBAAoB,IAAI,EAAEA,EAAE,IAAI,GAAG,EAAEA,EAAE,IAAImC,EAAE,KAAKJ,CAAC,EAAe,IAAb,WAAe,CAAC,KAAK,CAAC,KAAK,CAAC,EAAEI,EAAE,MAAM,CAAC,IAAIA,EAAE,CAAC,MAAMC,EAAE,EAAE,IAAI,KAAK,IAAI,EAAE,EAAE,IAAI,KAAK,KAAKD,CAAC,EAAE,KAAK,cAAc,EAAEC,EAAEL,CAAC,CAAC,EAAE,KAAKC,EAAE,CAAC,OAAgBA,IAAT,QAAY,KAAK,EAAE,EAAE,OAAOD,CAAC,EAAEC,CAAC,CAAC,CAAC,CAAC,GAAc,IAAX,SAAa,CAAC,KAAK,CAAC,KAAK,CAAC,EAAEG,EAAE,OAAO,SAASA,EAAE,CAAC,MAAMC,EAAE,KAAK,CAAC,EAAE,EAAE,KAAK,KAAKD,CAAC,EAAE,KAAK,cAAc,EAAEC,EAAEL,CAAC,CAAC,CAAC,CAAC,MAAM,MAAM,mCAAmC,CAAC,CAAC,EAAE,SAASK,EAAEL,EAAE,CAAC,MAAM,CAAC,EAAEE,IAAc,OAAOA,GAAjB,SAAmBE,GAAEJ,EAAE,EAAEE,CAAC,GAAG,CAACF,EAAEC,EAAEC,IAAI,CAAC,MAAME,EAAEH,EAAE,eAAeC,CAAC,EAAE,OAAOD,EAAE,YAAY,eAAeC,EAAEE,EAAE,CAAC,GAAGJ,EAAE,QAAQ,EAAE,EAAEA,CAAC,EAAEI,EAAE,OAAO,yBAAyBH,EAAEC,CAAC,EAAE,MAAM,GAAGF,EAAE,EAAEE,CAAC,CAAC,CCJvwB;AAAA;AAAA;AAAA;AAAA,GAIG,SAASE,GAAEA,EAAE,CAAC,OAAOJ,EAAE,CAAC,GAAGI,EAAE,MAAM,GAAG,UAAU,EAAE,CAAC,CAAC,CCLvD;AAAA;AAAA;AAAA;AAAA,GAKK,MAACH,GAAE,CAACA,EAAED,EAAE/P,KAAKA,EAAE,aAAa,GAAGA,EAAE,WAAW,GAAG,QAAQ,UAAoB,OAAO+P,GAAjB,UAAoB,OAAO,eAAeC,EAAED,EAAE/P,CAAC,EAAEA,GCJvH;AAAA;AAAA;AAAA;AAAA,GAIG,SAASgQ,GAAEA,EAAEG,EAAE,CAAC,MAAM,CAACC,EAAEpC,EAAE,IAAI,CAAC,MAAMiC,EAAEF,GAAGA,EAAE,YAAY,cAAcC,CAAC,GAAG,KAAK,GAAGG,EAAE,CAAC,KAAK,CAAC,IAAIH,EAAE,IAAIG,CAAC,EAAY,OAAOnC,GAAjB,SAAmBoC,EAAE,IAAI,IAAI,CAAC,MAAML,EAAE,OAAM,EAAG,MAAM,CAAC,KAAK,CAAC,OAAO,KAAKA,CAAC,CAAC,EAAE,IAAIC,EAAE,CAAC,KAAKD,CAAC,EAAEC,CAAC,CAAC,CAAC,GAAC,EAAI,OAAOD,GAAEK,EAAEpC,EAAE,CAAC,KAAK,CAAC,IAAI+B,EAAEC,EAAE,KAAK,IAAI,EAAE,OAAgBD,IAAT,SAAaA,EAAEE,EAAE,IAAI,GAAUF,IAAP,MAAU,KAAK,aAAaI,EAAE,KAAK,KAAKJ,CAAC,GAAGA,CAAC,CAAC,CAAC,CAAC,CAAC,OAAOA,GAAEK,EAAEpC,EAAE,CAAC,KAAK,CAAC,OAAOiC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CCJ5W;AAAA;AAAA;AAAA;AAAA,GAKA,SAASE,GAAEA,EAAE,CAAC,MAAM,CAACC,EAAEJ,IAAID,GAAEK,EAAEJ,EAAE,CAAC,MAAM,KAAK,CAAC,OAAO,MAAM,KAAK,eAAe,KAAK,YAAY,cAAcG,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CCNzH;AAAA;AAAA;AAAA;AAAA,GAKK,MAACJ,GAAE,CAAC,UAAU,EAAE,MAAM,EAAE,SAAS,EAAE,kBAAkB,EAAE,MAAM,EAAE,QAAQ,CAAC,EAAEC,GAAED,GAAG,IAAI,KAAK,CAAC,gBAAgBA,EAAE,OAAO,CAAC,GAAC,IAAAa,GAAE,KAAO,CAAC,YAAYb,EAAE,CAAA,CAAE,IAAI,MAAM,CAAC,OAAO,KAAK,KAAK,IAAI,CAAC,KAAKA,EAAEC,EAAE3Q,EAAE,CAAC,KAAK,KAAK0Q,EAAE,KAAK,KAAKC,EAAE,KAAK,KAAK3Q,CAAC,CAAC,KAAK0Q,EAAEC,EAAE,CAAC,OAAO,KAAK,OAAOD,EAAEC,CAAC,CAAC,CAAC,OAAOD,EAAEC,EAAE,CAAC,OAAO,KAAK,OAAO,GAAGA,CAAC,CAAC,CAAC,ECJ3S;AAAA;AAAA;AAAA;AAAA,GAIQ,MAACI,GAAE,YAAY/Q,GAAE,KAAK+Q,GAAEH,GAAED,GAAE,cAAcG,EAAC,CAAC,YAAYJ,EAAE,CAAC,GAAG,MAAMA,CAAC,EAAEA,EAAE,OAAO/B,GAAE,WAAqB+B,EAAE,OAAZ,SAAkBA,EAAE,SAAS,OAAO,EAAE,MAAM,MAAM,4GAA4G,CAAC,CAAC,OAAOA,EAAE,CAAC,OAAO,OAAO,KAAKA,CAAC,EAAE,OAAQ,CAAC,EAAEI,IAAI,CAAC,MAAMnC,EAAE+B,EAAEI,CAAC,EAAE,OAAanC,GAAN,KAAQ,EAAE,EAAE,GAAGmC,EAAEA,EAAE,SAAS,GAAG,EAAEA,EAAEA,EAAE,QAAQ,oCAAoC,KAAK,EAAE,YAAW,CAAE,IAAInC,CAAC,GAAG,EAAG,EAAE,CAAC,CAAC,OAAOgC,EAAE,CAACG,CAAC,EAAE,CAAC,KAAK,CAAC,MAAMnC,CAAC,EAAEgC,EAAE,QAAQ,GAAY,KAAK,KAAd,OAAiB,OAAO,KAAK,GAAG,IAAI,IAAI,OAAO,KAAKG,CAAC,CAAC,EAAE,KAAK,OAAOA,CAAC,EAAE,UAAUJ,KAAK,KAAK,GAASI,EAAEJ,CAAC,GAAT,OAAa,KAAK,GAAG,OAAOA,CAAC,EAAEA,EAAE,SAAS,GAAG,EAAE/B,EAAE,eAAe+B,CAAC,EAAE/B,EAAE+B,CAAC,EAAE,MAAM,UAAUA,KAAKI,EAAE,CAAC,MAAMH,EAAEG,EAAEJ,CAAC,EAAE,GAASC,GAAN,KAAQ,CAAC,KAAK,GAAG,IAAID,CAAC,EAAE,MAAM,EAAY,OAAOC,GAAjB,UAAoBA,EAAE,SAAS3Q,EAAC,EAAE0Q,EAAE,SAAS,GAAG,GAAG,EAAE/B,EAAE,YAAY+B,EAAE,EAAEC,EAAE,MAAM,EAAE,GAAG,EAAEA,EAAE,EAAEI,GAAE,EAAE,EAAEpC,EAAE+B,CAAC,EAAEC,CAAC,CAAC,CAAC,OAAOD,EAAC,CAAC,CAAC,ECL1zBc,GAAmB,IAEnBC,GAAwB,IAExBC,GAAmB,cCEzB,SAASC,GAEdC,EAAgD,CAChD,MAAMC,EAAKD,EAAO,YAElB,GAAI,CAACC,EACG,MAAA,IAAI,MAAM,+BAA+B,EAG3C,MAAAC,EAAOD,EAAG,cAEhB,OACGC,aAAgB,UAAYA,aAAgB,aAC7C,iBAAkBA,EAEXA,EAGFD,EAAG,aACZ,CAEO,SAASE,GAA0BC,EAAgC,CACxE,MAAMC,EAAcD,EAAQ,QAC1B,IAAIN,EAAgB,GAAA,EAEtB1N,EAAaiO,EAAa,iCAAiC,EAC3D,MAAMC,EAAeD,EAAY,aACjC,OAAAjO,EACEkO,EACA,oDAAA,EAEKA,CACT,sMC5Ba,IAAAC,GAAN,cAEGC,CAAW,CAFd,aAAA,CAAA,MAAA,GAAA,SAAA,EAImB,KAAA,MAAA,CACtB,OAAQZ,EAAA,CACV,CAKS,QAAS,CACV,MAAAU,EAAeH,GAA0B,IAAI,EAC7CM,EAAoBH,EAAa,iBAAiB,kBAGxD,GADgBA,EAAa,QAAQ,KAAK,KAAK,EAClC,CACX,GAAI,KAAK,MAAM,OAAO,SAAW,EAC/B,MAAM,IAAI,MAAM;AAAA;AAAA;AAAA,wBAGA,EAGX,OAAAtN;AAAAA;AAAAA;AAAAA;AAAAA,gBAIG0N,GAAS,CAAE,WAAY,MAAQ,CAAA,CAAC;AAAA,WACrCD,EAAkB,KAAK,MAAO,KAAK,QAAQ,CAAC;AAAA,QAEnD,CAIO,OAAAzN;AAAAA,SACFyN,EAAkB,KAAK,MAAO,KAAK,QAAQ,CAAC;AAAA,MAEnD,CAES,kBAAmB,CACnB,OAAA,IACT,CACF,EAvCEE,GAAA,CADCC,EAAS,CAAE,KAAM,OAAQ,CAAA,EAHfL,GAIX,UAAA,QAAA,CAAA,EAKAI,GAAA,CADCC,EAAS,CAAE,UAAW,GAAO,CAAA,EARnBL,GASX,UAAA,WAAA,CAAA,EATWA,GAANI,GAAA,CADNE,GAAc,WAAW,CAAA,EACbN,EAAA,ECPN,MAAMO,GAAW9N;AAAAA;AAAAA,UAEd0N,GAAS,CACf,WAAY,OACZ,QAAS,UACT,QAAS,MACX,CAAC,CAAC;AAAA;AAAA,+MCES,IAAAK,GAAN,cAAoBP,CAAW,CAA/B,aAAA,CAAA,MAAA,GAAA,SAAA,EAEL,KAAA,SAA+C,EAAC,CAEhD,IAAI,WAAY,CACd,OAAO,MAAM,KAAK,KAAK,iBAAiB,WAAW,CAAC,CACtD,CAEA,IAAI,QAAS,CACX,OAAO,MAAM,KAAK,KAAK,iBAAiB,QAAQ,CAAC,CACnD,CAEA,IAAI,YAAa,CACR,OAAA,KAAK,UAAU,OAAO,CAACQ,EAAKf,IAAOe,EAAMf,EAAG,MAAM,OAAO,OAAQ,CAAC,CAC3E,CAEA,IAAa,aAAc,CAClB,OAAA,KAAK,UAAU,OAAO,CAACe,EAAKf,IAAOe,EAAMf,EAAG,MAAM,OAAQ,EAAE,CACrE,CAEA,MAAe,mBAAoB,CAC3B,MAAAnR,EAAS,MAAM,MAAM,oBACrB,aAAA,QAAQ,IAAI,KAAK,UAAU,IAAUmR,GAAAA,EAAG,cAAc,CAAC,EACvD,MAAA,QAAQ,IAAI,KAAK,OAAO,IAAUA,GAAAA,EAAG,cAAc,CAAC,EACnDnR,CACT,CAEmB,cAAqB,CACtC,KAAK,MAAM,QAAU,OACvB,CAES,QAAS,CACZ,GAAA,KAAK,SAAS,SAAW,EAC3B,OAAOkE,sBAAyB4M,EAAgB,mBAGlD,GAAI,CAAC,KAAK,YAAa,OAEvB,MAAMS,EAAc,KAAK,QACvB,IAAIP,EAAgB,GAAA,EAEtB1N,EAAaiO,EAAa,gCAAgC,EAC1D,MAAMC,EAAeD,EAAY,aACjCjO,EACEkO,EACA,mDAAA,EAGI,MAAAW,EAAiB,KAAK,SAAS,QAAQ,CAAC,CAACC,EAAUC,CAAK,EAAG3S,IAAU,CACrE,GAAA8R,EAAa,QAAQa,CAAK,EAAG,CAC3B,GAAAA,EAAM,OAAO,SAAW,EAC1B,MAAM,IAAI,MAAM;AAAA;AAAA;AAAA,0BAGA,EAGlB,GAAI3S,IAAU,EAAG,CACf,MAAM4S,EAAY,KAAK,SAAS5S,EAAQ,CAAC,IAAI,CAAC,EAC9C,MAAI,CAAC4S,GAAad,EAAa,QAAQc,CAAS,EACvC,CAACN,GAAUI,EAAUJ,EAAQ,EAE7B,CAACA,GAAUI,CAAQ,CAC5B,KACK,CACL,MAAME,EAAY,KAAK,SAAS5S,EAAQ,CAAC,IAAI,CAAC,EAC9C,MAAI,CAAC4S,GAAad,EAAa,QAAQc,CAAS,EACvC,CAACF,EAAUJ,EAAQ,EAEnB,CAACI,CAAQ,CAEpB,CACF,CACO,OAAAA,CAAA,CACR,EAID,OAAOlO,eAAkB0N,GAAS,CAGhC,QAAS,SACV,CAAA,CAAC,IAAIO,CAAc,QACtB,CAES,kBAAmB,CACnB,OAAA,IACT,CACF,EAtFEN,GAAA,CADCC,EAAS,CAAE,UAAW,GAAO,CAAA,EADnBG,GAEX,UAAA,WAAA,CAAA,EAFWA,GAANJ,GAAA,CADNE,GAAc,QAAQ,CAAA,EACVE,EAAA,uMCJA,IAAAM,GAAN,cAAoBb,CAAW,CAA/B,aAAA,CAAA,MAAA,GAAA,SAAA,EAES,KAAA,IAAAZ,GAGM,KAAA,OAAA,CAClB,YAAa,aACb,cAAe,cAAA,CACjB,CAES,QAAS,CAGhB,OAAO5M,gBAAmB0N,GAAS,KAAK,MAAM,CAAC;AAAA,SAC1C,KAAK,GAAG;AAAA,MAEf,CAES,kBAAmB,CACnB,OAAA,IACT,CACF,EAnBEC,GAAA,CADCC,EAAS,CAAE,UAAW,GAAO,CAAA,EADnBS,GAEX,UAAA,MAAA,CAAA,EAGAV,GAAA,CADCC,EAAS,CAAE,UAAW,GAAO,CAAA,EAJnBS,GAKX,UAAA,SAAA,CAAA,EALWA,GAANV,GAAA,CADNE,GAAc,QAAQ,CAAA,EACVQ,EAAA,ECkBN,MAAMC,EAA6D,CACxE,YACkBtB,EACAuB,EAOZ,GACJ,CATgB,KAAA,OAAAvB,EACA,KAAA,MAAAuB,CAQf,CACL,CC/BA,SAASC,GACPC,EAC6B,CAC7B,IAAIC,EAAkB,GAClBD,EAAM,YACWC,GAAA,aAEjBD,EAAM,SACWC,GAAA,iBAGrB,IAAIC,EAAkB,CAAA,EACtB,OAAIF,EAAM,OACUE,EAAA,CAChB,cACE,sFACF,cAAe,SACf,WAAY,yBACZ,MAAO,UACP,gBAAiB,MACjB,YAAa,MACb,QAAS,aAAA,GAINjB,GAAS,CACd,YAAa,aACb,cAAe,eACf,cAAee,EAAM,KAAO,OAAS,SACrC,aAAcA,EAAM,OAAS,SAAW,SACxC,kBAAmBC,EAAgB,OAAS,EAAIA,EAAkB,OAClE,GAAGC,CAAA,CACJ,CACH,CAEa,MAAAC,GACX,IACST,GAAA,CACD,MAAAU,EAAQV,EAAM,WAChBK,GAAiBL,EAAM,UAAU,EACjCT,GAAS,CAAA,CAAE,EACf,OAAO1N,gBAAmB6O,CAAK;AAAA,sBACbV,EAAM,MAAM;AAAA,aAEhC,EChDWW,GAAqBnG,EAAE,OAAO,CACzC,KAAMA,EAAE,QAAQ,EAAI,EAAE,SAAW,EAAA,SAAW,EAAA,MAAM,MAAS,EAC3D,OAAQA,EAAE,QAAQ,EAAI,EAAE,SAAW,EAAA,SAAW,EAAA,MAAM,MAAS,EAC7D,UAAWA,EAAE,QAAQ,EAAI,EAAE,SAAW,EAAA,SAAW,EAAA,MAAM,MAAS,EAChE,OAAQA,EAAE,QAAQ,EAAI,EAAE,SAAW,EAAA,SAAW,EAAA,MAAM,MAAS,EAC7D,KAAMA,EAAE,QAAQ,EAAI,EAAE,SAAW,EAAA,SAAW,EAAA,MAAM,MAAS,EAC3D,KAAMA,EAAE,SAAS,SAAW,EAAA,SAAW,EAAA,MAAM,MAAS,CACxD,CAAC,ECNM,SAASoG,GACdZ,EACwC,CACxC,MAAMrS,EAAiD,CAAA,EAEvD,IAAIkT,EAAYb,EAAM,OACf,KAAAa,EAAU,OAAS,GAAG,CACrB,MAAAxT,EAAQwT,EAAU,QAAQ;AAAA,CAAI,EACpC,GAAIxT,IAAU,GAAI,CAChBM,EAAO,KAAK,CACV,OAAQkT,EACR,WAAYb,EAAM,UAAA,CACnB,EACD,KACF,CAEIa,EAAU,MAAM,EAAGxT,CAAK,EAAE,OAAS,GACrCM,EAAO,KAAK,CACV,OAAQkT,EAAU,MAAM,EAAGxT,CAAK,EAChC,WAAY2S,EAAM,UAAA,CACnB,EAGHrS,EAAO,KAAK;AAAA,CAAI,EACJkT,EAAAA,EAAU,MAAMxT,EAAQ,CAAC,CACvC,CAEO,OAAAM,CACT,CAKO,SAASmT,GACdd,EACiC,CAC7B,GAAAA,EAAM,SAAW,EACZ,MAAA,CAAC,CAAE,CAAA,EAGN,MAAAe,EAAmBf,EAAM,QAAQY,EAAc,EAErD,SAAUI,EAAgBC,EAA6C,CACrE,IAAIzI,EAAQ,EACZ,QAASvL,EAAI,EAAGA,EAAIgU,EAAI,OAAQhU,IAC1B,GAAAgU,EAAIhU,CAAC,IAAM;AAAA,EAAM,CACnB,MAAMiU,EAAQD,EAAI,MAAMzI,EAAOvL,CAAC,EAChCuL,EAAQvL,EAAI,EACN,MAAAiU,CACG,MAAAjU,IAAMgU,EAAI,OAAS,IACtB,MAAAA,EAAI,MAAMzI,CAAK,GAIrByI,EAAI,GAAG,EAAE,IAAM;AAAA,IACjB,KAAM,GAEV,CAEA,OAAO,MAAM,KAAKD,EAAgBD,CAAgB,CAAC,CACrD,CC1DO,SAASI,GAAiBjI,EAAqB,CACpD,OAAIA,aAAgB,QACdA,aAAgBkG,GACXlG,EAAK,cAAc,uBAAuB,IAAM,KAGlD,CAAC,CADSA,EAAK,QAAQ,uBAAuB,EAI9C,CAAC,CADSA,EAAK,eAAe,QAAQ,uBAAuB,CAGxE,CAkBgB,SAAAkI,GAGdvC,EACAwC,EAC+B,CAI/B,MAAM1T,EAAwC,CAAA,EAC9C,UAAWqS,KAASqB,EACd,GAAAxC,EAAO,QAAQmB,CAAK,EAAG,CACzB,MAAMsB,EAAgB,CAAC,GAAGtB,EAAM,MAAM,EAAE,IAAkBuB,IAAA,CACxD,OAAQA,EACR,WAAYvB,EAAM,UAClB,EAAA,EACKrS,EAAA,KAAK,GAAG2T,CAAa,CAAA,MAE5B3T,EAAO,KAAKqS,CAAK,EAGd,OAAArS,CACT,CCtDO,SAAS6T,GAAoB9P,EAA6B,CAC/D,OAAOA,aAAgB,MAAQA,EAAK,eAAe,QAAQ,QAAU,MACvE,CAEO,SAAS+P,GAAWxC,EAA0C,CACnE,OACEA,aAAmB,cAClBA,EAAQ,QAAQ,WAAa,QAAUA,aAAmBG,GAE/D,CAEO,SAASsC,GAAQzC,EAA0C,CAChE,OACEA,aAAmB,cAClBA,aAAmBW,IAASX,EAAQ,yBAAyBW,GAElE,CAEO,SAAS+B,GAAa1C,EAA0C,CACrE,OAAOA,aAAmB,aAAeA,EAAQ,QAAQ,QAAU,MACrE,CChBA,MAAM2C,GAAqBC,IAAUC,GAAS,UAAY,UAE7CC,GAA2B,GAC3BC,GAAyB,GA6BtB,SAAAC,GACd9C,EACAjJ,EAC8B,CAC9B,MAAMgM,EAAkD,CAAA,EAExD,SAASrM,EAAUsM,EAA2C,CAC5D,OAAIA,EAAQ,WACFA,EAAAP,EAAkB,EAAIO,EAAQ,SACtC,OAAOA,EAAQ,UAEVA,CACT,CAES,SAAAC,EAASC,EAAoBF,EAA0B,CAC9D,MACG,CAAC,SAAU,UAAW,UAAW,UAAU,EAAY,KACtD/N,GAAO,OAAO,OAAO+N,EAAS/N,CAAG,GAAK+N,EAAQ/N,CAAG,IAAMiO,EAAIjO,CAAG,CAAA,EAGzD,GAEF+N,EAAQ,MAAQE,EAAI,GAC7B,CAEA,SAASC,EAAWC,EAA6B,CACzC,MAAAJ,EAAUtM,EAAU0M,CAAU,GACvB,MAAM,QAAQJ,EAAQ,GAAG,EAAIA,EAAQ,IAAM,CAACA,EAAQ,GAAG,GAC/D,QAAe/N,GAAA,CAClB,MAAMoO,EAAgB,CACpB,GAAGL,EACH,IAAA/N,CAAA,EAEF8N,EAAa9N,CAAG,EAAI8N,EAAa9N,CAAG,GAAK,CAAA,EAC5B8N,EAAA9N,CAAG,EAAE,KAAKoO,CAAa,CAAA,CACrC,CACH,CAEA,OAAO,OAAOtM,CAAQ,EAAE,QAAmBiM,GAAA,CACzCG,EAAWH,CAAO,CAAA,CACnB,EAED,SAASM,EAAeJ,EAAoB,CACtC,GAAAA,EAAI,kBAAoBA,EAAI,YAAa,OAG7C,MAAMK,GAFcR,EAAaG,EAAI,GAAG,GAAK,CAAA,GAEd,UAAkBD,EAASC,EAAKF,CAAO,CAAC,EACvE,GAAIO,EAAW,SAAW,EAAG,OAEvB,MAAAC,EAAcxD,EAAa,iBACjC,GAAI,CAACwD,EAAa,OAElB,KAAM,CAACC,EAAWC,CAAW,EAAI1D,EAAa,aAC5CwD,EAAY,KAAA,EAER,CAACG,EAASC,CAAS,EACvBJ,EAAY,SAAW,EACnB,CAACC,EAAWC,CAAW,EACvB1D,EAAa,aAAawD,EAAY,MAAQA,EAAY,MAAM,EAChEK,EAAaJ,EAAU,YACzBA,EAAU,YAAY,MAAM,EAAGC,CAAW,EAC1C,GACEI,EAAaH,EAAQ,YACvBA,EAAQ,YAAY,MAAMC,CAAS,EACnC,GACEG,EAAsC,CAC1C,YAAAP,EACA,aAAAxD,EACA,UAAWwD,EAAY,SAAW,EAClC,WAAAK,EACA,WAAAC,EACA,IAAKZ,CAAA,EAEWK,EAAW,KAAgBP,GACvCA,EAAQ,QAAU,CAACA,EAAQ,OAAO,KAAKe,EAAY,UAAU,GAG7Df,EAAQ,QAAU,CAACA,EAAQ,OAAO,KAAKe,EAAY,UAAU,EACxD,GAEFf,EAAQ,QAAQe,CAAW,IAAMnB,EACzC,GAECM,EAAI,eAAe,CAEvB,CAEO,OAAAI,CACT,CC5HO,SAASU,GAAoBzR,EAAoB,CAClD,OAAAA,EAAK,YAAc+M,GACd,EAEA/M,EAAK,UAAU,MAE1B,CAEO,SAAS0R,EAAwBnE,EAA0B,CAgBzD,OAfkB,MAAM,KAC7BA,EAAQ,iBAAiB,sBAAsB,CAAA,EAEd,IAAuBoE,GAAA,CACxD,MAAMC,EAAW,MAAM,KAAKD,EAAgB,UAAU,EAAE,KACrDnK,GAAuBA,aAAgB,IAAA,EAG1C,GAAI,CAACoK,EACG,MAAA,IAAI,MAAM,qBAAqB,EAGhC,OAAAA,CAAA,CACR,CAGH,CChBgB,SAAAC,GACdrK,EACAsK,EACkB,CACd,GAAAhC,GAAoBtI,CAAI,EACnB,MAAA,CAACA,EAAMsK,CAAM,EAGlB,GAAA/B,GAAWvI,CAAI,EAAG,CACd,MAAAuK,EAAQL,EAAwBlK,CAAI,EACtC,GAAAuK,EAAM,SAAW,EAAG,CACtB,MAAMC,EAAWD,EAAM,CAAC,EAAE,eAAe,QACvC,yBAAA,EAEF,GACEC,aAAoB,aACpBA,EAAS,QAAQ,SAAW,OAE5B,MAAO,CAACD,EAAM,CAAC,EAAG,CAAC,CAEvB,CACO,OAAAA,EAAMD,CAAM,EAAI,CAACC,EAAMD,CAAM,EAAG,CAAC,EAAI,IAC9C,CAEA,GAAI9B,GAAQxI,CAAI,GAAKyI,GAAazI,CAAI,EAC7B,OAAAyK,GAAuCzK,EAAMsK,EAAQ,EAAI,EAG9D,GAAA,EAAEtK,aAAgB,MACb,OAAA,KAGH,MAAA0K,EAASC,GAAkB3K,CAAI,EAErC,OAAI0K,EACKE,GAAuBF,EAAQ1K,EAAMsK,CAAM,EAG7C,IACT,CAEgB,SAAAO,GACdrS,EACA8R,EACAtE,EACiB,CACb,GAAAA,EAAY,QAAQ,QAAU,OAChC,MAAM,IAAI,MACR,+DAAA,EAIJ,GAAI,CAACA,EAAY,SAASxN,CAAI,EACrB,OAAA,KAGH,MAAA+R,EAAQL,EAAwBlE,CAAW,EAC3C8E,EAAYP,EAAM,QAAQ/R,CAAI,EACpC,IAAIrE,EAAQ,EACZ,UAAWqE,KAAQ+R,EAAM,MAAM,EAAGO,CAAS,EACzC3W,GAAS8V,GAAoBzR,CAAI,EAG/BA,EAAK,YAAc+M,KACZpR,GAAAmW,GAGX,MAAMS,EAAoBvS,EAAK,cAC/B,GAAI,CAACuS,EACG,MAAA,IAAI,MAAM,+BAA+B,EAG3C,MAAAC,EAAcD,EAAkB,QAAQ,QAAQ,EAEtD,GAAI,CAACC,EACG,MAAA,IAAI,MAAM,wBAAwB,EAG1C,MAAMC,EAAY,MAAM,KAAKjF,EAAY,iBAAiB,QAAQ,CAAC,EAAE,QACnEgF,CAAA,EAGF,MAAO,CAAE,KAAAxS,EAAM,MAAOrE,EAAQ8W,CAAU,CAC1C,CAEA,SAASN,GAAkB3K,EAAyC,CAClE,MAAMkL,EAAQlL,EAAK,eAAe,QAAQ,QAAQ,EAElD,GAAIkL,EACF,OAAO,MAAM,KAAKA,EAAM,iBAAiB,WAAW,CAAC,EAGvD,MAAMC,EACJnL,aAAgB,QACZA,EAAK,QAAQ,IAAIyF,EAAgB,GAAG,EACpCzF,EAAK,eAAe,QAAQ,IAAIyF,EAAgB,GAAG,EAEzD,OAAI0F,EACK,MAAM,KAAKA,EAAU,iBAAiB,QAAQ,CAAC,EAGjD,IACT,CAEA,SAASP,GACPF,EACA1K,EACAsK,EACkB,CACZ,MAAAc,EAAQV,EAAO,CAAC,EACtB,QAAS,EAAI,EAAG,EAAIA,EAAO,OAAQ,IAAK,CAChC,MAAAW,EAAQX,EAAO,CAAC,EAEtB,GAAI,IAAM,GAAKY,GAAatL,EAAMqL,CAAK,EAC9B,OAAAZ,GAAuCW,EAAOd,EAAQ,EAAI,EAG/D,GAAAiB,GAASvL,EAAMqL,CAAK,EACf,OAAAZ,GAAuCW,EAAOd,EAAQ,EAAK,EAOpE,GAJI,IAAMI,EAAO,OAAS,GAAKc,GAAaxL,EAAMqL,CAAK,GAKrD,EAAIX,EAAO,OAAS,GACpBc,GAAaxL,EAAMqL,CAAK,GACxBC,GAAatL,EAAM0K,EAAO,EAAI,CAAC,CAAC,EAEhC,OAAOe,GAA+BJ,CAAK,CAE/C,CAEO,OAAA,IACT,CAEA,SAASI,GAA+B1F,EAAoC,CACpE,MAAAwE,EAAQL,EAAwBnE,CAAO,EAC7C,GAAIwE,EAAM,SAAW,EAAU,OAAA,KAC/B,MAAM/R,EAAO+R,EAAMA,EAAM,OAAS,CAAC,EACnC,MAAO,CAAC/R,EAAMyR,GAAoBzR,CAAI,CAAC,CACzC,CAEA,SAASiS,GACP1E,EACAuE,EACAoB,EACkB,CACZ,MAAAnB,EAAQL,EAAwBnE,CAAO,EAC7C,GAAIwE,EAAM,SAAW,EAAU,OAAA,KACzB,MAAA/R,EAAOkT,EAAYnB,EAAM,CAAC,EAAIA,EAAMA,EAAM,OAAS,CAAC,EAC1D,MAAO,CAAC/R,EAAM8R,IAAW,EAAIA,EAAS9R,EAAK,MAAM,CACnD,CAEA,SAAS+S,GAASrX,EAASsD,EAAkB,CAC3C,OACEA,EAAE,wBAAwBtD,CAAC,IAAM,KAAK,gCACtCsD,EAAE,wBAAwBtD,CAAC,KACxB,KAAK,+BAAiC,KAAK,4BAElD,CAEA,SAASoX,GAAapX,EAASsD,EAAkB,CAC/C,OAAOtD,EAAE,wBAAwBsD,CAAC,IAAM,KAAK,2BAC/C,CAEA,SAASgU,GAAatX,EAASsD,EAAkB,CAC/C,OAAOtD,EAAE,wBAAwBsD,CAAC,IAAM,KAAK,2BAC/C,CCxJA,MAAMmU,GAAkC,CAAC,CACvC,YAAA3F,EACA,UAAA4F,EACA,QAAAC,CACF,IACS7F,EAAY,SAAS4F,CAAS,GAAK5F,EAAY,SAAS6F,CAAO,EAGlEC,GAAyC,CAAC,CAC9C,YAAA9F,EACA,UAAA4F,EACA,QAAAC,EACA,gBAAAE,EACA,cAAAC,CACF,IAAM,CACJ,MAAMC,EAAiBpB,GACrBe,EACAG,EACA/F,CAAA,EAEIkG,EAAgBrB,GACpBgB,EACAG,EACAhG,CAAA,EAGE,MAAA,CAACiG,GAAkB,CAACC,EACf,KAGF,CACL,MAAO,KAAK,IAAID,EAAe,MAAOC,EAAc,KAAK,EACzD,OAAQ,KAAK,IAAID,EAAe,MAAQC,EAAc,KAAK,CAAA,CAE/D,EAEMC,GAA6B,CAAC,CAAE,YAAAnG,EAAa,UAAA4F,EAAW,QAAAC,KACrD,CAAC7F,EAAY,SAAS4F,CAAS,GAAK5F,EAAY,SAAS6F,CAAO,EAGnEO,GAAoC,CAAC,CACzC,YAAApG,EACA,QAAA6F,EACA,cAAAG,CACF,IAAM,CACJ,MAAME,EAAgBrB,GACpBgB,EACAG,EACAhG,CAAA,EAGF,OAAKkG,EAIE,CACL,MAAO,EACP,OAAQA,EAAc,KAAA,EALf,IAOX,EAEMG,GAA8B,CAAC,CAAE,YAAArG,EAAa,UAAA4F,EAAW,QAAAC,KACtD7F,EAAY,SAAS4F,CAAS,GAAK,CAAC5F,EAAY,SAAS6F,CAAO,EAGnES,GAAqC,CAAC,CAC1C,MAAAC,EACA,YAAAvG,EACA,UAAA4F,EACA,gBAAAG,CACF,IAAM,CACJ,MAAMS,EAAgB3B,GACpBe,EACAG,EACA/F,CAAA,EAGF,OAAKwG,EAIE,CACL,MAAOA,EAAc,MACrB,OAAQD,EAAM,OAASC,EAAc,KAAA,EAL9B,IAOX,EAEMC,GAAoC,CAAC,CACzC,YAAAzG,EACA,UAAA4F,EACA,QAAAC,EACA,MAAA7M,CACF,IAEI,CAACgH,EAAY,SAAS4F,CAAS,GAC/B,CAAC5F,EAAY,SAAS6F,CAAO,GAC7B7M,EAAM,eAAegH,CAAW,EAI9B0G,GAA2C,CAAC,CAAE,MAAAH,MAC3C,CACL,MAAO,EACP,OAAQA,EAAM,MAAA,GAIZI,GAAe,CACnB3N,EACAgH,EACAuG,IACoC,CACpC,KAAM,CAAE,eAAAK,EAAgB,YAAAC,EAAa,aAAAC,EAAc,UAAAC,GAAc/N,EAE3DgO,EAAiB3C,GAAuBuC,EAAgBC,CAAW,EACnEI,EAAe5C,GAAuByC,EAAcC,CAAS,EAE/D,GAAA,CAACC,GAAkB,CAACC,EACf,OAAA,KAGH,KAAA,CAACrB,EAAWG,CAAe,EAAIiB,EAC/B,CAACnB,EAASG,CAAa,EAAIiB,EAE1B,MAAA,CACL,YAAAjH,EACA,MAAAhH,EACA,MAAAuN,EACA,UAAWK,EACX,YAAAC,EACA,QAASC,EACT,UAAAC,EACA,UAAAnB,EACA,gBAAAG,EACA,QAAAF,EACA,cAAAG,CAAA,CAEJ,EA4BgB,SAAAkB,GACdlO,EACAgH,EACAuG,EACoB,CACpB,MAAMxR,EAAU4R,GAAa3N,EAAOgH,EAAauG,CAAK,EAEtD,GAAI,CAACxR,EAAgB,OAAA,KAInB,GAAAA,EAAQ,WACRA,EAAQ,YAAcA,EAAQ,SAC9BkN,GAAiBlN,EAAQ,SAAS,EAClC,CACA,MAAMkR,EAAiBpB,GACrB9P,EAAQ,UACRA,EAAQ,gBACRiL,CAAA,EAGF,GAAIiG,EACK,MAAA,CACL,MAAOA,EAAe,MACtB,OAAQ,CAAA,CAGd,CAGI,OAAAN,GAAuB5Q,CAAO,EACzB+Q,GAA8B/Q,CAAO,EAI1CoR,GAAkBpR,CAAO,EACpBqR,GAAyBrR,CAAO,EAIrCsR,GAAmBtR,CAAO,EACrBuR,GAA0BvR,CAAO,EAItC0R,GAAyB1R,CAAO,EAC3B2R,GAAgC3R,CAAO,EAGzC,IACT,CAKgB,SAAAoS,GACdnH,EACAyD,EACc,CACd,MAAM2D,EAAe,MAAM,KAAKpH,EAAY,iBAAiB,QAAQ,CAAC,EAGtE,IAAI4F,EAAyB,KACzBC,EAAuB,KACvBwB,EAAe,EACfC,EAAc,EACdnZ,EAAQ,EAEZ,QAASJ,EAAI,EAAGA,EAAIqZ,EAAa,QAC3B,EAAAxB,GAAaC,GADsB9X,IAAK,CAK5C,MAAMwW,EAAQL,EAAwBkD,EAAarZ,CAAC,CAAC,EACrD,UAAWyE,KAAQ+R,EAAO,CAClB,MAAAgD,EAAatD,GAAoBzR,CAAI,EAc3C,GAZI,CAACoT,GAAazX,EAAQoZ,GAAc9D,EAAY,QACtCmC,EAAApT,EACZ6U,EAAe5D,EAAY,MAAQtV,GAGnC,CAAC0X,GACD1X,EAAQoZ,GAAc9D,EAAY,MAAQA,EAAY,SAE5CoC,EAAArT,EACI8U,EAAA7D,EAAY,MAAQA,EAAY,OAAStV,GAGrDyX,GAAaC,EACf,MAGO1X,GAAAoZ,CACX,CAGSpZ,GAAA,CACX,CAEI,GAAA,CAACyX,GAAa,CAACC,EACV,OAAA,KAGL,GAAA5D,GAAiB2D,CAAS,EAAG,CAC/B,MAAM4B,EAAiB5B,EAAU,eAAe,QAAQ,WAAW,EACnE,GAAI,CAAC4B,EACH,MAAM,IAAI,MACR,6DAAA,EAGJ,MAAMC,EAAcD,EAAe,mBACnC,GAAI,CAACC,EACG,MAAA,IAAI,MAAM,wDAAwD,EAGpE,MAAAlD,EAAQL,EAAwBuD,CAAW,EAC7CA,aAAuBvH,IACb0F,EAAArB,EAAMA,EAAM,OAAS,CAAC,EAClC8C,EAAepD,GAAoB2B,CAAS,IAG5CA,EAAYrB,EAAM,CAAC,EACJ8C,EAAA,EAEnB,CACI,GAAApF,GAAiB4D,CAAO,EAAG,CAC7B,MAAM6B,EAAgB7B,EAAQ,eAAe,QAAQ,WAAW,EAChE,GAAI,CAAC6B,EACH,MAAM,IAAI,MACR,6DAAA,EAGJ,MAAMD,EAAcC,EAAc,mBAClC,GAAI,CAACD,EACG,MAAA,IAAI,MAAM,wDAAwD,EAI1E5B,EADc3B,EAAwBuD,CAAW,EACjC,CAAC,EACHH,EAAA,CAChB,CAEM,MAAAtO,EAAQ,SAAS,cACjB,OAAAA,EAAA,SAAS4M,EAAWyB,CAAY,EAChCrO,EAAA,OAAO6M,EAASyB,CAAW,EAE1BtO,CACT,CChVgB,SAAA2O,GACd7G,EACA8G,EAGAC,EACmB,CACZ,OAAAlV;AAAAA,gBACOkV,CAAQ;AAAA,aACX,CACP,OAAQ/G,EAAM,OACd,WAAY8G,EAAgB9G,EAAM,UAAU,CAAA,CAC7C;AAAA,gBAEL,CCfA,SAASgH,GACPrE,EACAlT,EACAoP,EACAoI,EACA,CACKxX,IACEoP,EAAA,WAAW8D,EAAalT,EAAMwX,CAAU,EAC/CpI,EAAO,eAAe,CACpB,MAAO8D,EAAY,MAAQlT,EAAK,OAChC,OAAQ,CAAA,CACT,EACH,CAEA,SAASyX,GAAsBvE,EAA0B9D,EAAsB,CAC7EA,EAAO,gBAAgB8D,CAAW,EAClC9D,EAAO,eAAe,CACpB,MAAO8D,EAAY,MAAQ,EAC3B,OAAQ,CAAA,CACT,CACH,CAEA,SAASwE,GAAaxE,EAA0B9D,EAAsB,CACpEA,EAAO,WAAW8D,CAAW,EAC7B9D,EAAO,eAAe,CACpB,MAAO8D,EAAY,MACnB,OAAQ,CAAA,CACT,CACH,CAEO,SAASyE,GACdC,EACA5X,EACAwX,EACAtE,EACA9D,EACA,CACI,GAACA,EAAO,mBAAmB8D,CAAW,EAE1C,GAAI0E,IAAc,aACCL,GAAArE,EAAalT,EAAMoP,EAAQoI,CAAU,UAEtDI,IAAc,mBACdA,IAAc,kBAEdH,GAAsBvE,EAAa9D,CAAM,UAChCwI,EAAU,WAAW,QAAQ,EACtCF,GAAaxE,EAAa9D,CAAM,MAEhC,OAEJ,CC5CO,MAAMyI,EAA4D,CASvE,YAA4BzI,EAAsC,CAAtC,KAAA,OAAAA,EAR5B,KAAQ,OAAgC,KAExC,KAAQ,mBACN4B,KAEF,KAAQ,iBACNE,GAYF,KAAA,SAAY4G,GAAgC,CAC1C,KAAK,OAASA,CAAA,EAGhB,KAAA,WAAa,IAAY,CACvB,KAAK,OAAS,IAAA,EAGhB,KAAA,mBACEC,GACG,CACH,KAAK,iBAAmBA,CAAA,EAG1B,KAAA,qBAAwBC,GAAgD,CACtE,KAAK,mBAAqBA,CAAA,EAGhB,KAAA,UAAA,CAAC9E,EAA0B+E,EAAQ,KAA0B,CAQjE,MAAAC,EAPS,KAAK,OAAO,aACxB,uBAAuBhF,CAAW,EAClC,OACC,CAAC,CAAC1P,EAAG2U,CAAQ,IACXA,EAAS,MAAQA,EAAS,OAASjF,EAAY,OAC/CiF,EAAS,OAASjF,EAAY,MAAQA,EAAY,MAAA,EAErB,IAAI,CAAC,CAAC3C,CAAK,IAAMA,EAAM,UAAU,EACpE,OAAI0H,EACKC,EAAoB,OACzB,CAAC9H,EAAKgI,KAAS,CAAE,GAAGhI,EAAK,GAAGgI,CAAI,GAChC,CAAC,CAAA,EAIH,CAACF,EAAoB,QAErBA,EAAoB,KAAmBV,GAAA,CAACA,CAAU,EAE3C,GAEcU,EACD,OAAO,CAAC9H,EAAKgI,IAAQ,CACzC,MAAMC,EAAY,CAAA,EAClB,UAAW1T,KAAOyL,EAAK,CACrB,MAAMkI,EAAW3T,EAIbyL,EAAIkI,CAAQ,IAAMF,EAAIE,CAAQ,IAGtBD,EAAAC,CAAQ,EAAIlI,EAAIkI,CAAQ,EAEtC,CACO,OAAAD,CAAA,CACR,CAAA,EAGH,KAAA,oBAAuBE,GAAoC,CACzD,GAAI,CAACA,EACI,OAET,MAAMC,EAAkB,KAAK,iBAAiB,UAAUD,CAAc,EAClE,GAAA,CAACC,EAAgB,QAAS,CACpB,QAAA,MAAMA,EAAgB,KAAK,EAC5B,MACT,CACA,OAAO,OAAO,YAEZ,OAAO,QAAQA,EAAgB,IAAI,EAAE,OAAO,CAAC,CAAChV,EAAGiV,CAAC,IAAMA,GAAKA,IAAM,IAAI,CAAA,CACzE,CAhFiE,CAEnE,IAAI,OAAQ,CACV,OAAO,KAAK,MACd,CAEA,IAAI,mBAAoB,CACtB,OAAO,KAAK,kBACd,CA0EF,CCrGA;AAAA;AAAA;AAAA;AAAA,GAIO,KAAC,CAAC,EAAEvK,EAAC,EAAEE,GAA2ED,GAAE,CAACC,EAAEF,IAAaA,IAAT,OAAoBE,GAAG,aAAZ,OAAuBA,GAAG,aAAaF,EAAuFjR,GAAEmR,GAAYA,EAAE,UAAX,OAAmBjC,GAAE,IAAI,SAAS,cAAc,EAAE,EAAEmC,GAAE,CAACF,EAAE5Q,EAAE+Q,IAAI,CAAC,MAAMJ,EAAEC,EAAE,KAAK,WAAWM,EAAWlR,IAAT,OAAW4Q,EAAE,KAAK5Q,EAAE,KAAK,GAAY+Q,IAAT,OAAW,CAAC,MAAM/Q,EAAE2Q,EAAE,aAAahC,KAAIuC,CAAC,EAAEvQ,EAAEgQ,EAAE,aAAahC,GAAG,EAACuC,CAAC,EAAEH,EAAE,IAAIL,GAAE1Q,EAAEW,EAAEiQ,EAAEA,EAAE,OAAO,CAAC,KAAK,CAAC,MAAMF,EAAEK,EAAE,KAAK,YAAY/Q,EAAE+Q,EAAE,KAAKpQ,EAAEX,IAAI4Q,EAAE,GAAGjQ,EAAE,CAAC,IAAI+P,EAAEK,EAAE,OAAOH,CAAC,EAAEG,EAAE,KAAKH,EAAWG,EAAE,OAAX,SAAkBL,EAAEE,EAAE,QAAQ5Q,EAAE,MAAM+Q,EAAE,KAAKL,CAAC,CAAC,CAAC,GAAGA,IAAIQ,GAAGvQ,EAAE,CAAC,IAAIiQ,EAAEG,EAAE,KAAK,KAAKH,IAAIF,GAAG,CAAC,MAAMA,EAAEE,EAAE,YAAYD,EAAE,aAAaC,EAAEM,CAAC,EAAEN,EAAEF,CAAC,CAAC,CAAC,CAAC,OAAOK,CAAC,EAAEkK,GAAE,CAACrK,EAAEF,EAAE1Q,EAAE4Q,KAAKA,EAAE,KAAKF,EAAE1Q,CAAC,EAAE4Q,GAAGS,GAAE,CAAE,EAACxO,GAAE,CAAC+N,EAAEF,EAAEW,KAAIT,EAAE,KAAKF,EAAES,GAAEP,GAAGA,EAAE,KAAKK,GAAEL,GAAG,CAACA,EAAE,OAAO,GAAG,EAAE,EAAE,IAAIF,EAAEE,EAAE,KAAK,MAAM5Q,EAAE4Q,EAAE,KAAK,YAAY,KAAKF,IAAI1Q,GAAG,CAAC,MAAM4Q,EAAEF,EAAE,YAAYA,EAAE,OAAQ,EAACA,EAAEE,CAAC,CAAC,ECJx1B;AAAA;AAAA;AAAA;AAAA,GAKK,MAACS,GAAE,CAACV,EAAEhC,EAAE,IAAI,CAAC,MAAMmC,EAAE,IAAI,IAAI,QAAQI,EAAEvC,EAAEuC,GAAG,EAAEA,IAAIJ,EAAE,IAAIH,EAAEO,CAAC,EAAEA,CAAC,EAAE,OAAOJ,CAAC,EAAEnQ,GAAEgO,GAAE,cAAc+B,EAAC,CAAC,YAAYC,EAAE,CAAC,GAAG,MAAMA,CAAC,EAAEA,EAAE,OAAOG,GAAE,MAAM,MAAM,MAAM,+CAA+C,CAAC,CAAC,GAAGH,EAAEhC,EAAE,EAAE,CAAC,IAAImC,EAAW,IAAT,OAAW,EAAEnC,EAAWA,IAAT,SAAamC,EAAEnC,GAAG,MAAMuC,EAAE,CAAE,EAACN,EAAE,CAAA,EAAG,IAAI5Q,EAAE,EAAE,UAAU2O,KAAKgC,EAAEO,EAAElR,CAAC,EAAE8Q,EAAEA,EAAEnC,EAAE3O,CAAC,EAAEA,EAAE4Q,EAAE5Q,CAAC,EAAE,EAAE2O,EAAE3O,CAAC,EAAEA,IAAI,MAAM,CAAC,OAAO4Q,EAAE,KAAKM,CAAC,CAAC,CAAC,OAAOP,EAAEhC,EAAE,EAAE,CAAC,OAAO,KAAK,GAAGgC,EAAEhC,EAAE,CAAC,EAAE,MAAM,CAAC,OAAO,EAAE,CAAC+B,EAAEI,EAAEnQ,CAAC,EAAE,CAAC,MAAMyQ,EAAEF,GAAE,CAAC,EAAE,CAAC,OAAOC,EAAE,KAAKhR,CAAC,EAAE,KAAK,GAAGuQ,EAAEI,EAAEnQ,CAAC,EAAE,GAAG,CAAC,MAAM,QAAQyQ,CAAC,EAAE,OAAO,KAAK,GAAGjR,EAAEgR,EAAE,MAAMF,EAAE,KAAK,KAAK,CAAE,EAACgK,EAAE,CAAA,EAAG,IAAIpY,EAAE+K,EAAEjB,EAAE,EAAEuO,EAAE9J,EAAE,OAAO,EAAE+J,EAAE,EAAEhZ,EAAEgP,EAAE,OAAO,EAAE,KAAKxE,GAAGuO,GAAGC,GAAGhZ,GAAG,GAAUiP,EAAEzE,CAAC,IAAV,KAAYA,YAAmByE,EAAE8J,CAAC,IAAV,KAAYA,YAAYjK,EAAEtE,CAAC,IAAIxM,EAAEgb,CAAC,EAAEF,EAAEE,CAAC,EAAEvK,GAAEQ,EAAEzE,CAAC,EAAEwE,EAAEgK,CAAC,CAAC,EAAExO,IAAIwO,YAAYlK,EAAEiK,CAAC,IAAI/a,EAAEgC,CAAC,EAAE8Y,EAAE9Y,CAAC,EAAEyO,GAAEQ,EAAE8J,CAAC,EAAE/J,EAAEhP,CAAC,CAAC,EAAE+Y,IAAI/Y,YAAY8O,EAAEtE,CAAC,IAAIxM,EAAEgC,CAAC,EAAE8Y,EAAE9Y,CAAC,EAAEyO,GAAEQ,EAAEzE,CAAC,EAAEwE,EAAEhP,CAAC,CAAC,EAAEnC,GAAE,EAAEib,EAAE9Y,EAAE,CAAC,EAAEiP,EAAEzE,CAAC,CAAC,EAAEA,IAAIxK,YAAY8O,EAAEiK,CAAC,IAAI/a,EAAEgb,CAAC,EAAEF,EAAEE,CAAC,EAAEvK,GAAEQ,EAAE8J,CAAC,EAAE/J,EAAEgK,CAAC,CAAC,EAAEnb,GAAE,EAAEoR,EAAEzE,CAAC,EAAEyE,EAAE8J,CAAC,CAAC,EAAEA,IAAIC,YAAqBtY,IAAT,SAAaA,EAAEwO,GAAElR,EAAEgb,EAAEhZ,CAAC,EAAEyL,EAAEyD,GAAEJ,EAAEtE,EAAEuO,CAAC,GAAGrY,EAAE,IAAIoO,EAAEtE,CAAC,CAAC,EAAE,GAAG9J,EAAE,IAAIoO,EAAEiK,CAAC,CAAC,EAAE,CAAC,MAAMvK,EAAE/C,EAAE,IAAIzN,EAAEgb,CAAC,CAAC,EAAEzK,EAAWC,IAAT,OAAWS,EAAET,CAAC,EAAE,KAAK,GAAUD,IAAP,KAAS,CAAC,MAAMC,EAAE3Q,GAAE,EAAEoR,EAAEzE,CAAC,CAAC,EAAEiE,GAAED,EAAEQ,EAAEgK,CAAC,CAAC,EAAEF,EAAEE,CAAC,EAAExK,CAAC,MAAMsK,EAAEE,CAAC,EAAEvK,GAAEF,EAAES,EAAEgK,CAAC,CAAC,EAAEnb,GAAE,EAAEoR,EAAEzE,CAAC,EAAE+D,CAAC,EAAEU,EAAET,CAAC,EAAE,KAAKwK,GAAG,MAAMpK,GAAEK,EAAE8J,CAAC,CAAC,EAAEA,SAASnK,GAAEK,EAAEzE,CAAC,CAAC,EAAEA,IAAI,KAAKwO,GAAGhZ,GAAG,CAAC,MAAMwO,EAAE3Q,GAAE,EAAEib,EAAE9Y,EAAE,CAAC,CAAC,EAAEyO,GAAED,EAAEQ,EAAEgK,CAAC,CAAC,EAAEF,EAAEE,GAAG,EAAExK,CAAC,CAAC,KAAKhE,GAAGuO,GAAG,CAAC,MAAMvK,EAAES,EAAEzE,GAAG,EAASgE,IAAP,MAAUI,GAAEJ,CAAC,CAAC,CAAC,OAAO,KAAK,GAAGxQ,EAAEV,GAAE,EAAEwb,CAAC,EAAEtK,EAAC,CAAC,CAAC,ECQ7qC,MAAMyK,EAAwD,CACnE,YAA4BxJ,EAAsC,CAAtC,KAAA,OAAAA,EAM5B,KAAA,uBAAyB,CACvB8D,EACA2F,EAKAzS,EAAY,KACT,CACG,MAAAwL,EAASxL,EACXuL,GAA6B,KAAK,OAAQ,KAAK,MAAM,EACrD,KAAK,OACHzT,EAAmB,CAAA,EAEzB,OAAA0T,EAAO,OAAO,CAACkH,EAAYvI,EAAOwI,IAAe,CACzC,MAAA5Z,EAASoR,EAAM,OAAO,OACtB1E,EAAOqH,EAAY,MAAQ/T,EAC3B2M,EAAKoH,EAAY,MAAQA,EAAY,OAO3C,GAJE4F,GAAcjN,IACbiN,EAAahN,GACXoH,EAAY,SAAW,GAAK4F,IAAe5F,EAAY,OAE1C,CAChB,MAAM5U,EAAQua,EAAStI,EAAOuI,EAAYC,CAAU,EACpD7a,EAAO,KAAKI,CAAK,CACnB,CAEA,OAAOwa,EAAa3Z,GACnB,CAAC,EAEGjB,CAAA,EAoDT,KAAA,qBAAwB4a,GAAuB,CAC7C,MAAMlH,EAAS,KAAK,OAEpB,IAAIhU,EAAQ,EACZ,UAAW2S,KAASqB,EAAQ,CAC1B,GAAIhU,EAAQ2S,EAAM,OAAO,QAAUuI,EAC1B,OAAAvI,EAET3S,GAAS2S,EAAM,OAAO,MACxB,CAEO,OAAA,IAAA,EA2DT,KAAA,uBACE2C,GAEO,KAAK,uBACVA,EACA,CAAC3C,EAAO3S,IAAsC,CAC5C2S,EACA,CAAE,MAAA3S,EAAO,OAAQ2S,EAAM,OAAO,MAAO,CACvC,CAAA,EAKK,KAAA,OAAA,MAAOyI,EAAkB,KAAS,CACrC,GAAA,CAAC,KAAK,OAAO,QAAS,OAErB,KAAA,OAAO,MAAM,OAAO,KAAK,EAExB,MAAAvJ,EAAc,KAAK,OAAO,YAE1BwJ,EAAmBtH,GACvB,KAAK,OACL,KAAK,MAAA,EAEDuH,EAAS7H,GAAqB4H,CAAgB,EAEpD,IAAIE,EAAuB,EAErB,MAAAC,EAAQF,EAAO,IAAazH,GAAA,CAC5B,GAAAA,EAAM,OAAS,EAAG,CACpB,MAAM4H,EAAsD,CAAA,EAC5D5H,EAAM,QAAiBlB,GAAA,CACrB8I,EAAW,KAAK,CAAC9I,EAAO4I,CAAoB,CAAC,EAC7CA,GAAA,CACD,EAED,MAAM5N,EAA8B8N,EAAW,IAC7C,CAAC,CAAC9I,EAAO4I,CAAoB,IAAM,CACjC,IAAI7B,EAAW,GACT,MAAApE,EAAc,KAAK,OAAO,eAAe,EAC/C,OAAIA,IACFoE,EAAW,KAAK,0BACd6B,EACAjG,CAAA,GAIG,CACLkE,GACE7G,EACA,KAAK,OAAO,iBAAiB,oBAC7B+G,CACF,EACA/G,CAAA,CAEJ,CAAA,EAGF,OAAOnO,sBAAyBmJ,CAAQ,YAAA,KAEjC,QAAAnJ,sBAAyB,CAAE,CAAA,YACpC,CACD,EAEG,GAAA,CACFkX,GACEC,GACEH,EAAM,IAAI,CAACI,EAAMhc,KAAO,CAAE,KAAAgc,EAAM,MAAOhc,CAAA,EAAI,KAClCkC,EAAM,SACNA,EAAM,IACjB,EACA+P,CAAA,OAEQ,CAEV,KAAK,OAAO,sBACN,MAAA,KAAK,OAAO,eACpB,CAEM,MAAA,KAAK,OAAO,gBAEduJ,GAGG,KAAA,OAAO,aAAa,kBAGtB,KAAA,OAAO,MAAM,eAAe,KAAK,CAAA,CAvP2B,CAEnE,IAAI,QAAS,CACJ,OAAA,KAAK,OAAO,MAAM,QAAQ,CACnC,CAqCA,0BACEG,EACAjG,EACS,CACT,IAAIhV,EAAS,GACT,OAAAgV,EAAY,QAAU,GACxB,KAAK,OAAO,uBACVA,EACA,CAAC1P,EAAGsV,EAAYC,IAAe,CAE3BA,IAAeI,GACfL,GAAc5F,EAAY,QAEjBhV,EAAA,GAEb,EAEA,EAAA,EAIGA,CACT,CA0LF,CCtQgB,SAAAub,GACd9b,EACAsD,EACS,CACT,OAAOtD,IAAMsD,IAAMtD,GAAKsD,EAAIyY,GAAmB/b,EAAGsD,CAAC,EAAI,GACzD,CAMgB,SAAAyY,GAAmB/b,EAAgBsD,EAAyB,CAC1E,OAAOtD,EAAE,QAAUsD,EAAE,OAAStD,EAAE,SAAWsD,EAAE,MAC/C,CAEgB,SAAA0Y,GACdhc,EACAsD,EACS,CACF,OAAAtD,EAAE,OAASsD,EAAE,MAAQA,EAAE,QAAUtD,EAAE,MAAQA,EAAE,QAAUsD,EAAE,KAClE,CAyCgB,SAAA2Y,GACdjc,EACAsD,EACoB,CACpB,GAAI,CAAC0Y,GAAuBhc,EAAGsD,CAAC,EACvB,OAAA,KAET,MAAMrD,EAAQ,KAAK,IAAID,EAAE,MAAOsD,EAAE,KAAK,EACjC9B,EAAS,KAAK,IAAIxB,EAAE,MAAQA,EAAE,OAAQsD,EAAE,MAAQA,EAAE,MAAM,EAAIrD,EAC3D,MAAA,CAAE,MAAAA,EAAO,OAAAuB,EAClB,CC7DO,MAAM0a,EAAwD,CASnE,YAA4BzK,EAAsC,CAAtC,KAAA,OAAAA,EAR5B,KAAQ,aAAe,GAKvB,KAAQ,gBAAsC,KAC9C,KAAQ,eAAqC,KAQ7C,KAAA,MAAQ,IAAM,CACN,MAAA0K,EAAc,KAAK,OAAO,YAC1BrK,EAAc,KAAK,OAAO,YAE3B,KAAK,qBACR,KAAK,OAAO,YAAY,aACtB,SACA,kBACA,KAAK,kBAAA,EAIT,KAAK,OAAO,YAAY,aACtBqK,EACA,cACA,KAAK,cAAA,EAEP,KAAK,OAAO,YAAY,aACtBA,EACA,mBACA,KAAK,mBAAA,EAEP,KAAK,OAAO,YAAY,aACtBA,EACA,oBACA,KAAK,oBAAA,EAEP,KAAK,OAAO,YAAY,aACtBA,EACA,iBACCxY,GAA4B,CAC3B,KAAK,kBAAkBA,CAAK,EAAE,MAAM,QAAQ,KAAK,CACnD,CAAA,EAEF,KAAK,OAAO,YAAY,aACtBwY,EACA,UACA,KAAK,UAAA,EAEP,KAAK,OAAO,YAAY,aAAarK,EAAa,QAAS,KAAK,QAAQ,CAAA,EAGlE,KAAA,yBAA4BhH,GAAiB,CAC7C,MAAAgH,EAAc,KAAK,OAAO,YAC1BsK,EAAY,SAAS,cAG3B,OAFAA,EAAU,WAAWtK,CAAW,EAG9BhH,EAAM,eAAe,wBAAwBA,EAAM,YAAY,EAC/D,KAAK,4BAGHsR,EAAU,aAAatR,EAAM,eAAgBA,EAAM,WAAW,GAAK,GACnEsR,EAAU,aAAatR,EAAM,aAAcA,EAAM,SAAS,GAAK,EAI/DsR,EAAU,aAAatR,EAAM,aAAcA,EAAM,WAAW,GAAK,GACjEsR,EAAU,aAAatR,EAAM,eAAgBA,EAAM,SAAS,GAAK,CAErE,EAGF,KAAQ,mBAAqB,IAAM,CAC3B,MAAAgH,EAAc,KAAK,OAAO,YAC1BuK,EAAsB,KAAK,OAAO,eAAe,EACvD,GAAI,KAAK,aACP,OAII,MAAAxR,EADgB2G,GAAyB,KAAK,MAAM,EAC1B,eAChC,GAAI,CAAC3G,EAAW,OACZ,GAAAA,EAAU,aAAe,EAAG,CAC1BwR,IAAwB,MACrB,KAAA,OAAO,eAAe,KAAM,EAAK,EAGxC,MACF,CAEM,MAAAvR,EAAQD,EAAU,WAAW,CAAC,EAGlC,GAAAC,EAAM,iBAAmBA,EAAM,cAC/BA,EAAM,eAAe,cAAgBuG,IACrCvG,EAAM,cAAgB,EACtB,CACMA,EAAA,SAASA,EAAM,eAAgB,CAAC,EAChCA,EAAA,OAAOA,EAAM,aAAc,CAAC,EAClCD,EAAU,gBAAgB,EAC1BA,EAAU,SAASC,CAAK,EACxB,MACF,CAEA,GAAI,CAACA,EAAM,eAAegH,CAAW,EAUnC,GAREhH,EAAM,aAAa,SAASgH,CAAW,GACvC,MAAM,KAAKhH,EAAM,aAAa,UAAU,EAAE,UAChCgB,aAAgB,WACxB,EAAA,SAAW,GACbhB,EAAM,eAAe,SAASgH,CAAW,GACzC,MAAM,KAAKhH,EAAM,eAAe,UAAU,EAAE,UAClCgB,aAAgB,WAAA,EACxB,SAAW,EACU,CACvB,KAAK,OAAO,WACZ,MAAA,KACK,CACDuQ,IAAwB,MACrB,KAAA,OAAO,eAAe,KAAM,EAAK,EAExC,MACF,CAGF,KAAK,gBAAkB,CAACvR,EAAM,eAAgBA,EAAM,WAAW,EAC/D,KAAK,eAAiB,CAACA,EAAM,aAAcA,EAAM,SAAS,EAE1D,MAAMyK,EAAc,KAAK,OAAO,cAAc1K,EAAU,WAAW,CAAC,CAAC,EAChEiR,GAAwBO,EAAqB9G,CAAW,GACtD,KAAA,OAAO,eAAeA,EAAa,EAAK,IAK3CzK,EAAM,eAAe,WAAa,KAAK,WACvCA,EAAM,aAAa,WAAa,KAAK,YACrCA,EAAM,iBAAmB,KAAK,gBAAgB,CAAC,GAC/CA,EAAM,eAAiB,KAAK,eAAe,CAAC,GAC5CA,EAAM,cAAgB,KAAK,gBAAgB,CAAC,GAC5CA,EAAM,YAAc,KAAK,eAAe,CAAC,GAC3CA,EAAM,eAAe,WAAa,KAAK,cACvCA,EAAM,aAAa,WAAa,KAAK,eAErC,KAAK,OAAO,iBACd,EAGF,KAAQ,wBAA8C,KACtD,KAAQ,oBAAsB,IAAM,CAClC,KAAK,aAAe,GAEL,KAAK,OAAO,YAAY,iBACrC,uBAAA,EAEK,QAAiBwR,GAAA,CACtBA,EAAM,gBAAgB,iBAAiB,CAAA,CACxC,EAED,MAAMxR,EAAQ,KAAK,OAAO,aAAa,eAAe,EAClDA,EACF,KAAK,wBAA0B,KAAK,OAAO,cAAcA,CAAK,EAE9D,KAAK,wBAA0B,IACjC,EAGF,KAAQ,qBAAuB,IAAM,CAC/B,GAAA,CAAC,KAAK,OAAO,YAAY,YAAa,OAE1C,MAAMA,EAAQ,KAAK,OAAO,aAAa,eAAe,EAEpD,KAAK,OAAO,YACZ,CAACA,GACD,CAAC,KAAK,yBAAyBA,CAAK,GAIjC,KAAA,OAAO,MAAM,UAAU,KAAK,CAAA,EAG3B,KAAA,kBAAoB,MAAOnH,GAA4B,CAEzD,GADJ,KAAK,aAAe,GAChB,CAAC,KAAK,OAAO,YAAY,YAAa,OAE1C,MAAMmH,EAAQ,KAAK,OAAO,aAAa,eAAe,EAEpD,GAAA,KAAK,OAAO,YACZ,CAACA,GACD,CAAC,KAAK,yBAAyBA,CAAK,EAEpC,OAEF,KAAK,OAAO,sBACN,MAAA,KAAK,OAAO,gBAElB,MAAMyK,EAAc,KAAK,wBACzB,GAAI,CAACA,EAAa,OAElB5R,EAAM,eAAe,EAErB,IAAI6B,EAAoD,CACtD,aAAc,KAAK,OACnB,IAAK7B,EACL,YAAA4R,EACA,KAAM5R,EAAM,KACZ,WAAY,CAAC,CAAA,EAET,MAAA4Y,EAAO,KAAK,OAAO,MAAM,eAI/B,GAHIA,IACF/W,EAAM+W,EAAK/W,CAAG,GAEZ,CAACA,EAAK,OAEV,KAAM,CAAE,YAAagX,EAAgB,KAAMC,GAAYjX,EACnDiX,GAAWA,EAAQ,OAAS,IAC9B,KAAK,OAAO,WAAWD,EAAgBC,EAASjX,EAAI,UAAU,EAC9D,KAAK,OAAO,eACV,CACE,MAAOgX,EAAe,MAAQC,EAAQ,OACtC,OAAQ,CACV,EACA,EAAA,GAIC,KAAA,OAAO,MAAM,UAAU,KAAK,CAAA,EAG3B,KAAA,eAAkB9Y,GAAsB,CAC9C,MAAMmH,EAAQ,KAAK,OAAO,aAAa,eAAe,EASlD,GAPF,KAAK,OAAO,YACZ,KAAK,cACL,CAACA,GACD,CAAC,KAAK,yBAAyBA,CAAK,GAIlC,CAAC,KAAK,OAAO,eAAe,EAAG,OAE7B,MAAA4R,EAAe/Y,EAAM,kBACvB,GAAA+Y,EAAa,OAAS,EAAG,CACrB,MAAAC,EAAcD,EAAa,CAAC,EAC5B5R,EAAQ,SAAS,cACvBA,EAAM,SAAS6R,EAAY,eAAgBA,EAAY,WAAW,EAClE7R,EAAM,OAAO6R,EAAY,aAAcA,EAAY,SAAS,EAC5D,MAAMpH,EAAc,KAAK,OAAO,cAAczK,CAAK,EAE9CgR,GAAwB,KAAK,OAAO,eAAe,EAAGvG,CAAW,GAC/D,KAAA,OAAO,eAAeA,EAAa,EAAK,CAEjD,CAEM,MAAAA,EAAc,KAAK,OAAO,eAAe,EAC/C,GAAI,CAACA,EAAa,OAElB5R,EAAM,eAAe,EAErB,IAAI6B,EAAiD,CACnD,aAAc,KAAK,OACnB,IAAK7B,EACL,YAAA4R,EACA,KAAM5R,EAAM,KACZ,WAAY,CAAC,CAAA,EAET,MAAA4Y,EAAO,KAAK,OAAO,MAAM,YAI/B,GAHIA,IACF/W,EAAM+W,EAAK/W,CAAG,GAEZ,CAACA,EAAK,OAEV,KAAM,CAAE,IAAKoX,EAAU,KAAAva,EAAM,YAAama,CAAmB,EAAAhX,EAC7DwU,GACE4C,EAAS,UACTva,EACAmD,EAAI,WACJgX,EACA,KAAK,MAAA,EAGF,KAAA,OAAO,MAAM,UAAU,KAAK,CAAA,EAG3B,KAAA,WAAc7Y,GAAyB,CACvC,MAAA4R,EAAc,KAAK,OAAO,eAAe,EAC/C,GAAKA,IAEL,KAAK,OAAO,MAAM,QAAQ,KAAK5R,CAAK,EAGlC,CAACA,EAAM,WACNA,EAAM,MAAQ,aAAeA,EAAM,MAAQ,eAC5C,CACA,GAAI4R,EAAY,SAAW,EAAG,OAE9B,MAAMsH,EAAU,IAAM,CACpBlZ,EAAM,eAAe,EACrBA,EAAM,gBAAgB,CAAA,EAGlBsQ,EAAS,KAAK,OAAO,uBAAuBsB,CAAW,EACzD,GAAAtB,EAAO,SAAW,EAChBtQ,EAAM,MAAQ,aAAe,KAAK,OAAO,QAAQsQ,EAAO,CAAC,EAAE,CAAC,CAAC,GACvD4I,IACR,KAAK,OAAO,eAAe,CACzB,MAAOtH,EAAY,MAAQ,EAC3B,OAAQ,CAAA,CACT,GAED5R,EAAM,MAAQ,cACd,KAAK,OAAO,QAAQsQ,EAAO,CAAC,EAAE,CAAC,CAAC,IAExB4I,IACR,KAAK,OAAO,eAAe,CACzB,MAAOtH,EAAY,MACnB,OAAQ,CAAA,CACT,WAEMtB,EAAO,SAAW,EAAG,CAC9B,MAAMrB,EAAQqB,EAAO,CAAC,EAAE,CAAC,EACrB,KAAK,OAAO,QAAQrB,CAAK,IACvBjP,EAAM,MAAQ,aAAe4R,EAAY,MAAQ,GAAK,GAChDsH,IACR,KAAK,OAAO,eAAe,CACzB,MAAOtH,EAAY,MAAQ,EAC3B,OAAQ,CAAA,CACT,GAED5R,EAAM,MAAQ,cACd4R,EAAY,MAAQ,GAAK,KAAK,OAAO,cAE7BsH,IACR,KAAK,OAAO,eAAe,CACzB,MAAOtH,EAAY,MACnB,OAAQ,CAAA,CACT,GAGP,CACF,CAAA,EAGM,KAAA,SAAY5R,GAAsB,CAExC,GAAIA,EAAM,kBAAkB,MAAQoQ,GAAiBpQ,EAAM,MAAM,EAAG,CAE5D,MAAAkH,EADgB2G,GAAyB,KAAK,MAAM,EAC1B,eAChC,GAAI,CAAC3G,EAAW,OACZ,GAAAlH,EAAM,kBAAkB,YAAa,CACvC,MAAM2S,EAAW3S,EAAM,OAAO,QAAQ,WAAW,EAC7C2S,GACFzL,EAAU,kBAAkByL,CAAQ,CACtC,KACK,CACL,MAAMA,EAAW3S,EAAM,OAAO,eAAe,QAAQ,WAAW,EAC5D2S,GACFzL,EAAU,kBAAkByL,CAAQ,CAExC,CACF,CAAA,CArWiE,CAPnE,IAAI,aAAc,CAChB,OAAO,KAAK,YACd,CAOA,IAAI,qBAAsB,CACxB,OAAO,KAAK,OAAO,mBACrB,CAmWF,CCzWO,MAAMwG,EAAwD,CAKnE,YAA4BrL,EAAsC,CAAtC,KAAA,OAAAA,EAJ5B,KAAQ,aAAmC,KAC3C,KAAQ,2BAAwD,KAChE,KAAQ,yBAAsD,KAuB9D,KAAA,qBAAuB,MAAO,CAC5B+K,EACAO,CAAA,IAC4B,CA6B5B,GA5BWjB,GAAwB,KAAK,aAAcU,CAAc,IAKpE,KAAK,aAAeA,EAEhBA,GACF,KAAK,2BAA6BQ,GAChC,KAAK,MACLR,EAAe,KAAA,EAEjB,KAAK,yBAA2BQ,GAC9B,KAAK,MACLR,EAAe,MAAQA,EAAe,MAAA,IAGxC,KAAK,2BAA6B,KAClC,KAAK,yBAA2B,MAI9B,KAAK,OAAO,UAER,MAAA,KAAK,OAAO,gBACb,KAAA,OAAO,cAAc,EAAK,GAG7B,CAACO,GACH,OAGE,GAAA,KAAK,eAAiB,KAAM,CAExB,MAAAlS,EADgB2G,GAAyB,KAAK,MAAM,EAC1B,eAC5B3G,GAAaA,EAAU,WAAa,GACxBA,EAAU,WAAW,CAAC,EAC1B,eAAe,KAAK,OAAO,WAAW,GAC9CA,EAAU,gBAAgB,EAG9B,MACF,CAYA,sBAVW,IAAM,CAMf,KAAK,gBAAgB,CAAA,CAIC,CAAA,EAkB1B,KAAA,eAAiB,IACX,KAAK,oBACA,KAAK,oBAAoB,iBAG3B,KAAK,aAGd,KAAA,0BAA6BgH,GAAyC,CAC9D,MAAA/G,EAAQ,SAAS,cACjBxG,EAAOuN,EAAQ,cAAc,cAAc,EACjD,GAAI,CAACvN,EACI,OAAA,KAEH,MAAA4R,EAAW5R,EAAK,WAAW,CAAC,EAClC,OAAAT,EAAaqS,aAAoB,IAAI,EAC/BpL,EAAA,SAASoL,EAAU,CAAC,EAC1BpL,EAAM,OAAOoL,EAAUA,EAAS,aAAa,QAAU,CAAC,EACpC,KAAK,cAAcpL,CAAK,CACrC,EAiDT,KAAA,mBAAsByK,GACb,EACLA,IACCA,EAAY,MAAQ,GACnBA,EAAY,MAAQA,EAAY,OAAS,KAAK,OAAO,MAAM,SASjE,KAAA,YAAeA,GAA6C,CAC1D,GAAI,CAACA,EAAoB,MAAA,GAErB,GAAAA,EAAY,OAAS,EACjB,MAAA,IAAI,MAAM,kCAAkC,EAG9C,MAAAzK,EAAQ,KAAK,WAAWyK,CAAW,EACzC,GAAI,CAACzK,EACG,MAAA,IAAI,MAAM,4CAA4C,EAK1D,GADe,KAAK,OAAO,YAAY,MAAM,EAAGyK,EAAY,KAAK,EACtD,SAAS;AAAA,CAAI,EACnB,MAAA,GAWH,MAAA0B,EAAYnM,EAAM,wBAAwB,cAChDjH,EAAaoT,CAAS,EAChB,MAAAgG,EAAgBhG,EAAU,wBAI1BiG,EAAapS,EAAM,iBAIlB,OADWoS,EAAWA,EAAW,OAAS,CAAC,EACjC,MAAQD,EAAc,GAAA,EAQzC,KAAA,WAAc1H,GAA6C,CACzD,GAAI,CAACA,EAAoB,MAAA,GAErB,GAAAA,EAAY,OAAS,EACjB,MAAA,IAAI,MAAM,kCAAkC,EAKhD,GADc,KAAK,OAAO,YAAY,MAAMA,EAAY,KAAK,EACnD,SAAS;AAAA,CAAI,EAClB,MAAA,GAGH,MAAAzK,EAAQ,KAAK,WAAWyK,CAAW,EACzC,GAAI,CAACzK,EACG,MAAA,IAAI,MAAM,4CAA4C,EAWxD,MAAAmM,EAAYnM,EAAM,wBAAwB,cAChDjH,EAAaoT,CAAS,EAChB,MAAAgG,EAAgBhG,EAAU,wBAI1BiG,EAAapS,EAAM,iBAIlB,OADWoS,EAAWA,EAAW,OAAS,CAAC,EACjC,SAAWD,EAAc,MAAA,EAO3B,KAAA,eAAA,CAAC1H,EAAiCwH,EAAO,KAAe,CACvE,GAAI,CAAC,KAAK,mBAAmBxH,CAAW,EAChC,MAAA,IAAI,MAAM,sBAAsB,EAGxC,GAAI,KAAK,oBAAqB,CACvB,KAAA,oBAAoB,eAAeA,EAAawH,CAAI,EACzD,MACF,CAEA,KAAK,OAAO,MAAM,kBAAkB,KAAK,CAACxH,EAAawH,CAAI,CAAC,CAAA,EAG9D,KAAA,SAAW,IAAY,CACrB,KAAK,eAAe,CAClB,MAAO,KAAK,OAAO,YACnB,OAAQ,CAAA,CACT,CAAA,EAGH,KAAA,WAAa,IAAY,CACvB,KAAK,eAAe,CAClB,MAAO,EACP,OAAQ,CAAA,CACT,CAAA,EAGH,KAAA,UAAY,IAAY,CACtB,KAAK,eAAe,CAClB,MAAO,EACP,OAAQ,KAAK,OAAO,WAAA,CACrB,CAAA,EAGH,KAAA,WAAc9c,GAAwB,CACpC,KAAK,eAAe,CAClB,MAAAA,EACA,OAAQ,CAAA,CACT,CAAA,EAMH,KAAA,gBAAkB,IAAY,CACtB,MAAAsV,EAAc,KAAK,iBACrBA,GAAe,KAAK,OAAO,SAC7B,KAAK,kBAAkBA,CAAW,CACpC,EAMF,KAAA,WAAcA,GAA2C,CACjD,MAAAzD,EAAc,KAAK,OAAO,YACzB,OAAAmH,GAAsBnH,EAAayD,CAAW,CAAA,EAmCvD,KAAA,cAAiBzK,GAAqC,CACpD,KAAM,CAAE,YAAAgH,EAAa,MAAAuG,GAAU,KAAK,OAE7B,OAAAW,GAAsBlO,EAAOgH,EAAauG,CAAK,CAAA,EAGhD,KAAA,kBAAqB9C,GAAmC,CAExD,MAAA1K,EADgB2G,GAAyB,KAAK,MAAM,EAC1B,eAChC,GAAI,CAAC3G,EACH,OAEI,MAAAsS,EAAW,KAAK,WAAW5H,CAAW,EAEvC4H,IAILtS,EAAU,gBAAgB,EAC1BA,EAAU,SAASsS,CAAQ,EAC3B,KAAK,OAAO,MAAM,iBAAiB,KAAKA,CAAQ,EAAA,CAxXiB,CAEnE,IAAI,OAAQ,CACV,OAAO,KAAK,OAAO,KACrB,CAEA,IAAI,qBAAsB,CACxB,OAAO,KAAK,OAAO,mBACrB,CAEA,IAAI,aAAc,CAChB,OAAO,KAAK,OAAO,WACrB,CAEA,IAAI,2BAA4B,CAC9B,OAAO,KAAK,0BACd,CACA,IAAI,yBAA0B,CAC5B,OAAO,KAAK,wBACd,CA+DA,oBAAuC,CAE/B,MAAAtS,EADgB2G,GAAyB,KAAK,MAAM,EAC1B,eAEhC,MADI,CAAC3G,GACDA,EAAU,aAAe,EAAU,KAEhCA,CACT,CAEA,gBAA+B,CACvB,MAAAA,EAAY,KAAK,qBACvB,OAAKA,EACEA,EAAU,WAAW,CAAC,EADN,IAEzB,CAwBA,aAAasQ,EAA6C,CACxD,MAAMiC,EAAS,MAAM,KAAK,KAAK,YAAY,iBAAiB,QAAQ,CAAC,EAErE,IAAInd,EAAQ,EACZ,UAAW+W,KAASoG,EAAQ,CACpB,MAAA/G,EAAQL,EAAwBgB,CAAK,EAE3C,UAAW1S,KAAQ+R,EAAO,CACpB,GAAA,CAAC/R,EAAK,YACF,MAAA,IAAI,MAAM,sCAAsC,EAExD,GAAIrE,EAAQqE,EAAK,YAAY,QAAU6W,EAC9B,MAAA,CAAC7W,EAAM6W,EAAalb,CAAK,EAElCA,GAAS8V,GAAoBzR,CAAI,CACnC,CAESrE,GAAA,CACX,CAEM,MAAA,IAAI,MAAM,qBAAqB,CACvC,CAGA,QAAQkb,EAA4D,CAClE,MAAMjC,EAAe,MAAM,KACzB,KAAK,YAAY,iBAAiB,QAAQ,CAAA,EAG5C,IAAIjZ,EAAQ,EACZ,UAAW6W,KAAeoC,EAAc,CACtC,GAAIiC,GAAclb,GAASkb,GAAclb,EAAQ6W,EAAY,WACpD,MAAA,CAACA,EAAaqE,EAAalb,CAAK,EAEzC,GACEkb,IAAelb,EAAQ6W,EAAY,YACnCqE,IAAe,KAAK,OAAO,YAEpB,MAAA,CAACrE,EAAaqE,EAAalb,CAAK,EAEzCA,GAAS6W,EAAY,WAAa,CACpC,CAEM,MAAA,IAAI,MAAM,qBAAqB,CACvC,CAuNF,CC7YO,MAAMuG,EAA6D,CACxE,YAA4B5L,EAAsC,CAAtC,KAAA,OAAAA,EAEnB,KAAA,SAAW,KAAK,OAAO,SAMhC,KAAA,WAAc8D,GAAmC,CAC/C,KAAK,SAAS,IAAM,CAClB,KAAK,MAAM,OAAOA,EAAY,MAAOA,EAAY,MAAM,CAAA,CACxD,CAAA,EAGH,KAAA,WAAa,CACXA,EACAjR,EACAuV,EAA6B,CAAA,IACpB,CACL,KAAK,OAAO,iBAAiB,QAC/BA,EAAa,CAAE,GAAGA,EAAY,GAAG,KAAK,OAAO,iBAAiB,QAEhE,MAAMyD,EACJ,KAAK,OAAO,iBAAiB,oBAAoBzD,CAAU,EAE7D,GAAI,CAACvV,GAAQ,CAACA,EAAK,OACX,MAAA,IAAI,MAAM,wBAAwB,EAG1C,KAAK,SAAS,IAAM,CAClB,KAAK,MAAM,OAAOiR,EAAY,MAAOA,EAAY,MAAM,EACvD,KAAK,MAAM,OAAOA,EAAY,MAAOjR,EAAMgZ,CAAoB,CAAA,CAChE,CAAA,EAGH,KAAA,gBAAmB/H,GAAmC,CACpD,KAAK,SAAS,IAAM,CAClB,KAAK,MAAM,OAAOA,EAAY,MAAOA,EAAY,MAAM,EACvD,KAAK,MAAM,OAAOA,EAAY,MAAO;AAAA,CAAI,CAAA,CAC1C,CAAA,EAGH,KAAA,WAAa,CACXA,EACAsE,EACA5P,EAGI,CAAA,IACK,CACT,KAAM,CAAE,MAAAsT,EAAQ,IAAM,GAAM,KAAAC,EAAO,OAAY,EAAAvT,EAChC,KAAK,OAAO,aAAa,uBAAuBsL,CAAW,EAGvE,OAAO,CAAC,CAAC3C,EAAO6K,CAAgB,IAAMF,EAAM3K,EAAO6K,CAAgB,CAAC,EACpE,QAAQ,CAAC,CAACC,EAAQD,CAAgB,IAAM,CACvC,MAAMH,EACJ,KAAK,OAAO,iBAAiB,oBAAoBzD,CAAU,EAC7D,GAAI,CAACyD,EAAsB,OAE3B,MAAMK,EAAoB1B,GACxB1G,EACAkI,CAAA,EAEGE,IAEDH,IAAS,WACX,KAAK,UAAUG,CAAiB,EAGlC,KAAK,SAAS,IAAM,CAClB,KAAK,MAAM,OACTA,EAAkB,MAClBA,EAAkB,OAClBL,CAAA,CACF,CACD,EAAA,CACF,CAAA,EAGL,KAAA,UAAa/H,GAAmC,CAC9C,MAAMqI,EAA6B,CAAA,EAE7B,QAAA/d,EAAI0V,EAAY,MACpB1V,GAAK0V,EAAY,MAAQA,EAAY,OACrC1V,IACA,CACA,MAAM+S,EAAQ,KAAK,OAAO,qBAAqB/S,CAAC,EAC5C+S,GACFgL,EAAY,KAAKhL,CAAK,CAE1B,CAEA,MAAMiL,EAAQ,OAAO,YACnBD,EAAY,QACVhL,GAAAA,EAAM,WACF,OAAO,KAAKA,EAAM,UAAU,EAAE,OAAW,CAAC5L,EAAK,IAAI,CAAC,EACpD,CAAC,CACP,CAAA,EAGF,KAAK,SAAS,IAAM,CAClB,KAAK,MAAM,OAAOuO,EAAY,MAAOA,EAAY,OAAQ,CACvD,GAAGsI,CAAA,CACJ,CAAA,CACF,CAAA,EAGH,KAAA,QAAU,CACRvZ,EACAuV,EAA6B,CAAA,IACpB,CACT,KAAK,SAAS,IAAM,CAClB,KAAK,MAAM,OAAO,EAAG,KAAK,MAAM,MAAM,EACtC,KAAK,MAAM,OAAO,EAAGvV,EAAMuV,CAAU,CAAA,CACtC,CAAA,CAnHgE,CAInE,IAAI,OAAQ,CACV,OAAO,KAAK,OAAO,KACrB,CA+GF,CCtFO,MAAMiE,EAEX,CA0JA,YACEzF,EACA0F,EAII,GACJ,CACI,GA7JE,KAAA,aAAe,IAAI7R,GAM3B,KAAQ,aAAyD,KACjE,KAAQ,aAAmC,KAC3C,KAAQ,YAAc,GAEd,KAAA,cACN,IAAIgQ,GAA6B,IAAI,EAE/B,KAAA,cACN,IAAIY,GAA6B,IAAI,EAE/B,KAAA,kBACN,IAAI5C,GAAiC,IAAI,EAEnC,KAAA,cACN,IAAIe,GAA6B,IAAI,EAE/B,KAAA,aACN,IAAIoC,GAAkC,IAAI,EAI5C,KAAQ,SAAW,GAKnB,KAAS,MAAQ,CACf,QAAS,IAAI/O,EACb,UAAW,IAAIA,EACf,WAAY,IAAIA,EAChB,OAAQ,IAAIA,EACZ,eAAgB,IAAIA,EACpB,kBAAmB,IAAIA,EACvB,iBAAkB,IAAIA,EAItB,UAAW,IAAIA,EAIf,QAAS,IAAIA,CAAoB,EAsDnC,KAAA,mBAAqB,KAAK,kBAAkB,mBAC5C,KAAA,qBAAuB,KAAK,kBAAkB,qBAC9C,KAAA,SAAW,KAAK,kBAAkB,SAClC,KAAA,WAAa,KAAK,kBAAkB,WACpC,KAAA,UAAY,KAAK,kBAAkB,UAGnC,KAAA,WAAa,KAAK,aAAa,WAC/B,KAAA,cAAgB,KAAK,aAAa,cAClC,KAAA,eAAiB,KAAK,aAAa,eACnC,KAAA,0BAA4B,KAAK,aAAa,0BAC9C,KAAA,mBAAqB,KAAK,aAAa,mBACvC,KAAA,aAAe,KAAK,aAAa,aACjC,KAAA,QAAU,KAAK,aAAa,QAC5B,KAAA,mBAAqB,KAAK,aAAa,mBACvC,KAAA,YAAc,KAAK,aAAa,YAChC,KAAA,WAAa,KAAK,aAAa,WAC/B,KAAA,eAAiB,KAAK,aAAa,eACnC,KAAA,WAAa,KAAK,aAAa,WAC/B,KAAA,SAAW,KAAK,aAAa,SAC7B,KAAA,UAAY,KAAK,aAAa,UAC9B,KAAA,WAAa,KAAK,aAAa,WAC/B,KAAA,gBAAkB,KAAK,aAAa,gBAGpC,KAAA,uBAAyB,KAAK,aAAa,uBAC3C,KAAA,qBAAuB,KAAK,aAAa,qBACzC,KAAA,uBAAyB,KAAK,aAAa,uBAC3C,KAAA,0BAA4B,KAAK,aAAa,0BAG9C,KAAA,WAAa,KAAK,aAAa,WAC/B,KAAA,WAAa,KAAK,aAAa,WAC/B,KAAA,gBAAkB,KAAK,aAAa,gBACpC,KAAA,WAAa,KAAK,aAAa,WAC/B,KAAA,UAAY,KAAK,aAAa,UAC9B,KAAA,QAAU,KAAK,aAAa,QAiHpB,KAAA,eAAiB,CAACzI,EAAiBmY,IAAgC,CACzE,GAAI,KAAK,MAAM,SAAW,EAAA,SAAS,IAAI,EACrC,MAAM,IAAI,MACR,8EAAA,EAIC,KAAA,MAAM,WAAW,OAEd,QAAA,UACL,KAAK,IAAM,CAIV,GAHA,KAAK,aAAa,OAAA,EAAS,MAAM,QAAQ,KAAK,EAG1C,CADgB,KAAK,aAAa,eAAe,EACnC,OAEZ,MAAAC,EACJ,KAAK,aAAa,0BACdC,EACJ,KAAK,aAAa,wBAChB,GAAA,CAACD,GAA6B,CAACC,EAAyB,OAEtD,MAAAC,EAAM,KAAK,MAAM,IACvBta,EAAasa,CAAG,EAChB,MAAMC,EAAgBC,GACpBJ,EACAE,CAAA,EAEIG,EAAcD,GAClBH,EACAC,CAAA,EAEM,QAAA,IACN,4BACAG,EACAC,GAAyBN,CAAyB,CAAA,EAGpD,MAAMO,EAAaJ,GAAe,MAC5BK,EAAWH,GAAa,MAC1B,GAAA,CAACE,GAAc,CAACC,EAAU,OAE9B,MAAMjC,EAA8B,CAClC,MAAOgC,EACP,OAAQC,EAAWD,CAAA,EAEhB,KAAK,mBAAmBhC,CAAc,GAE3C,KAAK,eAAeA,CAAc,CACnC,CAAA,EACA,MAAM,QAAQ,KAAK,CAAA,EA/IlB,CAACnE,EAAM,IACH,MAAA,IAAI,MAAM,mCAAmC,EAGrD,GAAIA,EAAM,SAAA,EAAW,SAAS,IAAI,EAChC,MAAM,IAAI,MACR,8EAAA,EAIE,KAAA,CACJ,QAAAqG,EAAU,IAAM,GAChB,MAAA1L,EAAQ,CAAC,EACT,oBAAA2L,EAAsB,IACpB,EAAAZ,EACJ,KAAK,OAAS1F,EACd,KAAK,QAAUqG,EACf,KAAK,cAAgB,IAAI3L,GAAkB,KAAMC,CAAK,EACtD,KAAK,oBAAsB2L,EAEvBA,GACkBA,EAAA,mBAAmB,GAAW/V,GAAA,CAC3C,KAAA,MAAM,kBAAkB,KAAKA,CAAI,CAAA,CACvC,EAEH,KAAK,MAAM,kBAAkB,GAAG,KAAK,aAAa,oBAAoB,CACxE,CA3LA,MAAA,CAAA,KAAO,uBAAyBuN,EAAA,CAChC,MAAA,CAAA,KAAO,oBAAsBQ,EAAA,CAC7B,MAAA,CAAA,KAAO,wBAA0BX,CAAA,CAGjC,IAAI,aAAc,CAChB,OAAO,KAAK,YACd,CA+CA,IAAI,OAAQ,CACV,OAAO,KAAK,MACd,CAEA,IAAI,aAAc,CACT,OAAA,KAAK,MAAM,UACpB,CAEA,IAAI,aAAc,CAChB,OAAO,KAAK,MAAM,MACpB,CAEA,IAAI,aAAc,CACT,OAAA,KAAK,MAAM,SACpB,CAEA,IAAI,aAAc,CAChB,OAAAnS,EAAa,KAAK,YAAY,EACvB,KAAK,YACd,CAEA,IAAI,aAAc,CAChB,OAAAA,EAAa,KAAK,YAAY,EACvB,KAAK,YACd,CAEA,IAAI,cAAe,CACjB,OAAO,KAAK,aACd,CAEA,IAAI,cAAe,CACjB,OAAO,KAAK,aACd,CAEA,IAAI,kBAAmB,CACrB,OAAO,KAAK,iBACd,CAEA,IAAI,cAAe,CACjB,OAAO,KAAK,aACd,CAEA,IAAI,SAAU,CACZ,OAAO,KAAK,QACd,CAGA,IAAI,OAAQ,CACV,OAAO,KAAK,kBAAkB,KAChC,CAyCA,IAAI,OAAQ,CACV,OAAO,KAAK,cAAc,KAC5B,CAGA,IAAI,aAAc,CAChB,OAAO,KAAK,cAAc,WAC5B,CAsCA,MAAMiO,EAA0BqK,EAA2BrK,EAAa,CACtE,MAAM8M,EAAa9M,EACnB8M,EAAW,aAAe,KAC1B,KAAK,aAAeA,EACpB,KAAK,aAAezC,EACbR,GAAAkD,EAAS,KAAK,YAAY,EACjC,KAAK,aAAa,gBAAkB,OAC/B,KAAA,aAAa,MAAM,QAAU,OAClC,KAAK,aAAa,gBAAkB,OAC/B,KAAA,aAAa,MAAM,QAAU,OAC7B,KAAA,aAAa,QAAQ,MAAQ,OAElC,KAAK,mBAAmB,EAExB,KAAK,cAAc,QAEnB,KAAK,SAAW,GACX,KAAA,MAAM,QAAQ,OACnB,KAAK,cAAc,OAAA,EAAS,MAAM,QAAQ,KAAK,CACjD,CAEA,SAAU,CACJ,KAAK,YAAY,aACZlD,GAAAkD,EAAS,KAAK,WAAW,EAE7B,KAAA,YAAY,gBAAgBtN,EAAgB,EACjD,KAAK,aAAe,KACpB,KAAK,SAAW,GAChB,KAAK,YAAY,UACZ,KAAA,MAAM,UAAU,MACvB,CAEA,cAAc8J,EAAkB,GAAY,CAC1C,KAAK,cAAc,OAAOA,CAAe,EAAE,MAAM,QAAQ,KAAK,CAChE,CAEA,MAAM,eAAgB,CACpB,MAAM+B,EAAS,MAAM,KAAK,KAAK,YAAY,iBAAiB,QAAQ,CAAC,EACrE,MAAM,QAAQ,IAAIA,EAAO,IAAYvB,GAAAA,EAAK,cAAc,CAAC,CAC3D,CAEA,YAAYiD,EAA2B,CAChC,KAAA,YAAY,gBAAkBA,EAAa,QAAU,OAC1D,KAAK,YAAcA,CACrB,CAEA,IAAI,YAAa,CACf,OAAO,KAAK,WACd,CAEA,qBAAsB,CACf,KAAK,YAAY,cACfnD,GAAAkD,EAAS,KAAK,WAAW,EAChC,KAAK,cAAc,OAAA,EAAS,MAAM,QAAQ,KAAK,EACjD,CAEA,SAAS5Y,EAAsB,CACvB,MAAAkY,EAAM,KAAK,MAAM,IACvB,GAAI,CAACA,EACG,MAAA,IAAI,MAAM,gCAAgC,EAG9CA,EAAA,SAASlY,EAAIkY,EAAI,QAAQ,CAC/B,CAuDQ,oBAAqB,CACtB,KAAA,MAAM,QAAQ,KAAK,cAAc,EACtC,KAAK,YAAY,IAAI,CACnB,QAAS,IAAM,CACR,KAAA,MAAM,UAAU,KAAK,cAAc,CAC1C,CAAA,CACD,CACH,CACF,CCnWA;AAAA;AAAA;AAAA;AAAA,GAKA,SAASvN,GAAEA,EAAED,EAAE,EAAE,CAAC,OAAOC,EAAED,EAAEC,CAAC,EAAE,IAAIA,CAAC,CAAC,CCqB/B,SAASmO,GACdC,EACA,CACA,MAAMC,UAAqBD,CAAW,CAAtC,aAAA,CAAA,MAAA,GAAA,SAAA,EACY,KAAA,aAAe,IAAI9S,EAAgB,CAE7C,IAAI,aAAc,CAChB,OAAO,KAAK,YACd,CAES,mBAAoB,CAC3B,MAAM,kBAAkB,EACpB,KAAK,aAAa,WACf,KAAA,aAAe,IAAIA,GAE5B,CAES,sBAAuB,CAC9B,MAAM,qBAAqB,EAC3B,KAAK,aAAa,SACpB,CACF,CACO,OAAA+S,CACT,CC9CO,MAAMC,WAA0BjN,CAAW,CAChD,MAAA,CAAA,KAAO,kBAAoB,EAAA,CAE3B,OAA0B,eACxBkN,EACqB,CACjB,IAAAC,EAAgB,MAAM,eAAeD,CAAM,EAC/C,OAAI,KAAK,oBAGOC,EAAA,QAAS5Q,GAAyB,CAC9C,GAAIA,aAAa6Q,IAAa,OAAO,SAAa,IAAa,CAC7D,MAAMC,EAAY,SAAS,KACrBhM,EAAQ,SAAS,cAAc,OAAO,EAC5CA,EAAM,YAAc9E,EAAE,QACtB8Q,EAAU,YAAYhM,CAAK,CAAA,MAE3B,QAAQ,MAAM,aAAa,CAC7B,CACD,EACD8L,EAAgB,CAAA,GAEXA,CACT,CAES,kBAAmB,CAC1B,OAAQ,KAAK,YAAyC,kBAClD,KACA,MAAM,kBACZ,CACF,sMChBa,MAAAG,WAIHR,GAAeG,EAAiB,CAAE,CAJrC,aAAA,CAAA,MAAA,GAAA,SAAA,EAY4B,KAAA,QAAA,KAqBzB,KAAA,MAAA,GAWyB,KAAA,SAAA,KAiFnB,KAAA,YAAA,CACZ3Y,EACAgG,EACAtC,IACG,CACUpG,EAAA,KAAK,KAAM,6CAA6C,EACrE,MAAM2b,EAAS,CACb,QAASvV,GAAS,OACd,OACAA,GAAS,QACP,KAAK,MAAM,QACX,OACN,KAAMA,GAAS,QAAUA,GAAS,QAAU,OAAY,KAAK,IAAA,EAE1D,KAAA,aAAa,IAAI,KAAK,KAAK,MAAM,IAAI1D,EAAMgG,EAASiT,CAAM,CAAC,CAAA,EAmBlE,KAAA,YAAeC,GACN,KAAK,KAAK,YAAYA,CAAK,EAGpC,KAAA,oBAAuBA,GACd,KAAK,KAAK,oBAAoBA,CAAK,CAC5C,CApHA,IAAI,YAAuB,CACzB,OAAO,KAAK,KAAK,MAAM,EAAG,EAAE,CAC9B,CAEA,IAAI,oBAAqB,CACvB,MAAMC,EAAgB,KAAK,cAC3B7b,EAAa6b,CAAa,EAC1B,MAAM7P,EAAW,KAAK,KAAK,KAAK,YAAY6P,CAAa,EACzD,OAAA7b,EAAagM,CAAQ,EACdA,EAAS,IAClB,CAEA,IAAI,oBAAqB,CAEhB,OADU,KAAK,KAAK,KAAK,YAAY,KAAK,IAAI,EAElD,OAAOE,GAASA,EAAM,OAAS,OAAO,EACtC,IAAaA,GAAAA,EAAM,IAAoB,CAC5C,CAEA,IAAI,kBAAmB,CACf,MAAA+B,EAAc,KAAK,KAAK,KAAK,aACjC,QACA,KAAK,KAAK,MAAM,EAAG,CAAC,CAAA,EAEtB,OAAAjO,EAAaiO,CAAW,EACjBA,CACT,CAEA,IAAI,2BAAiD,CACnD,OAAO,KAAK,gBACd,CAEA,IAAI,SAAkB,CACpB,OAAO,KAAK,MAAM,OACpB,CAEA,IAAI,gBAA6D,CACxD,OAAA,OAAO,KAAK,KAAK,OAAO,EAAE,OAAO,CAAC6N,EAAS3Y,KACzC,CACL,GAAG2Y,EACH,CAAC3Y,CAAG,EAAG,KAAK,KAAK,KAAK,aAAa,SAAU,CAAC,GAAG,KAAK,KAAMA,CAAG,CAAC,CAAA,GAEjE,CAAE,CAAA,CACP,CAEA,IAAI,SAA+B,CACjC,OAAO,KAAK,KAAK,IAAI,KAAK,WAAW,KAAK,MAAM,OAAO,CAGzD,CAEA,IAAI,WAAY,CACd,OAAO,KAAK,KAAK,SACnB,CAEA,IAAI,KAAM,CACR,OAAO,KAAK,KAAK,GACnB,CAEA,IAAI,mBAAoB,CAChB,MAAAoT,EAAS,KAAK,KAAK,OAAO,iBAAiB,IAAI,KAAK,MAAM,OAAO,EACvEvW,EACEuW,EACA,kCAAkC,KAAK,MAAM,OAAO,EAAA,EAEtD,MAAMwF,EAAkBxF,EAAO,QACzByF,EAAgB,KAAK,MAAM,QACjC,OAAID,IAAoBC,GACd,QAAA,KACN,8BAA8B,KAAK,MAAM,EAAE,cAAcD,CAAe,YAAYC,CAAa,EAAA,EAE5F,IAGF,EACT,CAmBA,WACE7V,EACAC,EACA,CACapG,EAAA,KAAK,KAAM,6CAA6C,EACrE,MAAM2b,EAAS,CACb,QAASvV,GAAS,OACd,OACAA,GAAS,QACP,KAAK,MAAM,QACX,OACN,KAAMA,GAAS,QAAUA,GAAS,QAAU,OAAY,KAAK,IAAA,EAE1D,KAAA,aAAa,IAAI,KAAK,KAAK,MAAM,WAAWD,EAAQwV,CAAM,CAAC,CAClE,CAUA,MAAyB,mBAAsC,CACvD,MAAAjf,EAAS,MAAM,MAAM,oBACrB,aAAA,QAAQ,IAAI,KAAK,mBAAmB,IAAUmR,GAAAA,EAAG,cAAc,CAAC,EAC/DnR,CACT,CACmB,OAAOuf,EAAyC,CAG7D,KAAK,OAEF,KAAA,yBAA2B,KAAK,uBAAuB,QAAQ9O,GAElE,KAAK,sBAAsBA,EAAG,KAAKA,CAAe,CAAC,CAAA,EAGhD,KAAA,wBAA0B,IAC/B,KAAK,gBAAkB,GAEvB,KAAK,YAAc2K,GAAOkD,EAAS,KAAK,UAAU,EAE7C,KAAA,eACF,KAAK,IAAM,CACV,KAAK,MAAQ,EACd,CAAA,EACA,MAAM,QAAQ,KAAK,GAEtB,MAAM,OAAOiB,CAAiB,CAElC,CAES,mBAAoB,CAC3B,MAAM,kBAAkB,EAExB,KAAK,KAAO,KAAK,KAAK,KAAK,cAAc,IAAI,EAE7C,KAAK,aAAa,IAChB,KAAK,MAAM,aAAa,GAAG,IAAM,CAC/B,KAAK,cAAc,CAAA,CACpB,CAAA,EAGH,KAAK,aAAa,IAChB,KAAK,MAAM,gBAAgB,GAAG,IAAM,CAClC,KAAK,cAAc,CAAA,CACpB,CAAA,EAGH,KAAK,aAAa,IAChB,KAAK,KAAK,UAAU,MAAM,QAAQ,GAAiB9S,GAAA,CACjD,MAAMnC,EAAYmC,EAAW,KAAKnC,GACzB/D,EAAW,OAAO+D,EAAU,KAAM,KAAK,IAAI,CACnD,EAED,GAAI,CAACA,EAAW,CACd,KAAK,SAAW,KAChB,MACF,CAEA,KAAK,SAAWA,CAAA,CACjB,CAAA,CAEL,CAES,sBAAuB,CAC9B,MAAM,qBAAqB,CAC7B,CAEA,aAAuB,CACd,OAAAgU,CACT,CAEA,sBACEe,EACAC,EACgB,CACT,OAAApb;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA,0CAO+B,KAAK,MAAM,OAAO;AAAA;AAAA;AAAA,oCAGxBmb,CAAe;AAAA,kCACjBC,CAAa;AAAA;AAAA;AAAA,KAI7C,CAES,QAAS,CACT,OAAAE,GACL,KAAK,kBACL,IAAM,CACJ,MAAM3F,EAAS,KAAK,KAAK,OAAO,iBAAiB,IAC/C,KAAK,MAAM,OAAA,EAEbvW,EACEuW,EACA,kCAAkC,KAAK,MAAM,OAAO,EAAA,EAEtD,MAAMwF,EAAkBxF,EAAO,QACzByF,EAAgB,KAAK,MAAM,QAC1B,OAAA,KAAK,sBAAsBD,EAAiBC,CAAa,CAClE,EACA,IAAM,KAAK,YAAY,CAAA,CAE3B,CACF,CA9QEzN,GAAA,CADCC,EAAS,CAAE,UAAW,GAAO,CAAA,EALnBkN,GAMX,UAAA,OAAA,CAAA,EAGAnN,GAAA,CADCC,EAAS,CAAE,UAAW,GAAO,CAAA,EARnBkN,GASX,UAAA,QAAA,CAAA,EAGAnN,GAAA,CADCC,EAAS,CAAE,UAAW,GAAO,CAAA,EAXnBkN,GAYX,UAAA,UAAA,CAAA,EAeAnN,GAAA,CAbCC,EAAS,CACR,UAAW,GACX,WAAW1R,EAAOqf,EAAU,CACtB,MAAA,CAACrf,GAAS,CAACqf,EACNrf,IAAUqf,EAGf,CAAC,OAAO,KAAKrf,CAAK,EAAE,QAAU,CAAC,OAAO,KAAKqf,CAAQ,EAAE,OAChD,GAEFrf,IAAUqf,CACnB,CAAA,CACD,CAAA,EA1BUT,GA2BX,UAAA,UAAA,CAAA,EAGAnN,GAAA,CADCC,EAAS,CAAE,UAAW,GAAO,CAAA,EA7BnBkN,GA8BX,UAAA,OAAA,CAAA,EAGAnN,GAAA,CADCC,EAAS,CAAE,UAAW,GAAO,CAAA,EAhCnBkN,GAiCX,UAAA,QAAA,CAAA,EAWAnN,GAAA,CATCzL,GAAM,CACL,WAAWhG,EAA6Bqf,EAAgC,CAClE,MAAA,CAACrf,GAAS,CAACqf,EACNrf,IAAUqf,EAGZ,CAACrf,GAAO,OAAOqf,CAAQ,CAChC,CAAA,CACD,CAAA,EA3CUT,GA4CX,UAAA,WAAA,CAAA,ECnDK,MAAMU,EAAa,CAcxB,YAAmBC,EAAuB,CAAvB,KAAA,QAAAA,EA6BL,KAAA,YAAA,GACd,KAAQ,eAAuC,KACvC,KAAA,uBAA0BlT,GAAgC,CAE3D,KAAA,KAAK,eACP,KAAK,IAAM,CACV,MAAM1I,EACJ0I,EAAW,KAAMnC,GACfA,EAAU,GAAG,MAAM,CAChB,GAAA,MAGLvG,GAAQ,KAAK,eACTA,EAAK,OAAO,KAAK,cAAc,EAC/BA,IAAS,KAAK,kBAKpB,KAAK,eAAiBA,EAClBA,EACG,KAAA,aAAa,yBAAyBA,CAAI,EAE/C,KAAK,aAAa,QAErB,CAAA,EACA,MAAM,QAAQ,KAAK,CAAA,EAGxB,KAAQ,0BAA4B,SAAY,CAC9C,GAAI,KAAK,YAAa,OAEtB,MAAM,KAAK,KAAK,eAEV,MAAAuG,EAAY,SAAS,eAC3B,GAAI,CAACA,EAAW,CACd,KAAK,iBAAiB,MAAM,CAAC,MAAM,CAAC,EACpC,MACF,CACA,MAAMC,EAAQD,EAAU,WAAa,EAAIA,EAAU,WAAW,CAAC,EAAI,KAC7DsV,EACJ,CAAC,CAACtV,EAAU,YACZ,CAAC,CAACA,EAAU,YACXA,EAAU,aAAeA,EAAU,UAChCA,EAAU,aAAeA,EAAU,YACnCA,EAAU,WAAW,wBAAwBA,EAAU,SAAS,IAChE,KAAK,6BAEX,GAAIC,EAAO,CACH,MAAAiH,EAAe,KAAK,aAAa,uBACrCjH,EAAM,uBAAA,EAER,GAAIiH,GAAgBA,EAAa,YAAa,OAEzC,KAAA,eAAiB,KAAK,aAAa,qBACtCjH,EACAqV,CAAA,EAEG,KAAA,aAAa,yBAAyBrV,EAAOqV,CAAe,CAAA,MAEjE,KAAK,eAAiB,KACtB,KAAK,iBAAiB,MAAM,CAAC,MAAM,CAAC,CACtC,EAGM,KAAA,eAAkBxc,GAAsB,CAC9C,MAAMkH,EAAY,KAAK,iBAAiB,KAAK,MAAM,EAGnD,GAFI,CAACA,GAEDlH,EAAM,YAAa,OAEjB,KAAA,CAAE,KAAAuK,EAAM,GAAAC,CAAO,EAAAtD,EACrB,GAAI,CAACsD,GAAMrH,EAAW,OAAOoH,EAAK,KAAMC,EAAG,IAAI,EAAG,OAE5C,MAAArD,EAAQ,KAAK,aAAa,MAChC,GAAI,CAACA,EAAO,OAEZ,MAAMe,EAAS,KAAK,aAAa,gCAAgCf,EAAO,CACtE,KAAM,MAAA,CACP,EAEKM,EAAQS,EAAO,GAAG,CAAC,EACnBR,EAAMQ,EAAO,GAAG,EAAE,EACpB,GAAA,CAACT,GAAS,CAACC,EAAK,OAEd,MAAAqM,EAAYtM,EAAM,MAAM,KACxBuM,EAAUtM,EAAI,MAAM,KACtB,GAAA,CAACqM,GAAa,CAACC,EAAS,OAE5BhU,EAAM,eAAe,EAEhB,KAAA,KAAK,KAAK,SAAS,IAAM,CAC5B+T,EAAU,OAAOxJ,EAAK,MAAOA,EAAK,MAAM,EACxCwJ,EAAU,OAAO/T,EAAM,MAAQ,GAAIuK,EAAK,KAAK,EACrCyJ,EAAA,OAAO,EAAGxJ,EAAG,MAAM,EAC3BuJ,EAAU,KAAKC,CAAO,EAEtB9L,EACG,MAAM,CAAC,EAEP,QAAQ,EACR,QAAiBuU,GAAA,CAChB,MAAMhd,EAAS,KAAK,KAAK,KAAK,UAAUgd,EAAM,KAAK,EACnDvc,EAAaT,CAAM,EACnB,KAAK,KAAK,KAAK,YAAYgd,EAAM,MAAO,CACtC,gBAAiBhd,CAAA,CAClB,CAAA,CACF,CAAA,CACJ,EAED,MAAMid,EAAe,KAAK,iBAAiB,OAAO,OAAQ,CACxD,KAAM,CACJ,KAAMnS,EAAK,KACX,MAAOA,EAAK,OAASvK,EAAM,MAAM,QAAU,GAC3C,OAAQ,CACV,EACA,GAAI,IAAA,CACL,EACD,KAAK,iBAAiB,IAAI,CAAC0c,CAAY,CAAC,CAAA,EAG1C,KAAQ,0BAEG,KACX,KAAQ,oBAAsB,IAAM,CAClC,MAAMxV,EAAY,KAAK,iBAAiB,KAAK,MAAM,EACnD,GAAI,CAACA,EAAW,OAEV,KAAA,CAAE,KAAAqD,EAAM,GAAAC,CAAO,EAAAtD,EACrB,GAAI,CAACsD,EAAI,OAET,KAAK,YAAc,GAEb,MAAArD,EAAQ,KAAK,aAAa,MAChC,GAAI,CAACA,EAAO,OAEZ,MAAMe,EAAS,KAAK,aAAa,gCAAgCf,EAAO,CACtE,KAAM,MAAA,CACP,EACKwV,EAAgB,KAAK,aAAa,gCACtCxV,EACA,CACE,KAAM,UACN,MAAOsV,GAASA,EAAM,MAAM,OAAS,SACvC,CAAA,EAGIhV,EAAQS,EAAO,GAAG,CAAC,EACnBR,EAAMQ,EAAO,GAAG,EAAE,EACpB,GAAA,CAACT,GAAS,CAACC,EAAK,OAEd,MAAAqM,EAAYtM,EAAM,MAAM,KACxBuM,EAAUtM,EAAI,MAAM,KACtB,CAACqM,GAAa,CAACC,IAEd,KAAA,0BAA4B,MAAMhU,GAAS,CAC9C,KAAK,YAAc,GAEnB,MAAM4c,EAA0B,CAAA,EAChC,UAAWC,KAAgBF,EAAe,CACxC,MAAMld,EAAS,KAAK,KAAK,KAAK,UAAUod,EAAa,IAAI,GAAG,KACxD,EAAEpd,aAAkBmc,KAAiBgB,EAAQ,SAASnd,CAAM,IAIhEA,EAAO,MAAQ,GACf,MAAMA,EAAO,eACb,MAAMA,EAAO,eACbmd,EAAQ,KAAKnd,CAAM,EACrB,CAEK,KAAA,KAAK,KAAK,SAAS,IAAM,CACpBuU,EAAA,OAAO,EAAGxJ,EAAG,MAAM,EAC3BuJ,EAAU,KAAKC,CAAO,EAEtB9L,EACG,MAAM,CAAC,EAEP,QAAQ,EACR,QAAiBuU,GAAA,CAChB,MAAMhd,EAAS,KAAK,KAAK,KAAK,UAAUgd,EAAM,KAAK,EACnDvc,EAAaT,CAAM,EACnB,KAAK,KAAK,KAAK,YAAYgd,EAAM,MAAO,CACtC,gBAAiBhd,CAAA,CAClB,CAAA,CACF,CAAA,CACJ,EAED,MAAM,KAAK,KAAK,eAEhB,MAAMyH,EAAY,KAAK,iBAAiB,OAAO,OAAQ,CACrD,KAAM,CACJ,KAAMqD,EAAK,KACX,MAAOA,EAAK,OAASvK,EAAM,MAAM,QAAU,GAC3C,OAAQ,CACV,EACA,GAAI,IAAA,CACL,EACD,KAAK,KAAK,UAAU,IAAI,CAACkH,CAAS,CAAC,EAC9B,KAAA,aAAa,yBAAyBA,CAAS,CAAA,EACtD,EAEM,KAAA,kBAAqBlH,GAA4B,CACnD,KAAK,4BACPA,EAAM,eAAe,EACrB,KAAK,0BAA0BA,CAAK,EAAE,MAAM,QAAQ,KAAK,EACzD,KAAK,0BAA4B,KACnC,EA3OA,KAAK,KAAK,YAAY,IACpB,KAAK,iBAAiB,MAAM,QAAQ,GAAG,KAAK,sBAAsB,CAAA,EAGpE,KAAK,KAAK,YAAY,IACpB,KAAK,KAAK,MAAM,IAAI,kBAAmB,IAAM,CAC3C,KAAK,0BAA0B,EAAE,MAAM,QAAQ,KAAK,CAAA,CACrD,CAAA,EAGH,KAAK,KAAK,YAAY,IACpB,KAAK,KAAK,MAAM,IAAI,cAAsB6B,GAAA,CACxC,MAAM7B,EAAQ6B,EAAI,IAAI,cAAc,EAAE,MACtC,KAAK,eAAe7B,CAAK,CAAA,CAC1B,CAAA,EAGH,KAAK,KAAK,YAAY,IACpB,KAAK,KAAK,MAAM,IAAI,mBAAoB,KAAK,mBAAmB,CAAA,EAElE,KAAK,KAAK,YAAY,IACpB,KAAK,KAAK,MAAM,IAAI,iBAAyB6B,GAAA,CAC3C,MAAM7B,EAAQ6B,EAAI,IAAI,cAAc,EAAE,MACtC,KAAK,kBAAkB7B,CAAK,CAAA,CAC7B,CAAA,CAEL,CAxCA,IAAI,kBAAmB,CACrB,OAAO,KAAK,KAAK,SACnB,CAEA,IAAI,cAAe,CACJ,OAAAE,EAAA,KAAK,KAAK,YAAY,EAC5B,KAAK,KAAK,YACnB,CAEA,IAAI,MAAO,CACT,OAAO,KAAK,QAAQ,IACtB,CAgPF,CC3PO,MAAM4c,EAAa,CAMxB,YAAmB9Q,EAAkB,CAAlB,KAAA,KAAAA,EAFV,KAAA,QAAU,IAAIsQ,GAAa,IAAI,CAEF,CALtC,MAAA,CAAA,KAAO,qBAAuB,yBAAA,CAC9B,MAAA,CAAA,KAAO,sBAAwB,0BAAA,CAM/B,IAAI,OAAQ,CACJ,MAAApV,EAAY,SAAS,eAE3B,OADAhH,EAAagH,CAAS,EAClBA,EAAU,aAAe,EAAU,KAChCA,EAAU,WAAW,CAAC,CAC/B,CAEA,OAAQ,CACA,MAAAA,EAAY,SAAS,eAC3BhH,EAAagH,CAAS,EACtBA,EAAU,gBAAgB,EAEpB,MAAA6V,EAA4B,KAAK,KAAK,cAC1C,0BAAA,EAEEA,aAAqC,aACvCA,EAA0B,KAAK,CAEnC,CAEA,IAAI5V,EAAc,CACV,MAAAD,EAAY,SAAS,eAC3BhH,EAAagH,CAAS,EACtBA,EAAU,gBAAgB,EAC1BA,EAAU,SAASC,CAAK,CAC1B,CAEA,yBAAyBD,EAA0B,CAC3C,MAAAC,EAAQ,KAAK,qBAAqBD,CAAS,EAC7CC,EACF,KAAK,IAAIA,CAAK,EAEd,KAAK,MAAM,CAEf,CAEA,yBAAyBA,EAAcqV,EAA0B,CACzD,MAAAQ,EAAmB,KAAK,KAAK,UAEnC,GAAI,CAAC7V,EAAO,CACO6V,EAAA,MAAM,CAAC,MAAM,CAAC,EAC/B,MACF,CAEA,MAAMC,EAAgB,KAAK,qBAAqB9V,EAAOqV,CAAe,EAClES,EACFD,EAAiB,SAAS,OAAQ,CAACC,CAAa,CAAC,EAEhCD,EAAA,MAAM,CAAC,MAAM,CAAC,CAEnC,CAgBA,gCACE7V,EACAb,EAGI,GACY,CAChB,KAAM,CAAE,KAAAuT,EAAO,MAAO,MAAAD,EAAQ,IAAM,EAAS,EAAAtT,EAE7C,IAAI1J,EAAS,MAAM,KACjB,KAAK,KAAK,iBACR,IAAI,KAAK,KAAK,WAAW,UAAUkgB,GAAa,qBAAqB,WACvE,CAAA,EACA,OAAa/O,GAAA5G,EAAM,eAAe4G,CAAE,GAAK6L,EAAM7L,CAAE,CAAC,EAEhD,GAAAnR,EAAO,SAAW,EACpB,MAAO,GAGT,MAAMsgB,EAAe,KAAK,gBAAgB/V,EAAM,cAAc,EAG9D,GAFAjH,EAAagd,CAAY,EAErBrD,IAAS,OACXjd,EAASA,EAAO,UAEZsgB,EAAa,wBAAwBnP,CAAE,EACrC,KAAK,6BAA+BA,IAAOmP,CAAA,UAExCrD,IAAS,UAAW,CACzB,IAAApa,EAAS7C,EAAO,CAAC,EACrBA,EAASA,EAAO,OAAO,CAACuL,EAAM7L,IACxBA,IAAU,EAAU,GAEtBmD,EAAO,wBAAwB0I,CAAI,EACnC,KAAK,+BAEE,IAEE1I,EAAA0I,EACF,GAEV,CACH,CAEO,OAAAvL,CACT,CAEA,qBAAqBsK,EAAwC,CAC3D,KAAM,CAAE,KAAAqD,EAAM,GAAAC,EAAI,UAAAC,CAAA,EAAcvD,EAE1BiW,EAAmB,KAAK,wBAAwB5S,EAAK,IAAI,EAC/D,GAAI,CAAC4S,EAAyB,OAAA,KAE1B,GAAAjW,EAAU,gBACZ,OAAOiW,EAAiB,WAAW,CACjC,MAAO5S,EAAK,MACZ,OAAQA,EAAK,MAAA,CACd,EACI,CACLrK,EAAasK,CAAE,EACf,MAAM4S,EAAiB,KAAK,wBAAwB5S,EAAG,IAAI,EAC3D,GAAI,CAAC4S,EAAuB,OAAA,KAEtB,MAAAC,EAAYF,EAAiB,WAAW,CAC5C,MAAO5S,EAAK,MACZ,OAAQA,EAAK,MAAA,CACd,EACK+S,EAAUF,EAAe,WAAW,CACxC,MAAO5S,EAAG,MACV,OAAQA,EAAG,MAAA,CACZ,EAEG,GAAA,CAAC6S,GAAa,CAACC,EAAgB,OAAA,KAE7B,MAAAnW,EAAQ,SAAS,cACvB,GAAKsD,EAOE,CACL,MAAMsK,EAAiBuI,EAAQ,aACzBtI,EAAcsI,EAAQ,UACtBrI,EAAeoI,EAAU,eACzBnI,EAAYmI,EAAU,YACtBlW,EAAA,SAAS4N,EAAgBC,CAAW,EACpC7N,EAAA,OAAO8N,EAAcC,CAAS,CACtC,KAdgB,CACd,MAAMH,EAAiBsI,EAAU,eAC3BrI,EAAcqI,EAAU,YACxBpI,EAAeqI,EAAQ,aACvBpI,EAAYoI,EAAQ,UACpBnW,EAAA,SAAS4N,EAAgBC,CAAW,EACpC7N,EAAA,OAAO8N,EAAcC,CAAS,CAAA,CAS/B,OAAA/N,CACT,CACF,CAEA,qBAAqBA,EAAcoW,EAAU,GAA6B,CAClE,KAAA,CAAE,eAAAxI,EAAgB,aAAAE,CAAiB,EAAA9N,EAEnCqW,EAAa,KAAK,gBAAgBzI,CAAc,EAChD0I,EAAW,KAAK,gBAAgBxI,CAAY,EAC9C,GAAA,CAACuI,GAAc,CAACC,EACX,OAAA,KAGH,MAAAC,EAAoB,KAAK,uBAAuB3I,CAAc,EAC9D4I,EAAkB,KAAK,uBAAuB1I,CAAY,EAC5D,GAAA,CAACyI,GAAqB,CAACC,EAClB,OAAA,KAGH,MAAAC,EAAmBF,EAAkB,cAAcvW,CAAK,EACxD0W,EAAiBF,EAAgB,cAAcxW,CAAK,EACtD,MAAA,CAACyW,GAAoB,CAACC,EACjB,KAGF,KAAK,KAAK,UAAU,OAAO,OAAQ,CACxC,KAAM,CACJ,KAAML,EAAW,KACjB,MAAOI,EAAiB,MACxB,OAAQA,EAAiB,MAC3B,EACA,GACEJ,IAAeC,EACX,KACA,CACE,KAAMA,EAAS,KACf,MAAOI,EAAe,MACtB,OAAQA,EAAe,MACzB,EACN,UAAWN,CAAA,CACZ,CACH,CAEA,gBAAgBpV,EAAY,CAC1B,MAAM4F,EAAK5F,aAAgB,QAAUA,EAAOA,EAAK,cACjD,GAAI,CAAC4F,EAAW,OAAA,KAChB,MAAM0O,EAAQ1O,EAAG,QAAsB,IAAI,KAAK,KAAK,WAAW,GAAG,EAEnE,MADI,CAAC0O,GACDA,EAAM,aAAaK,GAAa,oBAAoB,IAAM,OACrD,KACFL,CACT,CACA,uBAAuBtU,EAAY,CACjC,MAAM4F,EAAK5F,aAAgB,QAAUA,EAAOA,EAAK,cACjD,GAAI,CAAC4F,EAAW,OAAA,KAChB,MAAMkN,EAAalN,EAAG,QAA2B,IAAIH,EAAgB,GAAG,EAKxE,MAJI,CAACqN,GAID,CADiB,KAAK,gBAAgBA,CAAU,EAC1B,KAEnBA,EAAW,YACpB,CAEA,wBAAwB7X,EAAgB,CACtC,MAAMqZ,EAAQ,KAAK,KAAK,KAAK,aAAa,QAASrZ,CAAI,EACvD,GAAI,CAACqZ,EAAc,OAAA,KAEnB,MAAMxB,EAAawB,EAAM,cACvB,IAAI7O,EAAgB,GAAA,EAMtB,MAJI,CAACqN,GAID,CADiB,KAAK,gBAAgBA,CAAU,EAC1B,KAEnBA,EAAW,YACpB,CACF,sMChOO,IAAM6C,GAAN,cAAyB1C,GAAeG,EAAiB,CAAE,CAA3D,aAAA,CAAA,MAAA,GAAA,SAAA,EAQS,KAAA,YAAA,gBAGC,KAAA,aAAA,iBAIqB,KAAA,aAAA,KAmFpC,KAAA,YAAeO,GAAsC,CAC7C,KAAA,CAAE,QAAAtU,CAAY,EAAAsU,EAEpB,GAAI,CADW,KAAK,KAAK,OAAO,iBAAiB,IAAItU,CAAO,EAElD,eAAA,KAAK,0BAA0BA,CAAO,GAAG,EAC1C1G,KAAOoa,CAAO,GAGvB,MAAMnP,EAAO,KAAK,IAAI,KAAK,QAAQvE,CAAO,EAC1C,GAAI,CAACuE,EACK,eAAA,KAAK,wBAAwBvE,CAAO,GAAG,EACxC1G,KAAOoa,CAAO,GAGvB,MAAM6C,EAAMhS,EAAK,UACXiS,EAA0CjS,EAAK,QACjD,OAAO,QAAQA,EAAK,OAAO,EAAE,OAAO,CAACiQ,EAAS,CAAC3Y,EAAK0a,CAAG,IAAM,CACrD,MAAA/O,EAAWlO,MAAQid,CAAG,IAAIE,GAC9B,KAAK,YACN,CAAA,IAAI5a,CAAG,UAAU,IAAI,UAAU,KAAK,IAAI,MAAM0a,CAAG,IAE3C,MAAA,CACL,GAAG/B,EACH,CAAC3Y,CAAG,EAAG2L,CAAA,CACT,EACC,CAAA,CAAE,EACL,GAEJ,OAAOlO,MAAQid,CAAG;AAAA,QACdE,GAAa,KAAK,WAAW,CAAC,IAAInC,EAAM,EAAE;AAAA,cACpC,IAAI;AAAA,cACJ,KAAK,IAAI;AAAA,eACRA,CAAK;AAAA,iBACHkC,CAAO;AAAA,SACfD,CAAG,GAAA,EAGV,KAAA,oBAAuBjC,GACdhb,KAAOmX,GACZ6D,EAAM,YACG1P,EAAM,GACfA,GAAS,KAAK,YAAYA,CAAK,CAChC,CAAA,GAGH,KAAQ,cAAgB,IAAM,CACtB,MAAA8R,EAAgB,IAAI,KAAK,WAAW,IACpCC,EAAiB,IAAI,KAAK,YAAY,IAEvC,KAAA,IAAI,KAAK,SAAkB,CAC9B,KAAM,QACN,QACEhW,GAAAiW,GACEjW,EACA,KAAK,YACL,KAAK,aACL,OACF,EACF,MAAO,CAAC,CAAE,KAAA4D,CAAA,IAAWA,EACrB,YACE5D,GAAAkW,GAAYlW,EAAM+V,EAAeC,EAAgB,OAAO,CAAA,CAC3D,EAEI,KAAA,IAAI,KAAK,SAAmB,CAC/B,KAAM,SACN,QACEhW,GAAAiW,GACEjW,EACA,KAAK,aACL,KAAK,YACL,QACF,EACF,MAAO,CAAC,CAAE,KAAA4D,CAAA,IAAWA,EACrB,YACE5D,GAAAkW,GAAYlW,EAAM+V,EAAeC,EAAgB,QAAQ,CAAA,CAC5D,CAAA,CACH,CA7JA,IAAI,SAA0B,CAC5B,OAAO,KAAK,IAAI,OAClB,CAEA,IAAI,OAA2B,CAC7B,OAAO,KAAK,IAAI,KAClB,CAEA,IAAI,WAA8B,CAChC,OAAO,KAAK,IAAI,SAClB,CAEA,IAAI,MAAkB,CACpB,OAAO,KAAK,IAAI,IAClB,CAEA,IAAI,MAAkB,CACpB,OAAO,KAAK,IAAI,IAClB,CAES,WAAWhC,EAAmC,CACjDA,EAAkB,IAAI,OAAO,GAC/B,KAAK,IAAI,KAAK,WAAW,KAAK,KAAK,EAErC,MAAM,WAAWA,CAAiB,CACpC,CAEA,MAAe,mBAAsC,CAC7C,MAAAvf,EAAS,MAAM,MAAM,oBACrBoR,EAAO,KAAK,KAAK,KACvB9N,EAAa8N,CAAI,EACjB,MAAMjC,EAAO,KAAK,IAAI,KAAK,QAAQiC,EAAK,OAAO,EAC/C9N,EAAa6L,CAAI,EACjB,MAAMuS,EAAa,OAAO,OAAOvS,EAAK,SAAW,CAAA,CAAE,EAC7CwS,EAAe,CAACxS,EAAK,UAAW,GAAGuS,CAAU,EACnD,aAAM,QAAQ,IACZC,EAAa,IAAWR,GAAA,CACtB,MAAM7P,EAAU,KAAK,WAAW,cAAc6P,EAAI,YAAY,EAC9D,GAAI7P,aAAmBI,EACrB,OAAOJ,EAAQ,cAEjB,CACD,CAAA,EAEItR,CACT,CAES,mBAAoB,CAGvB,GAFJ,MAAM,kBAAkB,EAEpB,CAAC,KAAK,KAAK,KACb,MAAM,IAAI,MACR,qHAAA,EAIC,KAAA,IAAM,IAAI+P,GAAc,CAC3B,KAAM,KACN,UAAW,KAAK,KAAK,UACrB,KAAM,KAAK,IAAA,CACZ,EACD,KAAK,cAAc,EAEnB,KAAK,IAAI,QACT,KAAK,IAAI,KAAK,WAAW,KAAK,KAAK,EAC9B,KAAA,aAAe,IAAImQ,GAAa,IAAI,CAC3C,CAES,sBAAuB,CAC9B,MAAM,qBAAqB,EAC3B,KAAK,IAAI,UACT,KAAK,aAAe,IACtB,CAES,QAAS,CACV,KAAA,CAAE,KAAA9O,CAAK,EAAI,KAAK,KACtB,OAAKA,EAEE,KAAK,YAAYA,CAAI,EAFVkN,CAGpB,CA+EF,EA7KEzM,GAAA,CADCC,EAAS,CAAE,UAAW,GAAO,CAAA,EADnBoP,GAEX,UAAA,QAAA,CAAA,EAGArP,GAAA,CADCC,EAAS,CAAE,UAAW,GAAO,CAAA,EAJnBoP,GAKX,UAAA,OAAA,CAAA,EAGArP,GAAA,CADCC,EAAS,CAAE,UAAW,GAAO,CAAA,EAPnBoP,GAQX,UAAA,cAAA,CAAA,EAGArP,GAAA,CADCC,EAAS,CAAE,UAAW,GAAO,CAAA,EAVnBoP,GAWX,UAAA,eAAA,CAAA,EAXWA,GAANrP,GAAA,CADNE,GAAc,aAAa,CAAA,EACfmP,EAAA,EAiLb,SAASM,GACPjW,EACAiB,EACAoV,EACApf,EACA,CACM,MAAAqf,EAAW,IAAIrV,CAAM,IACrBsV,EAAgB,IAAIF,CAAS,IAC7BtQ,EACJ/F,GAAQA,aAAgB,YAAcA,EAAOA,EAAK,cACpD,GAAI,CAAC+F,EAAgB,OAAA,KAEf,MAAAnC,EAAOmC,EAAQ,QAAWuQ,CAAQ,EACxC,GAAI,CAAC1S,EACI,OAAA,KAEH,MAAA4S,EAAMzQ,EAAQ,QAAQwQ,CAAa,EACrC,GAAA3S,EAAK,SAAS4S,CAAG,EACZ,OAAA,KAGH,MAAAxU,EAAK4B,EAAK,aAAa3C,CAAM,EACnC,OAAAlJ,EAAaiK,CAAE,EAER,CACL,GAAAA,EACA,KAAM4B,EAAK,KACX,KAAAA,EACA,KAAA3M,CAAA,CAEJ,CAEA,SAASif,GACPlW,EACA+V,EACAC,EACA/e,EACA,CACA,MAAMqf,EAAW,GAAGP,CAAa,IAAIC,CAAc,GACnD,OAAO,MAAM,KACXhW,EAAK,iBAA+CsW,CAAQ,CAAA,EAC5D,OACA5V,GACEA,EAAE,eAAe,QACfzJ,IAAS,QAAU8e,EAAgBC,CAAA,IAC/BhW,CAAA,CAEZ,sMCrPa,MAAAyW,WAEHxD,GAAe9M,CAAU,CAAE,CAF9B,aAAA,CAAA,MAAA,GAAA,SAAA,EAoCS,KAAA,YAAA,CACZ1L,EACAgG,EACAtC,IACG,CACH,KAAK,aAAa,IAChB,KAAK,KAAK,MAAM,IAAI1D,EAAMgG,EAAS,CACjC,QAAStC,GAAS,OAAS,OAAY,KAAK,OAAA,CAC7C,CAAA,CACH,CACF,CAnCA,IAAI,YAAqB,CACvB,OAAO,KAAK,KAAK,KAAK,KAAK,OAAS,CAAC,CACvC,CAEA,IAAI,UAAW,CACb,OAAO,KAAK,KAAK,MAAM,EAAG,EAAE,CAC9B,CAEA,IAAI,cAAkB,CACpB,MAAMyV,EAAgB,KAAK,cAC3B7b,EAAa6b,CAAa,EAC1B,MAAM7P,EAAW,KAAK,KAAK,KAAK,YAAY6P,CAAa,EACzD,OAAA7b,EAAagM,CAAQ,EACdA,EAAS,IAClB,CAEA,IAAI,SAAkB,CACpB,OAAAhM,EAAa,KAAK,YAAY,EACvB,KAAK,aAAa,MAAM,OACjC,CAEA,IAAI,KAAM,CACR,OAAO,KAAK,KAAK,GACnB,CAcA,WACEmG,EACAC,EACA,CACA,KAAK,aAAa,IAChB,KAAK,KAAK,MAAM,WAAWD,EAAQ,CACjC,QAASC,GAAS,OAAS,OAAY,KAAK,OAAA,CAC7C,CAAA,CAEL,CAES,mBAAoB,CAC3B,MAAM,kBAAkB,EACxB,KAAK,KAAO,KAAK,KAAK,KAAK,cAAc,IAAI,CAC/C,CAES,QAAkB,CAClB,OAAA,IACT,CACF,CA/DEmI,GAAA,CADCC,EAAS,CAAE,UAAW,GAAO,CAAA,EAHnBkQ,GAIX,UAAA,OAAA,CAAA,EAGAnQ,GAAA,CADCC,EAAS,CAAE,UAAW,GAAO,CAAA,EANnBkQ,GAOX,UAAA,OAAA,CAAA,ECZF,MAAMC,GAAQ,CAAC,MAAO,QAAS,SAAU,MAAM,EACzCC,GAAa,CAAC,QAAS,KAAK,EAC5BC,GAA0BF,GAAM,OAAO,CAAC/P,EAAKkQ,IAASlQ,EAAI,OAAOkQ,EAAMA,EAAO,IAAMF,GAAW,CAAC,EAAGE,EAAO,IAAMF,GAAW,CAAC,CAAC,EAAG,CAAA,CAAE,EAClIG,EAAM,KAAK,IACXC,EAAM,KAAK,IACXC,GAAQ,KAAK,MACbC,GAAQ,KAAK,MACbC,GAAelI,IAAM,CACzB,EAAGA,EACH,EAAGA,CACL,GACMmI,GAAkB,CACtB,KAAM,QACN,MAAO,OACP,OAAQ,MACR,IAAK,QACP,EACMC,GAAuB,CAC3B,MAAO,MACP,IAAK,OACP,EACA,SAASC,GAAM/X,EAAOzK,EAAO0K,EAAK,CAChC,OAAOwX,EAAIzX,EAAOwX,EAAIjiB,EAAO0K,CAAG,CAAC,CACnC,CACA,SAAS+X,EAASziB,EAAO0iB,EAAO,CAC9B,OAAO,OAAO1iB,GAAU,WAAaA,EAAM0iB,CAAK,EAAI1iB,CACtD,CACA,SAAS2iB,EAAQC,EAAW,CAC1B,OAAOA,EAAU,MAAM,GAAG,EAAE,CAAC,CAC/B,CACA,SAASC,EAAaD,EAAW,CAC/B,OAAOA,EAAU,MAAM,GAAG,EAAE,CAAC,CAC/B,CACA,SAASE,GAAgBC,EAAM,CAC7B,OAAOA,IAAS,IAAM,IAAM,GAC9B,CACA,SAASC,GAAcD,EAAM,CAC3B,OAAOA,IAAS,IAAM,SAAW,OACnC,CACA,SAASE,GAAYL,EAAW,CAC9B,MAAO,CAAC,MAAO,QAAQ,EAAE,SAASD,EAAQC,CAAS,CAAC,EAAI,IAAM,GAChE,CACA,SAASM,GAAiBN,EAAW,CACnC,OAAOE,GAAgBG,GAAYL,CAAS,CAAC,CAC/C,CACA,SAASO,GAAkBP,EAAWQ,EAAOC,EAAK,CAC5CA,IAAQ,SACVA,EAAM,IAER,MAAMC,EAAYT,EAAaD,CAAS,EAClCW,EAAgBL,GAAiBN,CAAS,EAC1C/hB,EAASmiB,GAAcO,CAAa,EAC1C,IAAIC,EAAoBD,IAAkB,IAAMD,KAAeD,EAAM,MAAQ,SAAW,QAAU,OAASC,IAAc,QAAU,SAAW,MAC9I,OAAIF,EAAM,UAAUviB,CAAM,EAAIuiB,EAAM,SAASviB,CAAM,IACjD2iB,EAAoBC,GAAqBD,CAAiB,GAErD,CAACA,EAAmBC,GAAqBD,CAAiB,CAAC,CACpE,CACA,SAASE,GAAsBd,EAAW,CACxC,MAAMe,EAAoBF,GAAqBb,CAAS,EACxD,MAAO,CAACgB,GAA8BhB,CAAS,EAAGe,EAAmBC,GAA8BD,CAAiB,CAAC,CACvH,CACA,SAASC,GAA8BhB,EAAW,CAChD,OAAOA,EAAU,QAAQ,aAAcU,GAAaf,GAAqBe,CAAS,CAAC,CACrF,CACA,SAASO,GAAY7B,EAAM8B,EAAST,EAAK,CACvC,MAAMU,EAAK,CAAC,OAAQ,OAAO,EACrBC,EAAK,CAAC,QAAS,MAAM,EACrBC,EAAK,CAAC,MAAO,QAAQ,EACrBC,EAAK,CAAC,SAAU,KAAK,EAC3B,OAAQlC,EAAI,CACV,IAAK,MACL,IAAK,SACH,OAAIqB,EAAYS,EAAUE,EAAKD,EACxBD,EAAUC,EAAKC,EACxB,IAAK,OACL,IAAK,QACH,OAAOF,EAAUG,EAAKC,EACxB,QACE,MAAO,EACV,CACH,CACA,SAASC,GAA0BvB,EAAWwB,EAAeC,EAAWhB,EAAK,CAC3E,MAAMC,EAAYT,EAAaD,CAAS,EACxC,IAAI0B,EAAOT,GAAYlB,EAAQC,CAAS,EAAGyB,IAAc,QAAShB,CAAG,EACrE,OAAIC,IACFgB,EAAOA,EAAK,IAAItC,GAAQA,EAAO,IAAMsB,CAAS,EAC1Cc,IACFE,EAAOA,EAAK,OAAOA,EAAK,IAAIV,EAA6B,CAAC,IAGvDU,CACT,CACA,SAASb,GAAqBb,EAAW,CACvC,OAAOA,EAAU,QAAQ,yBAA0BZ,GAAQM,GAAgBN,CAAI,CAAC,CAClF,CACA,SAASuC,GAAoBC,EAAS,CACpC,MAAO,CACL,IAAK,EACL,MAAO,EACP,OAAQ,EACR,KAAM,EACN,GAAGA,CACP,CACA,CACA,SAASC,GAAiBD,EAAS,CACjC,OAAO,OAAOA,GAAY,SAAWD,GAAoBC,CAAO,EAAI,CAClE,IAAKA,EACL,MAAOA,EACP,OAAQA,EACR,KAAMA,CACV,CACA,CACA,SAASE,GAAiB9b,EAAM,CAC9B,MAAO,CACL,GAAGA,EACH,IAAKA,EAAK,EACV,KAAMA,EAAK,EACX,MAAOA,EAAK,EAAIA,EAAK,MACrB,OAAQA,EAAK,EAAIA,EAAK,MAC1B,CACA,CC3HA,SAAS+b,GAA2BC,EAAMhC,EAAWS,EAAK,CACxD,GAAI,CACF,UAAAwB,EACA,SAAAC,CACD,EAAGF,EACJ,MAAMG,EAAW9B,GAAYL,CAAS,EAChCW,EAAgBL,GAAiBN,CAAS,EAC1CoC,EAAchC,GAAcO,CAAa,EACzCvB,EAAOW,EAAQC,CAAS,EACxBqC,EAAaF,IAAa,IAC1BG,EAAUL,EAAU,EAAIA,EAAU,MAAQ,EAAIC,EAAS,MAAQ,EAC/DK,EAAUN,EAAU,EAAIA,EAAU,OAAS,EAAIC,EAAS,OAAS,EACjEM,EAAcP,EAAUG,CAAW,EAAI,EAAIF,EAASE,CAAW,EAAI,EACzE,IAAIK,EACJ,OAAQrD,EAAI,CACV,IAAK,MACHqD,EAAS,CACP,EAAGH,EACH,EAAGL,EAAU,EAAIC,EAAS,MAClC,EACM,MACF,IAAK,SACHO,EAAS,CACP,EAAGH,EACH,EAAGL,EAAU,EAAIA,EAAU,MACnC,EACM,MACF,IAAK,QACHQ,EAAS,CACP,EAAGR,EAAU,EAAIA,EAAU,MAC3B,EAAGM,CACX,EACM,MACF,IAAK,OACHE,EAAS,CACP,EAAGR,EAAU,EAAIC,EAAS,MAC1B,EAAGK,CACX,EACM,MACF,QACEE,EAAS,CACP,EAAGR,EAAU,EACb,EAAGA,EAAU,CACrB,CACG,CACD,OAAQhC,EAAaD,CAAS,EAAC,CAC7B,IAAK,QACHyC,EAAO9B,CAAa,GAAK6B,GAAe/B,GAAO4B,EAAa,GAAK,GACjE,MACF,IAAK,MACHI,EAAO9B,CAAa,GAAK6B,GAAe/B,GAAO4B,EAAa,GAAK,GACjE,KACH,CACD,OAAOI,CACT,CASA,MAAMC,GAAkB,MAAOT,EAAWC,EAAUjG,IAAW,CAC7D,KAAM,CACJ,UAAA+D,EAAY,SACZ,SAAA2C,EAAW,WACX,WAAAzjB,EAAa,CAAE,EACf,SAAA0jB,CACD,EAAG3G,EACE4G,EAAkB3jB,EAAW,OAAO,OAAO,EAC3CuhB,EAAM,MAAOmC,EAAS,OAAS,KAAO,OAASA,EAAS,MAAMV,CAAQ,GAC5E,IAAI1B,EAAQ,MAAMoC,EAAS,gBAAgB,CACzC,UAAAX,EACA,SAAAC,EACA,SAAAS,CACJ,CAAG,EACG,CACF,EAAA1Z,EACA,EAAAiB,CACD,EAAG6X,GAA2BvB,EAAOR,EAAWS,CAAG,EAChDqC,EAAoB9C,EACpB+C,EAAiB,CAAA,EACjBC,EAAa,EACjB,QAAS1mB,EAAI,EAAGA,EAAIumB,EAAgB,OAAQvmB,IAAK,CAC/C,KAAM,CACJ,KAAA0G,EACA,GAAAN,CACN,EAAQmgB,EAAgBvmB,CAAC,EACf,CACJ2mB,EACA,EAAGC,EACH,KAAApkB,EACA,MAAAqkB,CACD,EAAG,MAAMzgB,EAAG,CACX,EAAAuG,EACA,EAAAiB,EACA,iBAAkB8V,EAClB,UAAW8C,EACX,SAAAH,EACA,eAAAI,EACA,MAAAvC,EACA,SAAAoC,EACA,SAAU,CACR,UAAAX,EACA,SAAAC,CACD,CACP,CAAK,EAUD,GATAjZ,EAAIga,GAAwBha,EAC5BiB,EAAIgZ,GAAwBhZ,EAC5B6Y,EAAiB,CACf,GAAGA,EACH,CAAC/f,CAAI,EAAG,CACN,GAAG+f,EAAe/f,CAAI,EACtB,GAAGlE,CACJ,CACP,EACQqkB,GAASH,GAAc,GAAI,CAC7BA,IACI,OAAOG,GAAU,WACfA,EAAM,YACRL,EAAoBK,EAAM,WAExBA,EAAM,QACR3C,EAAQ2C,EAAM,QAAU,GAAO,MAAMP,EAAS,gBAAgB,CAC5D,UAAAX,EACA,SAAAC,EACA,SAAAS,CACZ,CAAW,EAAIQ,EAAM,OAEZ,CACC,EAAAla,EACA,EAAAiB,CACD,EAAG6X,GAA2BvB,EAAOsC,EAAmBrC,CAAG,GAE9DnkB,EAAI,GACJ,QACD,CACF,CACD,MAAO,CACL,EAAA2M,EACA,EAAAiB,EACA,UAAW4Y,EACX,SAAAH,EACA,eAAAI,CACJ,CACA,EAUA,eAAeK,GAAehgB,EAAOsD,EAAS,CAC5C,IAAI2c,EACA3c,IAAY,SACdA,EAAU,CAAA,GAEZ,KAAM,CACJ,EAAAuC,EACA,EAAAiB,EACA,SAAA0Y,EACA,MAAApC,EACA,SAAAnW,EACA,SAAAsY,CACD,EAAGvf,EACE,CACJ,SAAAkgB,EAAW,oBACX,aAAAC,EAAe,WACf,eAAAC,EAAiB,WACjB,YAAAC,EAAc,GACd,QAAA7B,EAAU,CACd,EAAM/B,EAASnZ,EAAStD,CAAK,EACrBsgB,EAAgB7B,GAAiBD,CAAO,EAExCtT,EAAUjE,EAASoZ,EADND,IAAmB,WAAa,YAAc,WACbA,CAAc,EAC5DG,EAAqB7B,GAAiB,MAAMc,EAAS,gBAAgB,CACzE,SAAWS,EAAwB,MAAOT,EAAS,WAAa,KAAO,OAASA,EAAS,UAAUtU,CAAO,KAAO,MAAO+U,EAAgC/U,EAAUA,EAAQ,gBAAmB,MAAOsU,EAAS,oBAAsB,KAAO,OAASA,EAAS,mBAAmBvY,EAAS,QAAQ,GAChS,SAAAiZ,EACA,aAAAC,EACA,SAAAZ,CACD,CAAA,CAAC,EACI3c,EAAOwd,IAAmB,WAAa,CAC3C,GAAGhD,EAAM,SACT,EAAAvX,EACA,EAAAiB,CACJ,EAAMsW,EAAM,UACJoD,EAAe,MAAOhB,EAAS,iBAAmB,KAAO,OAASA,EAAS,gBAAgBvY,EAAS,QAAQ,GAC5GwZ,EAAe,MAAOjB,EAAS,WAAa,KAAO,OAASA,EAAS,UAAUgB,CAAY,GAAO,MAAOhB,EAAS,UAAY,KAAO,OAASA,EAAS,SAASgB,CAAY,IAAO,CACvL,EAAG,EACH,EAAG,CACP,EAAM,CACF,EAAG,EACH,EAAG,CACP,EACQE,EAAoBhC,GAAiBc,EAAS,sDAAwD,MAAMA,EAAS,sDAAsD,CAC/K,KAAA5c,EACA,aAAA4d,EACA,SAAAjB,CACJ,CAAG,EAAI3c,CAAI,EACT,MAAO,CACL,KAAM2d,EAAmB,IAAMG,EAAkB,IAAMJ,EAAc,KAAOG,EAAY,EACxF,QAASC,EAAkB,OAASH,EAAmB,OAASD,EAAc,QAAUG,EAAY,EACpG,MAAOF,EAAmB,KAAOG,EAAkB,KAAOJ,EAAc,MAAQG,EAAY,EAC5F,OAAQC,EAAkB,MAAQH,EAAmB,MAAQD,EAAc,OAASG,EAAY,CACpG,CACA,CAOA,MAAME,GAAQrd,IAAY,CACxB,KAAM,QACN,QAAAA,EACA,MAAM,GAAGtD,EAAO,CACd,KAAM,CACJ,EAAA6F,EACA,EAAAiB,EACA,UAAA8V,EACA,MAAAQ,EACA,SAAAoC,EACA,SAAAvY,EACA,eAAA0Y,CACD,EAAG3f,EAEE,CACJ,QAAAkL,EACA,QAAAsT,EAAU,CACX,EAAG/B,EAASnZ,EAAStD,CAAK,GAAK,CAAA,EAChC,GAAIkL,GAAW,KACb,MAAO,GAET,MAAMoV,EAAgB7B,GAAiBD,CAAO,EACxCa,EAAS,CACb,EAAAxZ,EACA,EAAAiB,CACN,EACUiW,EAAOG,GAAiBN,CAAS,EACjC/hB,EAASmiB,GAAcD,CAAI,EAC3B6D,EAAkB,MAAMpB,EAAS,cAActU,CAAO,EACtD2V,EAAU9D,IAAS,IACnB+D,EAAUD,EAAU,MAAQ,OAC5BE,EAAUF,EAAU,SAAW,QAC/BG,EAAaH,EAAU,eAAiB,cACxCI,EAAU7D,EAAM,UAAUviB,CAAM,EAAIuiB,EAAM,UAAUL,CAAI,EAAIsC,EAAOtC,CAAI,EAAIK,EAAM,SAASviB,CAAM,EAChGqmB,EAAY7B,EAAOtC,CAAI,EAAIK,EAAM,UAAUL,CAAI,EAC/CoE,EAAoB,MAAO3B,EAAS,iBAAmB,KAAO,OAASA,EAAS,gBAAgBtU,CAAO,GAC7G,IAAIkW,EAAaD,EAAoBA,EAAkBH,CAAU,EAAI,GAGjE,CAACI,GAAc,CAAE,MAAO5B,EAAS,WAAa,KAAO,OAASA,EAAS,UAAU2B,CAAiB,MACpGC,EAAana,EAAS,SAAS+Z,CAAU,GAAK5D,EAAM,SAASviB,CAAM,GAErE,MAAMwmB,EAAoBJ,EAAU,EAAIC,EAAY,EAI9CI,EAAyBF,EAAa,EAAIR,EAAgB/lB,CAAM,EAAI,EAAI,EACxE0mB,EAAatF,EAAIqE,EAAcQ,CAAO,EAAGQ,CAAsB,EAC/DE,EAAavF,EAAIqE,EAAcS,CAAO,EAAGO,CAAsB,EAI/DG,EAAQF,EACRrF,EAAMkF,EAAaR,EAAgB/lB,CAAM,EAAI2mB,EAC7CE,EAASN,EAAa,EAAIR,EAAgB/lB,CAAM,EAAI,EAAIwmB,EACxD5R,EAAS+M,GAAMiF,EAAOC,EAAQxF,CAAG,EAMjCyF,EAAkB,CAAChC,EAAe,OAAS9C,EAAaD,CAAS,GAAK,MAAQ8E,GAAUjS,GAAU2N,EAAM,UAAUviB,CAAM,EAAI,GAAK6mB,EAASD,EAAQF,EAAaC,GAAcZ,EAAgB/lB,CAAM,EAAI,EAAI,EAC3M+mB,EAAkBD,EAAkBD,EAASD,EAAQC,EAASD,EAAQC,EAASxF,EAAM,EAC3F,MAAO,CACL,CAACa,CAAI,EAAGsC,EAAOtC,CAAI,EAAI6E,EACvB,KAAM,CACJ,CAAC7E,CAAI,EAAGtN,EACR,aAAciS,EAASjS,EAASmS,EAChC,GAAID,GAAmB,CACrB,gBAAAC,CACD,CACF,EACD,MAAOD,CACb,CACG,CACH,GAEA,SAASE,GAAiBvE,EAAWwE,EAAeC,EAAmB,CAErE,OAD2CzE,EAAY,CAAC,GAAGyE,EAAkB,OAAOnF,GAAaC,EAAaD,CAAS,IAAMU,CAAS,EAAG,GAAGyE,EAAkB,OAAOnF,GAAaC,EAAaD,CAAS,IAAMU,CAAS,CAAC,EAAIyE,EAAkB,OAAOnF,GAAaD,EAAQC,CAAS,IAAMA,CAAS,GACxP,OAAOA,GAC3CU,EACKT,EAAaD,CAAS,IAAMU,IAAcwE,EAAgBlE,GAA8BhB,CAAS,IAAMA,EAAY,IAErH,EACR,CACH,CAOA,MAAMoF,GAAgB,SAAU1e,EAAS,CACvC,OAAIA,IAAY,SACdA,EAAU,CAAA,GAEL,CACL,KAAM,gBACN,QAAAA,EACA,MAAM,GAAGtD,EAAO,CACd,IAAIiiB,EAAuBC,EAAwBC,EACnD,KAAM,CACJ,MAAA/E,EACA,eAAAuC,EACA,UAAA/C,EACA,SAAA4C,EACA,SAAAvY,CACD,EAAGjH,EACE,CACJ,UAAAoiB,EAAY,GACZ,UAAA9E,EACA,kBAAAyE,EAAoBhG,GACpB,cAAA+F,EAAgB,GAChB,GAAGO,CACX,EAAU5F,EAASnZ,EAAStD,CAAK,EACrBsiB,EAAehF,IAAc,QAAayE,IAAsBhG,GAAa8F,GAAiBvE,GAAa,KAAMwE,EAAeC,CAAiB,EAAIA,EACrJQ,EAAW,MAAMvC,GAAehgB,EAAOqiB,CAAqB,EAC5DG,IAAiBP,EAAwBtC,EAAe,gBAAkB,KAAO,OAASsC,EAAsB,QAAU,EAC1HQ,EAAmBH,EAAaE,CAAY,EAClD,GAAIC,GAAoB,KACtB,MAAO,GAET,MAAMC,EAAiBvF,GAAkBsF,EAAkBrF,EAAO,MAAOoC,EAAS,OAAS,KAAO,OAASA,EAAS,MAAMvY,EAAS,QAAQ,EAAE,EAG7I,GAAI2V,IAAc6F,EAChB,MAAO,CACL,MAAO,CACL,UAAWH,EAAa,CAAC,CAC1B,CACX,EAEM,MAAMK,EAAmB,CAACJ,EAAS5F,EAAQ8F,CAAgB,CAAC,EAAGF,EAASG,EAAe,CAAC,CAAC,EAAGH,EAASG,EAAe,CAAC,CAAC,CAAC,EACjHE,EAAe,CAAC,KAAMV,EAAyBvC,EAAe,gBAAkB,KAAO,OAASuC,EAAuB,YAAc,CAAA,EAAK,CAC9I,UAAWO,EACX,UAAWE,CACnB,CAAO,EACKE,EAAgBP,EAAaE,EAAe,CAAC,EAGnD,GAAIK,EACF,MAAO,CACL,KAAM,CACJ,MAAOL,EAAe,EACtB,UAAWI,CACZ,EACD,MAAO,CACL,UAAWC,CACZ,CACX,EAEM,MAAMC,EAA8BF,EAAa,IAAItY,GAAK,CACxD,MAAMgT,EAAYT,EAAavS,EAAE,SAAS,EAC1C,MAAO,CAACA,EAAE,UAAWgT,GAAa8E,EAElC9X,EAAE,UAAU,MAAM,EAAG,CAAC,EAAE,OAAO,CAACwB,EAAKqI,IAAMrI,EAAMqI,EAAG,CAAC,EAErD7J,EAAE,UAAU,CAAC,EAAGA,EAAE,SAAS,CACnC,CAAO,EAAE,KAAK,CAACjR,EAAGsD,IAAMtD,EAAE,CAAC,EAAIsD,EAAE,CAAC,CAAC,EAKvBomB,IAAmBZ,EAJWW,EAA4B,OAAOxY,GAAKA,EAAE,CAAC,EAAE,MAAM,EAGvFuS,EAAavS,EAAE,CAAC,CAAC,EAAI,EAAI,CAAC,EAAE,MAAM6J,GAAKA,GAAK,CAAC,CAAC,EAC+B,CAAC,IAAM,KAAO,OAASgO,EAAsB,CAAC,IAAMW,EAA4B,CAAC,EAAE,CAAC,EACjK,OAAIC,IAAmBnG,EACd,CACL,KAAM,CACJ,MAAO4F,EAAe,EACtB,UAAWI,CACZ,EACD,MAAO,CACL,UAAWG,CACZ,CACX,EAEa,EACR,CACL,CACA,EAQMC,GAAO,SAAU1f,EAAS,CAC9B,OAAIA,IAAY,SACdA,EAAU,CAAA,GAEL,CACL,KAAM,OACN,QAAAA,EACA,MAAM,GAAGtD,EAAO,CACd,IAAIijB,EAAuBC,EAC3B,KAAM,CACJ,UAAAtG,EACA,eAAA+C,EACA,MAAAvC,EACA,iBAAA+F,EACA,SAAA3D,EACA,SAAAvY,CACD,EAAGjH,EACE,CACJ,SAAUojB,EAAgB,GAC1B,UAAWC,EAAiB,GAC5B,mBAAoBC,EACpB,iBAAAC,EAAmB,UACnB,0BAAAC,EAA4B,OAC5B,cAAApF,EAAgB,GAChB,GAAGiE,CACX,EAAU5F,EAASnZ,EAAStD,CAAK,EAM3B,IAAKijB,EAAwBtD,EAAe,QAAU,MAAQsD,EAAsB,gBAClF,MAAO,GAET,MAAMjH,EAAOW,EAAQC,CAAS,EACxB6G,EAAkB9G,EAAQwG,CAAgB,IAAMA,EAChD9F,EAAM,MAAOmC,EAAS,OAAS,KAAO,OAASA,EAAS,MAAMvY,EAAS,QAAQ,GAC/Eyc,EAAqBJ,IAAgCG,GAAmB,CAACrF,EAAgB,CAACX,GAAqB0F,CAAgB,CAAC,EAAIzF,GAAsByF,CAAgB,GAC5K,CAACG,GAA+BE,IAA8B,QAChEE,EAAmB,KAAK,GAAGvF,GAA0BgF,EAAkB/E,EAAeoF,EAA2BnG,CAAG,CAAC,EAEvH,MAAMtB,EAAa,CAACoH,EAAkB,GAAGO,CAAkB,EACrDnB,EAAW,MAAMvC,GAAehgB,EAAOqiB,CAAqB,EAC5DsB,EAAY,CAAA,EAClB,IAAIC,IAAkBV,EAAuBvD,EAAe,OAAS,KAAO,OAASuD,EAAqB,YAAc,CAAA,EAIxH,GAHIE,GACFO,EAAU,KAAKpB,EAASvG,CAAI,CAAC,EAE3BqH,EAAgB,CAClB,MAAMxH,EAAQsB,GAAkBP,EAAWQ,EAAOC,CAAG,EACrDsG,EAAU,KAAKpB,EAAS1G,EAAM,CAAC,CAAC,EAAG0G,EAAS1G,EAAM,CAAC,CAAC,CAAC,CACtD,CAOD,GANA+H,EAAgB,CAAC,GAAGA,EAAe,CACjC,UAAAhH,EACA,UAAA+G,CACR,CAAO,EAGG,CAACA,EAAU,MAAM3H,GAAQA,GAAQ,CAAC,EAAG,CACvC,IAAI6H,EAAuBC,EAC3B,MAAMC,KAAeF,EAAwBlE,EAAe,OAAS,KAAO,OAASkE,EAAsB,QAAU,GAAK,EACpHhB,EAAgB9G,EAAWgI,CAAS,EAC1C,GAAIlB,EAEF,MAAO,CACL,KAAM,CACJ,MAAOkB,EACP,UAAWH,CACZ,EACD,MAAO,CACL,UAAWf,CACZ,CACb,EAKQ,IAAIE,GAAkBe,EAAwBF,EAAc,OAAOtZ,GAAKA,EAAE,UAAU,CAAC,GAAK,CAAC,EAAE,KAAK,CAACjR,EAAGsD,IAAMtD,EAAE,UAAU,CAAC,EAAIsD,EAAE,UAAU,CAAC,CAAC,EAAE,CAAC,IAAM,KAAO,OAASmnB,EAAsB,UAG1L,GAAI,CAACf,EACH,OAAQQ,EAAgB,CACtB,IAAK,UACH,CACE,IAAIS,EACJ,MAAMpH,GAAaoH,EAAwBJ,EAAc,IAAItZ,GAAK,CAACA,EAAE,UAAWA,EAAE,UAAU,OAAOiY,GAAYA,EAAW,CAAC,EAAE,OAAO,CAACzW,EAAKyW,KAAazW,EAAMyW,GAAU,CAAC,CAAC,CAAC,EAAE,KAAK,CAAClpB,EAAGsD,IAAMtD,EAAE,CAAC,EAAIsD,EAAE,CAAC,CAAC,EAAE,CAAC,IAAM,KAAO,OAASqnB,EAAsB,CAAC,EAClPpH,IACFmG,EAAiBnG,GAEnB,KACD,CACH,IAAK,mBACHmG,EAAiBI,EACjB,KACH,CAEH,GAAIvG,IAAcmG,EAChB,MAAO,CACL,MAAO,CACL,UAAWA,CACZ,CACb,CAEO,CACD,MAAO,EACR,CACL,CACA,EAuEA,SAASkB,GAAgB7G,EAAO,CAC9B,MAAM8G,EAAOjI,EAAI,GAAGmB,EAAM,IAAIxa,GAAQA,EAAK,IAAI,CAAC,EAC1CuhB,EAAOlI,EAAI,GAAGmB,EAAM,IAAIxa,GAAQA,EAAK,GAAG,CAAC,EACzCwhB,EAAOlI,EAAI,GAAGkB,EAAM,IAAIxa,GAAQA,EAAK,KAAK,CAAC,EAC3CyhB,EAAOnI,EAAI,GAAGkB,EAAM,IAAIxa,GAAQA,EAAK,MAAM,CAAC,EAClD,MAAO,CACL,EAAGshB,EACH,EAAGC,EACH,MAAOC,EAAOF,EACd,OAAQG,EAAOF,CACnB,CACA,CACA,SAASG,GAAelH,EAAO,CAC7B,MAAMmH,EAAcnH,EAAM,MAAK,EAAG,KAAK,CAAC/jB,EAAGsD,IAAMtD,EAAE,EAAIsD,EAAE,CAAC,EACpD6nB,EAAS,CAAA,EACf,IAAIC,EAAW,KACf,QAAS,EAAI,EAAG,EAAIF,EAAY,OAAQ,IAAK,CAC3C,MAAM3hB,EAAO2hB,EAAY,CAAC,EACtB,CAACE,GAAY7hB,EAAK,EAAI6hB,EAAS,EAAIA,EAAS,OAAS,EACvDD,EAAO,KAAK,CAAC5hB,CAAI,CAAC,EAElB4hB,EAAOA,EAAO,OAAS,CAAC,EAAE,KAAK5hB,CAAI,EAErC6hB,EAAW7hB,CACZ,CACD,OAAO4hB,EAAO,IAAI5hB,GAAQ8b,GAAiBuF,GAAgBrhB,CAAI,CAAC,CAAC,CACnE,CAMA,MAAM8hB,GAAS,SAAUphB,EAAS,CAChC,OAAIA,IAAY,SACdA,EAAU,CAAA,GAEL,CACL,KAAM,SACN,QAAAA,EACA,MAAM,GAAGtD,EAAO,CACd,KAAM,CACJ,UAAA4c,EACA,SAAA3V,EACA,MAAAmW,EACA,SAAAoC,EACA,SAAAD,CACD,EAAGvf,EAIE,CACJ,QAAAwe,EAAU,EACV,EAAA3Y,EACA,EAAAiB,CACR,EAAU2V,EAASnZ,EAAStD,CAAK,EACrB2kB,EAAoB,MAAM,KAAM,MAAOnF,EAAS,gBAAkB,KAAO,OAASA,EAAS,eAAevY,EAAS,SAAS,IAAO,CAAA,CAAE,EACrI2d,EAAcN,GAAeK,CAAiB,EAC9CE,EAAWnG,GAAiBuF,GAAgBU,CAAiB,CAAC,EAC9DrE,EAAgB7B,GAAiBD,CAAO,EAC9C,SAASsG,GAAwB,CAE/B,GAAIF,EAAY,SAAW,GAAKA,EAAY,CAAC,EAAE,KAAOA,EAAY,CAAC,EAAE,OAAS/e,GAAK,MAAQiB,GAAK,KAE9F,OAAO8d,EAAY,KAAKhiB,GAAQiD,EAAIjD,EAAK,KAAO0d,EAAc,MAAQza,EAAIjD,EAAK,MAAQ0d,EAAc,OAASxZ,EAAIlE,EAAK,IAAM0d,EAAc,KAAOxZ,EAAIlE,EAAK,OAAS0d,EAAc,MAAM,GAAKuE,EAI/L,GAAID,EAAY,QAAU,EAAG,CAC3B,GAAI3H,GAAYL,CAAS,IAAM,IAAK,CAClC,MAAMmI,EAAYH,EAAY,CAAC,EACzBI,EAAWJ,EAAYA,EAAY,OAAS,CAAC,EAC7CK,EAAQtI,EAAQC,CAAS,IAAM,MAC/BsI,EAAMH,EAAU,IAChBI,EAASH,EAAS,OAClBI,EAAOH,EAAQF,EAAU,KAAOC,EAAS,KACzCK,EAAQJ,EAAQF,EAAU,MAAQC,EAAS,MAC3CM,EAAQD,EAAQD,EAChBG,GAASJ,EAASD,EACxB,MAAO,CACL,IAAAA,EACA,OAAAC,EACA,KAAAC,EACA,MAAAC,EACA,MAAAC,EACA,OAAAC,GACA,EAAGH,EACH,EAAGF,CACjB,CACW,CACD,MAAMM,EAAa7I,EAAQC,CAAS,IAAM,OACpC6I,EAAWvJ,EAAI,GAAG0I,EAAY,IAAIhiB,GAAQA,EAAK,KAAK,CAAC,EACrD8iB,EAAUzJ,EAAI,GAAG2I,EAAY,IAAIhiB,GAAQA,EAAK,IAAI,CAAC,EACnD+iB,EAAef,EAAY,OAAOhiB,GAAQ4iB,EAAa5iB,EAAK,OAAS8iB,EAAU9iB,EAAK,QAAU6iB,CAAQ,EACtGP,EAAMS,EAAa,CAAC,EAAE,IACtBR,EAASQ,EAAaA,EAAa,OAAS,CAAC,EAAE,OAC/CP,EAAOM,EACPL,EAAQI,EACRH,EAAQD,EAAQD,EAChBG,EAASJ,EAASD,EACxB,MAAO,CACL,IAAAA,EACA,OAAAC,EACA,KAAAC,EACA,MAAAC,EACA,MAAAC,EACA,OAAAC,EACA,EAAGH,EACH,EAAGF,CACf,CACS,CACD,OAAOL,CACR,CACD,MAAMe,EAAa,MAAMpG,EAAS,gBAAgB,CAChD,UAAW,CACT,sBAAAsF,CACD,EACD,SAAU7d,EAAS,SACnB,SAAAsY,CACR,CAAO,EACD,OAAInC,EAAM,UAAU,IAAMwI,EAAW,UAAU,GAAKxI,EAAM,UAAU,IAAMwI,EAAW,UAAU,GAAKxI,EAAM,UAAU,QAAUwI,EAAW,UAAU,OAASxI,EAAM,UAAU,SAAWwI,EAAW,UAAU,OACnM,CACL,MAAO,CACL,MAAOA,CACR,CACX,EAEa,EACR,CACL,CACA,EAKA,eAAeC,GAAqB7lB,EAAOsD,EAAS,CAClD,KAAM,CACJ,UAAAsZ,EACA,SAAA4C,EACA,SAAAvY,CACD,EAAGjH,EACEqd,EAAM,MAAOmC,EAAS,OAAS,KAAO,OAASA,EAAS,MAAMvY,EAAS,QAAQ,GAC/E+U,EAAOW,EAAQC,CAAS,EACxBU,EAAYT,EAAaD,CAAS,EAClCqC,EAAahC,GAAYL,CAAS,IAAM,IACxCkJ,EAAgB,CAAC,OAAQ,KAAK,EAAE,SAAS9J,CAAI,EAAI,GAAK,EACtD+J,EAAiB1I,GAAO4B,EAAa,GAAK,EAC1C+G,EAAWvJ,EAASnZ,EAAStD,CAAK,EAGxC,GAAI,CACF,SAAAimB,EACA,UAAA7D,EACA,cAAA7E,CACJ,EAAM,OAAOyI,GAAa,SAAW,CACjC,SAAUA,EACV,UAAW,EACX,cAAe,IACnB,EAAM,CACF,SAAU,EACV,UAAW,EACX,cAAe,KACf,GAAGA,CACP,EACE,OAAI1I,GAAa,OAAOC,GAAkB,WACxC6E,EAAY9E,IAAc,MAAQC,EAAgB,GAAKA,GAElD0B,EAAa,CAClB,EAAGmD,EAAY2D,EACf,EAAGE,EAAWH,CAClB,EAAM,CACF,EAAGG,EAAWH,EACd,EAAG1D,EAAY2D,CACnB,CACA,CASK,MAACtW,GAAS,SAAUnM,EAAS,CAChC,OAAIA,IAAY,SACdA,EAAU,GAEL,CACL,KAAM,SACN,QAAAA,EACA,MAAM,GAAGtD,EAAO,CACd,IAAIkmB,EAAuBjD,EAC3B,KAAM,CACJ,EAAApd,EACA,EAAAiB,EACA,UAAA8V,EACA,eAAA+C,CACD,EAAG3f,EACEmmB,EAAa,MAAMN,GAAqB7lB,EAAOsD,CAAO,EAI5D,OAAIsZ,MAAgBsJ,EAAwBvG,EAAe,SAAW,KAAO,OAASuG,EAAsB,aAAejD,EAAwBtD,EAAe,QAAU,MAAQsD,EAAsB,gBACjM,GAEF,CACL,EAAGpd,EAAIsgB,EAAW,EAClB,EAAGrf,EAAIqf,EAAW,EAClB,KAAM,CACJ,GAAGA,EACH,UAAAvJ,CACD,CACT,CACK,CACL,CACA,EAOM3b,GAAQ,SAAUqC,EAAS,CAC/B,OAAIA,IAAY,SACdA,EAAU,CAAA,GAEL,CACL,KAAM,QACN,QAAAA,EACA,MAAM,GAAGtD,EAAO,CACd,KAAM,CACJ,EAAA6F,EACA,EAAAiB,EACA,UAAA8V,CACD,EAAG5c,EACE,CACJ,SAAUojB,EAAgB,GAC1B,UAAWC,EAAiB,GAC5B,QAAA+C,EAAU,CACR,GAAIxH,GAAQ,CACV,GAAI,CACF,EAAA/Y,EACA,EAAAiB,CACD,EAAG8X,EACJ,MAAO,CACL,EAAA/Y,EACA,EAAAiB,CACd,CACW,CACF,EACD,GAAGub,CACX,EAAU5F,EAASnZ,EAAStD,CAAK,EACrBqf,EAAS,CACb,EAAAxZ,EACA,EAAAiB,CACR,EACYyb,EAAW,MAAMvC,GAAehgB,EAAOqiB,CAAqB,EAC5DD,EAAYnF,GAAYN,EAAQC,CAAS,CAAC,EAC1CqJ,EAAWnJ,GAAgBsF,CAAS,EAC1C,IAAIiE,EAAgBhH,EAAO4G,CAAQ,EAC/BK,EAAiBjH,EAAO+C,CAAS,EACrC,GAAIgB,EAAe,CACjB,MAAMmD,EAAUN,IAAa,IAAM,MAAQ,OACrCO,EAAUP,IAAa,IAAM,SAAW,QACxChK,EAAMoK,EAAgB9D,EAASgE,CAAO,EACtCrK,EAAMmK,EAAgB9D,EAASiE,CAAO,EAC5CH,EAAgB7J,GAAMP,EAAKoK,EAAenK,CAAG,CAC9C,CACD,GAAImH,EAAgB,CAClB,MAAMkD,EAAUnE,IAAc,IAAM,MAAQ,OACtCoE,EAAUpE,IAAc,IAAM,SAAW,QACzCnG,EAAMqK,EAAiB/D,EAASgE,CAAO,EACvCrK,EAAMoK,EAAiB/D,EAASiE,CAAO,EAC7CF,EAAiB9J,GAAMP,EAAKqK,EAAgBpK,CAAG,CAChD,CACD,MAAMuK,EAAgBL,EAAQ,GAAG,CAC/B,GAAGpmB,EACH,CAACimB,CAAQ,EAAGI,EACZ,CAACjE,CAAS,EAAGkE,CACrB,CAAO,EACD,MAAO,CACL,GAAGG,EACH,KAAM,CACJ,EAAGA,EAAc,EAAI5gB,EACrB,EAAG4gB,EAAc,EAAI3f,CACtB,CACT,CACK,CACL,CACA,EAIM4f,GAAa,SAAUpjB,EAAS,CACpC,OAAIA,IAAY,SACdA,EAAU,CAAA,GAEL,CACL,QAAAA,EACA,GAAGtD,EAAO,CACR,KAAM,CACJ,EAAA6F,EACA,EAAAiB,EACA,UAAA8V,EACA,MAAAQ,EACA,eAAAuC,CACD,EAAG3f,EACE,CACJ,OAAAyP,EAAS,EACT,SAAU2T,EAAgB,GAC1B,UAAWC,EAAiB,EACpC,EAAU5G,EAASnZ,EAAStD,CAAK,EACrBqf,EAAS,CACb,EAAAxZ,EACA,EAAAiB,CACR,EACYsb,EAAYnF,GAAYL,CAAS,EACjCqJ,EAAWnJ,GAAgBsF,CAAS,EAC1C,IAAIiE,EAAgBhH,EAAO4G,CAAQ,EAC/BK,EAAiBjH,EAAO+C,CAAS,EACrC,MAAMuE,EAAYlK,EAAShN,EAAQzP,CAAK,EAClC4mB,EAAiB,OAAOD,GAAc,SAAW,CACrD,SAAUA,EACV,UAAW,CACnB,EAAU,CACF,SAAU,EACV,UAAW,EACX,GAAGA,CACX,EACM,GAAIvD,EAAe,CACjB,MAAMyD,EAAMZ,IAAa,IAAM,SAAW,QACpCa,EAAW1J,EAAM,UAAU6I,CAAQ,EAAI7I,EAAM,SAASyJ,CAAG,EAAID,EAAe,SAC5EG,EAAW3J,EAAM,UAAU6I,CAAQ,EAAI7I,EAAM,UAAUyJ,CAAG,EAAID,EAAe,SAC/EP,EAAgBS,EAClBT,EAAgBS,EACPT,EAAgBU,IACzBV,EAAgBU,EAEnB,CACD,GAAI1D,EAAgB,CAClB,IAAI6C,EAAuBc,EAC3B,MAAMH,EAAMZ,IAAa,IAAM,QAAU,SACnCgB,EAAe,CAAC,MAAO,MAAM,EAAE,SAAStK,EAAQC,CAAS,CAAC,EAC1DkK,EAAW1J,EAAM,UAAUgF,CAAS,EAAIhF,EAAM,SAASyJ,CAAG,GAAKI,KAAiBf,EAAwBvG,EAAe,SAAW,KAAO,OAASuG,EAAsB9D,CAAS,IAAM,IAAU6E,EAAe,EAAIL,EAAe,WACnOG,EAAW3J,EAAM,UAAUgF,CAAS,EAAIhF,EAAM,UAAUyJ,CAAG,GAAKI,EAAe,IAAMD,EAAyBrH,EAAe,SAAW,KAAO,OAASqH,EAAuB5E,CAAS,IAAM,IAAM6E,EAAeL,EAAe,UAAY,GAChPN,EAAiBQ,EACnBR,EAAiBQ,EACRR,EAAiBS,IAC1BT,EAAiBS,EAEpB,CACD,MAAO,CACL,CAACd,CAAQ,EAAGI,EACZ,CAACjE,CAAS,EAAGkE,CACrB,CACK,CACL,CACA,EAQMY,GAAO,SAAU5jB,EAAS,CAC9B,OAAIA,IAAY,SACdA,EAAU,CAAA,GAEL,CACL,KAAM,OACN,QAAAA,EACA,MAAM,GAAGtD,EAAO,CACd,KAAM,CACJ,UAAA4c,EACA,MAAAQ,EACA,SAAAoC,EACA,SAAAvY,CACD,EAAGjH,EACE,CACJ,MAAAmnB,EAAQ,IAAM,CAAE,EAChB,GAAG9E,CACX,EAAU5F,EAASnZ,EAAStD,CAAK,EACrBuiB,EAAW,MAAMvC,GAAehgB,EAAOqiB,CAAqB,EAC5DrG,EAAOW,EAAQC,CAAS,EACxBU,EAAYT,EAAaD,CAAS,EAClCiE,EAAU5D,GAAYL,CAAS,IAAM,IACrC,CACJ,MAAA0I,EACA,OAAAC,CACR,EAAUnI,EAAM,SACV,IAAIgK,EACAC,EACArL,IAAS,OAASA,IAAS,UAC7BoL,EAAapL,EACbqL,EAAY/J,KAAgB,MAAOkC,EAAS,OAAS,KAAO,OAASA,EAAS,MAAMvY,EAAS,QAAQ,GAAM,QAAU,OAAS,OAAS,UAEvIogB,EAAYrL,EACZoL,EAAa9J,IAAc,MAAQ,MAAQ,UAE7C,MAAMgK,EAA0B/B,EAAShD,EAAS6E,CAAU,EACtDG,EAAyBjC,EAAQ/C,EAAS8E,CAAS,EACnDhlB,EAAU,CAACrC,EAAM,eAAe,MACtC,IAAIwnB,EAAkBF,EAClBG,EAAiBF,EACrB,GAAI1G,EAAS,CACX,MAAM6G,EAAuBpC,EAAQ/C,EAAS,KAAOA,EAAS,MAC9DkF,EAAiBnK,GAAajb,EAAU4Z,EAAIsL,EAAwBG,CAAoB,EAAIA,CACpG,KAAa,CACL,MAAMC,EAAwBpC,EAAShD,EAAS,IAAMA,EAAS,OAC/DiF,EAAkBlK,GAAajb,EAAU4Z,EAAIqL,EAAyBK,CAAqB,EAAIA,CAChG,CACD,GAAItlB,GAAW,CAACib,EAAW,CACzB,MAAMsK,EAAO1L,EAAIqG,EAAS,KAAM,CAAC,EAC3BsF,EAAO3L,EAAIqG,EAAS,MAAO,CAAC,EAC5BuF,EAAO5L,EAAIqG,EAAS,IAAK,CAAC,EAC1BwF,EAAO7L,EAAIqG,EAAS,OAAQ,CAAC,EAC/B1B,EACF4G,EAAiBnC,EAAQ,GAAKsC,IAAS,GAAKC,IAAS,EAAID,EAAOC,EAAO3L,EAAIqG,EAAS,KAAMA,EAAS,KAAK,GAExGiF,EAAkBjC,EAAS,GAAKuC,IAAS,GAAKC,IAAS,EAAID,EAAOC,EAAO7L,EAAIqG,EAAS,IAAKA,EAAS,MAAM,EAE7G,CACD,MAAM4E,EAAM,CACV,GAAGnnB,EACH,eAAAynB,EACA,gBAAAD,CACR,CAAO,EACD,MAAMQ,EAAiB,MAAMxI,EAAS,cAAcvY,EAAS,QAAQ,EACrE,OAAIqe,IAAU0C,EAAe,OAASzC,IAAWyC,EAAe,OACvD,CACL,MAAO,CACL,MAAO,EACR,CACX,EAEa,EACR,CACL,CACA,EC7/BA,SAASC,GAAY9iB,EAAM,CACzB,OAAI+iB,GAAO/iB,CAAI,GACLA,EAAK,UAAY,IAAI,YAAW,EAKnC,WACT,CACA,SAASgjB,EAAUhjB,EAAM,CACvB,IAAIijB,EACJ,OAAQjjB,GAAQ,OAASijB,EAAsBjjB,EAAK,gBAAkB,KAAO,OAASijB,EAAoB,cAAgB,MAC5H,CACA,SAASC,GAAmBljB,EAAM,CAChC,IAAIyZ,EACJ,OAAQA,GAAQsJ,GAAO/iB,CAAI,EAAIA,EAAK,cAAgBA,EAAK,WAAa,OAAO,WAAa,KAAO,OAASyZ,EAAK,eACjH,CACA,SAASsJ,GAAOluB,EAAO,CACrB,OAAOA,aAAiB,MAAQA,aAAiBmuB,EAAUnuB,CAAK,EAAE,IACpE,CACA,SAASsuB,EAAUtuB,EAAO,CACxB,OAAOA,aAAiB,SAAWA,aAAiBmuB,EAAUnuB,CAAK,EAAE,OACvE,CACA,SAASuuB,EAAcvuB,EAAO,CAC5B,OAAOA,aAAiB,aAAeA,aAAiBmuB,EAAUnuB,CAAK,EAAE,WAC3E,CACA,SAASwuB,GAAaxuB,EAAO,CAE3B,OAAI,OAAO,WAAe,IACjB,GAEFA,aAAiB,YAAcA,aAAiBmuB,EAAUnuB,CAAK,EAAE,UAC1E,CACA,SAASyuB,GAAkBvd,EAAS,CAClC,KAAM,CACJ,SAAAqX,EACA,UAAAmG,EACA,UAAAC,EACA,QAAAC,CACJ,EAAMC,EAAiB3d,CAAO,EAC5B,MAAO,kCAAkC,KAAKqX,EAAWoG,EAAYD,CAAS,GAAK,CAAC,CAAC,SAAU,UAAU,EAAE,SAASE,CAAO,CAC7H,CACA,SAASE,GAAe5d,EAAS,CAC/B,MAAO,CAAC,QAAS,KAAM,IAAI,EAAE,SAAS+c,GAAY/c,CAAO,CAAC,CAC5D,CACA,SAAS6d,GAAkB7d,EAAS,CAClC,MAAM8d,EAASC,KACTC,EAAML,EAAiB3d,CAAO,EAGpC,OAAOge,EAAI,YAAc,QAAUA,EAAI,cAAgB,SAAWA,EAAI,cAAgBA,EAAI,gBAAkB,SAAW,KAAU,CAACF,IAAWE,EAAI,eAAiBA,EAAI,iBAAmB,OAAS,KAAU,CAACF,IAAWE,EAAI,OAASA,EAAI,SAAW,OAAS,KAAU,CAAC,YAAa,cAAe,QAAQ,EAAE,KAAKlvB,IAAUkvB,EAAI,YAAc,IAAI,SAASlvB,CAAK,CAAC,GAAK,CAAC,QAAS,SAAU,SAAU,SAAS,EAAE,KAAKA,IAAUkvB,EAAI,SAAW,IAAI,SAASlvB,CAAK,CAAC,CACnc,CACA,SAASmvB,GAAmBje,EAAS,CACnC,IAAIke,EAAcC,GAAcne,CAAO,EACvC,KAAOqd,EAAca,CAAW,GAAK,CAACE,GAAsBF,CAAW,GAAG,CACxE,GAAIL,GAAkBK,CAAW,EAC/B,OAAOA,EAEPA,EAAcC,GAAcD,CAAW,CAE1C,CACD,OAAO,IACT,CACA,SAASH,IAAW,CAClB,OAAI,OAAO,IAAQ,KAAe,CAAC,IAAI,SAAiB,GACjD,IAAI,SAAS,0BAA2B,MAAM,CACvD,CACA,SAASK,GAAsBnkB,EAAM,CACnC,MAAO,CAAC,OAAQ,OAAQ,WAAW,EAAE,SAAS8iB,GAAY9iB,CAAI,CAAC,CACjE,CACA,SAAS0jB,EAAiB3d,EAAS,CACjC,OAAOid,EAAUjd,CAAO,EAAE,iBAAiBA,CAAO,CACpD,CACA,SAASqe,GAAcre,EAAS,CAC9B,OAAIod,EAAUpd,CAAO,EACZ,CACL,WAAYA,EAAQ,WACpB,UAAWA,EAAQ,SACzB,EAES,CACL,WAAYA,EAAQ,YACpB,UAAWA,EAAQ,WACvB,CACA,CACA,SAASme,GAAclkB,EAAM,CAC3B,GAAI8iB,GAAY9iB,CAAI,IAAM,OACxB,OAAOA,EAET,MAAMvL,EAENuL,EAAK,cAELA,EAAK,YAELqjB,GAAarjB,CAAI,GAAKA,EAAK,MAE3BkjB,GAAmBljB,CAAI,EACvB,OAAOqjB,GAAa5uB,CAAM,EAAIA,EAAO,KAAOA,CAC9C,CACA,SAAS4vB,GAA2BrkB,EAAM,CACxC,MAAMskB,EAAaJ,GAAclkB,CAAI,EACrC,OAAImkB,GAAsBG,CAAU,EAC3BtkB,EAAK,cAAgBA,EAAK,cAAc,KAAOA,EAAK,KAEzDojB,EAAckB,CAAU,GAAKhB,GAAkBgB,CAAU,EACpDA,EAEFD,GAA2BC,CAAU,CAC9C,CACA,SAASC,GAAqBvkB,EAAMmZ,EAAMqL,EAAiB,CACzD,IAAIC,EACAtL,IAAS,SACXA,EAAO,CAAA,GAELqL,IAAoB,SACtBA,EAAkB,IAEpB,MAAME,EAAqBL,GAA2BrkB,CAAI,EACpD2kB,EAASD,MAAyBD,EAAuBzkB,EAAK,gBAAkB,KAAO,OAASykB,EAAqB,MACrHG,EAAM5B,EAAU0B,CAAkB,EACxC,OAAIC,EACKxL,EAAK,OAAOyL,EAAKA,EAAI,gBAAkB,CAAE,EAAEtB,GAAkBoB,CAAkB,EAAIA,EAAqB,GAAIE,EAAI,cAAgBJ,EAAkBD,GAAqBK,EAAI,YAAY,EAAI,CAAA,CAAE,EAE/LzL,EAAK,OAAOuL,EAAoBH,GAAqBG,EAAoB,CAAE,EAAEF,CAAe,CAAC,CACtG,CCvHA,SAASK,GAAiB9e,EAAS,CACjC,MAAMge,EAAML,EAAiB3d,CAAO,EAGpC,IAAIoa,EAAQ,WAAW4D,EAAI,KAAK,GAAK,EACjC3D,EAAS,WAAW2D,EAAI,MAAM,GAAK,EACvC,MAAMe,EAAY1B,EAAcrd,CAAO,EACjCgf,EAAcD,EAAY/e,EAAQ,YAAcoa,EAChD6E,EAAeF,EAAY/e,EAAQ,aAAeqa,EAClD6E,EAAiBjO,GAAMmJ,CAAK,IAAM4E,GAAe/N,GAAMoJ,CAAM,IAAM4E,EACzE,OAAIC,IACF9E,EAAQ4E,EACR3E,EAAS4E,GAEJ,CACL,MAAA7E,EACA,OAAAC,EACA,EAAG6E,CACP,CACA,CAEA,SAASC,GAAcnf,EAAS,CAC9B,OAAQod,EAAUpd,CAAO,EAA6BA,EAAzBA,EAAQ,cACvC,CAEA,SAASof,GAASpf,EAAS,CACzB,MAAMqf,EAAaF,GAAcnf,CAAO,EACxC,GAAI,CAACqd,EAAcgC,CAAU,EAC3B,OAAOlO,GAAa,CAAC,EAEvB,MAAMzZ,EAAO2nB,EAAW,wBAClB,CACJ,MAAAjF,EACA,OAAAC,EACA,EAAAiF,CACJ,EAAMR,GAAiBO,CAAU,EAC/B,IAAI1kB,GAAK2kB,EAAIrO,GAAMvZ,EAAK,KAAK,EAAIA,EAAK,OAAS0iB,EAC3Cxe,GAAK0jB,EAAIrO,GAAMvZ,EAAK,MAAM,EAAIA,EAAK,QAAU2iB,EAIjD,OAAI,CAAC1f,GAAK,CAAC,OAAO,SAASA,CAAC,KAC1BA,EAAI,IAEF,CAACiB,GAAK,CAAC,OAAO,SAASA,CAAC,KAC1BA,EAAI,GAEC,CACL,EAAAjB,EACA,EAAAiB,CACJ,CACA,CAEA,MAAM2jB,GAAyBpO,GAAa,CAAC,EAC7C,SAASqO,GAAiBxf,EAAS,CACjC,MAAM6e,EAAM5B,EAAUjd,CAAO,EAC7B,MAAI,CAAC+d,GAAQ,GAAM,CAACc,EAAI,eACfU,GAEF,CACL,EAAGV,EAAI,eAAe,WACtB,EAAGA,EAAI,eAAe,SAC1B,CACA,CACA,SAASY,GAAuBzf,EAAS0f,EAASC,EAAsB,CAItE,OAHID,IAAY,SACdA,EAAU,IAER,CAACC,GAAwBD,GAAWC,IAAyB1C,EAAUjd,CAAO,EACzE,GAEF0f,CACT,CAEA,SAAS9F,GAAsB5Z,EAAS4f,EAAcC,EAAiBvK,EAAc,CAC/EsK,IAAiB,SACnBA,EAAe,IAEbC,IAAoB,SACtBA,EAAkB,IAEpB,MAAMC,EAAa9f,EAAQ,wBACrBqf,EAAaF,GAAcnf,CAAO,EACxC,IAAI+f,EAAQ5O,GAAa,CAAC,EACtByO,IACEtK,EACE8H,EAAU9H,CAAY,IACxByK,EAAQX,GAAS9J,CAAY,GAG/ByK,EAAQX,GAASpf,CAAO,GAG5B,MAAMggB,EAAgBP,GAAuBJ,EAAYQ,EAAiBvK,CAAY,EAAIkK,GAAiBH,CAAU,EAAIlO,GAAa,CAAC,EACvI,IAAIxW,GAAKmlB,EAAW,KAAOE,EAAc,GAAKD,EAAM,EAChDnkB,GAAKkkB,EAAW,IAAME,EAAc,GAAKD,EAAM,EAC/C3F,EAAQ0F,EAAW,MAAQC,EAAM,EACjC1F,EAASyF,EAAW,OAASC,EAAM,EACvC,GAAIV,EAAY,CACd,MAAMR,EAAM5B,EAAUoC,CAAU,EAC1BY,EAAY3K,GAAgB8H,EAAU9H,CAAY,EAAI2H,EAAU3H,CAAY,EAAIA,EACtF,IAAI4K,EAAgBrB,EAAI,aACxB,KAAOqB,GAAiB5K,GAAgB2K,IAAcpB,GAAK,CACzD,MAAMsB,EAAcf,GAASc,CAAa,EACpCE,EAAaF,EAAc,wBAC3BlC,EAAML,EAAiBuC,CAAa,EACpChG,EAAOkG,EAAW,MAAQF,EAAc,WAAa,WAAWlC,EAAI,WAAW,GAAKmC,EAAY,EAChGnG,EAAMoG,EAAW,KAAOF,EAAc,UAAY,WAAWlC,EAAI,UAAU,GAAKmC,EAAY,EAClGxlB,GAAKwlB,EAAY,EACjBvkB,GAAKukB,EAAY,EACjB/F,GAAS+F,EAAY,EACrB9F,GAAU8F,EAAY,EACtBxlB,GAAKuf,EACLte,GAAKoe,EACLkG,EAAgBjD,EAAUiD,CAAa,EAAE,YAC1C,CACF,CACD,OAAO1M,GAAiB,CACtB,MAAA4G,EACA,OAAAC,EACA,EAAA1f,EACA,EAAAiB,CACJ,CAAG,CACH,CAEA,SAASykB,GAAsD3M,EAAM,CACnE,GAAI,CACF,KAAAhc,EACA,aAAA4d,EACA,SAAAjB,CACD,EAAGX,EACJ,MAAM4M,EAA0BjD,EAAc/H,CAAY,EACpDiL,EAAkBpD,GAAmB7H,CAAY,EACvD,GAAIA,IAAiBiL,EACnB,OAAO7oB,EAET,IAAI8oB,EAAS,CACX,WAAY,EACZ,UAAW,CACf,EACMT,EAAQ5O,GAAa,CAAC,EAC1B,MAAMsP,EAAUtP,GAAa,CAAC,EAC9B,IAAImP,GAA2B,CAACA,GAA2BjM,IAAa,YAClE0I,GAAYzH,CAAY,IAAM,QAAUiI,GAAkBgD,CAAe,KAC3EC,EAASnC,GAAc/I,CAAY,GAEjC+H,EAAc/H,CAAY,GAAG,CAC/B,MAAMoL,EAAa9G,GAAsBtE,CAAY,EACrDyK,EAAQX,GAAS9J,CAAY,EAC7BmL,EAAQ,EAAIC,EAAW,EAAIpL,EAAa,WACxCmL,EAAQ,EAAIC,EAAW,EAAIpL,EAAa,SACzC,CAEH,MAAO,CACL,MAAO5d,EAAK,MAAQqoB,EAAM,EAC1B,OAAQroB,EAAK,OAASqoB,EAAM,EAC5B,EAAGroB,EAAK,EAAIqoB,EAAM,EAAIS,EAAO,WAAaT,EAAM,EAAIU,EAAQ,EAC5D,EAAG/oB,EAAK,EAAIqoB,EAAM,EAAIS,EAAO,UAAYT,EAAM,EAAIU,EAAQ,CAC/D,CACA,CAEA,SAASE,GAAe3gB,EAAS,CAC/B,OAAO,MAAM,KAAKA,EAAQ,eAAgB,CAAA,CAC5C,CAEA,SAAS4gB,GAAoB5gB,EAAS,CAGpC,OAAO4Z,GAAsBuD,GAAmBnd,CAAO,CAAC,EAAE,KAAOqe,GAAcre,CAAO,EAAE,UAC1F,CAIA,SAAS6gB,GAAgB7gB,EAAS,CAChC,MAAMpN,EAAOuqB,GAAmBnd,CAAO,EACjCwgB,EAASnC,GAAcre,CAAO,EAC9B8gB,EAAO9gB,EAAQ,cAAc,KAC7Boa,EAAQpJ,EAAIpe,EAAK,YAAaA,EAAK,YAAakuB,EAAK,YAAaA,EAAK,WAAW,EAClFzG,EAASrJ,EAAIpe,EAAK,aAAcA,EAAK,aAAckuB,EAAK,aAAcA,EAAK,YAAY,EAC7F,IAAInmB,EAAI,CAAC6lB,EAAO,WAAaI,GAAoB5gB,CAAO,EACxD,MAAMpE,EAAI,CAAC4kB,EAAO,UAClB,OAAI7C,EAAiBmD,CAAI,EAAE,YAAc,QACvCnmB,GAAKqW,EAAIpe,EAAK,YAAakuB,EAAK,WAAW,EAAI1G,GAE1C,CACL,MAAAA,EACA,OAAAC,EACA,EAAA1f,EACA,EAAAiB,CACJ,CACA,CAEA,SAASmlB,GAAgB/gB,EAASqU,EAAU,CAC1C,MAAMwK,EAAM5B,EAAUjd,CAAO,EACvBpN,EAAOuqB,GAAmBnd,CAAO,EACjCghB,EAAiBnC,EAAI,eAC3B,IAAIzE,EAAQxnB,EAAK,YACbynB,EAASznB,EAAK,aACd+H,EAAI,EACJiB,EAAI,EACR,GAAIolB,EAAgB,CAClB5G,EAAQ4G,EAAe,MACvB3G,EAAS2G,EAAe,OACxB,MAAMC,EAAsBlD,MACxB,CAACkD,GAAuBA,GAAuB5M,IAAa,WAC9D1Z,EAAIqmB,EAAe,WACnBplB,EAAIolB,EAAe,UAEtB,CACD,MAAO,CACL,MAAA5G,EACA,OAAAC,EACA,EAAA1f,EACA,EAAAiB,CACJ,CACA,CAGA,SAASslB,GAA2BlhB,EAASqU,EAAU,CACrD,MAAMyL,EAAalG,GAAsB5Z,EAAS,GAAMqU,IAAa,OAAO,EACtE2F,EAAM8F,EAAW,IAAM9f,EAAQ,UAC/Bka,EAAO4F,EAAW,KAAO9f,EAAQ,WACjC+f,EAAQ1C,EAAcrd,CAAO,EAAIof,GAASpf,CAAO,EAAImR,GAAa,CAAC,EACnEiJ,EAAQpa,EAAQ,YAAc+f,EAAM,EACpC1F,EAASra,EAAQ,aAAe+f,EAAM,EACtCplB,EAAIuf,EAAO6F,EAAM,EACjBnkB,EAAIoe,EAAM+F,EAAM,EACtB,MAAO,CACL,MAAA3F,EACA,OAAAC,EACA,EAAA1f,EACA,EAAAiB,CACJ,CACA,CACA,SAASulB,GAAkCnhB,EAASohB,EAAkB/M,EAAU,CAC9E,IAAI3c,EACJ,GAAI0pB,IAAqB,WACvB1pB,EAAOqpB,GAAgB/gB,EAASqU,CAAQ,UAC/B+M,IAAqB,WAC9B1pB,EAAOmpB,GAAgB1D,GAAmBnd,CAAO,CAAC,UACzCod,EAAUgE,CAAgB,EACnC1pB,EAAOwpB,GAA2BE,EAAkB/M,CAAQ,MACvD,CACL,MAAM2L,EAAgBR,GAAiBxf,CAAO,EAC9CtI,EAAO,CACL,GAAG0pB,EACH,EAAGA,EAAiB,EAAIpB,EAAc,EACtC,EAAGoB,EAAiB,EAAIpB,EAAc,CAC5C,CACG,CACD,OAAOxM,GAAiB9b,CAAI,CAC9B,CACA,SAAS2pB,GAAyBrhB,EAASshB,EAAU,CACnD,MAAM/C,EAAaJ,GAAcne,CAAO,EACxC,OAAIue,IAAe+C,GAAY,CAAClE,EAAUmB,CAAU,GAAKH,GAAsBG,CAAU,EAChF,GAEFZ,EAAiBY,CAAU,EAAE,WAAa,SAAW8C,GAAyB9C,EAAY+C,CAAQ,CAC3G,CAKA,SAASC,GAA4BvhB,EAASwhB,EAAO,CACnD,MAAMC,EAAeD,EAAM,IAAIxhB,CAAO,EACtC,GAAIyhB,EACF,OAAOA,EAET,IAAI/yB,EAAS8vB,GAAqBxe,EAAS,CAAA,EAAI,EAAK,EAAE,OAAOH,GAAMud,EAAUvd,CAAE,GAAKkd,GAAYld,CAAE,IAAM,MAAM,EAC1G6hB,EAAsC,KAC1C,MAAMC,EAAiBhE,EAAiB3d,CAAO,EAAE,WAAa,QAC9D,IAAIke,EAAcyD,EAAiBxD,GAAcne,CAAO,EAAIA,EAG5D,KAAOod,EAAUc,CAAW,GAAK,CAACE,GAAsBF,CAAW,GAAG,CACpE,MAAM0D,EAAgBjE,EAAiBO,CAAW,EAC5C2D,EAA0BhE,GAAkBK,CAAW,EACzD,CAAC2D,GAA2BD,EAAc,WAAa,UACzDF,EAAsC,OAEVC,EAAiB,CAACE,GAA2B,CAACH,EAAsC,CAACG,GAA2BD,EAAc,WAAa,UAAY,CAAC,CAACF,GAAuC,CAAC,WAAY,OAAO,EAAE,SAASA,EAAoC,QAAQ,GAAKnE,GAAkBW,CAAW,GAAK,CAAC2D,GAA2BR,GAAyBrhB,EAASke,CAAW,GAGvZxvB,EAASA,EAAO,OAAO+K,GAAYA,IAAaykB,CAAW,EAG3DwD,EAAsCE,EAExC1D,EAAcC,GAAcD,CAAW,CACxC,CACD,OAAAsD,EAAM,IAAIxhB,EAAStR,CAAM,EAClBA,CACT,CAIA,SAASozB,GAAgBpO,EAAM,CAC7B,GAAI,CACF,QAAA1T,EACA,SAAAgV,EACA,aAAAC,EACA,SAAAZ,CACD,EAAGX,EAEJ,MAAMqO,EAAoB,CAAC,GADM/M,IAAa,oBAAsBuM,GAA4BvhB,EAAS,KAAK,EAAE,EAAI,CAAA,EAAG,OAAOgV,CAAQ,EAC9EC,CAAY,EAC9D+M,EAAwBD,EAAkB,CAAC,EAC3CE,EAAeF,EAAkB,OAAO,CAACG,EAASd,IAAqB,CAC3E,MAAM1pB,EAAOypB,GAAkCnhB,EAASohB,EAAkB/M,CAAQ,EAClF,OAAA6N,EAAQ,IAAMlR,EAAItZ,EAAK,IAAKwqB,EAAQ,GAAG,EACvCA,EAAQ,MAAQnR,EAAIrZ,EAAK,MAAOwqB,EAAQ,KAAK,EAC7CA,EAAQ,OAASnR,EAAIrZ,EAAK,OAAQwqB,EAAQ,MAAM,EAChDA,EAAQ,KAAOlR,EAAItZ,EAAK,KAAMwqB,EAAQ,IAAI,EACnCA,CACR,EAAEf,GAAkCnhB,EAASgiB,EAAuB3N,CAAQ,CAAC,EAC9E,MAAO,CACL,MAAO4N,EAAa,MAAQA,EAAa,KACzC,OAAQA,EAAa,OAASA,EAAa,IAC3C,EAAGA,EAAa,KAChB,EAAGA,EAAa,GACpB,CACA,CAEA,SAASE,GAAcniB,EAAS,CAC9B,KAAM,CACJ,MAAAoa,EACA,OAAAC,CACJ,EAAMyE,GAAiB9e,CAAO,EAC5B,MAAO,CACL,MAAAoa,EACA,OAAAC,CACJ,CACA,CAEA,SAAS+H,GAA8BpiB,EAASsV,EAAcjB,EAAU,CACtE,MAAMiM,EAA0BjD,EAAc/H,CAAY,EACpDiL,EAAkBpD,GAAmB7H,CAAY,EACjDoK,EAAUrL,IAAa,QACvB3c,EAAOkiB,GAAsB5Z,EAAS,GAAM0f,EAASpK,CAAY,EACvE,IAAIkL,EAAS,CACX,WAAY,EACZ,UAAW,CACf,EACE,MAAMC,EAAUtP,GAAa,CAAC,EAC9B,GAAImP,GAA2B,CAACA,GAA2B,CAACZ,EAI1D,IAHI3C,GAAYzH,CAAY,IAAM,QAAUiI,GAAkBgD,CAAe,KAC3EC,EAASnC,GAAc/I,CAAY,GAEjCgL,EAAyB,CAC3B,MAAMI,EAAa9G,GAAsBtE,EAAc,GAAMoK,EAASpK,CAAY,EAClFmL,EAAQ,EAAIC,EAAW,EAAIpL,EAAa,WACxCmL,EAAQ,EAAIC,EAAW,EAAIpL,EAAa,SACzC,MAAUiL,IACTE,EAAQ,EAAIG,GAAoBL,CAAe,GAGnD,MAAO,CACL,EAAG7oB,EAAK,KAAO8oB,EAAO,WAAaC,EAAQ,EAC3C,EAAG/oB,EAAK,IAAM8oB,EAAO,UAAYC,EAAQ,EACzC,MAAO/oB,EAAK,MACZ,OAAQA,EAAK,MACjB,CACA,CAEA,SAAS2qB,GAAoBriB,EAASsiB,EAAU,CAC9C,MAAI,CAACjF,EAAcrd,CAAO,GAAK2d,EAAiB3d,CAAO,EAAE,WAAa,QAC7D,KAELsiB,EACKA,EAAStiB,CAAO,EAElBA,EAAQ,YACjB,CAIA,SAASuiB,GAAgBviB,EAASsiB,EAAU,CAC1C,MAAME,EAASvF,EAAUjd,CAAO,EAChC,GAAI,CAACqd,EAAcrd,CAAO,EACxB,OAAOwiB,EAET,IAAIlN,EAAe+M,GAAoBriB,EAASsiB,CAAQ,EACxD,KAAOhN,GAAgBsI,GAAetI,CAAY,GAAKqI,EAAiBrI,CAAY,EAAE,WAAa,UACjGA,EAAe+M,GAAoB/M,EAAcgN,CAAQ,EAE3D,OAAIhN,IAAiByH,GAAYzH,CAAY,IAAM,QAAUyH,GAAYzH,CAAY,IAAM,QAAUqI,EAAiBrI,CAAY,EAAE,WAAa,UAAY,CAACuI,GAAkBvI,CAAY,GACnLkN,EAEFlN,GAAgB2I,GAAmBje,CAAO,GAAKwiB,CACxD,CAEA,MAAMC,GAAkB,eAAgB/O,EAAM,CAC5C,GAAI,CACF,UAAAC,EACA,SAAAC,EACA,SAAAS,CACD,EAAGX,EACJ,MAAMgP,EAAoB,KAAK,iBAAmBH,GAC5CI,EAAkB,KAAK,cAC7B,MAAO,CACL,UAAWP,GAA8BzO,EAAW,MAAM+O,EAAkB9O,CAAQ,EAAGS,CAAQ,EAC/F,SAAU,CACR,EAAG,EACH,EAAG,EACH,GAAI,MAAMsO,EAAgB/O,CAAQ,CACnC,CACL,CACA,EAEA,SAASgP,GAAM5iB,EAAS,CACtB,OAAO2d,EAAiB3d,CAAO,EAAE,YAAc,KACjD,CAEK,MAACsU,GAAW,CACf,sDAAA+L,GACA,mBAAAlD,GACA,gBAAA2E,GACA,gBAAAS,GACA,gBAAAE,GACA,eAAA9B,GACA,cAAAwB,GACA,SAAA/C,GACA,UAAAhC,EACA,MAAAwF,EACF,EAGA,SAASC,GAAY7iB,EAAS8iB,EAAQ,CACpC,IAAIC,EAAK,KACLC,EACJ,MAAMljB,EAAOqd,GAAmBnd,CAAO,EACvC,SAASijB,GAAU,CACjB,aAAaD,CAAS,EACtBD,GAAMA,EAAG,aACTA,EAAK,IACN,CACD,SAASG,EAAQC,EAAMC,EAAW,CAC5BD,IAAS,SACXA,EAAO,IAELC,IAAc,SAChBA,EAAY,GAEdH,IACA,KAAM,CACJ,KAAA/I,EACA,IAAAF,EACA,MAAAI,EACA,OAAAC,CACN,EAAQra,EAAQ,wBAIZ,GAHKmjB,GACHL,IAEE,CAAC1I,GAAS,CAACC,EACb,OAEF,MAAMgJ,EAAWnS,GAAM8I,CAAG,EACpBsJ,EAAapS,GAAMpR,EAAK,aAAeoa,EAAOE,EAAM,EACpDmJ,EAAcrS,GAAMpR,EAAK,cAAgBka,EAAMK,EAAO,EACtDmJ,EAAYtS,GAAMgJ,CAAI,EAEtB9hB,EAAU,CACd,WAFiB,CAACirB,EAAW,MAAQ,CAACC,EAAa,MAAQ,CAACC,EAAc,MAAQ,CAACC,EAAY,KAG/F,UAAWxS,EAAI,EAAGD,EAAI,EAAGqS,CAAS,CAAC,GAAK,CAC9C,EACI,IAAIK,EAAgB,GACpB,SAASC,EAAcC,EAAS,CAC9B,MAAMC,EAAQD,EAAQ,CAAC,EAAE,kBACzB,GAAIC,IAAUR,EAAW,CACvB,GAAI,CAACK,EACH,OAAOP,EAAO,EAEXU,EAKHV,EAAQ,GAAOU,CAAK,EAJpBZ,EAAY,WAAW,IAAM,CAC3BE,EAAQ,GAAO,IAAI,CACpB,EAAE,GAAG,CAIT,CACDO,EAAgB,EACjB,CAID,GAAI,CACFV,EAAK,IAAI,qBAAqBW,EAAe,CAC3C,GAAGtrB,EAEH,KAAM0H,EAAK,aACnB,CAAO,CACF,MAAW,CACVijB,EAAK,IAAI,qBAAqBW,EAAetrB,CAAO,CACrD,CACD2qB,EAAG,QAAQ/iB,CAAO,CACnB,CACD,OAAAkjB,EAAQ,EAAI,EACLD,CACT,CAUA,SAASY,GAAWlQ,EAAWC,EAAUkQ,EAAQ1rB,EAAS,CACpDA,IAAY,SACdA,EAAU,CAAA,GAEZ,KAAM,CACJ,eAAA2rB,EAAiB,GACjB,eAAAC,EAAiB,GACjB,cAAAC,EAAgB,OAAO,gBAAmB,WAC1C,YAAAC,EAAc,OAAO,sBAAyB,WAC9C,eAAAC,EAAiB,EAClB,EAAG/rB,EACEgsB,EAAcjF,GAAcxL,CAAS,EACrC0Q,EAAYN,GAAkBC,EAAiB,CAAC,GAAII,EAAc5F,GAAqB4F,CAAW,EAAI,CAAE,EAAG,GAAG5F,GAAqB5K,CAAQ,CAAC,EAAI,CAAA,EACtJyQ,EAAU,QAAQ5qB,GAAY,CAC5BsqB,GAAkBtqB,EAAS,iBAAiB,SAAUqqB,EAAQ,CAC5D,QAAS,EACf,CAAK,EACDE,GAAkBvqB,EAAS,iBAAiB,SAAUqqB,CAAM,CAChE,CAAG,EACD,MAAMQ,EAAYF,GAAeF,EAAcrB,GAAYuB,EAAaN,CAAM,EAAI,KAClF,IAAIS,EAAiB,GACjBC,EAAiB,KACjBP,IACFO,EAAiB,IAAI,eAAe9Q,GAAQ,CAC1C,GAAI,CAAC+Q,CAAU,EAAI/Q,EACf+Q,GAAcA,EAAW,SAAWL,GAAeI,IAGrDA,EAAe,UAAU5Q,CAAQ,EACjC,qBAAqB2Q,CAAc,EACnCA,EAAiB,sBAAsB,IAAM,CAC3CC,GAAkBA,EAAe,QAAQ5Q,CAAQ,CAC3D,CAAS,GAEHkQ,GACN,CAAK,EACGM,GAAe,CAACD,GAClBK,EAAe,QAAQJ,CAAW,EAEpCI,EAAe,QAAQ5Q,CAAQ,GAEjC,IAAI8Q,EACAC,EAAcR,EAAiBvK,GAAsBjG,CAAS,EAAI,KAClEwQ,GACFS,IAEF,SAASA,GAAY,CACnB,MAAMC,EAAcjL,GAAsBjG,CAAS,EAC/CgR,IAAgBE,EAAY,IAAMF,EAAY,GAAKE,EAAY,IAAMF,EAAY,GAAKE,EAAY,QAAUF,EAAY,OAASE,EAAY,SAAWF,EAAY,SACtKb,IAEFa,EAAcE,EACdH,EAAU,sBAAsBE,CAAS,CAC1C,CACD,OAAAd,IACO,IAAM,CACXO,EAAU,QAAQ5qB,GAAY,CAC5BsqB,GAAkBtqB,EAAS,oBAAoB,SAAUqqB,CAAM,EAC/DE,GAAkBvqB,EAAS,oBAAoB,SAAUqqB,CAAM,CACrE,CAAK,EACDQ,GAAaA,EAAS,EACtBE,GAAkBA,EAAe,aACjCA,EAAiB,KACbL,GACF,qBAAqBO,CAAO,CAElC,CACA,CAQK,MAAC5N,GAAgBgO,GAOhB/uB,GAAQgvB,GAQRjN,GAAOkN,GAQPhJ,GAAOiJ,GAcPxP,GAAQyP,GAOR1L,GAAS2L,GAKT3J,GAAa4J,GAMbhR,GAAkB,CAACT,EAAWC,EAAUxb,IAAY,CAIxD,MAAMopB,EAAQ,IAAI,IACZ6D,EAAgB,CACpB,SAAA/Q,GACA,GAAGlc,CACP,EACQktB,EAAoB,CACxB,GAAGD,EAAc,SACjB,GAAI7D,CACR,EACE,OAAO+D,GAAkB5R,EAAWC,EAAU,CAC5C,GAAGyR,EACH,SAAUC,CACd,CAAG,CACH,ECnpBA;AAAA;AAAA;AAAA;AAAA,GAIQ,MAAC3mB,GAAEhC,GAAE,cAAc3O,EAAC,CAAC,YAAY0Q,EAAE,CAAC,GAAG,MAAMA,CAAC,EAAEA,EAAE,OAAOI,GAAE,WAAqBJ,EAAE,OAAZ,SAAkBA,EAAE,SAAS,OAAO,EAAE,MAAM,MAAM,oGAAoG,CAAC,CAAC,OAAOA,EAAE,CAAC,MAAM,IAAI,OAAO,KAAKA,CAAC,EAAE,OAAQ/B,GAAG+B,EAAE/B,CAAC,CAAG,EAAC,KAAK,GAAG,EAAE,GAAG,CAAC,OAAO,EAAE,CAAC3O,CAAC,EAAE,CAAC,GAAY,KAAK,KAAd,OAAiB,CAAC,KAAK,GAAG,IAAI,IAAa,EAAE,UAAX,SAAqB,KAAK,GAAG,IAAI,IAAI,EAAE,QAAQ,KAAK,GAAG,EAAE,MAAM,IAAI,EAAE,OAAQ0Q,GAAQA,IAAL,GAAQ,GAAG,UAAUA,KAAK1Q,EAAEA,EAAE0Q,CAAC,GAAG,CAAC,KAAK,IAAI,IAAIA,CAAC,GAAG,KAAK,GAAG,IAAIA,CAAC,EAAE,OAAO,KAAK,OAAO1Q,CAAC,CAAC,CAAC,MAAM8Q,EAAE,EAAE,QAAQ,UAAU,UAAUJ,KAAK,KAAK,GAAGA,KAAK1Q,IAAI8Q,EAAE,OAAOJ,CAAC,EAAE,KAAK,GAAG,OAAOA,CAAC,GAAG,UAAUA,KAAK1Q,EAAE,CAAC,MAAM2O,EAAE,CAAC,CAAC3O,EAAE0Q,CAAC,EAAE/B,IAAI,KAAK,GAAG,IAAI+B,CAAC,GAAG,KAAK,IAAI,IAAIA,CAAC,IAAI/B,GAAGmC,EAAE,IAAIJ,CAAC,EAAE,KAAK,GAAG,IAAIA,CAAC,IAAII,EAAE,OAAOJ,CAAC,EAAE,KAAK,GAAG,OAAOA,CAAC,GAAG,CAAC,OAAOA,EAAC,CAAC,CAAC,ECJ9uB;AAAA;AAAA;AAAA;AAAA,GAIQ,MAACE,GAAEA,GAAGA,GAAGF,ECJjB;AAAA;AAAA;AAAA;AAAA,GAIG,MAAM/B,GAAE,CAAC3O,EAAE0Q,IAAI,CAAC,MAAMC,EAAE3Q,EAAE,KAAK,GAAY2Q,IAAT,OAAW,MAAM,GAAG,UAAU3Q,KAAK2Q,EAAE3Q,EAAE,OAAO0Q,EAAE,EAAE,EAAE/B,GAAE3O,EAAE0Q,CAAC,EAAE,MAAM,EAAE,EAAEE,GAAE5Q,GAAG,CAAC,IAAI0Q,EAAEC,EAAE,EAAE,CAAC,IAAaD,EAAE1Q,EAAE,QAAd,OAAoB,MAAM2Q,EAAED,EAAE,KAAKC,EAAE,OAAO3Q,CAAC,EAAEA,EAAE0Q,CAAC,OAAWC,GAAG,OAAP,EAAY,EAAEG,GAAE9Q,GAAG,CAAC,QAAQ0Q,EAAEA,EAAE1Q,EAAE,KAAKA,EAAE0Q,EAAE,CAAC,IAAIC,EAAED,EAAE,KAAK,GAAYC,IAAT,OAAWD,EAAE,KAAKC,EAAE,IAAI,YAAYA,EAAE,IAAI3Q,CAAC,EAAE,MAAM2Q,EAAE,IAAI3Q,CAAC,EAAEW,GAAE+P,CAAC,CAAC,CAAC,EAAE,SAASO,GAAEjR,EAAE,CAAU,KAAK,OAAd,QAAoB4Q,GAAE,IAAI,EAAE,KAAK,KAAK5Q,EAAE8Q,GAAE,IAAI,GAAG,KAAK,KAAK9Q,CAAC,CAAC,SAAS+Q,GAAE/Q,EAAE0Q,EAAE,GAAGC,EAAE,EAAE,CAAC,MAAMG,EAAE,KAAK,KAAKG,EAAE,KAAK,KAAK,GAAYA,IAAT,QAAgBA,EAAE,OAAN,EAAW,GAAGP,EAAE,GAAG,MAAM,QAAQI,CAAC,EAAE,QAAQ9Q,EAAE2Q,EAAE3Q,EAAE8Q,EAAE,OAAO9Q,IAAI2O,GAAEmC,EAAE9Q,CAAC,EAAE,EAAE,EAAE4Q,GAAEE,EAAE9Q,CAAC,CAAC,OAAa8Q,GAAN,OAAUnC,GAAEmC,EAAE,EAAE,EAAEF,GAAEE,CAAC,QAAQnC,GAAE,KAAK3O,CAAC,CAAC,CAAC,MAAMW,GAAEX,GAAG,CAACA,EAAE,MAAM2Q,GAAE,QAAQ3Q,EAAE,OAAO+Q,GAAE/Q,EAAE,OAAOiR,GAAE,EAAE,MAAMxR,WAAUiR,EAAC,CAAC,aAAa,CAAC,MAAM,GAAG,SAAS,EAAE,KAAK,KAAK,MAAM,CAAC,KAAK1Q,EAAE,EAAE2Q,EAAE,CAAC,MAAM,KAAK3Q,EAAE,EAAE2Q,CAAC,EAAEG,GAAE,IAAI,EAAE,KAAK,YAAY9Q,EAAE,IAAI,CAAC,KAAKA,EAAE,EAAE,GAAG,CAACA,IAAI,KAAK,cAAc,KAAK,YAAYA,EAAEA,EAAE,KAAK,cAAW,EAAK,KAAK,eAAgB,GAAE,IAAI2O,GAAE,KAAK3O,CAAC,EAAE4Q,GAAE,IAAI,EAAE,CAAC,SAASF,EAAE,CAAC,GAAG1Q,GAAE,KAAK,IAAI,EAAE,KAAK,KAAK,KAAK0Q,EAAE,IAAI,MAAM,CAAC,MAAM1Q,EAAE,CAAC,GAAG,KAAK,KAAK,IAAI,EAAEA,EAAE,KAAK,IAAI,EAAE0Q,EAAE,KAAK,KAAK,KAAK1Q,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,cAAc,CAAE,CAAA,aAAa,CAAE,CAAA,CCJphC;AAAA;AAAA;AAAA;AAAA,GAIQ,MAAC2Q,GAAE,IAAI,IAAIM,GAAE,MAAMA,EAAC,CAAA,CAAO,MAACL,GAAE,IAAI,QAAQG,GAAEpC,GAAE,cAAc3O,EAAC,CAAC,OAAOA,EAAE,CAAC,OAAO0Q,CAAC,CAAC,OAAO1Q,EAAE,CAAC2O,CAAC,EAAE,CAAC,MAAMgC,EAAEhC,IAAI,KAAK,EAAE,OAAOgC,GAAY,KAAK,IAAd,QAAiB,KAAK,GAAG,MAAM,GAAGA,GAAG,KAAK,KAAK,KAAK,MAAM,KAAK,EAAEhC,EAAE,KAAK,GAAG3O,EAAE,SAAS,KAAK,KAAK,GAAG,KAAK,GAAGA,EAAE,OAAO,GAAG0Q,CAAC,CAAC,GAAGA,EAAE,CAAC,GAAe,OAAO,KAAK,GAAxB,WAA0B,CAAC,MAAM1Q,EAAE,KAAK,IAAI,WAAW,IAAI2O,EAAEiC,GAAE,IAAI5Q,CAAC,EAAW2O,IAAT,SAAaA,EAAE,IAAI,QAAQiC,GAAE,IAAI5Q,EAAE2O,CAAC,GAAYA,EAAE,IAAI,KAAK,CAAC,IAArB,QAAwB,KAAK,EAAE,KAAK,KAAK,GAAG,MAAM,EAAEA,EAAE,IAAI,KAAK,EAAE+B,CAAC,EAAWA,IAAT,QAAY,KAAK,EAAE,KAAK,KAAK,GAAGA,CAAC,CAAC,MAAM,KAAK,EAAE,MAAMA,CAAC,CAAC,IAAI,IAAI,CAAC,OAAkB,OAAO,KAAK,GAAxB,WAA0BE,GAAE,IAAI,KAAK,IAAI,UAAU,GAAG,IAAI,KAAK,CAAC,EAAE,KAAK,GAAG,KAAK,CAAC,cAAc,CAAC,KAAK,KAAK,KAAK,IAAI,KAAK,GAAG,MAAM,CAAC,CAAC,aAAa,CAAC,KAAK,GAAG,KAAK,EAAE,CAAC,CAAC,CAAC","x_google_ignoreList":[0,8,26,27,28,29,30,31,32,33,34,35,36,56,57,64,72,73,74,75,76,77,78,79]}